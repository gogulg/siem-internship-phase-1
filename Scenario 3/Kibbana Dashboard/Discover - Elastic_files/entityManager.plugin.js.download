/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */(()=>{var e={525:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ERROR_API_KEY_NOT_FOUND:()=>E,ERROR_API_KEY_NOT_VALID:()=>g,ERROR_API_KEY_SERVICE_DISABLED:()=>m,ERROR_DEFINITION_STOPPED:()=>_,ERROR_PARTIAL_BUILTIN_INSTALLATION:()=>b,EntityClient:()=>EntityClient,EntityManagerUnauthorizedError:()=>EntityManagerUnauthorizedError,plugin:()=>w});var n=r(915);const i=["delete","get","patch","post","put"];const o=__kbnSharedDeps__.Rxjs;var a=Object.defineProperty,s=(e,t,r)=>((e,t,r)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class ParseError extends Error{constructor(e,t){super(e),s(this,"type"),s(this,"field"),s(this,"value"),s(this,"line"),this.name="ParseError",this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}}function l(e){}const d=__kbnSharedDeps__.KbnI18n;let c=function(e){return e.error="error",e.data="data",e}({}),u=function(e){return e.internalError="internalError",e.requestError="requestError",e}({});class ServerSentEventError extends Error{constructor(e,t,r){super(t),this.code=e,this.meta=r}toJSON(){return{type:c.error,error:{code:this.code,message:this.message,meta:this.meta}}}}function p(e=d.i18n.translate("sse.internalError",{defaultMessage:"An internal error occurred"})){return new ServerSentEventError(u.internalError,e,{})}function h(){return(0,o.switchMap)((e=>function(e){const t=e.response,r=null==t?void 0:t.body;return r?new o.Observable((e=>{const t=function(e){const{onEvent:t=l,onError:r=l,onRetry:n=l,onComment:i}=e;let o,a="",s=!0,d="",c="";function u(e){if(""===e)return d.length>0&&t({id:o,event:c||void 0,data:d.endsWith("\n")?d.slice(0,-1):d}),o=void 0,d="",void(c="");if(e.startsWith(":"))return void(i&&i(e.slice(e.startsWith(": ")?2:1)));const r=e.indexOf(":");if(-1===r)p(e,"",e);else{const t=e.slice(0,r),n=" "===e[r+1]?2:1;p(t,e.slice(r+n),e)}}function p(e,t,i){switch(e){case"event":c=t;break;case"data":d=`${d}${t}\n`;break;case"id":o=t.includes("\0")?void 0:t;break;case"retry":/^\d+$/.test(t)?n(parseInt(t,10)):r(new ParseError(`Invalid \`retry\` value: "${t}"`,{type:"invalid-retry",value:t,line:i}));break;default:r(new ParseError(`Unknown field "${e.length>20?`${e.slice(0,20)}â€¦`:e}"`,{type:"unknown-field",field:e,value:t,line:i}))}}return{feed:function(e){const t=s?e.replace(/^\xEF\xBB\xBF/,""):e,[r,n]=function(e){const t=[];let r="";const n=e.length;for(let i=0;i<n;i++){const n=e[i];"\r"===n&&"\n"===e[i+1]?(t.push(r),r="",i++):"\r"===n||"\n"===n?(t.push(r),r=""):r+=n}return[t,r]}(`${a}${t}`);for(const e of r)u(e);a=n,s=!1},reset:function(e={}){a&&e.consume&&u(a),o=void 0,d="",c="",a=""}}}({onEvent:t=>{try{const r=JSON.parse(t.data);if("error"===t.event){const t=r;e.error(new ServerSentEventError(t.error.code,t.error.message,t.error.meta))}else e.next({type:t.event||"event",...r})}catch(t){e.error(p("Failed to parse JSON"))}}});(async()=>{const e=r.getReader(),n=new TextDecoder,i=({done:r,value:o})=>r?Promise.resolve():(t.feed(n.decode(o,{stream:!0})),e.read().then(i));return e.read().then(i)})().then((()=>{e.complete()})).catch((t=>{e.error(t)}))})):(0,o.throwError)((()=>{throw p("No readable stream found in response")}))}(e)))}const y=__kbnSharedDeps__.Lodash;function v(e){return function(e){return e instanceof Error&&"request"in e&&"name"in e}(e)}const f=__kbnSharedDeps__.KbnEsQuery;class EntityManagerUnauthorizedError extends Error{constructor(e){super(e)}}class EntityClient{constructor(e){(0,n.default)(this,"repositoryClient",void 0),this.repositoryClient=function(e){const t=(t,r,n)=>{const{method:o,pathname:a,version:s}=function(e,t={}){var r,n,o;const{method:a,pathname:s,version:l}=function(e){var t;const r=e.split(" "),n=r[0].trim().toLowerCase(),o=r[1].trim(),a=null===(t=r[2])||void 0===t?void 0:t.trim();if(!i.includes(n))throw new Error(`Endpoint ${e} was not prefixed with a valid HTTP method`);return{method:n,pathname:o,version:a}}(e),d=/(\/\{\w+\?\})/g,c=/(\/{)((.+?))(\})/g;if(0===(null===(r=Object.keys(t))||void 0===r?void 0:r.length))return{method:a,pathname:s.replace(c,""),version:l};const u=Object.keys(t).reduce(((e,r)=>e.replace(`{${r}}`,encodeURIComponent(t[r])).replace(`{${r}?}`,encodeURIComponent(t[r]))),s);if((null===(n=null!==(o=u.match(d))&&void 0!==o?o:[])||void 0===n?void 0:n.length)>0)throw new Error(`Missing parameters: ${u.match(d)}`);return{method:a,pathname:u,version:l}}(t,null==r?void 0:r.path);return e.http[o](a,{...n,body:r&&r.body?JSON.stringify(r.body):void 0,query:null==r?void 0:r.query,version:s})};return{fetch:(e,...r)=>{var n;const i=null!==(n=r[0])&&void 0!==n?n:{},o="params"in i?i.params:{},a=(0,y.omit)(i,"params");return t(e,o,a)},stream:(e,...r)=>{var n;const i=null!==(n=r[0])&&void 0!==n?n:{},a="params"in i?i.params:{},s=(0,y.omit)(i,"params");return(0,o.from)(t(e,a,{...s,asResponse:!0,rawResponse:!0})).pipe(h())}}}(e).fetch}async isManagedEntityDiscoveryEnabled(){return await this.repositoryClient("GET /internal/entities/managed/enablement")}async enableManagedEntityDiscovery(e){try{return await this.repositoryClient("PUT /internal/entities/managed/enablement",{params:{query:{installOnly:null==e?void 0:e.installOnly}}})}catch(e){var t;if(v(e)&&403===(null===(t=e.body)||void 0===t?void 0:t.statusCode))throw new EntityManagerUnauthorizedError(e.body.message);throw e}}async disableManagedEntityDiscovery(e){try{return await this.repositoryClient("DELETE /internal/entities/managed/enablement",{params:{query:{deleteData:null==e?void 0:e.deleteData}}})}catch(e){var t;if(v(e)&&403===(null===(t=e.body)||void 0===t?void 0:t.statusCode))throw new EntityManagerUnauthorizedError(e.body.message);throw e}}async getEntityDefinition(e){try{return await this.repositoryClient("GET /internal/entities/definition/{id?}",{params:{path:{id:e},query:{page:1,perPage:1}}})}catch(e){var t;if(v(e)&&403===(null===(t=e.body)||void 0===t?void 0:t.statusCode))throw new EntityManagerUnauthorizedError(e.body.message);throw e}}asKqlFilter({entity:e}){const t=this.getIdentityFieldsValue({entity:e}),r=Object.entries(t).map((([e,t])=>f.nodeTypes.function.buildNode("is",e,`"${t}"`)));if(0===r.length)return"";const n=r.length>1?f.nodeTypes.function.buildNode("and",r):r[0];return(0,f.toKqlExpression)(n)}getIdentityFieldsValue({entity:e}){const{entityIdentityFields:t}=e;if(!Object.keys(t||{}).length)throw new Error("Identity fields are missing");return Object.values(t).reduce(((t,r)=>(r.forEach((r=>{null!=e&&e[r]&&(t[r]=e[r])})),t)),{})}}class Plugin{constructor(e){(0,n.default)(this,"config",void 0),(0,n.default)(this,"logger",void 0),this.config=e.config.get(),this.logger=e.logger.get()}setup(e){return{entityClient:new EntityClient(e)}}start(e){return{entityClient:new EntityClient(e)}}stop(){}}const E="api_key_not_found",g="api_key_not_valid",m="api_key_service_disabled",b="partial_builtin_installation",_="error_definition_stopped",w=e=>new Plugin(e)},389:(e,t,r)=>{r.p=window.__kbnPublicPath__.entityManager},915:(e,t,r)=>{e.exports=r(497)(67493)},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=n[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),r(389),__kbnBundles__.define("plugin/entityManager/public",r,525)})();