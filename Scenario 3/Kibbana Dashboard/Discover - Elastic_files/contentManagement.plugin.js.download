(()=>{var e={379:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ContentClient:()=>ContentClient,ContentClientProvider:()=>g,plugin:()=>m,useContentClient:()=>h,useCreateContentMutation:()=>f,useDeleteContentMutation:()=>b,useGetContentQuery:()=>v,useSearchContentQuery:()=>C,useUpdateContentMutation:()=>T});var r=n(915);const i=__kbnSharedDeps__.ReactQuery,s=e=>{if("string"==typeof e){if(/^\d+$/.test(e)){const t=parseInt(e,10);return Number.isNaN(t)?{result:!1,value:null}:{result:!0,value:t}}return{result:!1,value:null}}return Number.isInteger(e)?{result:!0,value:e}:{result:!1,value:null}},o=__kbnSharedDeps__.Rxjs,u=(e,t)=>{const n=new i.QueryObserver(e,e.defaultQueryOptions(t));return new o.Observable((e=>{const t=n.subscribe(i.notifyManager.batchCalls((t=>{e.next(t)})));return()=>{t()}}))},a={all:e=>[e],item:(e,t)=>[...a.all(e),t],search:(e,t,n)=>[...a.all(e),"search",t,n]},l=(e,t)=>{var n;const r=t.get(e.contentTypeId);if(!r)throw new Error(`Unknown content type [${e.contentTypeId}]`);const i=null!==(n=e.version)&&void 0!==n?n:r.version.latest,{result:o,value:u}=s(i);if(!o)throw new Error(`Invalid version [${i}]. Must be an integer.`);if(u>r.version.latest)throw new Error(`Invalid version [${i}]. Latest version is [${r.version.latest}]`);return{...e,version:i}};class ContentClient{constructor(e,t){(0,r.default)(this,"queryClient",void 0),(0,r.default)(this,"queryOptionBuilder",void 0),this.crudClientProvider=e,this.contentTypeRegistry=t,this.queryClient=new i.QueryClient({defaultOptions:{queries:{networkMode:"always"}}}),this.queryOptionBuilder=(({crudClientProvider:e,contentTypeRegistry:t})=>({get:n=>{const r=l(n,t);return{queryKey:a.item(r.contentTypeId,r.id),queryFn:()=>e(r.contentTypeId).get(r)}},search:n=>{const r=l(n,t);return{queryKey:a.search(r.contentTypeId,r.query,r.options),queryFn:()=>e(r.contentTypeId).search(r)}}}))({crudClientProvider:this.crudClientProvider,contentTypeRegistry:this.contentTypeRegistry})}get(e){return this.queryClient.fetchQuery(this.queryOptionBuilder.get(e))}get$(e){return u(this.queryClient,this.queryOptionBuilder.get(e))}create(e){return this.crudClientProvider(e.contentTypeId).create(l(e,this.contentTypeRegistry))}update(e){return this.crudClientProvider(e.contentTypeId).update(l(e,this.contentTypeRegistry))}delete(e){return this.crudClientProvider(e.contentTypeId).delete(l(e,this.contentTypeRegistry))}search(e){return this.crudClientProvider(e.contentTypeId).search(l(e,this.contentTypeRegistry))}search$(e){return u(this.queryClient,this.queryOptionBuilder.search(l(e,this.contentTypeRegistry)))}mSearch(e){const t=this.crudClientProvider();if(!t.mSearch)throw new Error("mSearch is not supported by provided crud client");return t.mSearch({...e,contentTypes:e.contentTypes.map((e=>l(e,this.contentTypeRegistry)))})}}const c=__kbnSharedDeps__.React;var d=n.n(c);const y=__kbnSharedDeps__.EmotionReact,p=d().createContext(null),h=()=>{const e=d().useContext(p);if(!e)throw new Error("contentClient not found");return e},g=({contentClient:e,children:t})=>(0,y.jsx)(p.Provider,{value:e},(0,y.jsx)(i.QueryClientProvider,{client:e.queryClient},t)),v=(e,t)=>{const n=h();return(0,i.useQuery)({...n.queryOptionBuilder.get(e),...t})},C=(e,t)=>{const n=h();return(0,i.useQuery)({...n.queryOptionBuilder.search(e),...t})},f=()=>{const e=h();return(0,i.useMutation)({mutationFn:t=>e.create(t),onSuccess:(t,n)=>{e.queryClient.invalidateQueries({queryKey:a.all(n.contentTypeId)})}})},T=()=>{const e=h();return(0,i.useMutation)({mutationFn:t=>e.update(t),onSuccess:(t,n)=>{e.queryClient.invalidateQueries({queryKey:a.all(n.contentTypeId)})}})},b=()=>{const e=h();return(0,i.useMutation)({mutationFn:t=>e.delete(t),onSuccess:(t,n)=>{e.queryClient.invalidateQueries({queryKey:a.all(n.contentTypeId)})}})};class ContentType{constructor(e){this.definition=e}get id(){return this.definition.id}get name(){var e;return null!==(e=this.definition.name)&&void 0!==e?e:this.id}get description(){var e;return null!==(e=this.definition.description)&&void 0!==e?e:""}get icon(){var e;return null!==(e=this.definition.icon)&&void 0!==e?e:"questionInCircle"}get crud(){return this.definition.crud}get version(){return this.definition.version}}class ContentTypeRegistry{constructor(){(0,r.default)(this,"types",new Map)}register(e){var t;if(this.types.has(e.id))throw new Error(`Content type with id "${e.id}" already registered.`);const{result:n,value:r}=s(null===(t=e.version)||void 0===t?void 0:t.latest);var i;if(!n)throw new Error(`Invalid version [${null===(i=e.version)||void 0===i?void 0:i.latest}]. Must be an integer.`);if(r<1)throw new Error("Version must be >= 1");const o=new ContentType({...e,version:{...e.version,latest:r}});return this.types.set(o.id,o),o}get(e){return this.types.get(e)}getAll(){return Array.from(this.types.values())}}var w=n(721);class RpcClient{constructor(e){(0,r.default)(this,"sendMessage",(async(e,t)=>{try{return(await this.http.post(`/api/content_management/rpc/${e}`,{body:JSON.stringify(t)})).result}catch(e){throw w.log(`Content management client error: ${e.body.message}`),e}})),this.http=e}get(e){return this.sendMessage("get",e).then((e=>e.result))}bulkGet(e){return this.sendMessage("bulkGet",e).then((e=>e.result))}create(e){return this.sendMessage("create",e).then((e=>e.result))}update(e){return this.sendMessage("update",e).then((e=>e.result))}delete(e){return this.sendMessage("delete",e).then((e=>e.result))}search(e){return this.sendMessage("search",e).then((e=>e.result))}mSearch(e){return this.sendMessage("mSearch",e).then((e=>e.result))}}class ContentManagementPlugin{constructor(){(0,r.default)(this,"contentTypeRegistry",void 0),this.contentTypeRegistry=new ContentTypeRegistry}setup(){return{registry:{register:this.contentTypeRegistry.register.bind(this.contentTypeRegistry)}}}start(e,t){const n=new RpcClient(e.http);return{client:new ContentClient((e=>{var t,r;return e&&null!==(t=null===(r=this.contentTypeRegistry.get(e))||void 0===r?void 0:r.crud)&&void 0!==t?t:n}),this.contentTypeRegistry),registry:{get:this.contentTypeRegistry.get.bind(this.contentTypeRegistry),getAll:this.contentTypeRegistry.getAll.bind(this.contentTypeRegistry)}}}}function m(){return new ContentManagementPlugin}},4:(e,t,n)=>{n.p=window.__kbnPublicPath__.contentManagement},721:(e,t,n)=>{e.exports=n(497)(4971)},915:(e,t,n)=>{e.exports=n(497)(67493)},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var i=r.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=r[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n(4),__kbnBundles__.define("plugin/contentManagement/public",n,379)})();