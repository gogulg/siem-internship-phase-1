(()=>{var e,t={3789:(e,t,a)=>{"use strict";a.d(t,{j:()=>s});const s={META_FIELDS:"metaFields",DOC_HIGHLIGHT:"doc_table:highlight",QUERY_STRING_OPTIONS:"query:queryString:options",QUERY_ALLOW_LEADING_WILDCARDS:"query:allowLeadingWildcards",SEARCH_QUERY_LANGUAGE:"search:queryLanguage",SORT_OPTIONS:"sort:options",COURIER_IGNORE_FILTER_IF_FIELD_NOT_IN_INDEX:"courier:ignoreFilterIfFieldNotInIndex",COURIER_SET_REQUEST_PREFERENCE:"courier:setRequestPreference",COURIER_CUSTOM_REQUEST_PREFERENCE:"courier:customRequestPreference",COURIER_MAX_CONCURRENT_SHARD_REQUESTS:"courier:maxConcurrentShardRequests",SEARCH_INCLUDE_FROZEN:"search:includeFrozen",SEARCH_TIMEOUT:"search:timeout",HISTOGRAM_BAR_TARGET:"histogram:barTarget",HISTOGRAM_MAX_BARS:"histogram:maxBars",HISTORY_LIMIT:"history:limit",TIMEPICKER_REFRESH_INTERVAL_DEFAULTS:"timepicker:refreshIntervalDefaults",TIMEPICKER_QUICK_RANGES:"timepicker:quickRanges",TIMEPICKER_TIME_DEFAULTS:"timepicker:timeDefaults",FILTERS_PINNED_BY_DEFAULT:"filters:pinnedByDefault",FILTERS_EDITOR_SUGGEST_VALUES:"filterEditor:suggestValues",AUTOCOMPLETE_USE_TIMERANGE:"autocomplete:useTimeRange",AUTOCOMPLETE_VALUE_SUGGESTION_METHOD:"autocomplete:valueSuggestionMethod",DATE_FORMAT:"dateFormat",DATEFORMAT_TZ:"dateFormat:tz"}},8351:(e,t,a)=>{"use strict";a.d(t,{F:()=>r});var s=a(3789);function r(e){return{allowLeadingWildcards:e.get(s.j.QUERY_ALLOW_LEADING_WILDCARDS),queryStringOptions:e.get(s.j.QUERY_STRING_OPTIONS),ignoreFilterIfFieldNotInIndex:e.get(s.j.COURIER_IGNORE_FILTER_IF_FIELD_NOT_IN_INDEX),dateFormatTZ:e.get("dateFormat:tz")}}},3313:(e,t,a)=>{"use strict";a.d(t,{_c:()=>r,fM:()=>i,qZ:()=>KbnFieldType,s0:()=>g});var s=a(8915);let r=function(e){return e._ID="_id",e._INDEX="_index",e._SOURCE="_source",e._TYPE="_type",e.STRING="string",e.TEXT="text",e.MATCH_ONLY_TEXT="match_only_text",e.KEYWORD="keyword",e.VERSION="version",e.BOOLEAN="boolean",e.OBJECT="object",e.DATE="date",e.DATE_NANOS="date_nanos",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.FLOAT="float",e.HALF_FLOAT="half_float",e.SCALED_FLOAT="scaled_float",e.DOUBLE="double",e.INTEGER="integer",e.LONG="long",e.SHORT="short",e.UNSIGNED_LONG="unsigned_long",e.AGGREGATE_METRIC_DOUBLE="aggregate_metric_double",e.FLOAT_RANGE="float_range",e.DOUBLE_RANGE="double_range",e.INTEGER_RANGE="integer_range",e.LONG_RANGE="long_range",e.NESTED="nested",e.BYTE="byte",e.IP="ip",e.IP_RANGE="ip_range",e.ATTACHMENT="attachment",e.TOKEN_COUNT="token_count",e.MURMUR3="murmur3",e.HISTOGRAM="histogram",e}({}),i=function(e){return e._SOURCE="_source",e.ATTACHMENT="attachment",e.BOOLEAN="boolean",e.DATE="date",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.IP="ip",e.IP_RANGE="ip_range",e.MURMUR3="murmur3",e.NUMBER="number",e.NUMBER_RANGE="number_range",e.STRING="string",e.UNKNOWN="unknown",e.CONFLICT="conflict",e.OBJECT="object",e.NESTED="nested",e.HISTOGRAM="histogram",e.MISSING="missing",e}({});class KbnFieldType{constructor(e={}){(0,s.default)(this,"name",void 0),(0,s.default)(this,"sortable",void 0),(0,s.default)(this,"filterable",void 0),(0,s.default)(this,"esTypes",void 0),this.name=e.name||i.UNKNOWN,this.sortable=e.sortable||!1,this.filterable=e.filterable||!1,this.esTypes=Object.freeze((e.esTypes||[]).slice())}}const n=new KbnFieldType({name:i.UNKNOWN}),l=[new KbnFieldType({name:i.STRING,sortable:!0,filterable:!0,esTypes:[r.STRING,r.TEXT,r.MATCH_ONLY_TEXT,r.KEYWORD,r.VERSION,r._TYPE,r._ID]}),new KbnFieldType({name:i.NUMBER,sortable:!0,filterable:!0,esTypes:[r.FLOAT,r.HALF_FLOAT,r.SCALED_FLOAT,r.DOUBLE,r.INTEGER,r.LONG,r.UNSIGNED_LONG,r.SHORT,r.BYTE,r.TOKEN_COUNT,r.AGGREGATE_METRIC_DOUBLE]}),new KbnFieldType({name:i.NUMBER_RANGE,sortable:!0,filterable:!0,esTypes:[r.FLOAT_RANGE,r.DOUBLE_RANGE,r.INTEGER_RANGE,r.LONG_RANGE]}),new KbnFieldType({name:i.DATE,sortable:!0,filterable:!0,esTypes:[r.DATE,r.DATE_NANOS]}),new KbnFieldType({name:i.DATE_RANGE,sortable:!0,filterable:!0,esTypes:[r.DATE_RANGE]}),new KbnFieldType({name:i.IP,sortable:!0,filterable:!0,esTypes:[r.IP]}),new KbnFieldType({name:i.IP_RANGE,sortable:!0,filterable:!0,esTypes:[r.IP_RANGE]}),new KbnFieldType({name:i.BOOLEAN,sortable:!0,filterable:!0,esTypes:[r.BOOLEAN]}),new KbnFieldType({name:i.OBJECT,esTypes:[r.OBJECT]}),new KbnFieldType({name:i.NESTED,esTypes:[r.NESTED]}),new KbnFieldType({name:i.GEO_POINT,esTypes:[r.GEO_POINT]}),new KbnFieldType({name:i.GEO_SHAPE,esTypes:[r.GEO_SHAPE]}),new KbnFieldType({name:i.ATTACHMENT,esTypes:[r.ATTACHMENT]}),new KbnFieldType({name:i.MURMUR3,esTypes:[r.MURMUR3]}),new KbnFieldType({name:i._SOURCE,esTypes:[r._SOURCE]}),new KbnFieldType({name:i.HISTOGRAM,filterable:!0,esTypes:[r.HISTOGRAM]}),new KbnFieldType({name:i.CONFLICT}),n],o=e=>{const t=l.find((t=>t.esTypes.includes(e)));return t&&t.name?t.name:i.UNKNOWN};function g(e){if(e.startsWith("counter_"))return i.NUMBER;switch(e){case r._INDEX:return i.STRING;case"_version":return i.NUMBER;case"datetime":return i.DATE;default:return o(e)}}},6215:(e,t,a)=>{"use strict";a.d(t,{Pv:()=>o});var s=a(4286),r=a(2874),i=a.n(r),n=a(482),l=a(6791);const o=(e,t)=>a=>(i().render((0,l.jsx)(n.KibanaRenderContextProvider,t,e),a),()=>i().unmountComponentAtNode(a));a(8915),a(5008),s.Component},7005:(e,t,a)=>{"use strict";a.d(t,{V:()=>p});var s=a(4286),r=a.n(s),i=a(3185),n=a(7880),l=a(6791);const o=r().createContext(null),g=({children:e,...t})=>{const{navigateToUrl:a,currentAppId:s}=t;return(0,l.jsx)(o.Provider,{value:{navigateToUrl:a,currentAppId:s}},e)},u=({children:e,coreStart:t})=>{const{navigateToUrl:a,currentAppId$:s}=t.application,r=(0,n.A)(s,void 0);return(0,l.jsx)(o.Provider,{value:{navigateToUrl:a,currentAppId:r}},e)},d={name:"h42ud6",styles:"display:inherit;height:inherit;width:inherit;flex:1;flex-flow:column nowrap"},c=({children:e,navigateToUrl:t,currentAppId:a,...r})=>{const n=(0,s.useRef)(null),o=(0,s.useCallback)((e=>(({event:e,container:t,navigateToUrl:a,currentAppId:s})=>{if(!t||!s)return;const r=((e,t)=>{let a=e;do{var s,r;if("a"===(null===(s=a)||void 0===s?void 0:s.tagName.toLowerCase()))return a;const e=null===(r=a)||void 0===r?void 0:r.parentElement;if(!e||e===document.body||e===t)break;a=e}while(parent||parent!==document.body||parent!==t)})(e.target,t);if(!r)return;const i=r.href,n=""===r.target||"_self"===r.target,l=0===e.button;i&&n&&l&&!e.defaultPrevented&&!(e=>e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)(e)&&(e.preventDefault(),a(r.href))})({event:e,currentAppId:a,navigateToUrl:t,container:n.current})),[a,t]);return(0,l.jsx)("div",(0,i.default)({onClick:o,ref:n,css:d,"data-test-subj":"kbnRedirectAppLink"},r),e)},h=({children:e,...t})=>(0,l.jsx)(c,(0,i.default)({},function(){const e=(0,s.useContext)(o);if(!e)throw new Error("RedirectAppLinksContext is missing.  Ensure your component or React root is wrapped with RedirectAppLinksProvider.");return e}(),t),e),p=({children:e,...t})=>{if(void 0!==t.coreStart){const{coreStart:a,...s}=t,r=(0,l.jsx)(h,s,e);return(0,l.jsx)(u,{coreStart:a},r)}const{navigateToUrl:a,currentAppId:s,...r}=t,i=(0,l.jsx)(h,r,e);return(0,l.jsx)(g,{currentAppId:s,navigateToUrl:a},i)}},2787:(e,t,a)=>{"use strict";a.d(t,{JI:()=>l,JO:()=>r,M4:()=>n,SA:()=>s,nK:()=>i});const s="kuery",r="kibana.userQueryLanguage",i="/internal/saved_query",n="1",l="1"},4177:(e,t,a)=>{"use strict";a.r(t),a.d(t,{AggConfig:()=>g.CuU,AggConfigs:()=>g.dg3,AggGroupLabels:()=>g.qLR,AggGroupNames:()=>g.TO1,AggParamType:()=>g.Jnb,AggType:()=>g.sow,AggTypesRegistry:()=>g.QJv,AggsCommonService:()=>g.fXy,BUCKET_TYPES:()=>g.TDc,BaseParamType:()=>g.Lnr,BucketAggType:()=>g.aiG,CSV_FORMULA_CHARS:()=>d,CSV_MIME_TYPE:()=>S,CidrMask:()=>g.buk,DATA_VIEW_SAVED_OBJECT_TYPE:()=>T.DATA_VIEW_SAVED_OBJECT_TYPE,DEFAULT_ASSETS_TO_IGNORE:()=>T.DEFAULT_ASSETS_TO_IGNORE,DEFAULT_QUERY_LANGUAGE:()=>s.SA,DIVERSIFIED_SAMPLER_AGG_NAME:()=>g.yAE,DataView:()=>T.DataView,DataViewField:()=>T.DataViewField,DataViewSavedObjectConflictError:()=>T.DataViewSavedObjectConflictError,DataViewType:()=>T.DataViewType,DataViewsService:()=>T.DataViewsService,DatatableUtilitiesService:()=>DatatableUtilitiesService,DuplicateDataViewError:()=>T.DuplicateDataViewError,ENHANCED_ES_SEARCH_STRATEGY:()=>g.RNT,EQL_SEARCH_STRATEGY:()=>g.ky9,ESQL_ASYNC_SEARCH_STRATEGY:()=>g.mid,ESQL_SEARCH_STRATEGY:()=>g.fOT,ESQL_TABLE_TYPE:()=>g.AV0,ES_FIELD_TYPES:()=>u._,ES_SEARCH_STRATEGY:()=>g.kAj,FieldParamType:()=>g.Gwp,IP_RANGE_TYPES:()=>g.O0P,InvalidEsCalendarIntervalError:()=>g.zUd,InvalidEsIntervalFormatError:()=>g.mOS,IpAddress:()=>g.m8W,JsonParamType:()=>g.Oq5,KBN_FIELD_TYPES:()=>u.f,KIBANA_USER_QUERY_LANGUAGE_KEY:()=>s.JO,KQL_TELEMETRY_ROUTE_LATEST_VERSION:()=>s.M4,KbnFieldType:()=>l.qZ,META_FIELDS:()=>T.META_FIELDS,METRIC_TYPES:()=>g.zmd,MULTI_FIELD_KEY_SEPARATOR:()=>g.dY5,MetricAggType:()=>g.mz6,MultiFieldKey:()=>g.p0N,OptionedParamType:()=>g.o8K,REASON_IDS:()=>g.At2,RUNTIME_FIELD_TYPES:()=>T.RUNTIME_FIELD_TYPES,RequestFailure:()=>g.e6x,SAMPLER_AGG_NAME:()=>g.z3F,SAVED_QUERY_BASE_URL:()=>s.nK,SCRIPT_LANGUAGES_ROUTE_LATEST_VERSION:()=>s.JI,SEARCH_SESSIONS_TABLE_ID:()=>g.MXb,SEARCH_SESSION_TYPE:()=>g.VNk,SHARD_DELAY_AGG_NAME:()=>g.vZc,SQL_SEARCH_STRATEGY:()=>g.UNd,SearchSessionStatus:()=>g.vdD,SearchSource:()=>g.Cyp,SearchSourceService:()=>g.zA1,SearchStatus:()=>g.zmL,SortDirection:()=>g.UEL,StringParamType:()=>g.lug,TimeBuckets:()=>g.tTJ,UI_SETTINGS:()=>r.j,adaptToExpressionValueFilter:()=>g.Nh9,aggAvg:()=>g.OBf,aggAvgFnName:()=>g.hEG,aggBucketAvg:()=>g.Efy,aggBucketAvgFnName:()=>g.lbX,aggBucketMax:()=>g.cUf,aggBucketMaxFnName:()=>g.v3f,aggBucketMin:()=>g.gdu,aggBucketMinFnName:()=>g.Fb7,aggBucketSum:()=>g.zAP,aggBucketSumFnName:()=>g.e0w,aggCardinality:()=>g.mZy,aggCardinalityFnName:()=>g.rjA,aggCount:()=>g.ZmW,aggCountFnName:()=>g.OL7,aggCumulativeSum:()=>g.SsN,aggCumulativeSumFnName:()=>g.PAj,aggDateHistogram:()=>g.Ca8,aggDateHistogramFnName:()=>g.vQh,aggDateRange:()=>g.foF,aggDateRangeFnName:()=>g.C6H,aggDerivative:()=>g.bgr,aggDerivativeFnName:()=>g.i2N,aggDiversifiedSampler:()=>g.i5z,aggDiversifiedSamplerFnName:()=>g.TFY,aggFilter:()=>g.oXr,aggFilterFnName:()=>g.tbp,aggFilteredMetric:()=>g.T1k,aggFilteredMetricFnName:()=>g.om,aggFilters:()=>g.jfr,aggFiltersFnName:()=>g.ejh,aggGeoBounds:()=>g.WVh,aggGeoBoundsFnName:()=>g.dKG,aggGeoCentroid:()=>g.dHe,aggGeoCentroidFnName:()=>g.W8J,aggGeoTile:()=>g.jsV,aggGeoTileFnName:()=>g.qIu,aggHistogram:()=>g.qew,aggHistogramFnName:()=>g.Vjs,aggIpPrefix:()=>g.Du,aggIpPrefixFnName:()=>g.CWM,aggIpRange:()=>g.wB5,aggIpRangeFnName:()=>g.Vzo,aggMax:()=>g.uC8,aggMaxFnName:()=>g.jST,aggMedian:()=>g.AJK,aggMedianFnName:()=>g.rGL,aggMin:()=>g.y3o,aggMinFnName:()=>g.ZO1,aggMovingAvg:()=>g.mgw,aggMovingAvgFnName:()=>g.VD$,aggMultiTerms:()=>g.mXM,aggMultiTermsFnName:()=>g.Pp7,aggPercentileRanks:()=>g.mU8,aggPercentileRanksFnName:()=>g.tpD,aggPercentiles:()=>g.U6Y,aggPercentilesFnName:()=>g.jJm,aggRange:()=>g.v0U,aggRangeFnName:()=>g.qoF,aggRareTerms:()=>g.pMt,aggRareTermsFnName:()=>g.ibD,aggRate:()=>g.c9O,aggRateFnName:()=>g.xzq,aggSampler:()=>g.GFW,aggSamplerFnName:()=>g.tK_,aggSerialDiff:()=>g.REs,aggSerialDiffFnName:()=>g.si_,aggSignificantTerms:()=>g.aw4,aggSignificantTermsFnName:()=>g.HCP,aggSignificantText:()=>g.C98,aggSignificantTextFnName:()=>g.nv7,aggSinglePercentile:()=>g.f90,aggSinglePercentileFnName:()=>g.AUv,aggSinglePercentileRank:()=>g.L69,aggSinglePercentileRankFnName:()=>g.mwK,aggStdDeviation:()=>g._Fq,aggStdDeviationFnName:()=>g.$Bi,aggSum:()=>g.FeO,aggSumFnName:()=>g.W3G,aggTerms:()=>g.Vog,aggTermsFnName:()=>g.sAW,aggTimeSeries:()=>g.UGU,aggTimeSeriesFnName:()=>g.Rcq,aggTopHit:()=>g._xq,aggTopHitFnName:()=>g.FKr,aggTopMetrics:()=>g.qZi,aggTopMetricsFnName:()=>g.NkJ,aggValueCount:()=>g.IQS,aggValueCountFnName:()=>g.zfq,aggregateQueryToAst:()=>g.PSF,aggsRequiredUiSettings:()=>g.PX$,autoInterval:()=>g.B1X,boundsDescendingRaw:()=>g.OI_,calcAutoIntervalLessThan:()=>g.u0$,calcAutoIntervalNear:()=>g._er,calculateBounds:()=>o.AE,cellHasFormulas:()=>f,cidrFunction:()=>g.dtO,cidrToAst:()=>g.iJZ,convertDateRangeToString:()=>g.N2Z,convertIPRangeToString:()=>g.QyU,createEscapeValue:()=>b,createSearchSource:()=>g.kVi,datatableToCSV:()=>_,dateHistogramInterval:()=>g.I1L,dateRangeFunction:()=>g.Muh,dateRangeToAst:()=>g.lO1,eqlRawResponse:()=>g.iLg,esRawResponse:()=>g.uzQ,existsFilterFunction:()=>g.rk1,extendedBoundsFunction:()=>g.BUn,extendedBoundsToAst:()=>g.w1E,extractReferences:()=>g.QDx,fieldFunction:()=>g.rgn,fieldList:()=>T.fieldList,filtersToAst:()=>g.tTg,flattenHit:()=>g.Ucw,functionWrapper:()=>g.i0A,geoBoundingBoxFunction:()=>g.TU9,geoBoundingBoxToAst:()=>g.y9c,geoPointFunction:()=>g.aw$,geoPointToAst:()=>g.VNn,getAbsoluteTimeRange:()=>o.qq,getAggTypes:()=>g.F6S,getAggTypesFunctions:()=>g.Obw,getAggsFormats:()=>g.LaZ,getAvgMetricAgg:()=>g.UeN,getBucketAvgMetricAgg:()=>g.ATn,getBucketMaxMetricAgg:()=>g._h9,getBucketMinMetricAgg:()=>g.i23,getBucketSumMetricAgg:()=>g.HLz,getCalculateAutoTimeExpression:()=>g.JKe,getCardinalityMetricAgg:()=>g.Kd5,getCountMetricAgg:()=>g.HAP,getCumulativeSumMetricAgg:()=>g.YNN,getDateHistogramBucketAgg:()=>g.MUp,getDateRangeBucketAgg:()=>g.H8h,getDerivativeMetricAgg:()=>g.DqD,getDiversifiedSamplerBucketAgg:()=>g.qvY,getEqlFn:()=>g.l5r,getEsPreference:()=>g.OD5,getEsQueryConfig:()=>n.F,getEsaggsMeta:()=>g.KKF,getEsdslFn:()=>g.utN,getEsqlFn:()=>g.yhm,getFieldSubtypeMulti:()=>T.getFieldSubtypeMulti,getFieldSubtypeNested:()=>T.getFieldSubtypeNested,getFilterBucketAgg:()=>g.mOK,getFilteredMetricAgg:()=>g.Bw4,getFiltersBucketAgg:()=>g.Zy4,getGeoBoundsMetricAgg:()=>g.azA,getGeoCentroidMetricAgg:()=>g.nP5,getGeoTitleBucketAgg:()=>g.Bum,getHistogramBucketAgg:()=>g.IYs,getIndexPatternLoadMeta:()=>T.getIndexPatternLoadMeta,getIpPrefixBucketAgg:()=>g.pSU,getIpRangeBucketAgg:()=>g.aZK,getMaxMetricAgg:()=>g.EzU,getMedianMetricAgg:()=>g.oUU,getMinMetricAgg:()=>g.kY9,getMovingAvgMetricAgg:()=>g.Alz,getMultiTermsBucketAgg:()=>g._Xw,getPercentileRanksMetricAgg:()=>g.yyA,getPercentilesMetricAgg:()=>g.aRc,getRangeBucketAgg:()=>g.ZJo,getRareTermsBucketAgg:()=>g.XLV,getRateMetricAgg:()=>g.mvy,getRelativeTime:()=>o.gs,getResponseInspectorStats:()=>g.EzV,getSamplerBucketAgg:()=>g.IH1,getSearchParamsFromRequest:()=>g.c2H,getSerialDiffMetricAgg:()=>g.jb4,getSignificantTermsBucketAgg:()=>g.YHK,getSignificantTextBucketAgg:()=>g.czt,getSinglePercentileMetricAgg:()=>g.rFf,getSinglePercentileRankMetricAgg:()=>g.vo0,getStdDeviationMetricAgg:()=>g.uSi,getSumMetricAgg:()=>g.JXX,getTermsBucketAgg:()=>g.x0l,getTime:()=>o.WB,getTimeSeriesBucketAgg:()=>g.OrF,getTopHitMetricAgg:()=>g.YhB,getTopMetricsMetricAgg:()=>g.cLp,getTotalLoaded:()=>g.AmH,getUserTimeZone:()=>g.fyU,getValueCountMetricAgg:()=>g.c12,handleEsaggsRequest:()=>g.Q_w,inferTimeZone:()=>g.s9S,injectReferences:()=>g.kiA,intervalOptions:()=>g.WB4,ipPrefixFunction:()=>g.eYm,ipPrefixToAst:()=>g.dJ0,ipRangeFunction:()=>g.rDs,ipRangeToAst:()=>g.IZ,isAbortResponse:()=>g.E8Q,isAbsoluteTimeShift:()=>g.JNE,isAutoInterval:()=>g.za8,isBucketAggType:()=>g.M3U,isDateHistogramBucketAggConfig:()=>g.itY,isFilterable:()=>T.isFilterable,isMetricAggType:()=>g.sy,isMultiField:()=>T.isMultiField,isMultiFieldKey:()=>g.HbO,isNestedField:()=>T.isNestedField,isNumberType:()=>g.qSv,isQuery:()=>o.P4,isRunningResponse:()=>g.vQj,isSerializedSearchSource:()=>g.yPl,isStringOrNumberType:()=>g.Ehy,isStringType:()=>g.mgc,isTimeRange:()=>o.Df,isType:()=>g.Xjv,isValidEsInterval:()=>g.usJ,isValidInterval:()=>g.Cec,kibana:()=>g.L1,kibanaFilterFunction:()=>g.JjL,kibanaTimerangeFunction:()=>g.JW4,kqlFunction:()=>g.hnj,luceneFunction:()=>g.bOY,migrateIncludeExcludeFormat:()=>g.fYb,numericalRangeFunction:()=>g.wcW,numericalRangeToAst:()=>g.Lpc,parentPipelineAggHelper:()=>g.IJq,parentPipelineType:()=>g.$Ux,parseAbsoluteTimeShift:()=>g.spt,parseEsInterval:()=>g.njO,parseInterval:()=>g.P15,parseSearchSourceJSON:()=>g.zqr,parseTimeShift:()=>g.vC3,phraseFilterFunction:()=>g.SvO,pollSearch:()=>g.YV9,propFilter:()=>g.EyB,queryFilterFunction:()=>g.PFs,queryFilterToAst:()=>g.sjk,queryToAst:()=>g.EW1,queryToFields:()=>g.ri9,rangeFilterFunction:()=>g.c$p,rangeFunction:()=>g.EM$,removeFilterFunction:()=>g.LSk,searchSourceRequiredUiSettings:()=>g.EQP,selectFilterFunction:()=>g.XIV,shimHitsTotal:()=>g.E1R,siblingPipelineAggHelper:()=>g.gJ6,siblingPipelineType:()=>g.RRC,splitStringInterval:()=>g.drh,tabifyAggResponse:()=>g.AXn,tabifyDocs:()=>g.FUj,tabifyGetColumns:()=>g.jZz,tableHasFormulas:()=>y,termsAggFilter:()=>g.zQf,textBasedQueryStateToAstWithValidation:()=>o.kh,textBasedQueryStateToExpressionAst:()=>o.L9,timerangeToAst:()=>g._Sh,toAbsoluteDates:()=>g.IIR,validateAbsoluteTimeShift:()=>g.pa7});var s=a(2787),r=a(3789),i=a(730);class DatatableUtilitiesService{constructor(e,t,a){this.aggs=e,this.dataViews=t,this.fieldFormats=a,this.getAggConfig=this.getAggConfig.bind(this),this.getDataView=this.getDataView.bind(this),this.getField=this.getField.bind(this),this.isFilterable=this.isFilterable.bind(this)}clearField(e){delete e.meta.field}clearFieldFormat(e){delete e.meta.params}async getAggConfig(e){const t=await this.getDataView(e);if(!t)return;const{aggs:a}=await this.aggs.createAggConfigs(t,e.meta.sourceParams&&[e.meta.sourceParams]);return a[0]}getDateHistogramMeta(e,t={}){if(!e.meta.sourceParams||!e.meta.sourceParams.params)return;const a=e.meta.sourceParams.params;let s;return a.used_interval&&"auto"!==a.used_interval&&(s=a.used_interval),{interval:s,timeZone:a.used_time_zone||t.timeZone,timeRange:e.meta.sourceParams.appliedTimeRange}}async getDataView(e){if(e.meta.index)return this.dataViews.get(e.meta.index)}async getField(e){if(!e.meta.field)return;const t=await this.getDataView(e);return t?t.getFieldByName(e.meta.field):void 0}getFieldFormat(e){return this.fieldFormats.deserialize(e.meta.params)}getInterval(e){var t;const a=null===(t=e.meta.sourceParams)||void 0===t?void 0:t.params;return null==a?void 0:a.interval}getNumberHistogramInterval(e){var t;if("esaggs"!==e.meta.source)return;if((null===(t=e.meta.sourceParams)||void 0===t?void 0:t.type)!==i.T.HISTOGRAM)return;const a=e.meta.sourceParams.params;return a.used_interval&&"string"!=typeof a.used_interval?a.used_interval:void 0}getTotalCount(e){var t,a;return null===(t=e.meta)||void 0===t||null===(a=t.statistics)||void 0===a?void 0:a.totalCount}hasPrecisionError(e){var t;return null===(t=e.meta.sourceParams)||void 0===t?void 0:t.hasPrecisionError}isFilterable(e){var t;if("esaggs"!==e.meta.source)return!1;const a=this.aggs.types.get(null===(t=e.meta.sourceParams)||void 0===t?void 0:t.type);return Boolean(a.createFilter)}setFieldFormat(e,t){e.meta.params=t.toJSON()}}var n=a(8351),l=a(3313),o=a(1373),g=a(5536),u=a(7371);const d=["=","+","-","@"],c=/[^a-zA-Z0-9]/,h=/"/g,p=new Set([",",";","\t"," ","|"]);var m=a(770);const f=e=>d.some((t=>(0,m.startsWith)(e,t))),y=(e,t)=>e.some((({name:e})=>f(e)))||t.some((t=>e.some((({id:e})=>f(t[e])))));function b({separator:e,quoteValues:t,escapeFormulaValues:a}){return function(s){if(s&&"string"==typeof s){const e=a&&f(s)?"'"+s:s;if(t&&c.test(e))return`"${e.replace(h,'""')}"`}const r=null==s?"":s.toString();return t&&function(e,t){const a=t.trim();return e.includes(a)&&p.has(a)}(r,e)?`"${r}"`:r}}const v="\r\n",S="text/plain;charset=utf-8";function _({columns:e,rows:t},{csvSeparator:a,quoteValues:s,formatFactory:r,raw:i,escapeFormulaValues:n}){const l=b({separator:a,quoteValues:s,escapeFormulaValues:n}),o=[],g=[],u={};if(e.forEach(((e,t)=>{var a;o[t]=l(e.name),g[t]=e.id,u[e.id]=r(null===(a=e.meta)||void 0===a?void 0:a.params)})),0===o.length)return"";const d=t.map((e=>g.map((t=>l(i?e[t]:u[t].convert(e[t]))))));return[o,...d].map((e=>e.join(a))).join(v)+v}var T=a(7674)},2956:(e,t,a)=>{"use strict";a.d(t,{_:()=>s._c,f:()=>s.fM});var s=a(3313)},71:(e,t,a)=>{"use strict";a.d(t,{R9:()=>g,WQ:()=>n,Y9:()=>l,kr:()=>o,o6:()=>i});var s=a(9472),r=a(7674);const i=e=>{const t=[];return{state:e.map((e=>{var a;if(null!==(a=e.meta)&&void 0!==a&&a.index){const a=(0,s.v4)();return t.push({type:r.DATA_VIEW_SAVED_OBJECT_TYPE,name:a,id:e.meta.index}),{...e,meta:{...e.meta,index:a}}}return e})),references:t}},n=(e,t)=>e.map((e=>{if(!e.meta.index)return e;const a=t.find((t=>t.name===e.meta.index));return{...e,meta:{...e.meta,index:a?a.id:e.meta.index}}})),l=(e,t)=>({}),o=e=>e.state,g=()=>({})},1373:(e,t,a)=>{"use strict";a.d(t,{AE:()=>s.AE,qq:()=>s.qq,gs:()=>s.gs,WB:()=>s.WB,P4:()=>i,Df:()=>r,kh:()=>u,L9:()=>g});var s=a(5265);const r=e=>!!e&&"object"==typeof e&&"string"==typeof e.from&&"string"==typeof e.to,i=e=>!!e&&"object"==typeof e&&"string"==typeof e.language&&("string"==typeof e.query||"object"==typeof e.query&&!!e.query);var n=a(5964),l=a(7876),o=a(4177);function g({filters:e,query:t,inputQuery:a,time:s,timeFieldName:r,titleForInspector:i,descriptionForInspector:g}){const u=(0,l.buildExpressionFunction)("kibana",{});let d;a&&(d=a);const c=(0,l.buildExpressionFunction)("kibana_context",{q:d&&(0,o.queryToAst)(d),timeRange:s&&(0,o.timerangeToAst)(s),filters:e&&(0,o.filtersToAst)(e)}),h=(0,l.buildExpression)([u,c]).toAst();if(t&&(0,n.isOfAggregateQueryType)(t)){const e=(0,o.aggregateQueryToAst)({query:t,timeField:r,titleForInspector:i,descriptionForInspector:g});e&&h.chain.push(e)}return h}async function u({filters:e,query:t,inputQuery:a,time:s,timeFieldName:r,titleForInspector:i,descriptionForInspector:l}){let o;return t&&(0,n.isOfAggregateQueryType)(t)&&(o=g({filters:e,query:t,inputQuery:a,time:s,timeFieldName:r,titleForInspector:i,descriptionForInspector:l})),o}},5265:(e,t,a)=>{"use strict";a.d(t,{AE:()=>d,WB:()=>h,gs:()=>p,qq:()=>c});var s=a(3313),r=a(6494),i=a.n(r),n=a(770),l=a(5964);const o=(e,t)=>i().parse(e,{forceNow:t}),g=(e,t)=>i().parse(e,{roundUp:!0,forceNow:t}),u=e=>"string"==typeof e&&e.includes("now");function d(e,t={}){return{min:o(e.from,t.forceNow),max:g(e.to,t.forceNow)}}function c(e,{forceNow:t}={}){const{min:a,max:s}=d(e,{forceNow:t});return{from:a?a.toISOString():e.from,to:s?s.toISOString():e.to}}function h(e,t,a){return m(e,t,(null==a?void 0:a.fieldName)||(null==e?void 0:e.timeFieldName),null==a?void 0:a.forceNow,!0)}function p(e,t,a){return m(e,t,(null==a?void 0:a.fieldName)||(null==e?void 0:e.timeFieldName),null==a?void 0:a.forceNow,!1)}function m(e,t,a,r,i=!0){const c=function(e,t){return!e&&t?{name:t,type:s.fM.DATE}:e?e.fields.find((a=>a.name===(t||e.timeFieldName))):void 0}(e,a);if(!c)return;let h={format:"strict_date_optional_time"};if(i){var p,m;const e=d(t,{forceNow:r});if(!e)return;h.gte=null===(p=e.min)||void 0===p?void 0:p.toISOString(),h.lte=null===(m=e.max)||void 0===m?void 0:m.toISOString()}else{var f,y;h.gte=u(t.from)?t.from:null===(f=o(t.from,r))||void 0===f?void 0:f.toISOString(),h.lte=u(t.to)?t.to:null===(y=g(t.to,r))||void 0===y?void 0:y.toISOString()}return h=(0,n.omitBy)(h,(e=>null==e)),(0,l.buildRangeFilter)(c,h,e)}},1616:(e,t,a)=>{"use strict";a.d(t,{C:()=>AggConfig});var s=a(8915),r=a(1783),i=a.n(r),n=a(770),l=a.n(n),o=a(5008),g=a(9800),u=a(2023);class AggConfig{static ensureIds(e){const t=[],a=[];e.forEach((function(e){(e.id?t:a).push(e)}));let s=AggConfig.nextId(t);return a.forEach((function(e){e.id=String(s++)})),e}static nextId(e){return 1+e.reduce((function(e,t){return Math.max(e,+t.id||0)}),0)}constructor(e,t){(0,s.default)(this,"aggConfigs",void 0),(0,s.default)(this,"id",void 0),(0,s.default)(this,"enabled",void 0),(0,s.default)(this,"params",void 0),(0,s.default)(this,"parent",void 0),(0,s.default)(this,"brandNew",void 0),(0,s.default)(this,"schema",void 0),(0,s.default)(this,"__type",void 0),(0,s.default)(this,"__typeDecorations",void 0),(0,s.default)(this,"subAggs",[]),this.aggConfigs=e,this.id=String(t.id||AggConfig.nextId(e.aggs)),this.enabled="boolean"!=typeof t.enabled||t.enabled,this.params={},this.setType(t.type),t.schema&&(this.schema=t.schema),this.setParams(t.params||{}),this.__type=this.__type}setParams(e){e=e||this.params||{};const t=this.params={};this.getAggParams().forEach((a=>{let s=e[a.name];if(null==s){if(null==a.default)return;if(l().isFunction(a.default)){if(s=a.default(this),null==s)return}else s=a.default}if(a.deserialize){var r;const e=null===(r=a.getValueType)||void 0===r?void 0:r.call(a,this),i=l().isFunction(e),n=i&&s instanceof e,o=!i&&l().isObject(s);return n||o||(s=a.deserialize(l().cloneDeep(s),this)),void(t[a.name]=s)}t[a.name]=l().cloneDeep(s)}))}getParam(e){return l().get(this.params,e)}hasTimeShift(){return Boolean(this.getParam("timeShift"))}getTimeShift(){const e=this.getParam("timeShift");if(!e)return;const t=(0,u.vC)(e);if("invalid"===t)throw new Error(`could not parse time shift ${e}`);if("previous"===t){const e=this.aggConfigs.getTimeShiftInterval();if(e)return e;if(!this.aggConfigs.timeRange)return;const t=this.aggConfigs.getResolvedTimeRange();return i().duration(i().tz(t.max,this.aggConfigs.timeZone).diff(t.min))}return t}write(e){return(0,g.m)(this.type.params,this,e)}isFilterable(){return l().isFunction(this.type.createFilter)}createFilter(e,t={}){const a=this.type.createFilter;if(!a)throw new TypeError(`The "${this.type.title}" aggregation does not support filtering.`);const s=this.getField(),r=this.getFieldDisplayName();if(s&&!s.filterable){let e=`The "${r}" field can not be used for filtering.`;throw s.scripted&&(e=`The "${r}" field is scripted and can not be used for filtering.`),new TypeError(e)}return a(this,e,t)}onSearchRequestStart(e,t){return this.type?Promise.all(this.type.params.map((a=>a.modifyAggConfigOnSearchRequestStart(this,e,t)))):Promise.resolve()}toDsl(e){if(this.type.hasNoDsl)return;const t=this.write(e),a={};if(this.type.hasNoDslParams||(a[this.type.dslName||this.type.name]=t.params),this.subAggs.length&&(t.subAggs?t.subAggs.push(...this.subAggs):t.subAggs=this.subAggs),t.subAggs){const s=a.aggs||(a.aggs={});t.subAggs.forEach((function(t){s[t.id]=t.toDsl(e)}))}if(t.parentAggs){const s=a.parentAggs||(a.parentAggs={});t.parentAggs.forEach((function(t){s[t.id]=t.toDsl(e)}))}return a}serialize(){const e=this.params,t=l().transform(this.getAggParams(),((t,a)=>{let s=e[a.name];null!=s&&(a.serialize&&(s=a.serialize(s,this)),null!=s&&(t[a.name]=l().cloneDeep(s)))}),{});return{id:this.id,enabled:this.enabled,type:this.type&&this.type.name,params:t,...this.schema&&{schema:this.schema}}}toJSON(){return this.serialize()}toSerializedFieldFormat(){return this.type?this.type.getSerializedFormat(this):{}}toExpressionAst(){const e=this.type&&this.type.expressionName,{type:t,...a}=this.serialize();if(e&&a.params)return{type:"expression",chain:[{type:"function",function:e,arguments:{...Object.entries(a.params).reduce(((e,[t,a])=>{const s=this.getAggParams().find((e=>e.name===t));if(s&&s.toExpressionAst){const a=s.toExpressionAst(this.getParam(t));a&&(e[t]=Array.isArray(a)?a:[a])}else if(a&&Array.isArray(a)){const s=a.filter((e=>null!=e));e[t]="object"==typeof s[0]?[JSON.stringify(s)]:s}else"object"==typeof a?e[t]=[JSON.stringify(a)]:void 0!==a&&(e[t]=[a]);return e}),{}),id:[this.id],enabled:[this.enabled],...this.schema?{schema:[this.schema]}:{}}}]}}getAggParams(){return[...l().hasIn(this,"type.params")?this.type.params:[]]}getRequestAggs(){return this.type&&this.type.getRequestAggs(this)||[this]}getResponseAggs(){return this.type&&this.type.getResponseAggs(this)||[this]}getValue(e){return this.type.getValue(this,e)}getResponseId(){return this.type.getResponseId(this)}getKey(e,t){return this.type.getKey?this.type.getKey(e,t,this):""}getFieldDisplayName(){const e=this.getField();return e?e.displayName||this.fieldName():""}getField(){return this.params.field}getValueBucketPath(){return this.type.getValueBucketPath(this)}makeLabel(e=!1){return this.params.customLabel?this.params.customLabel:this.type?e?o.i18n.translate("data.search.aggs.percentageOfLabel",{defaultMessage:"Percentage of {label}",values:{label:this.type.makeLabel(this)}}):`${this.type.makeLabel(this)}`:""}getIndexPattern(){return this.aggConfigs.indexPattern}getTimeRange(){return this.aggConfigs.timeRange}fieldName(){const e=this.getField();return e?e.name:""}fieldIsTimeField(){var e,t,a;const s=null===(e=this.getIndexPattern())||void 0===e||null===(t=e.getTimeField)||void 0===t||null===(a=t.call(e))||void 0===a?void 0:a.name,r=s?[s]:[],i=this.aggConfigs.timeFields&&this.aggConfigs.timeFields.length>0?this.aggConfigs.timeFields:r,n=this.fieldName();return i.includes(n)}get type(){return this.__type}set type(e){this.__typeDecorations&&l().forOwn(this.__typeDecorations,((e,t)=>{delete this[t]})),e&&l().isFunction(e.decorateAggConfig)&&(this.__typeDecorations=e.decorateAggConfig(),Object.defineProperties(this,this.__typeDecorations)),this.__type=e;let t=[];const a=this.type&&this.type.params.find((e=>"field"===e.type));a&&(t=a.getAvailableFields(this)),this.setParams({field:t.find((e=>e.name===this.getField()))})}setType(e){this.type=e}}},9800:(e,t,a)=>{"use strict";a.d(t,{V:()=>u,m:()=>d});var s=a(5675),r=a(6286),i=a(6252),n=a(8201),l=a(6490),o=a(8409);const g={field:r.G,optioned:i.o,string:n.l,json:l.O,agg:s.J,_default:o.L},u=e=>e.map((e=>new(g[e.type]||g._default)(e))),d=(e=[],t,a,s)=>{const r={params:{}};return s=s||{},e.forEach((e=>{e.write?e.write(t,r,a,s):e&&e.name&&(r.params[e.name]=t.params[e.name])})),r}},2666:(e,t,a)=>{"use strict";a.d(t,{s:()=>AggType});var s=a(8915),r=a(770),i=a(5008),n=a(9800),l=a(8409);class AggType{splitForTimeShift(e,t){return!1}constructor(e){if((0,s.default)(this,"name",void 0),(0,s.default)(this,"type",void 0),(0,s.default)(this,"subtype",void 0),(0,s.default)(this,"dslName",void 0),(0,s.default)(this,"expressionName",void 0),(0,s.default)(this,"title",void 0),(0,s.default)(this,"getValueType",void 0),(0,s.default)(this,"makeLabel",void 0),(0,s.default)(this,"ordered",void 0),(0,s.default)(this,"hasNoDsl",void 0),(0,s.default)(this,"hasNoDslParams",void 0),(0,s.default)(this,"createFilter",void 0),(0,s.default)(this,"params",void 0),(0,s.default)(this,"getRequestAggs",void 0),(0,s.default)(this,"getResponseAggs",void 0),(0,s.default)(this,"decorateAggConfig",void 0),(0,s.default)(this,"hasPrecisionError",void 0),(0,s.default)(this,"postFlightRequest",void 0),(0,s.default)(this,"getSerializedFormat",void 0),(0,s.default)(this,"getValue",void 0),(0,s.default)(this,"getKey",void 0),(0,s.default)(this,"paramByName",(e=>this.params.find((t=>t.name===e)))),(0,s.default)(this,"getValueBucketPath",(e=>e.id)),(0,s.default)(this,"getResponseId",void 0),this.name=e.name,this.type=e.type||"metrics",this.dslName=e.dslName||e.name,this.expressionName=e.expressionName,this.title=e.title,this.getValueType=e.getValueType,this.makeLabel=e.makeLabel||(0,r.constant)(this.name),this.ordered=e.ordered,this.hasNoDsl=!!e.hasNoDsl,this.hasNoDslParams=!!e.hasNoDslParams,e.createFilter&&(this.createFilter=e.createFilter),e.getValueBucketPath&&(this.getValueBucketPath=e.getValueBucketPath),e.params&&e.params.length&&e.params[0]instanceof l.L)this.params=e.params;else{const t=e.params?[...e.params]:[];!1!==e.json&&t.push({name:"json",type:"json",advanced:!0}),!1!==e.customLabels&&t.push({name:"customLabel",displayName:i.i18n.translate("data.search.aggs.string.customLabel",{defaultMessage:"Custom label"}),type:"string",write:r.noop}),this.params=(0,n.V)(t)}this.getRequestAggs=e.getRequestAggs||r.noop,this.getResponseAggs=e.getResponseAggs||(()=>{}),this.decorateAggConfig=e.decorateAggConfig||(()=>({})),this.postFlightRequest=e.postFlightRequest||r.identity,this.hasPrecisionError=e.hasPrecisionError,this.getSerializedFormat=e.getSerializedFormat||(e=>e.params.field?e.aggConfigs.indexPattern.getFormatterForField(e.params.field).toJSON():{}),this.getValue=e.getValue||((e,t)=>{}),this.getResponseId=e.getResponseId||(e=>e.id)}}},6763:(e,t,a)=>{"use strict";a.d(t,{B1:()=>r,WB:()=>n,z:()=>i});var s=a(5008);const r="auto",i=e=>e===r,n=[{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.autoDisplayName",{defaultMessage:"Auto"}),val:r,enabled:e=>e.fieldIsTimeField()},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.millisecondDisplayName",{defaultMessage:"Millisecond"}),val:"ms"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.secondDisplayName",{defaultMessage:"Second"}),val:"s"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.minuteDisplayName",{defaultMessage:"Minute"}),val:"m"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.hourlyDisplayName",{defaultMessage:"Hour"}),val:"h"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.dailyDisplayName",{defaultMessage:"Day"}),val:"d"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.weeklyDisplayName",{defaultMessage:"Week"}),val:"w"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.monthlyDisplayName",{defaultMessage:"Month"}),val:"M"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.yearlyDisplayName",{defaultMessage:"Year"}),val:"y"}]},5371:(e,t,a)=>{"use strict";a.d(t,{M:()=>n,a:()=>BucketAggType});var s=a(8915),r=a(2666);const i="buckets";class BucketAggType extends r.s{getShiftedKey(e,t,a){return t}getTimeShiftInterval(e){}orderBuckets(e,t,a){return Number(t.key)-Number(a.key)}constructor(e){super(e),(0,s.default)(this,"getKey",void 0),(0,s.default)(this,"type",i),this.getKey=e.getKey||((e,t)=>t||e.key),e.getShiftedKey&&(this.getShiftedKey=e.getShiftedKey),e.orderBuckets&&(this.orderBuckets=e.orderBuckets),e.getTimeShiftInterval&&(this.getTimeShiftInterval=e.getTimeShiftInterval),e.splitForTimeShift&&(this.splitForTimeShift=e.splitForTimeShift)}}function n(e){return e&&e.type===i}},730:(e,t,a)=>{"use strict";a.d(t,{T:()=>s});let s=function(e){return e.FILTER="filter",e.FILTERS="filters",e.HISTOGRAM="histogram",e.IP_PREFIX="ip_prefix",e.IP_RANGE="ip_range",e.DATE_RANGE="date_range",e.RANGE="range",e.TERMS="terms",e.MULTI_TERMS="multi_terms",e.RARE_TERMS="rare_terms",e.SIGNIFICANT_TERMS="significant_terms",e.SIGNIFICANT_TEXT="significant_text",e.GEOTILE_GRID="geotile_grid",e.DATE_HISTOGRAM="date_histogram",e.SAMPLER="sampler",e.DIVERSIFIED_SAMPLER="diversified_sampler",e.TIME_SERIES="time_series",e}({})},6034:(e,t,a)=>{"use strict";function s({from:e,to:t},a){return e?t?a(e)+" to "+a(t):"After "+a(e):"Before "+a(t)}a.d(t,{N:()=>s})},4611:(e,t,a)=>{"use strict";a.d(t,{Q:()=>s});const s=(e,t)=>"mask"===e.type?t(e.mask):`${e.from?t(e.from):"-Infinity"} to ${e.to?t(e.to):"Infinity"}`},1410:(e,t,a)=>{"use strict";a.d(t,{OI:()=>c,u0:()=>y,_e:()=>f});var s=a(1783),r=a.n(s),i=a(5008);const n=e=>i.i18n.translate("data.search.timeBuckets.dayLabel",{defaultMessage:"{amount, plural, one {a day} other {# days}}",values:{amount:e}}),l=e=>i.i18n.translate("data.search.timeBuckets.hourLabel",{defaultMessage:"{amount, plural, one {an hour} other {# hours}}",values:{amount:e}}),o=()=>i.i18n.translate("data.search.timeBuckets.yearLabel",{defaultMessage:"a year"}),g=e=>i.i18n.translate("data.search.timeBuckets.minuteLabel",{defaultMessage:"{amount, plural, one {a minute} other {# minutes}}",values:{amount:e}}),u=e=>i.i18n.translate("data.search.timeBuckets.secondLabel",{defaultMessage:"{amount, plural, one {a second} other {# seconds}}",values:{amount:e}}),d=e=>i.i18n.translate("data.search.timeBuckets.millisecondLabel",{defaultMessage:"{amount, plural, one {a millisecond} other {# milliseconds}}",values:{amount:e}}),c=[{bound:1/0,interval:r().duration(1,"year"),boundLabel:i.i18n.translate("data.search.timeBuckets.infinityLabel",{defaultMessage:"More than a year"}),intervalLabel:o()},{bound:r().duration(1,"year"),interval:r().duration(1,"month"),boundLabel:o(),intervalLabel:i.i18n.translate("data.search.timeBuckets.monthLabel",{defaultMessage:"a month"})},{bound:r().duration(3,"week"),interval:r().duration(1,"week"),boundLabel:n(21),intervalLabel:n(7)},{bound:r().duration(1,"week"),interval:r().duration(1,"d"),boundLabel:n(7),intervalLabel:n(1)},{bound:r().duration(24,"hour"),interval:r().duration(12,"hour"),boundLabel:n(1),intervalLabel:l(12)},{bound:r().duration(6,"hour"),interval:r().duration(3,"hour"),boundLabel:l(6),intervalLabel:l(3)},{bound:r().duration(2,"hour"),interval:r().duration(1,"hour"),boundLabel:l(2),intervalLabel:l(1)},{bound:r().duration(45,"minute"),interval:r().duration(30,"minute"),boundLabel:g(45),intervalLabel:g(30)},{bound:r().duration(20,"minute"),interval:r().duration(10,"minute"),boundLabel:g(20),intervalLabel:g(10)},{bound:r().duration(9,"minute"),interval:r().duration(5,"minute"),boundLabel:g(9),intervalLabel:g(5)},{bound:r().duration(3,"minute"),interval:r().duration(1,"minute"),boundLabel:g(3),intervalLabel:g(1)},{bound:r().duration(45,"second"),interval:r().duration(30,"second"),boundLabel:u(45),intervalLabel:u(30)},{bound:r().duration(15,"second"),interval:r().duration(10,"second"),boundLabel:u(15),intervalLabel:u(10)},{bound:r().duration(7.5,"second"),interval:r().duration(5,"second"),boundLabel:u(7.5),intervalLabel:u(5)},{bound:r().duration(5,"second"),interval:r().duration(1,"second"),boundLabel:u(5),intervalLabel:u(1)},{bound:r().duration(500,"ms"),interval:r().duration(100,"ms"),boundLabel:d(500),intervalLabel:d(100)}],h=c.map((({bound:e,interval:t})=>({bound:Number(e),interval:Number(t)})));function p(e,t){const a=t/e;return isFinite(a)?a:NaN}function m(e){const t=isNaN(e)?0:Math.max(Math.floor(e),1);return r().duration(t)}function f(e,t){const a=p(e,t),s=h.findIndex((({bound:e})=>Number(e)<=a));if(-1!==s){const e=h[s-1].interval;return r().duration(e)}return m(a)}function y(e,t){const a=p(e,t);for(const{interval:e}of h)if(e<=a)return r().duration(e);return m(a)}},232:(e,t,a)=>{"use strict";a.d(t,{t:()=>TimeBuckets});var s=a(8915),r=a(770),i=a(1783),n=a.n(i),l=a(2023),o=a(1410),g=a(6494),u=a.n(g),d=a(5008);const c=u().unitsDesc,h=c.indexOf("w");var p=a(6763);function m(e){return e&&"isValid"in e&&e.isValid()}function f(e){return n().isDuration(e)&&Boolean(+e)}class TimeBuckets{constructor(e){(0,s.default)(this,"_timeBucketConfig",void 0),(0,s.default)(this,"_lb",void 0),(0,s.default)(this,"_ub",void 0),(0,s.default)(this,"_originalInterval",null),(0,s.default)(this,"_i",void 0),this._timeBucketConfig=e}getDuration(){if(void 0===this._ub||void 0===this._lb||!this.hasBounds())return;const e=this._ub.valueOf()-this._lb.valueOf();return n().duration(e,"ms")}setBounds(e){if(!e)return this.clearBounds();let t;t=(0,r.isPlainObject)(e)&&!Array.isArray(e)?[e.min,e.max]:Array.isArray(e)?e:[];const a=(0,r.sortBy)(t,Number);if(2!==a.length||!a.every(m))throw this.clearBounds(),new Error("invalid bounds set: "+e);this._lb=a.shift(),this._ub=a.pop();const s=this.getDuration();if(!s||s.asSeconds()<0)throw new TypeError("Intervals must be positive")}clearBounds(){this._lb=this._ub=void 0}hasBounds(){return m(this._ub)&&m(this._lb)}getBounds(){if(this.hasBounds())return{min:this._lb,max:this._ub}}setInterval(e){var t;if(this._originalInterval=null,this._i=(t=e,(0,r.isObject)(t)?e.val:e),this._i&&this._i!==p.B1){if((0,r.isString)(this._i)){const e=(0,l.P1)(this._i);f(e)&&(this._originalInterval=this._i,this._i=e)}if(!f(this._i))throw new TypeError('"'+this._i+'" is not a valid interval.')}else this._i=p.B1}getInterval(e=!0){const t=this.getDuration(),a=f(this._i)?this._i:(0,o._e)(this._timeBucketConfig["histogram:barTarget"],Number(t)),s=t=>{let a;var s;!t.scaled&&this._originalInterval&&(a=null===(s=(0,l.dr)(this._originalInterval))||void 0===s?void 0:s.unit);const r=e||!this._originalInterval?function(e,t){for(let a=0;a<c.length;a++){const s=c[a],r=e.as(s);if(r>=1&&Math.floor(r)===r){if(1===r&&t&&s!==t)continue;if(a<=h&&1!==r)continue;return{value:r,unit:s,expression:r+s}}}const a=e.as("ms");return{value:a,unit:"ms",expression:a+"ms"}}(t,a):function(e){const{value:t,unit:a}=(0,l.nj)(e);return{value:t,unit:a,expression:e}}(this._originalInterval),i=n().normalizeUnits(r.unit),o=function(e,t){if("millisecond"===t)return 1===e?d.i18n.translate("data.search.aggs.buckets.intervalOptions.millisecond",{defaultMessage:"millisecond"}):d.i18n.translate("data.search.aggs.buckets.intervalOptions.milliseconds",{defaultMessage:"{n} milliseconds",values:{n:e}});const a=n().relativeTimeRounding(),s=[{unit:"m",value:60},{unit:"s",value:60},{unit:"ss",value:0},{unit:"ms",value:1e3}],r=s.map((({unit:e})=>n().relativeTimeThreshold(e))),i=Math.pow(10,2);n().relativeTimeRounding((e=>Math.round(e*i)/i)),s.forEach((({unit:e,value:t})=>n().relativeTimeThreshold(e,t)));const l=n().localeData()._config;n().updateLocale(n().locale(),{relativeTime:{ss:e=>1===e?d.i18n.translate("data.search.aggs.buckets.intervalOptions.second",{defaultMessage:"second"}):d.i18n.translate("data.search.aggs.buckets.intervalOptions.seconds",{defaultMessage:"{n} seconds",values:{n:e}}),m:d.i18n.translate("data.search.aggs.buckets.intervalOptions.minute",{defaultMessage:"minute"}),h:d.i18n.translate("data.search.aggs.buckets.intervalOptions.hourly",{defaultMessage:"hour"}),d:d.i18n.translate("data.search.aggs.buckets.intervalOptions.daily",{defaultMessage:"day"}),w:d.i18n.translate("data.search.aggs.buckets.intervalOptions.weekly",{defaultMessage:"week"}),M:d.i18n.translate("data.search.aggs.buckets.intervalOptions.monthly",{defaultMessage:"month"}),y:d.i18n.translate("data.search.aggs.buckets.intervalOptions.yearly",{defaultMessage:"year"})}});const o=n().duration(e,t).locale(d.i18n.getLocale()).humanize();return s.forEach((({unit:e},a)=>n().relativeTimeThreshold(t,r[a]))),n().relativeTimeRounding(a),n().updateLocale(n().locale(),l),o}(r.value,i);return Object.assign(t,{description:o,esValue:r.value,esUnit:r.unit,expression:r.expression})};return s(e?(e=>{if(!this.hasBounds()||!t)return e;const a=this._timeBucketConfig["histogram:maxBars"],r=(0,o.u0)(a,Number(t));let i;return e<r?(i=r,e=s(e),Object.assign(i,{preScaled:e,scale:Number(e)/Number(i),scaled:!0})):e})(a):a)}getScaledDateFormat(){const e=this.getInterval(),t=this._timeBucketConfig["dateFormat:scaled"];for(let a=t.length-1;a>=0;a--){const s=t[a];if(!s[0]||e&&e>=n().duration(s[0]))return s[1]}return this._timeBucketConfig.dateFormat}}},4882:(e,t,a)=>{"use strict";a.d(t,{V:()=>n,v:()=>i});var s=a(5371),r=a(6721);const i="shard_delay",n=()=>new s.a({name:i,title:"Shard Delay",expressionName:r.k,createFilter:()=>({match_all:{}}),customLabels:!1,params:[{name:"delay",type:"string",default:"5s",write(e,t){t.params={...t.params,value:e.params.delay}}}]})},6721:(e,t,a)=>{"use strict";a.d(t,{H:()=>n,k:()=>i});var s=a(5008),r=a(4882);const i="aggShardDelay",n=()=>({name:i,help:s.i18n.translate("data.search.aggs.function.buckets.shardDelay.help",{defaultMessage:"Generates a serialized agg config for a Shard Delay agg"}),type:"agg_type",args:{id:{types:["string"],help:s.i18n.translate("data.search.aggs.buckets.shardDelay.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:s.i18n.translate("data.search.aggs.buckets.shardDelay.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:s.i18n.translate("data.search.aggs.buckets.shardDelay.schema.help",{defaultMessage:"Schema to use for this aggregation"})},delay:{types:["string"],help:s.i18n.translate("data.search.aggs.buckets.shardDelay.delay.help",{defaultMessage:'Delay between shards to process. Example: "5s".'})},json:{types:["string"],help:s.i18n.translate("data.search.aggs.buckets.shardDelay.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:s.i18n.translate("data.search.aggs.buckets.shardDelay.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:r.v,params:{...n}}}}})},2607:(e,t,a)=>{"use strict";a.d(t,{CuU:()=>s.C,dg3:()=>AggConfigs,qLR:()=>h,TO1:()=>c,Jnb:()=>R.J,sow:()=>b.s,QJv:()=>AggTypesRegistry,fXy:()=>AggsCommonService,TDc:()=>_.T,Lnr:()=>k.L,aiG:()=>S.a,buk:()=>CidrMask,yAE:()=>Ot,Gwp:()=>x.G,O0P:()=>Ne,zUd:()=>B.zU,mOS:()=>B.mO,m8W:()=>B.m8,Oq5:()=>N.O,zmd:()=>w,dY5:()=>Tt,mz6:()=>MetricAggType,p0N:()=>MultiFieldKey,o8K:()=>P.o,At2:()=>B.At,z3F:()=>Nt,vZc:()=>Kt.v,lug:()=>C.l,tTJ:()=>A.t,OBf:()=>Yt,hEG:()=>Ht,Efy:()=>Xt,lbX:()=>Jt,cUf:()=>ga,v3f:()=>oa,gdu:()=>pa,Fb7:()=>ha,zAP:()=>va,e0w:()=>ba,mZy:()=>Ra,rjA:()=>wa,ZmW:()=>Oa,OL7:()=>Da,SsN:()=>ja,PAj:()=>Ba,Ca8:()=>E,vQh:()=>T,foF:()=>V,C6H:()=>$,bgr:()=>Qa,i2N:()=>Ya,i5z:()=>Ut,TFY:()=>jt,oXr:()=>J,tbp:()=>W,T1k:()=>Fa,om:()=>Ea,jfr:()=>ie,ejh:()=>re,WVh:()=>es,dKG:()=>Za,dHe:()=>is,W8J:()=>rs,jsV:()=>de,qIu:()=>ue,qew:()=>me,Vjs:()=>pe,Du:()=>Te,CWM:()=>_e,wB5:()=>Re,Vzo:()=>we,uC8:()=>us,jST:()=>gs,AJK:()=>ps,rGL:()=>hs,y3o:()=>Ts,ZO1:()=>_s,mgw:()=>As,VD$:()=>Ms,mXM:()=>Ft,Pp7:()=>Et,mU8:()=>xs,tpD:()=>ks,U6Y:()=>qs,jJm:()=>Os,v0U:()=>ze,qoF:()=>Ge,pMt:()=>Rt,ibD:()=>wt,c9O:()=>Gs,xzq:()=>Us,GFW:()=>Dt,tK_:()=>Lt,REs:()=>Ws,si_:()=>Qs,aw4:()=>Qe,HCP:()=>Ye,C98:()=>et,nv7:()=>Ze,f90:()=>bs,AUv:()=>ys,L69:()=>Ks,mwK:()=>Vs,_Fq:()=>tr,$Bi:()=>er,FeO:()=>ir,W3G:()=>rr,Vog:()=>rt,sAW:()=>st,UGU:()=>zt,Rcq:()=>Gt,_xq:()=>gr,FKr:()=>or,qZi:()=>hr,NkJ:()=>cr,IQS:()=>Pa,zfq:()=>Na,PX$:()=>yr,B1X:()=>v.B1,OI_:()=>De.OI,u0$:()=>De.u0,_er:()=>De._e,N2Z:()=>Ce.N,QyU:()=>Le.Q,I1L:()=>B.I1,F6S:()=>mr,Obw:()=>fr,LaZ:()=>B.L,UeN:()=>Wt,ATn:()=>la,_h9:()=>ca,i23:()=>ya,HLz:()=>Ta,JKe:()=>B.JK,Kd5:()=>xa,HAP:()=>qa,YNN:()=>Ha,MUp:()=>z,H8h:()=>Q,DqD:()=>Xa,qvY:()=>Bt,mOK:()=>se,Bw4:()=>Ia,Zy4:()=>ge,azA:()=>ss,nP5:()=>os,Bum:()=>he,IYs:()=>ve,pSU:()=>Ie,aZK:()=>Pe,EzU:()=>cs,oUU:()=>fs,kY9:()=>Fs,Alz:()=>Rs,_Xw:()=>It,yyA:()=>Ds,aRc:()=>js,ZJo:()=>He,XLV:()=>xt,mvy:()=>$s,IH1:()=>Ct,jb4:()=>Zs,YHK:()=>Xe,czt:()=>at,rFf:()=>Ss,vo0:()=>Ys,uSi:()=>sr,JXX:()=>lr,x0l:()=>bt,OrF:()=>Vt,YhB:()=>dr,cLp:()=>pr,c12:()=>La,s9S:()=>B.s9,WB4:()=>v.WB,JNE:()=>B.JN,za8:()=>v.z,M3U:()=>S.M,itY:()=>G,sy:()=>q,HbO:()=>_t,qSv:()=>qe,Ehy:()=>je,mgc:()=>Be,Xjv:()=>Oe,usJ:()=>B.us,Cec:()=>B.Ce,fYb:()=>Ue,IJq:()=>$a,$Ux:()=>za,spt:()=>B.sp,njO:()=>B.nj,P15:()=>B.P1,vC3:()=>B.vC,EyB:()=>B.Ey,gJ6:()=>ra,RRC:()=>sa,drh:()=>B.dr,zQf:()=>mt,IIR:()=>B.II,pa7:()=>B.p});var s=a(1616),r=a(8915),i=a(2488),n=a.n(i),l=a(770),o=a.n(l),g=a(5008),u=a(5964),d=a(7876);const c=Object.freeze({Buckets:"buckets",Metrics:"metrics",None:"none"}),h={[c.Buckets]:g.i18n.translate("data.search.aggs.aggGroups.bucketsText",{defaultMessage:"Buckets"}),[c.Metrics]:g.i18n.translate("data.search.aggs.aggGroups.metricsText",{defaultMessage:"Metrics"}),[c.None]:g.i18n.translate("data.search.aggs.aggGroups.noneText",{defaultMessage:"None"})};var p=a(4177);function m({type:e="random_sampler",probability:t,seed:a}){return{[e]:{probability:t,seed:a},aggs:{}}}function f(e){for(const t in e)if("parentAggs"===t)delete e[t];else if("object"==typeof e[t]){const a="parentAggs"in e[t];f(e[t]),a&&0===Object.keys(e[t]).length&&delete e[t]}}function y(e,t){t.parentAggs&&o().each(t.parentAggs,((t,a)=>{e[a]=t,y(e,t)}))}class AggConfigs{constructor(e,t=[],a,i){var n;(0,r.default)(this,"timeRange",void 0),(0,r.default)(this,"timeFields",void 0),(0,r.default)(this,"forceNow",void 0),(0,r.default)(this,"aggs",[]),(0,r.default)(this,"timeZone",void 0),(0,r.default)(this,"createAggConfig",((e,{addToAggConfigs:t=!0}={})=>{const{type:a}=e;let r;return e instanceof s.C?(r=e,e.parent=this):r=new s.C(this,{...e,type:"string"==typeof a?(e=>{const t=this.opts.typesRegistry.get(e);if(!t)throw new Error(g.i18n.translate("data.search.aggs.error.aggNotFound",{defaultMessage:'Unable to find a registered agg type for "{type}".',values:{type:a}}));return t})(a):a}),t&&this.aggs.push(r),r})),this.indexPattern=e,this.opts=a,this.getConfig=i,this.timeZone=(0,p.getUserTimeZone)(this.getConfig,null==a||null===(n=a.aggExecutionContext)||void 0===n?void 0:n.shouldDetectTimeZone),(t=s.C.ensureIds(t)).forEach((e=>this.createAggConfig(e)))}get hierarchical(){var e;return null!==(e=this.opts.hierarchical)&&void 0!==e&&e}get partialRows(){var e;return null!==(e=this.opts.partialRows)&&void 0!==e&&e}get samplerConfig(){var e;return{probability:null!==(e=this.opts.probability)&&void 0!==e?e:1,seed:this.opts.samplerSeed}}isSamplingEnabled(){return null!=(e=this.opts.probability)&&1!==e&&this.getRequestAggs().some((e=>!e.type.hasNoDsl));var e}setTimeFields(e){this.timeFields=e}setForceNow(e){this.forceNow=e}setTimeRange(e){this.timeRange=e;const t=a=>{o().each(a.params,(e=>{e instanceof s.C&&t(e)})),"date_histogram"===o().get(a,"type.name")&&(a.params.timeRange=e)};this.aggs.forEach(t)}getResolvedTimeRange(){return this.timeRange&&(0,p.calculateBounds)(this.timeRange,{forceNow:this.forceNow})}clone({enabledOnly:e=!0,opts:t}={}){return new AggConfigs(this.indexPattern,this.aggs.filter((t=>!e||t.enabled)),{...this.opts,...t},this.getConfig)}jsonDataEquals(e){if(e.length!==this.aggs.length)return!1;for(let t=0;t<this.aggs.length;t+=1)if(!o().isEqual(e[t].toJSON(),this.aggs[t].toJSON()))return!1;return!0}toDsl(){const e={};let t,a;const s=this.getTimeShifts(),r=Object.keys(s).length>1;if(this.hierarchical){if(r)throw new Error("Multiple time shifts not supported for hierarchical metrics");a=this.aggs.filter((function(e){return"metrics"===e.type.type&&"count"!==e.type.name})).map((e=>({config:e,dsl:e.toDsl(this)})))}const i=this.getRequestAggs(),l=i.filter((e=>!e.type.hasNoDsl)).length,g=this.getAll().findIndex((e=>"splitForTimeShift"in e.type&&e.type.splitForTimeShift(e,this)));var u;return this.isSamplingEnabled()&&(e.sampling=m({probability:null!==(u=this.opts.probability)&&void 0!==u?u:1,seed:this.opts.samplerSeed})),i.forEach(((i,u,d)=>{if(t){const e=d[u-1],a=t[e.id];t=(null==a?void 0:a.aggs)||t}else t=e,this.isSamplingEnabled()&&(t=t.sampling.aggs);if(r&&(t=function(e,t,a,s,r){if("splitForTimeShift"in t.type&&!t.type.splitForTimeShift(t,e))return s;if(!e.timeFields||e.timeFields.length<1)throw new Error("Time shift can only be used with configured time field");if(!e.timeRange)throw new Error("Time shift can only be used with configured time range");const i=e.timeRange,l={},o=e.timeFields[0],g=(0,p.getTime)(e.indexPattern,i,{fieldName:o,forceNow:e.forceNow});return Object.entries(a).forEach((([e,t])=>{g&&(l[e]={range:{[o]:{format:"strict_date_optional_time",gte:n().tz(g.query.range[o].gte,r).subtract(t).toISOString(),lte:n().tz(g.query.range[o].lte,r).subtract(t).toISOString()}}})})),s.time_offset_split={filters:{filters:l},aggs:{}},s.time_offset_split.aggs}(this,i,s,t,this.timeZone)),i.type.hasNoDsl)return;const h=i.type.hasNoDslParams?i.toDsl(this):t[i.id]=i.toDsl(this);let m;y(t,h),i.type.type===c.Buckets&&(u<l-1||g>u)&&(m=h.aggs||(h.aggs={})),m&&o().each(m,(e=>{y(m,e)})),m&&a&&a.forEach((e=>{m[e.config.id]=e.dsl,e.dsl.parentAggs&&Object.entries(e.dsl.parentAggs).forEach((([e,t])=>{m[e]=t}))}))})),f(e),e}getAll(){return[...this.aggs]}byIndex(e){return this.aggs[e]}byId(e){return this.aggs.find((t=>t.id===e))}byName(e){return this.aggs.filter((t=>{var a;return(null===(a=t.type)||void 0===a?void 0:a.name)===e}))}byType(e){return this.aggs.filter((t=>{var a;return(null===(a=t.type)||void 0===a?void 0:a.type)===e}))}byTypeName(e){return this.byName(e)}bySchemaName(e){return this.aggs.filter((t=>t.schema===e))}getRequestAggs(){const e=this.aggs.filter((e=>e.enabled&&e.type)).reduce(((e,t)=>{const a=t.getRequestAggs();return a?e.concat(a):e}),[]);return o().sortBy(e,(e=>e.type.type===c.Metrics?1:0))}getTimeShifts(){const e={};return this.getAll().filter((e=>"metric"===e.schema)).map((e=>e.getTimeShift())).forEach((t=>{t?e[String(t.asMilliseconds())]=t:e[0]=n().duration(0)})),e}getTimeShiftInterval(){const e=this.getAll().filter((e=>e.type.type===c.Buckets)).find((e=>e.type.splitForTimeShift(e,this)));return null==e?void 0:e.type.getTimeShiftInterval(e)}hasTimeShifts(){return this.getAll().some((e=>e.hasTimeShift()))}getSearchSourceTimeFilter(e){var t;if(!this.timeFields||!this.timeRange)return[];const a=this.timeRange,s=this.timeFields,r=this.getTimeShifts();return this.hasTimeShifts()?[{meta:{index:null===(t=this.indexPattern)||void 0===t?void 0:t.id,params:{},alias:"",disabled:!1,negate:!1},query:{bool:{should:Object.entries(r).map((([,t])=>({bool:{filter:s.map((t=>[(0,p.getTime)(this.indexPattern,a,{fieldName:t,forceNow:e}),t])).filter((([e])=>(0,u.isRangeFilter)(e))).map((([e,a])=>({range:{[a]:{format:"strict_date_optional_time",gte:n().tz(null==e?void 0:e.query.range[a].gte,this.timeZone).subtract(t).toISOString(),lte:n().tz(null==e?void 0:e.query.range[a].lte,this.timeZone).subtract(t).toISOString()}}})))}}))),minimum_should_match:1}}}]:this.timeFields.map((t=>(0,p.getTime)(this.indexPattern,a,{fieldName:t,forceNow:e}))).filter(u.isRangeFilter)}postFlightTransform(e){if(!this.hasTimeShifts())return e;let t=e.rawResponse;var a;return e.rawResponse.aggregations||(t=(0,l.cloneDeep)(e.rawResponse),t.aggregations={doc_count:null===(a=e.rawResponse.hits)||void 0===a?void 0:a.total}),function(e,t){const a=e.getTimeShifts(),s=Object.keys(a).length>1,r=e.getRequestAggs(),i=e.aggs.filter((e=>e.type.type===c.Buckets)),n=(e,t,a,s)=>{Object.entries(t).forEach((([o,g])=>{if("number"==typeof g&&"doc_count"===o)0===a.asMilliseconds()?e.doc_count=g:e[`doc_count_${a.asMilliseconds()}`]=g;else{if("object"!=typeof g)return;{const u=r.find((e=>o===e.getResponseId()));if(u&&u.type.type===c.Metrics){const s=u.getTimeShift();(s&&s.asMilliseconds()===a.asMilliseconds()||0===a.asMilliseconds()&&!s)&&(e[o]=t[o])}else if(u&&u===i[s]){const t=u,r="buckets"in g?g.buckets:void 0;e[o]||(e[o]={buckets:(0,l.isArray)(r)?[]:{}});const i=e[o],d="buckets"in i?i.buckets:void 0;if((0,l.isArray)(r)&&(0,l.isArray)(d)){const e={};d.forEach((t=>{e[String(t.key)]=t})),r.forEach((r=>{const i=t.type.getShiftedKey(t,r.key,a);e[i]||(e[String(i)]={key:i}),n(e[i],r,a,s+1)})),i.buckets=Object.values(e).sort(((e,a)=>t.type.orderBuckets(t,e,a)))}else d&&r&&!(0,l.isArray)(d)&&Object.entries(r).forEach((([e,t])=>{d[e]||(d[e]={}),n(d[e],t,a,s+1)}))}}}}))},o=(t,r)=>{if(e.aggs[r].type.splitForTimeShift(e.aggs[r],e))if(s&&t.time_offset_split){const e=t.time_offset_split.buckets,s={};Object.entries(a).forEach((([t,a])=>{n(s,e[t],a,r)})),delete t.time_offset_split,Object.assign(t,s)}else{const[[,e]]=Object.entries(a),s={};n(s,t,e,r),Object.assign(t,s)}else Object.keys(t).forEach((e=>{const a=t[e];"object"==typeof a&&"buckets"in a&&((0,l.isArray)(a.buckets)?a.buckets.forEach((e=>o(e,r+1))):Object.values(a.buckets).forEach((e=>o(e,r+1))))}))};o(t,0)}(this,this.isSamplingEnabled()?t.aggregations.sampling:t.aggregations),{...e,rawResponse:t}}getRequestAggById(e){return this.aggs.find((t=>t.id===e))}getResponseAggs(){return this.getRequestAggs().reduce((function(e,t){const a=t.getResponseAggs();return a?e.concat(a):e}),[])}getResponseAggById(e){e=String(e);const t=o().find(this.getRequestAggs(),(function(t){const a=String(t.id);return e.includes("[")||e.includes(".")?e.substring(0,-1!==e.indexOf("[")?e.indexOf("["):e.indexOf("."))===a:e===a}));if(t)return o().find(t.getResponseAggs(),{id:e})}onSearchRequestStart(e,t){return Promise.all(this.getRequestAggs().map((a=>a.onSearchRequestStart(e,t))))}toExpressionAst(){return(0,d.buildExpression)([(0,d.buildExpressionFunction)("esaggs",{index:(0,d.buildExpression)([(0,d.buildExpressionFunction)("indexPatternLoad",{id:this.indexPattern.id})]),metricsAtAllLevels:this.hierarchical,partialRows:this.partialRows,aggs:this.aggs.map((e=>(0,d.buildExpression)(e.toExpressionAst()))),probability:this.opts.probability,samplerSeed:this.opts.samplerSeed})]).toAst()}}var b=a(2666),v=a(6763),S=a(5371),_=a(730);const T="aggDateHistogram",E=()=>({name:T,help:g.i18n.translate("data.search.aggs.function.buckets.dateHistogram.help",{defaultMessage:"Generates a serialized agg config for a Histogram agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.dateHistogram.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.buckets.dateHistogram.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.dateHistogram.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.dateHistogram.field.help",{defaultMessage:"Field to use for this aggregation"})},useNormalizedEsInterval:{types:["boolean"],help:g.i18n.translate("data.search.aggs.buckets.dateHistogram.useNormalizedEsInterval.help",{defaultMessage:"Specifies whether to use useNormalizedEsInterval for this aggregation"})},time_zone:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.dateHistogram.timeZone.help",{defaultMessage:"Time zone to use for this aggregation"})},format:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.dateHistogram.format.help",{defaultMessage:"Format to use for this aggregation"})},scaleMetricValues:{types:["boolean"],help:g.i18n.translate("data.search.aggs.buckets.dateHistogram.scaleMetricValues.help",{defaultMessage:"Specifies whether to use scaleMetricValues for this aggregation"})},interval:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.dateHistogram.interval.help",{defaultMessage:"Interval to use for this aggregation"})},timeRange:{types:["timerange"],help:g.i18n.translate("data.search.aggs.buckets.dateHistogram.timeRange.help",{defaultMessage:"Time Range to use for this aggregation"})},min_doc_count:{types:["number"],help:g.i18n.translate("data.search.aggs.buckets.dateHistogram.minDocCount.help",{defaultMessage:"Minimum document count to use for this aggregation"})},drop_partials:{types:["boolean"],help:g.i18n.translate("data.search.aggs.buckets.dateHistogram.dropPartials.help",{defaultMessage:"Specifies whether to use drop_partials for this aggregation"})},extended_bounds:{types:["extended_bounds"],help:g.i18n.translate("data.search.aggs.buckets.dateHistogram.extendedBounds.help",{defaultMessage:'With extended_bounds setting, you now can "force" the histogram aggregation to start building buckets on a specific min value and also keep on building buckets up to a max value '})},extendToTimeRange:{types:["boolean"],help:g.i18n.translate("data.search.aggs.buckets.dateHistogram.extendToTimeRange.help",{defaultMessage:"Auto-sets the extended bounds to the currently applied time range. Is ignored if extended_bounds is set"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.dateHistogram.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.dateHistogram.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,timeRange:r,extended_bounds:i,...n})=>({type:"agg_type",value:{id:t,enabled:a,schema:s,params:{...n,timeRange:r&&(0,l.omit)(r,"type"),extended_bounds:i&&(0,l.omit)(i,"type")},type:_.T.DATE_HISTOGRAM}})});var F=a(8686);const M=(e,t)=>{const a=n().tz(t,e.aggConfigs.timeZone),s=e.buckets.getInterval();return(0,u.buildRangeFilter)(e.params.field,{gte:a.toISOString(),lt:a.add(s).toISOString(),format:"strict_date_optional_time"},e.getIndexPattern())};var A=a(232),I=a(9800);let w=function(e){return e.AVG="avg",e.FILTERED_METRIC="filtered_metric",e.CARDINALITY="cardinality",e.VALUE_COUNT="value_count",e.AVG_BUCKET="avg_bucket",e.MAX_BUCKET="max_bucket",e.MIN_BUCKET="min_bucket",e.SUM_BUCKET="sum_bucket",e.COUNT="count",e.CUMULATIVE_SUM="cumulative_sum",e.DERIVATIVE="derivative",e.GEO_BOUNDS="geo_bounds",e.GEO_CENTROID="geo_centroid",e.MEDIAN="median",e.SINGLE_PERCENTILE="single_percentile",e.SINGLE_PERCENTILE_RANK="single_percentile_rank",e.MIN="min",e.MAX="max",e.MOVING_FN="moving_avg",e.SERIAL_DIFF="serial_diff",e.SUM="sum",e.TOP_HITS="top_hits",e.TOP_METRICS="top_metrics",e.PERCENTILES="percentiles",e.PERCENTILE_RANKS="percentile_ranks",e.RATE="rate",e.STD_DEV="std_dev",e}({});var R=a(5675),k=a(8409),x=a(6286),N=a(6490),P=a(6252),C=a(8201);const L=(e,t)=>{const a=e.getIndexPattern();if(e.getField())return(0,u.buildExistsFilter)(e.getField(),a)},D=(e,t)=>{const a=e.getIndexPattern(),s=e.getField();if(s)return Array.isArray(t)?(0,u.buildCombinedFilter)(u.BooleanRelation.OR,t.map((e=>(0,u.buildPhraseFilter)(s,e,a))),a):(0,u.buildPhraseFilter)(s,t,a)},O="metrics";class MetricAggType extends b.s{constructor(e){e.createFilter||(e.createFilter=L),super(e),(0,r.default)(this,"subtype",void 0),(0,r.default)(this,"isScalable",void 0),(0,r.default)(this,"type",O),(0,r.default)(this,"getKey",(()=>{})),this.params.push(new k.L({name:"timeShift",type:"string",write:()=>{}})),e.enableEmptyAsNull&&this.params.push(new k.L({name:"emptyAsNull",type:"boolean",default:!1,write:()=>{}})),this.getValue=e.getValue||((e,t)=>{const a=[w.CARDINALITY,w.VALUE_COUNT,w.SUM].includes(e.type.name);if(!t[e.id]&&a&&!e.params.emptyAsNull)return 0;const s=t[e.id]&&t[e.id].value;return 0===s&&e.params.emptyAsNull?null:s}),this.subtype=e.subtype||g.i18n.translate("data.search.aggs.metrics.metricAggregationsSubtypeTitle",{defaultMessage:"Metric Aggregations"}),this.isScalable=e.isScalable||(()=>!1),this.splitForTimeShift=(e,t)=>t.hasTimeShifts()&&t.byType(c.Metrics)[0]===e&&!t.byType(c.Buckets).some((e=>e.type.splitForTimeShift(e,t)))}}function q(e){return e&&e.type===O}var B=a(2023),j=a(3721);const U=(e,t,a)=>{const s=e.params.timeRange&&(e.fieldIsTimeField()||(0,v.z)(e.params.interval))?t(e.params.timeRange):void 0,r=a||e.buckets;r.setBounds(s),r.setInterval(e.params.interval)};function G(e){return Boolean(e.buckets)}const z=({calculateBounds:e,aggExecutionContext:t,getConfig:a})=>new S.a({name:_.T.DATE_HISTOGRAM,expressionName:T,title:g.i18n.translate("data.search.aggs.buckets.dateHistogramTitle",{defaultMessage:"Date Histogram"}),ordered:{date:!0},makeLabel(e){let t={};this.params&&(t=(0,I.m)(this.params,e));const a=e.getFieldDisplayName();return g.i18n.translate("data.search.aggs.buckets.dateHistogramLabel",{defaultMessage:"{fieldName} per {intervalDescription}",values:{fieldName:a,intervalDescription:t.metricScaleText||t.bucketInterval.description}})},createFilter:M,decorateAggConfig(){let t;return{buckets:{configurable:!0,get(){if(t)return t;t=new A.t({"histogram:maxBars":a(p.UI_SETTINGS.HISTOGRAM_MAX_BARS),"histogram:barTarget":a(p.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:a("dateFormat"),"dateFormat:scaled":a("dateFormat:scaled")});try{U(this,e,t)}catch(e){j.error(e)}return t}}}},getSerializedFormat:e=>({id:"date",params:{pattern:e.buckets.getScaledDateFormat()}}),getShiftedKey(e,s,r){const i=(0,B.s9)(e.params,e.getIndexPattern(),"date_histogram",a,t);return n().tz(s,i).add(r).valueOf()},splitForTimeShift(e,t){var a;return t.hasTimeShifts()&&Boolean(null===(a=t.timeFields)||void 0===a?void 0:a.includes(e.fieldName()))},getTimeShiftInterval(e){const{useNormalizedEsInterval:t}=e.params;return e.buckets.getInterval(t)},params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.DATE,p.KBN_FIELD_TYPES.DATE_RANGE],default(e){var t,a,s;return null===(t=(a=e.getIndexPattern()).getTimeField)||void 0===t||null===(s=t.call(a))||void 0===s?void 0:s.name},onChange(e){(0,v.z)((0,l.get)(e,"params.interval"))&&!e.fieldIsTimeField()&&delete e.params.interval}},{name:"timeRange",default:null,write:l.noop,toExpressionAst:F.timerangeToAst},{name:"useNormalizedEsInterval",default:!0,write:l.noop},{name:"extendToTimeRange",default:!1,write:l.noop},{name:"scaleMetricValues",default:!1,write:l.noop,advanced:!0},{name:"interval",deserialize:(e,t)=>"custom"===e?(0,l.get)(t,"params.customInterval"):(0,l.find)(v.WB,{val:e})||"year"!==e?e:"y",default:v.B1,options:v.WB,write(t,a,s){var r,i;U(t,e);const{useNormalizedEsInterval:n,scaleMetricValues:o}=t.params,g=t.buckets.getInterval(n);if(a.bucketInterval=g,"0ms"===g.expression)return;const u=null===(r=t.params.field)||void 0===r||null===(i=r.fixedInterval)||void 0===i?void 0:i.length;if(a.params={...a.params,...(0,B.I1)(g.expression,u)},o&&g.scaled&&g.scale&&g.scale<1&&s){const e=s.aggs.filter((e=>q(e.type)));var d;(0,l.every)(e,(e=>{const{type:t}=e;if(q(t))return t.isScalable()}))&&(a.metricScale=g.scale,a.metricScaleText=(null===(d=g.preScaled)||void 0===d?void 0:d.description)||"")}}},{name:"used_interval",default:v.B1,shouldShow:()=>!1,write:()=>{},serialize(e,t){if(!t)return;const{useNormalizedEsInterval:a}=t.params;return t.buckets.getInterval(a).expression},toExpressionAst:()=>{}},{name:"time_zone",default:void 0,serialize:l.noop,write(e,s){var r,i;const n=(0,B.s9)(e.params,e.getIndexPattern(),"date_histogram",a,t),l=null===(r=e.params.field)||void 0===r||null===(i=r.timeZone)||void 0===i?void 0:i.includes("UTC");s.params.time_zone=l?"UTC":n}},{name:"used_timezone",shouldShow:()=>!1,write:()=>{},serialize(e,s){if(s)return(0,B.s9)(s.params,s.getIndexPattern(),"date_histogram",a,t)},toExpressionAst:()=>{}},{name:"drop_partials",default:!1,write:l.noop,shouldShow:e=>{const t=e.params.field;return t&&t.name&&t.name===e.getIndexPattern().timeFieldName}},{name:"format"},{name:"min_doc_count",default:1},{name:"extended_bounds",default:{},write(e,s){const r=e.params.extended_bounds,i=(0,B.s9)(e.params,e.getIndexPattern(),"date_histogram",a,t);if(null==r.min&&null==r.max){if(e.params.extendToTimeRange&&e.buckets.hasBounds()&&!e.aggConfigs.hasTimeShifts()){var o,g;const t=e.buckets.getBounds();s.params.extended_bounds=(0,l.omitBy)({min:null===(o=t.min)||void 0===o?void 0:o.valueOf(),max:null===(g=t.max)||void 0===g?void 0:g.valueOf()},l.isNil)}}else s.params.extended_bounds={min:n().tz(r.min,i).valueOf(),max:n().tz(r.max,i).valueOf()}},toExpressionAst:F.extendedBoundsToAst}]}),$="aggDateRange",V=()=>({name:$,help:g.i18n.translate("data.search.aggs.function.buckets.dateRange.help",{defaultMessage:"Generates a serialized agg config for a Date Range agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.dateRange.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.buckets.dateRange.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.dateRange.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.dateRange.field.help",{defaultMessage:"Field to use for this aggregation"})},ranges:{types:["date_range"],multi:!0,help:g.i18n.translate("data.search.aggs.buckets.dateRange.ranges.help",{defaultMessage:"Ranges to use for this aggregation."})},time_zone:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.dateRange.timeZone.help",{defaultMessage:"Time zone to use for this aggregation."})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.dateRange.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.dateRange.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,ranges:r,...i})=>({type:"agg_type",value:{id:t,enabled:a,schema:s,params:{...i,ranges:null==r?void 0:r.map((e=>(0,l.omit)(e,"type")))},type:_.T.DATE_RANGE}})}),K=(e,{from:t,to:a})=>{const s={};return t&&(s.gte=n().tz(t,e.aggConfigs.timeZone).toISOString()),a&&(s.lt=n().tz(a,e.aggConfigs.timeZone).toISOString()),a&&t&&(s.format="strict_date_optional_time"),(0,u.buildRangeFilter)(e.params.field,s,e.getIndexPattern())};var H=a(2956);const Y=g.i18n.translate("data.search.aggs.buckets.dateRangeTitle",{defaultMessage:"Date Range"}),Q=({aggExecutionContext:e,getConfig:t})=>new S.a({name:_.T.DATE_RANGE,expressionName:$,title:Y,createFilter:K,getKey:({from:e,to:t})=>({from:e,to:t}),getSerializedFormat:e=>({id:"date_range",params:e.params.field?e.aggConfigs.indexPattern.getFormatterForField(e.params.field).toJSON():{}}),makeLabel:e=>e.getFieldDisplayName()+" date ranges",params:[{name:"field",type:"field",filterFieldTypes:[H.f.DATE,H.f.DATE_RANGE],default(e){var t,a,s;return null===(t=(a=e.getIndexPattern()).getTimeField)||void 0===t||null===(s=t.call(a))||void 0===s?void 0:s.name}},{name:"ranges",default:[{from:"now-1w/w",to:"now"}],toExpressionAst:e=>null==e?void 0:e.map(F.dateRangeToAst)},{name:"time_zone",default:void 0,serialize:()=>{},write:(a,s)=>{const r=(0,p.inferTimeZone)(a.params,a.getIndexPattern(),"date_range",t,e);s.params.time_zone=r}}]}),W="aggFilter",J=()=>({name:W,help:g.i18n.translate("data.search.aggs.function.buckets.filter.help",{defaultMessage:"Generates a serialized agg config for a Filter agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.filter.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.buckets.filter.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.filter.schema.help",{defaultMessage:"Schema to use for this aggregation"})},geo_bounding_box:{types:["geo_bounding_box"],help:g.i18n.translate("data.search.aggs.buckets.filter.geoBoundingBox.help",{defaultMessage:"Filter results based on a point location within a bounding box"})},filter:{types:["kibana_query"],help:g.i18n.translate("data.search.aggs.buckets.filter.filter.help",{defaultMessage:"Filter results based on a kql or lucene query. Do not use together with geo_bounding_box"})},timeWindow:{types:["string"],help:""},timeShift:{types:["string"],help:""},json:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.filter.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.filter.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,geo_bounding_box:r,filter:i,...n})=>{if(r&&i)throw new Error("filter and geo_bounding_box can't be used together");return{type:"agg_type",value:{id:t,enabled:a,schema:s,params:{...n,geo_bounding_box:r&&(0,l.omit)(r,"type"),filter:i&&(0,l.omit)(i,"type")},type:_.T.FILTER}}}});var X=a(1783),Z=a.n(X),ee=a(8351),te=a(3721);const ae=g.i18n.translate("data.search.aggs.buckets.filterTitle",{defaultMessage:"Filter"}),se=({getConfig:e,calculateBounds:t})=>new S.a({name:_.T.FILTER,expressionName:W,title:ae,makeLabel:()=>ae,params:[{name:"geo_bounding_box",toExpressionAst:F.geoBoundingBoxToAst},{name:"timeShift",type:"string",write:()=>{}},{name:"timeWindow",write:()=>{}},{name:"filter",write(a,s,r){const i=a.params.filter,n=a.params.timeWindow,o=(0,l.cloneDeep)(i);if(!o&&!n)return;if(!r)return;let g;if(o){const t=(0,ee.F)({get:e});if(g=(0,u.buildEsQuery)(a.getIndexPattern(),[o],[],t),!g)return void te.log('malformed filter agg params, missing "query" on input')}const d=r.timeRange?Z()(t(r.timeRange).max):void 0;s.params=n&&d&&a.getIndexPattern().timeFieldName?{bool:{filter:[{range:{[a.getIndexPattern().timeFieldName]:{format:"strict_date_optional_time",gte:d.clone().subtract((0,B.P1)(n)).subtract(a.getTimeShift()).toISOString(),lte:d.clone().subtract(a.getTimeShift()).toISOString()}}},g||void 0].filter(Boolean)}}:g},toExpressionAst:F.queryToAst}]}),re="aggFilters",ie=()=>({name:re,help:g.i18n.translate("data.search.aggs.function.buckets.filters.help",{defaultMessage:"Generates a serialized agg config for a Filter agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.filters.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.buckets.filters.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.filters.schema.help",{defaultMessage:"Schema to use for this aggregation"})},filters:{types:["kibana_query_filter"],multi:!0,help:g.i18n.translate("data.search.aggs.buckets.filters.filters.help",{defaultMessage:"Filters to use for this aggregation"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.filters.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})}},fn:(e,{id:t,enabled:a,schema:s,filters:r,...i})=>({type:"agg_type",value:{id:t,enabled:a,schema:s,params:{...i,filters:null==r?void 0:r.map((e=>(0,l.omit)(e,"type")))},type:_.T.FILTERS}})}),ne=(e,t)=>{const a=(0,l.get)(e.toDsl(),"filters.filters")[t],s=e.getIndexPattern();if(a&&s&&s.id)return(0,u.buildQueryFilter)(a,s.id,t)};var le=a(3721);const oe=g.i18n.translate("data.search.aggs.buckets.filtersTitle",{defaultMessage:"Filters",description:"The name of an aggregation, that allows to specify multiple individual filters to group data by."}),ge=({getConfig:e})=>new S.a({name:_.T.FILTERS,expressionName:re,title:oe,createFilter:ne,customLabels:!1,params:[{name:"filters",default:()=>[{input:{query:"",language:e(p.UI_SETTINGS.SEARCH_QUERY_LANGUAGE)},label:""}],write(t,a){const s=t.params.filters;if(!(0,l.size)(s))return;const r=(0,l.transform)(s,(function(a,s){const r=(0,l.cloneDeep)(s.input);if(!r)return void le.log('malformed filter agg params, missing "input" query');const i=(0,p.getEsQueryConfig)({get:e}),n=(0,u.buildEsQuery)(t.getIndexPattern(),[r],[],i);if(!n)return void le.log('malformed filter agg params, missing "query" on input');const o=""===s.input.query?"*":"";a[s.label||o||("string"==typeof s.input.query?s.input.query:JSON.stringify(s.input.query))]=n}),{});(0,l.size)(r)&&((a.params||(a.params={})).filters=r)},toExpressionAst:e=>null==e?void 0:e.map(F.queryFilterToAst)}]}),ue="aggGeoTile",de=()=>({name:ue,help:g.i18n.translate("data.search.aggs.function.buckets.geoTile.help",{defaultMessage:"Generates a serialized agg config for a Geo Tile agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.geoTile.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.buckets.geoTile.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.geoTile.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.buckets.geoTile.field.help",{defaultMessage:"Field to use for this aggregation"})},useGeocentroid:{types:["boolean"],help:g.i18n.translate("data.search.aggs.buckets.geoTile.useGeocentroid.help",{defaultMessage:"Specifies whether to use geocentroid for this aggregation"})},precision:{types:["number"],help:g.i18n.translate("data.search.aggs.buckets.geoTile.precision.help",{defaultMessage:"Precision to use for this aggregation."})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.geoTile.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.geoTile.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:_.T.GEOTILE_GRID,params:{...i}}}}}),ce=g.i18n.translate("data.search.aggs.buckets.geotileGridTitle",{defaultMessage:"Geotile"}),he=()=>new S.a({name:_.T.GEOTILE_GRID,expressionName:ue,title:ce,params:[{name:"field",type:"field",filterFieldTypes:p.KBN_FIELD_TYPES.GEO_POINT},{name:"useGeocentroid",default:!0,write:l.noop},{name:"precision",default:0}],getRequestAggs(e){const t=[],a=e.getParam("useGeocentroid");if(t.push(e),a){const a={type:w.GEO_CENTROID,enabled:!0,params:{field:e.getField()}};t.push(e.aggConfigs.createAggConfig(a,{addToAggConfigs:!1}))}return t}}),pe="aggHistogram",me=()=>({name:pe,help:g.i18n.translate("data.search.aggs.function.buckets.histogram.help",{defaultMessage:"Generates a serialized agg config for a Histogram agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.histogram.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.buckets.histogram.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.histogram.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.buckets.histogram.field.help",{defaultMessage:"Field to use for this aggregation"})},interval:{types:["number","string"],required:!0,help:g.i18n.translate("data.search.aggs.buckets.histogram.interval.help",{defaultMessage:"Interval to use for this aggregation"})},intervalBase:{types:["number"],help:g.i18n.translate("data.search.aggs.buckets.histogram.intervalBase.help",{defaultMessage:"IntervalBase to use for this aggregation"})},min_doc_count:{types:["boolean"],help:g.i18n.translate("data.search.aggs.buckets.histogram.minDocCount.help",{defaultMessage:"Specifies whether to use min_doc_count for this aggregation"})},maxBars:{types:["number"],help:g.i18n.translate("data.search.aggs.buckets.histogram.maxBars.help",{defaultMessage:"Calculate interval to get approximately this many bars"})},autoExtendBounds:{types:["boolean"],help:g.i18n.translate("data.search.aggs.buckets.histogram.autoExtendBounds.help",{defaultMessage:"Set to true to extend bounds to the domain of the data. This makes sure each interval bucket within these bounds will create a separate table row"})},has_extended_bounds:{types:["boolean"],help:g.i18n.translate("data.search.aggs.buckets.histogram.hasExtendedBounds.help",{defaultMessage:"Specifies whether to use has_extended_bounds for this aggregation"})},extended_bounds:{types:["extended_bounds"],help:g.i18n.translate("data.search.aggs.buckets.histogram.extendedBounds.help",{defaultMessage:'With extended_bounds setting, you now can "force" the histogram aggregation to start building buckets on a specific min value and also keep on building buckets up to a max value '})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.histogram.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.histogram.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,extended_bounds:r,...i})=>({type:"agg_type",value:{id:t,enabled:a,schema:s,params:{...i,extended_bounds:r&&(0,l.omit)(r,"type")},type:_.T.HISTOGRAM}})}),fe=e=>(t,a)=>{const{deserialize:s}=e(),r=parseInt(a,10),i={gte:r,lt:r+("number"==typeof t.params.used_interval?t.params.used_interval:t.params.interval)};return(0,u.buildRangeFilter)(t.params.field,i,t.getIndexPattern(),s(t.toSerializedFieldFormat()).convert(a))};var ye=a(7371);const be=({interval:e,maxBucketsUiSettings:t,maxBucketsUserInput:a,intervalBase:s,values:r,esTypes:i})=>{const n=(0,v.z)(e);let l=n?0:"number"!=typeof e?parseFloat(e):e;if(Number.isNaN(l))return l;if(r){const e=r.max-r.min;e&&(l=n?((e,t,a)=>{const s=e/t;if(e<t&&a.every((e=>[ye._.INTEGER,ye._.LONG,ye._.SHORT,ye._.BYTE].includes(e))))return 1;const r=Math.pow(10,Math.floor(Math.log10(s))),i=e/r;return i>t?i/2<=t?2*r:i/5<=t?5*r:10*r:r})(e,Math.min(t,a||t),i):((e,t,a)=>e/t>a?(e=>{const t=Math.pow(10,Math.floor(Math.log10(e)));let a=t;for(;a<e;)a+=t;return a})(e/a):t)(e,l,t))}return s&&(l<s?l=s:l%s!=0&&(l=Math.round(l/s)*s)),l||1},ve=({getConfig:e,getFieldFormatsStart:t})=>new S.a({name:_.T.HISTOGRAM,expressionName:pe,title:g.i18n.translate("data.search.aggs.buckets.histogramTitle",{defaultMessage:"Histogram"}),ordered:{},makeLabel:e=>e.getFieldDisplayName(),createFilter:fe(t),decorateAggConfig(){let e;return{setAutoBounds:{configurable:!0,value(t){e=t}},getAutoBounds:{configurable:!0,value:()=>e}}},params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.NUMBER_RANGE]},{name:"intervalBase",default:null,write:()=>{}},{name:"autoExtendBounds",default:!1,write:()=>{}},{name:"interval",default:v.B1,modifyAggConfigOnSearchRequestStart(e,t,a){const s=e.getField();if("number_range"===(null==s?void 0:s.type))return;const r=s.scripted?{script:{source:s.script,lang:s.lang}}:{field:s.name};return t.createChild().setField("size",0).setField("aggs",{maxAgg:{max:r},minAgg:{min:r}}).fetch(a).then((t=>{var a,s,r,i,n,l;const o=null!==(a=null===(s=t.aggregations)||void 0===s||null===(r=s.minAgg)||void 0===r?void 0:r.value)&&void 0!==a?a:0,g=null!==(i=null===(n=t.aggregations)||void 0===n||null===(l=n.maxAgg)||void 0===l?void 0:l.value)&&void 0!==i?i:0;e.setAutoBounds({min:o,max:g})})).catch((e=>{if("AbortError"!==e.name){if("KQLSyntaxError"===e.name)throw e;throw new Error(g.i18n.translate("data.search.aggs.histogram.missingMaxMinValuesWarning",{defaultMessage:"Unable to retrieve max and min values to auto-scale histogram buckets. This may lead to poor visualization performance."}))}}))},write(t,a){a.params.interval=Se(t,e)}},{name:"used_interval",default:v.B1,shouldShow:()=>!1,write:()=>{},serialize(t,a){if(a)return Se(a,e)},toExpressionAst:()=>{}},{name:"maxBars",shouldShow(e){const t=e.getField();return"number_range"!==(null==t?void 0:t.type)&&(0,v.z)((0,l.get)(e,"params.interval"))},write:()=>{}},{name:"min_doc_count",default:!1,write(e,t){e.params.min_doc_count?t.params.min_doc_count=0:t.params.min_doc_count=1}},{name:"has_extended_bounds",default:!1,write:()=>{}},{name:"extended_bounds",default:{min:"",max:""},write(e,t){const{min:a,max:s}=e.params.extended_bounds;!e.params.has_extended_bounds||!a&&0!==a||!s&&0!==s?e.params.autoExtendBounds&&e.getAutoBounds()&&(t.params.extended_bounds=e.getAutoBounds()):t.params.extended_bounds={min:a,max:s}},shouldShow:e=>e.params.has_extended_bounds,toExpressionAst:F.extendedBoundsToAst}]});function Se(e,t){var a,s;const r=e.getAutoBounds();return be({values:r,interval:e.params.interval,maxBucketsUiSettings:t(p.UI_SETTINGS.HISTOGRAM_MAX_BARS),maxBucketsUserInput:e.params.maxBars,intervalBase:e.params.intervalBase,esTypes:(null===(a=e.params.field)||void 0===a||null===(s=a.spec)||void 0===s?void 0:s.esTypes)||[]})}const _e="aggIpPrefix",Te=()=>({name:_e,help:g.i18n.translate("data.search.aggs.function.buckets.ipPrefix.help",{defaultMessage:"Generates a serialized agg config for a Ip Prefix agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.ipPrefix.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.buckets.ipPrefix.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.ipPrefix.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.buckets.ipPrefix.field.help",{defaultMessage:"Field to use for this aggregation"})},ipPrefix:{types:["ip_prefix"],help:g.i18n.translate("data.search.aggs.buckets.ipPrefix.help",{defaultMessage:"Length of the network prefix and whether it is for IPv4 or IPv6"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.ipPrefix.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.ipPrefix.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,...r})=>({type:"agg_type",value:{id:t,enabled:a,schema:s,type:_.T.IP_PREFIX,params:{...r}}})});var Ee=a(6880),Fe=a.n(Ee);class CidrMask{static getNetmask(e,t){return new Array(e).fill(255).map(((e,a)=>{const s=8-Math.min(Math.max(t-8*a,0),8);return e>>s<<s}))}constructor(e){(0,r.default)(this,"address",void 0),(0,r.default)(this,"netmask",void 0),(0,r.default)(this,"prefix",void 0);try{const[t,a]=Fe().parseCIDR(e);this.address=t.toByteArray(),this.netmask=CidrMask.getNetmask(this.address.length,a),this.prefix=a}catch{throw Error("Invalid CIDR mask: "+e)}}getBroadcastAddress(){const e=this.address.map(((e,t)=>e|255^this.netmask[t]));return new B.m8(e).toString()}getNetworkAddress(){const e=this.address.map(((e,t)=>e&this.netmask[t]));return new B.m8(e).toString()}getRange(){return{from:this.getNetworkAddress(),to:this.getBroadcastAddress()}}toString(){return`${new B.m8(this.address)}/${this.prefix}`}}const Me=(e,t)=>{let a=t.address;a.includes(".")&&t.prefix_length>=96&&(a="::ffff:"+t.address);const s=new CidrMask(a+"/"+t.prefix_length).getRange();return(0,u.buildRangeFilter)(e.params.field,{gte:s.from,lte:s.to},e.getIndexPattern())},Ae=g.i18n.translate("data.search.aggs.buckets.ipPrefixTitle",{defaultMessage:"IP Prefix"}),Ie=()=>new S.a({name:_.T.IP_PREFIX,expressionName:_e,title:Ae,createFilter:Me,getKey:(e,t,a)=>({type:"ip_prefix",address:t,prefix_length:e.prefix_length}),getSerializedFormat:e=>({id:"ip_prefix",params:e.params.field?e.aggConfigs.indexPattern.getFormatterForField(e.params.field).toJSON():{}}),makeLabel:e=>g.i18n.translate("data.search.aggs.buckets.ipPrefixLabel",{defaultMessage:"{fieldName} IP prefixes",values:{fieldName:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:p.KBN_FIELD_TYPES.IP},{name:"ipPrefix",default:{prefixLength:0,isIpv6:!1},write:(e,t)=>{t.params.prefix_length=e.params.ipPrefix.prefixLength,t.params.is_ipv6=e.params.ipPrefix.isIpv6},toExpressionAst:F.ipPrefixToAst}]}),we="aggIpRange",Re=()=>({name:we,help:g.i18n.translate("data.search.aggs.function.buckets.ipRange.help",{defaultMessage:"Generates a serialized agg config for a Ip Range agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.ipRange.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.buckets.ipRange.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.ipRange.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.buckets.ipRange.field.help",{defaultMessage:"Field to use for this aggregation"})},ipRangeType:{types:["string"],options:["mask","fromTo"],help:g.i18n.translate("data.search.aggs.buckets.ipRange.ipRangeType.help",{defaultMessage:"IP range type to use for this aggregation. Takes one of the following values: mask, fromTo."})},ranges:{types:["cidr","ip_range"],multi:!0,help:g.i18n.translate("data.search.aggs.buckets.ipRange.ranges.help",{defaultMessage:"Ranges to use for this aggregation."})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.ipRange.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.ipRange.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,ranges:r,...i})=>{const{ip_range:n,cidr:o}=(0,l.mapValues)((0,l.groupBy)(r,"type"),(e=>(0,l.map)(e,(e=>(0,l.omit)(e,"type"))))),g=(0,l.omitBy)({fromTo:n,mask:o},l.isNil);return{type:"agg_type",value:{id:t,enabled:a,schema:s,type:_.T.IP_RANGE,params:{...i,ranges:(0,l.isEmpty)(g)?void 0:g}}}}}),ke=(e,t)=>{let a;return a="mask"===t.type?new CidrMask(t.mask).getRange():{from:t.from?t.from:-1/0,to:t.to?t.to:1/0},(0,u.buildRangeFilter)(e.params.field,{gte:a.from,lte:a.to},e.getIndexPattern())},xe=g.i18n.translate("data.search.aggs.buckets.ipRangeTitle",{defaultMessage:"IP Range"});let Ne=function(e){return e.FROM_TO="fromTo",e.MASK="mask",e}({});const Pe=()=>new S.a({name:_.T.IP_RANGE,expressionName:we,title:xe,createFilter:ke,getKey:(e,t,a)=>a.params.ipRangeType===Ne.MASK?{type:"mask",mask:t}:{type:"range",from:e.from,to:e.to},getSerializedFormat:e=>({id:"ip_range",params:e.params.field?e.aggConfigs.indexPattern.getFormatterForField(e.params.field).toJSON():{}}),makeLabel:e=>g.i18n.translate("data.search.aggs.buckets.ipRangeLabel",{defaultMessage:"{fieldName} IP ranges",values:{fieldName:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:p.KBN_FIELD_TYPES.IP},{name:"ipRangeType",default:Ne.FROM_TO,write:l.noop},{name:"ranges",default:{fromTo:[{from:"0.0.0.0",to:"127.255.255.255"},{from:"128.0.0.0",to:"191.255.255.255"}],mask:[{mask:"0.0.0.0/1"},{mask:"128.0.0.0/2"}]},write(e,t){const a=e.params.ipRangeType;let s=e.params.ranges[a];a===Ne.FROM_TO&&(s=(0,l.map)(s,(e=>(0,l.omitBy)(e,l.isNull)))),t.params.ranges=s},toExpressionAst:e=>[...(0,l.map)(null==e?void 0:e[Ne.FROM_TO],F.ipRangeToAst),...(0,l.map)(null==e?void 0:e[Ne.MASK],F.cidrToAst)]}]});var Ce=a(6034),Le=a(4611),De=a(1410);const Oe=(...e)=>t=>{const a=t.params.field;return e.some((e=>a&&a.type===e))},qe=Oe("number"),Be=Oe("string"),je=Oe("string","number"),Ue={serialize(e,t){if(!this.shouldShow||this.shouldShow(t))return!e||(0,l.isString)(e)||Array.isArray(e)?e:e.pattern},write(e,t){const a=e.getParam(this.name);if(Array.isArray(a)&&a.length>0&&qe(e)){const e=a.filter((e=>Number.isFinite(e)));e.length&&(t.params[this.name]=e)}else if(Array.isArray(a)&&a.length>0&&Be(e)){const s=a.filter((e=>""!==e));if(s.length){const a=e.getParam(`${this.name}IsRegex`);t.params[this.name]=a?s[0]:s}}else(0,l.isObject)(a)?t.params[this.name]=a.pattern:a&&Be(e)&&(t.params[this.name]=a)}},Ge="aggRange",ze=()=>({name:Ge,help:g.i18n.translate("data.search.aggs.function.buckets.range.help",{defaultMessage:"Generates a serialized agg config for a Range agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.range.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.buckets.range.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.range.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.buckets.range.field.help",{defaultMessage:"Field to use for this aggregation"})},ranges:{types:["numerical_range"],multi:!0,help:g.i18n.translate("data.search.aggs.buckets.range.ranges.help",{defaultMessage:"Serialized ranges to use for this aggregation."})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.range.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.range.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,ranges:r,...i})=>({type:"agg_type",value:{id:t,enabled:a,schema:s,params:{...i,ranges:null==r?void 0:r.map((e=>(0,l.omit)(e,"type")))},type:_.T.RANGE}})}),$e=Symbol("id");class RangeKey{findCustomLabel(e,t,a){var s;return null===(s=(a||[]).find((a=>(null==e&&null==a.from||a.from===e)&&(null==t&&null==a.to||a.to===t))))||void 0===s?void 0:s.label}constructor(e,t){(0,r.default)(this,$e,void 0),(0,r.default)(this,"gte",void 0),(0,r.default)(this,"lt",void 0),(0,r.default)(this,"label",void 0),this.gte=null==e.from?-1/0:e.from,this.lt=null==e.to?1/0:e.to,this.label=this.findCustomLabel(e.from,e.to,t),this[$e]=RangeKey.idBucket(e)}static idBucket(e){return`from:${e.from},to:${e.to}`}toString(){return this[$e]}}const Ve=e=>(t,{label:a,...s})=>{const{deserialize:r}=e();return(0,u.buildRangeFilter)(t.params.field,s,t.getIndexPattern(),r(t.toSerializedFieldFormat()).convert(s))},Ke=g.i18n.translate("data.search.aggs.buckets.rangeTitle",{defaultMessage:"Range"}),He=({getFieldFormatsStart:e})=>{const t=new WeakMap;return new S.a({name:_.T.RANGE,expressionName:Ge,title:Ke,createFilter:Ve(e),makeLabel:e=>g.i18n.translate("data.search.aggs.aggTypesLabel",{defaultMessage:"{fieldName} ranges",values:{fieldName:e.getFieldDisplayName()}}),getKey(e,a,s){let r=t.get(s);r||(r=new Map,t.set(s,r));const i=RangeKey.idBucket(e);return(a=r.get(i))||(a=new RangeKey(e,s.params.ranges),r.set(i,a)),a},getSerializedFormat(e){const t=e.params.field?e.aggConfigs.indexPattern.getFormatterForField(e.params.field).toJSON():{id:void 0,params:void 0};return{id:"range",params:{id:t.id,params:t.params}}},params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER]},{name:"ranges",default:[{from:0,to:1e3},{from:1e3,to:2e3}],write(e,t){var a;t.params.ranges=null===(a=e.params.ranges)||void 0===a?void 0:a.map((e=>({to:e.to,from:e.from}))),t.params.keyed=!0},toExpressionAst:e=>null==e?void 0:e.map(F.numericalRangeToAst)}]})},Ye="aggSignificantTerms",Qe=()=>({name:Ye,help:g.i18n.translate("data.search.aggs.function.buckets.significantTerms.help",{defaultMessage:"Generates a serialized agg config for a Significant Terms agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.significantTerms.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.buckets.significantTerms.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.significantTerms.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.buckets.significantTerms.field.help",{defaultMessage:"Field to use for this aggregation"})},size:{types:["number"],help:g.i18n.translate("data.search.aggs.buckets.significantTerms.size.help",{defaultMessage:"Max number of buckets to retrieve"})},shardSize:{types:["number"],help:g.i18n.translate("data.search.aggs.buckets.significantTerms.shardSize.help",{defaultMessage:"Number of terms provided by each shard and returned to coordinating node"})},exclude:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.significantTerms.exclude.help",{defaultMessage:"Specific bucket values to exclude from results"}),multi:!0},include:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.significantTerms.include.help",{defaultMessage:"Specific bucket values to include in results"}),multi:!0},json:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.significantTerms.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.significantTerms.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:_.T.SIGNIFICANT_TERMS,params:{...i}}}}}),We=(e,t,a)=>{const s=e.params.field,r=e.aggConfigs.indexPattern;if("__other__"===t){const e=a.terms,t=(0,u.buildPhrasesFilter)(s,e,r);t.meta.negate=!0;const i=[t];return e.some((e=>"__missing__"===e))&&i.push((0,u.buildExistsFilter)(s,r)),i}if("__missing__"===t){const e=(0,u.buildExistsFilter)(s,r);return e.meta.negate=!0,e}return(0,u.buildPhraseFilter)(s,t,r)},Je=g.i18n.translate("data.search.aggs.buckets.significantTermsTitle",{defaultMessage:"Significant Terms"}),Xe=()=>new S.a({name:_.T.SIGNIFICANT_TERMS,expressionName:Ye,title:Je,makeLabel:e=>g.i18n.translate("data.search.aggs.buckets.significantTermsLabel",{defaultMessage:"Top {size} unusual terms in {fieldName}",values:{size:e.params.size,fieldName:e.getFieldDisplayName()}}),createFilter:We,params:[{name:"field",type:"field",scriptable:!1,filterFieldTypes:p.KBN_FIELD_TYPES.STRING},{name:"size",default:""},{name:"shardSize",write:(e,t)=>{t.params.shard_size=e.params.shardSize}},{name:"exclude",displayName:g.i18n.translate("data.search.aggs.buckets.significantTerms.excludeLabel",{defaultMessage:"Exclude"}),type:"string",advanced:!0,shouldShow:Be,...Ue},{name:"include",displayName:g.i18n.translate("data.search.aggs.buckets.significantTerms.includeLabel",{defaultMessage:"Include"}),type:"string",advanced:!0,shouldShow:Be,...Ue}]}),Ze="aggSignificantText",et=()=>({name:Ze,help:g.i18n.translate("data.search.aggs.function.buckets.significantText.help",{defaultMessage:"Generates a serialized agg config for a Significant Text agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.significantText.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.buckets.significantText.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.significantText.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.buckets.significantText.field.help",{defaultMessage:"Field to use for this aggregation"})},size:{types:["number"],help:g.i18n.translate("data.search.aggs.buckets.significantText.size.help",{defaultMessage:"Max number of buckets to retrieve"})},min_doc_count:{types:["number"],help:g.i18n.translate("data.search.aggs.buckets.significantText.minDocCount.help",{defaultMessage:"Return terms that match more than a configured number"})},filter_duplicate_text:{types:["boolean"],help:g.i18n.translate("data.search.aggs.buckets.significantText.filterDuplicateText.help",{defaultMessage:"Filtering near-duplicate text"})},exclude:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.significantText.exclude.help",{defaultMessage:"Specific bucket values to exclude from results"})},include:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.significantText.include.help",{defaultMessage:"Specific bucket values to include in results"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.significantText.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.significantText.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:_.T.SIGNIFICANT_TEXT,params:{...i}}}}}),tt=g.i18n.translate("data.search.aggs.buckets.significantTextTitle",{defaultMessage:"Significant Text"}),at=()=>new S.a({name:_.T.SIGNIFICANT_TEXT,expressionName:Ze,title:tt,makeLabel:e=>g.i18n.translate("data.search.aggs.buckets.significantTextLabel",{defaultMessage:'Top {size} unusual terms from "{fieldName}" text',values:{size:e.params.size,fieldName:e.getFieldDisplayName()}}),createFilter:We,params:[{name:"field",type:"field",filterField:e=>{var t;return Boolean(e.type===p.KBN_FIELD_TYPES.STRING&&(null===(t=e.esTypes)||void 0===t?void 0:t.includes(p.ES_FIELD_TYPES.TEXT)))}},{name:"size",type:"number"},{name:"min_doc_count",type:"number"},{name:"filter_duplicate_text",type:"boolean"},{name:"exclude",displayName:g.i18n.translate("data.search.aggs.buckets.significantText.excludeLabel",{defaultMessage:"Exclude"}),type:"string",advanced:!0,...Ue},{name:"include",displayName:g.i18n.translate("data.search.aggs.buckets.significantText.includeLabel",{defaultMessage:"Include"}),type:"string",advanced:!0,...Ue}]}),st="aggTerms",rt=()=>({name:st,help:g.i18n.translate("data.search.aggs.function.buckets.terms.help",{defaultMessage:"Generates a serialized agg config for a Terms agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.terms.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.buckets.terms.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.terms.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.buckets.terms.field.help",{defaultMessage:"Field to use for this aggregation"})},order:{types:["string"],options:["asc","desc"],help:g.i18n.translate("data.search.aggs.buckets.terms.order.help",{defaultMessage:"Order in which to return the results: asc or desc"})},orderBy:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.terms.orderBy.help",{defaultMessage:"Field to order results by"})},orderAgg:{types:["agg_type"],help:g.i18n.translate("data.search.aggs.buckets.terms.orderAgg.help",{defaultMessage:"Agg config to use for ordering results"})},size:{types:["number"],help:g.i18n.translate("data.search.aggs.buckets.terms.size.help",{defaultMessage:"Max number of buckets to retrieve"})},shardSize:{types:["number"],help:g.i18n.translate("data.search.aggs.buckets.terms.shardSize.help",{defaultMessage:"Number of terms to evaluate during the aggregation."})},missingBucket:{types:["boolean"],help:g.i18n.translate("data.search.aggs.buckets.terms.missingBucket.help",{defaultMessage:"When set to true, groups together any buckets with missing fields"})},missingBucketLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.terms.missingBucketLabel.help",{defaultMessage:"Default label used in charts when documents are missing a field."})},otherBucket:{types:["boolean"],help:g.i18n.translate("data.search.aggs.buckets.terms.otherBucket.help",{defaultMessage:"When set to true, groups together any buckets beyond the allowed size"})},otherBucketLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.terms.otherBucketLabel.help",{defaultMessage:"Default label used in charts for documents in the Other bucket"})},exclude:{types:["string","number"],help:g.i18n.translate("data.search.aggs.buckets.terms.exclude.help",{defaultMessage:"Specific bucket values to exclude from results"}),multi:!0},include:{types:["string","number"],help:g.i18n.translate("data.search.aggs.buckets.terms.include.help",{defaultMessage:"Specific bucket values to include in results"}),multi:!0},includeIsRegex:{types:["boolean"],help:g.i18n.translate("data.search.aggs.buckets.terms.includeIsRegex.help",{defaultMessage:"When set to true, the include property is handled as regex"})},excludeIsRegex:{types:["boolean"],help:g.i18n.translate("data.search.aggs.buckets.terms.excludeIsRegex.help",{defaultMessage:"When set to true, the exclude property is handled as regex"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.terms.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.terms.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{var a;const{id:s,enabled:r,schema:i,...n}=t;return{type:"agg_type",value:{id:s,enabled:r,schema:i,type:_.T.TERMS,params:{...n,orderAgg:null===(a=t.orderAgg)||void 0===a?void 0:a.value}}}}});var it=a(190);const nt="__missing__",lt="",ot=new RegExp(`^${lt}`),gt=(e,t)=>{if(e[t])return e[t];const a=(0,l.values)(e);let s;for(let e=0;e<a.length;e++)if(a[e].aggs&&(s=gt(a[e].aggs,t)))return s},ut=(e,t)=>{const a=[];if(e[t]){const s=e[t].buckets.find((e=>e.key===nt));return s&&a.push(s),a}return(0,l.each)(e,(e=>{e.buckets&&(0,l.each)(e.buckets,(e=>{a.push(...ut(e,t))}))})),a},dt=(e,t)=>{var a;return t.isSamplingEnabled()?null===(a=e.aggregations)||void 0===a?void 0:a.sampling:e.aggregations};function ct(e,t,a){const s=((e,t,a)=>e["other-filter"].filters.filters[t].bool.must_not.filter((e=>e.match_phrase&&null!=e.match_phrase[a.params.field.name])).map((e=>e.match_phrase[a.params.field.name])))(e,t,a),r=(0,u.buildPhrasesFilter)(a.params.field,s,a.aggConfigs.indexPattern);return r.meta.negate=!0,r}function ht(e,t){return{query:e["other-filter"].filters.filters[t],meta:{}}}const pt=e=>async(t,a,s,r,i,n,o,d)=>{if(!t.aggregations)return t;const h=r.createChild();if(s.params.otherBucket){const r=((e,t,a)=>{const s=e.aggs.filter((e=>e.type.type===c.Buckets&&e.enabled)),r=s.findIndex((e=>e.id===t.id)),i=e.toDsl(),n=t.aggConfigs.indexPattern,o=e.createAggConfig({type:"filters",id:"other",params:{filters:[]},enabled:!1},{addToAggConfigs:!1}),g={aggs:gt(i,t.id).aggs,filters:o.toDsl()};let d=!1,h=!0;const p=(e,a,i,o,c)=>{var m;const f=a[i];if(!f||(Array.isArray(f.buckets)?!f.buckets.length:!Object.values(f.buckets).length))return void(d=!0);const y=e+1,b=s[y],v=s[e];if(e===r&&f&&f.sum_other_doc_count>0&&(h=!1),e<r)return void(0,l.each)(null==f?void 0:f.buckets,((e,t)=>{const a=v.getKey(e,(0,l.isNumber)(t)?void 0:t),s=(0,l.cloneDeep)(e.filters)||v.createFilter(a),r=(0,l.flatten)([...o,s]);p(y,e,b.id,r,`${c}${lt}${a.toString()}`)}));const S=!(null===(m=t.params.field)||void 0===m||!m.scripted),_=!!t.params.missingBucket,T=f.buckets.some((e=>e.key===nt));!t.params.field||S||_&&!T||o.push((0,u.buildExistsFilter)(t.params.field,t.aggConfigs.indexPattern)),(0,l.each)(f.buckets,(e=>{if(e.key===nt)return;const t=v.createFilter(v.getKey(e,e.key));t.meta.negate=!0,o.push(t)})),g.filters.filters[c]={bool:(0,u.buildQueryFromFilters)(o,n)}};return p(0,dt(a,e),s[0].id,[],""),!d&&!h&&(()=>e.isSamplingEnabled()?{sampling:{...m(e.samplerConfig),aggs:{"other-filter":g}}}:{"other-filter":g})})(a,s,t);if(!r)return t;h.setField("aggs",r);const{rawResponse:p}=await(0,it.lastValueFrom)(h.fetch$({abortSignal:n,sessionId:o,disableWarningToasts:d,inspector:{adapter:i,title:g.i18n.translate("data.search.aggs.buckets.terms.otherBucketTitle",{defaultMessage:"Other bucket"}),description:g.i18n.translate("data.search.aggs.buckets.terms.otherBucketDescription",{defaultMessage:"This request counts the number of documents that fall outside the criterion of the data buckets."})}}));t=((e,t,a,s,r,i)=>{const n=(0,l.cloneDeep)(t),o=dt(a,e),g=dt(n,e),d="buckets"in o["other-filter"]?o["other-filter"].buckets:{};return(0,l.each)(d,((t,a)=>{if(!t.doc_count||void 0===a)return;const n=a.replace(ot,""),o=((e,t,a,s)=>{var r;const i=s.split(lt);let n=t;for(const t in i)if(null!=i[t]){const s=(0,l.values)(n);for(let r=0;r<s.length;r++){const g=s[r],u=(0,l.keys)(n)[r],d=(0,l.find)(e.aggs,(e=>e.id===u));if(d){const e=(0,l.find)(g.buckets,((e,a)=>d.getKey(e,(0,l.isNumber)(a)?void 0:a).toString()===i[t]));var o;if(e&&(null===(o=n)||void 0===o||!o[a.id]||""!==i[t])){n=e;break}}}}return null!==(r=n)&&void 0!==r&&r[a.id]?n[a.id].buckets:[]})(e,g,s,n),d=i(((e,t)=>t.isSamplingEnabled()?e.sampling.aggs:e)(r,e),a,s);t.filters=[d],t.key="__other__",o.some((e=>e.key===nt))&&t.filters.push((0,u.buildExistsFilter)(s.params.field,s.aggConfigs.indexPattern)),o.push(t)})),n})(a,t,p,s,r(),e)}return s.params.missingBucket&&(t=((e,t,a)=>{const s=(0,l.cloneDeep)(e);return ut(dt(s,t),a.id).forEach((e=>{e.key=nt})),s})(t,a,s)),t},mt=["!top_hits","!percentiles","!percentile_ranks","!filtered_metric","!percentile","!percentile_rank","!geo_bounds","!geo_centroid","!std_dev","!derivative","!moving_avg","!serial_diff","!cumulative_sum","!avg_bucket","!max_bucket","!min_bucket","!sum_bucket"],ft={name:"orderAgg",type:"agg",allowedAggs:mt,default:null,makeAgg(e,t={type:"count"}){t.schema="orderAgg";const a=e.aggConfigs.createAggConfig(t,{addToAggConfigs:!1});return a.id=e.id+"-orderAgg",a},write(e,t,a){const s=e.params.order.value,r=t.params.order={};let i=e.params.orderAgg||a.getResponseAggById(e.params.orderBy);if(t.params.script&&(t.params.value_type="number"===e.getField().type?"float":e.getField().type),e.params.missingBucket&&"string"===e.params.field.type&&(t.params.missing="__missing__"),!i)return void(r[e.params.orderBy||"_count"]=s);if(null!=a&&a.hasTimeShifts()&&Object.keys(null==a?void 0:a.getTimeShifts()).length>1&&a.timeRange){const e=i.getTimeShift(),t=a.getResolvedTimeRange();i=a.createAggConfig({type:"filtered_metric",id:i.id,params:{customBucket:a.createAggConfig({type:"filter",id:"shift",params:{filter:{language:"lucene",query:{range:{[a.timeFields[0]]:{gte:n().tz(null==t?void 0:t.min,a.timeZone).subtract(e||0).toISOString(),lte:n().tz(null==t?void 0:t.max,a.timeZone).subtract(e||0).toISOString()}}}}}},{addToAggConfigs:!1}).serialize(),customMetric:i.serialize()},enabled:!1},{addToAggConfigs:!1})}if("count"===i.type.name)return void(r._count=s);const l=i.getValueBucketPath();i.parentId&&a&&(i=a.byId(i.parentId)),t.subAggs=(t.subAggs||[]).concat(i),r[l]=s}},yt=g.i18n.translate("data.search.aggs.buckets.termsTitle",{defaultMessage:"Terms"}),bt=()=>new S.a({name:_.T.TERMS,expressionName:st,title:yt,makeLabel(e){const t=e.params;return e.getFieldDisplayName()+": "+t.order.text},getSerializedFormat(e){const t=e.params.field?e.aggConfigs.indexPattern.getFormatterForField(e.params.field).toJSON():{id:void 0,params:void 0};return{id:"terms",params:{id:t.id,...t.params?{params:t.params}:{},otherBucketLabel:e.params.otherBucketLabel,missingBucketLabel:e.params.missingBucketLabel}}},createFilter:We,postFlightRequest:pt(ct),hasPrecisionError:e=>Boolean(null==e?void 0:e.doc_count_error_upper_bound),params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.BOOLEAN,p.KBN_FIELD_TYPES.DATE,p.KBN_FIELD_TYPES.IP,p.KBN_FIELD_TYPES.STRING]},{name:"orderBy",write:l.noop},ft,{name:"order",type:"optioned",default:"desc",options:[{text:g.i18n.translate("data.search.aggs.buckets.terms.orderDescendingTitle",{defaultMessage:"Descending"}),value:"desc"},{text:g.i18n.translate("data.search.aggs.buckets.terms.orderAscendingTitle",{defaultMessage:"Ascending"}),value:"asc"}],write:l.noop},{name:"size",default:5},{name:"shardSize",write:(e,t)=>{e.params.shardSize?t.params.shard_size=e.params.shardSize:e.params.size<=10&&(t.params.shard_size=25)}},{name:"otherBucket",default:!1,write:l.noop},{name:"otherBucketLabel",type:"string",default:g.i18n.translate("data.search.aggs.buckets.terms.otherBucketLabel",{defaultMessage:"Other"}),displayName:g.i18n.translate("data.search.aggs.otherBucket.labelForOtherBucketLabel",{defaultMessage:"Label for other bucket"}),shouldShow:e=>e.getParam("otherBucket"),write:l.noop},{name:"missingBucket",default:!1,write:l.noop},{name:"missingBucketLabel",default:g.i18n.translate("data.search.aggs.buckets.terms.missingBucketLabel",{defaultMessage:"Missing",description:'Default label used in charts when documents are missing a field.\n          Visible when you create a chart with a terms aggregation and enable "Show missing values"'}),type:"string",displayName:g.i18n.translate("data.search.aggs.otherBucket.labelForMissingValuesLabel",{defaultMessage:"Label for missing values"}),shouldShow:e=>e.getParam("missingBucket"),write:l.noop},{name:"exclude",displayName:g.i18n.translate("data.search.aggs.buckets.terms.excludeLabel",{defaultMessage:"Exclude"}),type:"string",advanced:!0,shouldShow:je,...Ue},{name:"include",displayName:g.i18n.translate("data.search.aggs.buckets.terms.includeLabel",{defaultMessage:"Include"}),type:"string",advanced:!0,shouldShow:je,...Ue},{name:"includeIsRegex",default:!0,write:l.noop},{name:"excludeIsRegex",default:!0,write:l.noop}]}),vt=Symbol("id");function St(e){if(!(e=>Boolean(e&&"object"==typeof e&&"key"in e))(e))throw new Error("bucket malformed - no key found");return Array.isArray(e.key)?e.key.map((e=>String(e))):[String(e.key)]}class MultiFieldKey{constructor(e){(0,r.default)(this,vt,void 0),(0,r.default)(this,"keys",void 0),this.keys=St(e),this[vt]=MultiFieldKey.idBucket(e)}static idBucket(e){return St(e).join(",")}toString(){return this[vt]}}function _t(e){return e instanceof MultiFieldKey}const Tt="  ",Et="aggMultiTerms",Ft=()=>({name:Et,help:g.i18n.translate("data.search.aggs.function.buckets.multiTerms.help",{defaultMessage:"Generates a serialized agg config for a Multi-Terms agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.multiTerms.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.buckets.multiTerms.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.multiTerms.schema.help",{defaultMessage:"Schema to use for this aggregation"})},fields:{types:["string"],multi:!0,required:!0,help:g.i18n.translate("data.search.aggs.buckets.multiTerms.fields.help",{defaultMessage:"Fields to use for this aggregation"})},order:{types:["string"],options:["asc","desc"],help:g.i18n.translate("data.search.aggs.buckets.multiTerms.order.help",{defaultMessage:"Order in which to return the results: asc or desc"})},orderBy:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.multiTerms.orderBy.help",{defaultMessage:"Field to order results by"})},orderAgg:{types:["agg_type"],help:g.i18n.translate("data.search.aggs.buckets.multiTerms.orderAgg.help",{defaultMessage:"Agg config to use for ordering results"})},size:{types:["number"],help:g.i18n.translate("data.search.aggs.buckets.multiTerms.size.help",{defaultMessage:"Max number of buckets to retrieve"})},shardSize:{types:["number"],help:g.i18n.translate("data.search.aggs.buckets.terms.shardSize.help",{defaultMessage:"Number of terms to evaluate during the aggregation."})},otherBucket:{types:["boolean"],help:g.i18n.translate("data.search.aggs.buckets.multiTerms.otherBucket.help",{defaultMessage:"When set to true, groups together any buckets beyond the allowed size"})},otherBucketLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.multiTerms.otherBucketLabel.help",{defaultMessage:"Default label used in charts for documents in the Other bucket"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.multiTerms.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.multiTerms.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},separatorLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.multiTerms.separatorLabel.help",{defaultMessage:"The separator label used to join each term combination"})}},fn:(e,t)=>{var a;const{id:s,enabled:r,schema:i,...n}=t;return{type:"agg_type",value:{id:s,enabled:r,schema:i,type:_.T.MULTI_TERMS,params:{...n,orderAgg:null===(a=t.orderAgg)||void 0===a?void 0:a.value}}}}}),Mt=(e,t,a)=>{const s=e.params.fields,r=e.aggConfigs.indexPattern;if("__other__"===String(t)){const e=a.terms,t=e.map((e=>e.keys.map(((e,t)=>(0,u.buildPhraseFilter)(r.getFieldByName(s[t]),e,r).query))));return{meta:{negate:!0,alias:e.map((e=>e.keys.join(", "))).join(` ${g.i18n.translate("data.search.aggs.buckets.multiTerms.otherFilterJoinName",{defaultMessage:"or"})} `),index:r.id},query:{bool:{should:t.map((e=>({bool:{must:e}}))),minimum_should_match:1}}}}const i=t.keys.map(((e,t)=>(0,u.buildPhraseFilter)(r.getFieldByName(s[t]),e,r)));return{meta:{alias:t.keys.join(", "),index:r.id},query:{bool:{must:i.map((e=>e.query))}}}},At=g.i18n.translate("data.search.aggs.buckets.multiTermsTitle",{defaultMessage:"Multi-Terms"}),It=()=>{const e=new WeakMap;return new S.a({name:_.T.MULTI_TERMS,expressionName:Et,title:At,makeLabel(e){const t=e.params;return e.getFieldDisplayName()+": "+t.order.text},getKey(t,a,s){let r=e.get(s);r||(r=new Map,e.set(s,r));const i=MultiFieldKey.idBucket(t);return(a=r.get(i))||(a=new MultiFieldKey(t),r.set(i,a)),a},getSerializedFormat(e){const t=e.params,a=t.fields?t.fields.map((t=>{const a=e.aggConfigs.indexPattern.getFieldByName(t);return a?e.aggConfigs.indexPattern.getFormatterForField(a).toJSON():{id:void 0,params:void 0}})):[{id:void 0,params:void 0}];return{id:"multi_terms",params:{otherBucketLabel:t.otherBucketLabel,paramsPerField:a,separator:e.params.separatorLabel}}},createFilter:Mt,postFlightRequest:pt(ht),hasPrecisionError:e=>Boolean(null==e?void 0:e.doc_count_error_upper_bound),params:[{name:"fields",write(e,t,a){const s=e.params;t.params.terms=s.fields.map((e=>({field:e})))}},{name:"orderBy",write:l.noop},ft,{name:"order",type:"optioned",default:"desc",options:[{text:g.i18n.translate("data.search.aggs.buckets.terms.orderDescendingTitle",{defaultMessage:"Descending"}),value:"desc"},{text:g.i18n.translate("data.search.aggs.buckets.terms.orderAscendingTitle",{defaultMessage:"Ascending"}),value:"asc"}],write:l.noop},{name:"size",default:5},{name:"shardSize",write:(e,t)=>{t.params.shard_size=e.params.shardSize}},{name:"otherBucket",default:!1,write:l.noop},{name:"otherBucketLabel",type:"string",default:g.i18n.translate("data.search.aggs.buckets.terms.otherBucketLabel",{defaultMessage:"Other"}),displayName:g.i18n.translate("data.search.aggs.otherBucket.labelForOtherBucketLabel",{defaultMessage:"Label for other bucket"}),shouldShow:e=>e.getParam("otherBucket"),write:l.noop},{name:"separatorLabel",type:"string",write:l.noop}]})},wt="aggRareTerms",Rt=()=>({name:wt,help:g.i18n.translate("data.search.aggs.function.buckets.rareTerms.help",{defaultMessage:"Generates a serialized agg config for a Rare-Terms agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.rareTerms.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.buckets.rareTerms.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.rareTerms.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.buckets.rareTerms.fields.help",{defaultMessage:"Field to use for this aggregation"})},max_doc_count:{types:["number"],help:g.i18n.translate("data.search.aggs.buckets.rareTerms.maxDocCount.help",{defaultMessage:"Maximum number of times a term is allowed to occur to qualify as rare"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.multiTerms.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:_.T.RARE_TERMS,params:{...i}}}}}),kt=g.i18n.translate("data.search.aggs.buckets.rareTermsTitle",{defaultMessage:"Rare terms"}),xt=()=>new S.a({name:_.T.RARE_TERMS,expressionName:wt,title:kt,makeLabel:e=>g.i18n.translate("data.search.aggs.rareTerms.aggTypesLabel",{defaultMessage:"Rare terms of {fieldName}",values:{fieldName:e.getFieldDisplayName()}}),createFilter:We,params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.BOOLEAN,p.KBN_FIELD_TYPES.DATE,p.KBN_FIELD_TYPES.IP,p.KBN_FIELD_TYPES.STRING]},{name:"max_doc_count",default:1}]}),Nt="sampler",Pt=g.i18n.translate("data.search.aggs.buckets.samplerTitle",{defaultMessage:"Sampler",description:"Sampler aggregation title"}),Ct=()=>new S.a({name:Nt,title:Pt,customLabels:!1,expressionName:Lt,params:[{name:"shard_size",type:"number"}]}),Lt="aggSampler",Dt=()=>({name:Lt,help:g.i18n.translate("data.search.aggs.function.buckets.sampler.help",{defaultMessage:"Generates a serialized agg config for a Sampler agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.sampler.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.buckets.sampler.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.sampler.schema.help",{defaultMessage:"Schema to use for this aggregation"})},shard_size:{types:["number"],help:g.i18n.translate("data.search.aggs.buckets.sampler.shardSize.help",{defaultMessage:"The shard_size parameter limits how many top-scoring documents are collected in the sample processed on each shard."})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:Nt,params:{...i}}}}}),Ot="diversified_sampler",qt=g.i18n.translate("data.search.aggs.buckets.diversifiedSamplerTitle",{defaultMessage:"Diversified sampler",description:"Diversified sampler aggregation title"}),Bt=()=>new S.a({name:Ot,title:qt,customLabels:!1,expressionName:jt,params:[{name:"shard_size",type:"number"},{name:"max_docs_per_value",type:"number"},{name:"field",type:"field"}]}),jt="aggDiversifiedSampler",Ut=()=>({name:jt,help:g.i18n.translate("data.search.aggs.function.buckets.diversifiedSampler.help",{defaultMessage:"Generates a serialized agg config for a Diversified sampler agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.diversifiedSampler.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.buckets.diversifiedSampler.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.diversifiedSampler.schema.help",{defaultMessage:"Schema to use for this aggregation"})},shard_size:{types:["number"],help:g.i18n.translate("data.search.aggs.buckets.diversifiedSampler.shardSize.help",{defaultMessage:"The shard_size parameter limits how many top-scoring documents are collected in the sample processed on each shard."})},max_docs_per_value:{types:["number"],help:g.i18n.translate("data.search.aggs.buckets.diversifiedSampler.maxDocsPerValue.help",{defaultMessage:"Limits how many documents are permitted per choice of de-duplicating value."})},field:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.diversifiedSampler.field.help",{defaultMessage:"Used to provide values used for de-duplication."})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:Ot,params:{...i}}}}}),Gt="aggTimeSeries",zt=()=>({name:Gt,help:g.i18n.translate("data.search.aggs.function.buckets.timeSeries.help",{defaultMessage:"Generates a serialized agg config for a Time Series agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.timeSeries.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.buckets.timeSeries.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.timeSeries.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.buckets.terms.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:_.T.TIME_SERIES,params:{...i}}}}}),$t=g.i18n.translate("data.search.aggs.buckets.timeSeriesTitle",{defaultMessage:"Time Series"}),Vt=()=>new S.a({name:_.T.TIME_SERIES,expressionName:Gt,title:$t,params:[]});var Kt=a(4882);const Ht="aggAvg",Yt=()=>({name:Ht,help:g.i18n.translate("data.search.aggs.function.metrics.avg.help",{defaultMessage:"Generates a serialized agg config for a Avg agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.avg.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.avg.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.avg.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.metrics.avg.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.avg.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.avg.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.AVG,params:{...i}}}}}),Qt=g.i18n.translate("data.search.aggs.metrics.averageTitle",{defaultMessage:"Average"}),Wt=()=>new MetricAggType({name:w.AVG,expressionName:Ht,title:Qt,getValueType:()=>"number",makeLabel:e=>g.i18n.translate("data.search.aggs.metrics.averageLabel",{defaultMessage:"Average {field}",values:{field:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.HISTOGRAM]}]}),Jt="aggBucketAvg",Xt=()=>({name:Jt,help:g.i18n.translate("data.search.aggs.function.metrics.bucket_avg.help",{defaultMessage:"Generates a serialized agg config for a Avg Bucket agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.bucket_avg.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.bucket_avg.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.bucket_avg.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customBucket:{types:["agg_type"],help:g.i18n.translate("data.search.aggs.metrics.bucket_avg.customBucket.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},customMetric:{types:["agg_type"],help:g.i18n.translate("data.search.aggs.metrics.bucket_avg.customMetric.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.bucket_avg.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.bucket_avg.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a,s;const{id:r,enabled:i,schema:n,...l}=t;return{type:"agg_type",value:{id:r,enabled:i,schema:n,type:w.AVG_BUCKET,params:{...l,customBucket:null===(a=t.customBucket)||void 0===a?void 0:a.value,customMetric:null===(s=t.customMetric)||void 0===s?void 0:s.value}}}}}),Zt=(e,t)=>{const a=(0,l.startCase)(t),s=e.getParam("customMetric"),r=e.getParam("metricAgg");if(s){let e=s.makeLabel();return e.includes(`${a} of `)?(e=e.substring(`${a} of `.length),e=`2. ${t} of ${e}`):e=e.includes(`${t} of `)?parseInt(e.substring(0,1),10)+1+e.substring(1):`${a} of ${e}`,e}const i=e.aggConfigs.byId(r);return i?`${a} of ${i.makeLabel()}`:""},ea=e=>(t,a,s)=>{if(!t||!t.params)return;const r=t.getParam(e);r&&r.type&&r.type.params&&r.type.params.forEach((e=>{e.modifyAggConfigOnSearchRequestStart&&e.modifyAggConfigOnSearchRequestStart(r,a,s)}))},ta=["!top_hits","!top_metrics","!percentiles","!percentile_ranks","!median","!std_dev","!sum_bucket","!avg_bucket","!min_bucket","!max_bucket","!derivative","!moving_avg","!serial_diff","!cumulative_sum","!geo_bounds","!geo_centroid","!filtered_metric","!single_percentile"],aa=["!filter","!sampler","!diversified_sampler","!multi_terms"],sa=g.i18n.translate("data.search.aggs.metrics.siblingPipelineAggregationsSubtypeTitle",{defaultMessage:"Sibling pipeline aggregations"}),ra={subtype:sa,params:(e=aa)=>[{name:"customBucket",type:"agg",allowedAggs:e,default:null,makeAgg(e,t={type:"date_histogram"}){const a=e.aggConfigs.createAggConfig(t,{addToAggConfigs:!1});return a.id=e.id+"-bucket",a},modifyAggConfigOnSearchRequestStart:ea("customBucket"),write:()=>{}},{name:"customMetric",type:"agg",allowedAggs:ta,default:null,makeAgg(e,t={type:"count"}){const a=e.aggConfigs.createAggConfig(t,{addToAggConfigs:!1});return a.id=e.id+"-metric",a},modifyAggConfigOnSearchRequestStart:ea("customMetric"),write:(e,t)=>((e,t)=>{const a=e.getParam("customMetric"),s=e.getParam("customBucket");if(a){if(a.type.name!==w.COUNT){if(s.subAggs=(t.subAggs||[]).concat(a),t.params.buckets_path=`${s.id}>${a.id}`,a.type.subtype===p.siblingPipelineType){const e=a.getParam("customBucket");e&&s.subAggs.push(e)}}else t.params.buckets_path=s.id+">_count";t.parentAggs=(t.parentAggs||[]).concat(s)}})(e,t)}],getSerializedFormat(e){const t=e.getParam("customMetric");return t?t.type.getSerializedFormat(t):{}}},ia=g.i18n.translate("data.search.aggs.metrics.overallAverageLabel",{defaultMessage:"overall average"}),na=g.i18n.translate("data.search.aggs.metrics.averageBucketTitle",{defaultMessage:"Average Bucket"}),la=()=>{const{subtype:e,params:t,getSerializedFormat:a}=ra;return new MetricAggType({name:w.AVG_BUCKET,expressionName:Jt,title:na,makeLabel:e=>Zt(e,ia),subtype:e,params:[...t()],getSerializedFormat:a,getValue(e,t){const a=e.getParam("customMetric"),s=e.getParam("customBucket"),r=a.type&&a.type.isScalable();let i=t[e.id]&&t[e.id].value;if(r&&"date_histogram"===s.type.name){const e=s.write();i*=(0,l.get)(e,"bucketInterval.scale",1)}return i}})},oa="aggBucketMax",ga=()=>({name:oa,help:g.i18n.translate("data.search.aggs.function.metrics.bucket_max.help",{defaultMessage:"Generates a serialized agg config for a Max Bucket agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.bucket_max.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.bucket_max.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.bucket_max.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customBucket:{types:["agg_type"],help:g.i18n.translate("data.search.aggs.metrics.bucket_max.customBucket.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},customMetric:{types:["agg_type"],help:g.i18n.translate("data.search.aggs.metrics.bucket_max.customMetric.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.bucket_max.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.bucket_max.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a,s;const{id:r,enabled:i,schema:n,...l}=t;return{type:"agg_type",value:{id:r,enabled:i,schema:n,type:w.MAX_BUCKET,params:{...l,customBucket:null===(a=t.customBucket)||void 0===a?void 0:a.value,customMetric:null===(s=t.customMetric)||void 0===s?void 0:s.value}}}}}),ua=g.i18n.translate("data.search.aggs.metrics.overallMaxLabel",{defaultMessage:"overall max"}),da=g.i18n.translate("data.search.aggs.metrics.maxBucketTitle",{defaultMessage:"Max Bucket"}),ca=()=>{const{subtype:e,params:t,getSerializedFormat:a}=ra;return new MetricAggType({name:w.MAX_BUCKET,expressionName:oa,title:da,makeLabel:e=>Zt(e,ua),subtype:e,params:[...t()],getSerializedFormat:a})},ha="aggBucketMin",pa=()=>({name:ha,help:g.i18n.translate("data.search.aggs.function.metrics.bucket_min.help",{defaultMessage:"Generates a serialized agg config for a Min Bucket agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.bucket_min.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.bucket_min.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.bucket_min.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customBucket:{types:["agg_type"],help:g.i18n.translate("data.search.aggs.metrics.bucket_min.customBucket.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},customMetric:{types:["agg_type"],help:g.i18n.translate("data.search.aggs.metrics.bucket_min.customMetric.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.bucket_min.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.bucket_min.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a,s;const{id:r,enabled:i,schema:n,...l}=t;return{type:"agg_type",value:{id:r,enabled:i,schema:n,type:w.MIN_BUCKET,params:{...l,customBucket:null===(a=t.customBucket)||void 0===a?void 0:a.value,customMetric:null===(s=t.customMetric)||void 0===s?void 0:s.value}}}}}),ma=g.i18n.translate("data.search.aggs.metrics.overallMinLabel",{defaultMessage:"overall min"}),fa=g.i18n.translate("data.search.aggs.metrics.minBucketTitle",{defaultMessage:"Min Bucket"}),ya=()=>{const{subtype:e,params:t,getSerializedFormat:a}=ra;return new MetricAggType({name:w.MIN_BUCKET,expressionName:ha,title:fa,makeLabel:e=>Zt(e,ma),subtype:e,params:[...t()],getSerializedFormat:a})},ba="aggBucketSum",va=()=>({name:ba,help:g.i18n.translate("data.search.aggs.function.metrics.bucket_sum.help",{defaultMessage:"Generates a serialized agg config for a Sum Bucket agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.bucket_sum.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.bucket_sum.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.bucket_sum.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customBucket:{types:["agg_type"],help:g.i18n.translate("data.search.aggs.metrics.bucket_sum.customBucket.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},customMetric:{types:["agg_type"],help:g.i18n.translate("data.search.aggs.metrics.bucket_sum.customMetric.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.bucket_sum.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.bucket_sum.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a,s;const{id:r,enabled:i,schema:n,...l}=t;return{type:"agg_type",value:{id:r,enabled:i,schema:n,type:w.SUM_BUCKET,params:{...l,customBucket:null===(a=t.customBucket)||void 0===a?void 0:a.value,customMetric:null===(s=t.customMetric)||void 0===s?void 0:s.value}}}}}),Sa=g.i18n.translate("data.search.aggs.metrics.overallSumLabel",{defaultMessage:"overall sum"}),_a=g.i18n.translate("data.search.aggs.metrics.sumBucketTitle",{defaultMessage:"Sum Bucket"}),Ta=()=>{const{subtype:e,params:t,getSerializedFormat:a}=ra;return new MetricAggType({name:w.SUM_BUCKET,expressionName:ba,title:_a,makeLabel:e=>Zt(e,Sa),subtype:e,params:[...t()],getSerializedFormat:a})},Ea="aggFilteredMetric",Fa=()=>({name:Ea,help:g.i18n.translate("data.search.aggs.function.metrics.filtered_metric.help",{defaultMessage:"Generates a serialized agg config for a filtered metric agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.filtered_metric.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.filtered_metric.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.filtered_metric.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customBucket:{types:["agg_type"],help:g.i18n.translate("data.search.aggs.metrics.filtered_metric.customBucket.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations. Has to be a filter aggregation"})},customMetric:{types:["agg_type"],help:g.i18n.translate("data.search.aggs.metrics.filtered_metric.customMetric.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.filtered_metric.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a,s;const{id:r,enabled:i,schema:n,...l}=t;return{type:"agg_type",value:{id:r,enabled:i,schema:n,type:w.FILTERED_METRIC,params:{...l,customBucket:null===(a=t.customBucket)||void 0===a?void 0:a.value,customMetric:null===(s=t.customMetric)||void 0===s?void 0:s.value}}}}}),Ma=g.i18n.translate("data.search.aggs.metrics.filteredMetricLabel",{defaultMessage:"filtered"}),Aa=g.i18n.translate("data.search.aggs.metrics.filteredMetricTitle",{defaultMessage:"Filtered metric"}),Ia=({getConfig:e})=>{const{subtype:t,params:a,getSerializedFormat:s}=ra;return new MetricAggType({name:w.FILTERED_METRIC,expressionName:Ea,title:Aa,makeLabel:e=>Zt(e,Ma),subtype:t,params:[...a(["filter"])],hasNoDslParams:!0,getSerializedFormat:s,createFilter:(t,a)=>{const s=t.getIndexPattern();if("top_hits"===t.params.customMetric.type.name||"top_metrics"===t.params.customMetric.type.name)return t.params.customMetric.createFilter(a);if(!t.params.customBucket.params.filter)return;const r=(0,p.getEsQueryConfig)({get:e});return(0,u.buildQueryFilter)((0,u.buildEsQuery)(s,[t.params.customBucket.params.filter],[],r),s.id,t.params.customBucket.params.filter.query)},getValue(e,t){const a=e.getParam("customMetric"),s=e.getParam("customBucket");return t&&t[s.id]&&a.getValue(t[s.id])},getValueType(e){var t,a,s;const r=e.getParam("customMetric");return(null===(t=(a=r.type).getValueType)||void 0===t?void 0:t.call(a,r))||(null===(s=r.params.field)||void 0===s?void 0:s.type)||"number"},getValueBucketPath(e){const t=e.getParam("customBucket"),a=e.getParam("customMetric");return"count"===a.type.name?t.getValueBucketPath():`${t.getValueBucketPath()}>${a.getValueBucketPath()}`},getResponseId:e=>e.params.customBucket.id})},wa="aggCardinality",Ra=()=>({name:wa,help:g.i18n.translate("data.search.aggs.function.metrics.cardinality.help",{defaultMessage:"Generates a serialized agg config for a Cardinality agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.cardinality.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.cardinality.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.cardinality.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.metrics.cardinality.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.cardinality.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.cardinality.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})},emptyAsNull:{types:["boolean"],help:g.i18n.translate("data.search.aggs.metrics.emptyAsNull.help",{defaultMessage:'If set to true, a missing value is treated as null in the resulting data table. If set to false, a "zero" is filled in'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.CARDINALITY,params:{...i}}}}}),ka=g.i18n.translate("data.search.aggs.metrics.uniqueCountTitle",{defaultMessage:"Unique Count"}),xa=()=>new MetricAggType({name:w.CARDINALITY,getValueType:()=>"number",expressionName:wa,title:ka,enableEmptyAsNull:!0,makeLabel:e=>g.i18n.translate("data.search.aggs.metrics.uniqueCountLabel",{defaultMessage:"Unique count of {field}",values:{field:e.getFieldDisplayName()}}),getSerializedFormat:e=>({id:"number"}),params:[{name:"field",type:"field",filterFieldTypes:Object.values(p.KBN_FIELD_TYPES).filter((e=>e!==p.KBN_FIELD_TYPES.HISTOGRAM))}]}),Na="aggValueCount",Pa=()=>({name:Na,help:g.i18n.translate("data.search.aggs.function.metrics.valueCount.help",{defaultMessage:"Generates a serialized agg config for a value count agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.value_count.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.value_count.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.value_count.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.metrics.value_count.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.value_count.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.value_count.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})},emptyAsNull:{types:["boolean"],help:g.i18n.translate("data.search.aggs.metrics.emptyAsNull.help",{defaultMessage:'If set to true, a missing value is treated as null in the resulting data table. If set to false, a "zero" is filled in'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.VALUE_COUNT,params:{...i}}}}}),Ca=g.i18n.translate("data.search.aggs.metrics.valueCountTitle",{defaultMessage:"Value Count"}),La=()=>new MetricAggType({name:w.VALUE_COUNT,getValueType:()=>"number",expressionName:Na,title:Ca,enableEmptyAsNull:!0,makeLabel:e=>g.i18n.translate("data.search.aggs.metrics.valueCountLabel",{defaultMessage:"Value count of {field}",values:{field:e.getFieldDisplayName()}}),getSerializedFormat:e=>({id:"number"}),params:[{name:"field",type:"field"}]}),Da="aggCount",Oa=()=>({name:Da,help:g.i18n.translate("data.search.aggs.function.metrics.count.help",{defaultMessage:"Generates a serialized agg config for a Count agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.count.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.count.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.count.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.count.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})},emptyAsNull:{types:["boolean"],help:g.i18n.translate("data.search.aggs.metrics.emptyAsNull.help",{defaultMessage:'If set to true, a missing value is treated as null in the resulting data table. If set to false, a "zero" is filled in'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.COUNT,params:i}}}}),qa=()=>new MetricAggType({name:w.COUNT,expressionName:Da,title:g.i18n.translate("data.search.aggs.metrics.countTitle",{defaultMessage:"Count"}),hasNoDsl:!0,json:!1,enableEmptyAsNull:!0,makeLabel:()=>g.i18n.translate("data.search.aggs.metrics.countLabel",{defaultMessage:"Count"}),getSerializedFormat:e=>({id:"number"}),getValue(e,t){const a=e.getTimeShift();let s;return s=a?t[`doc_count_${a.asMilliseconds()}`]:t.doc_count,0===s&&e.params.emptyAsNull?null:null==s?e.params.emptyAsNull?null:0:s},isScalable:()=>!0}),Ba="aggCumulativeSum",ja=()=>({name:Ba,help:g.i18n.translate("data.search.aggs.function.metrics.cumulative_sum.help",{defaultMessage:"Generates a serialized agg config for a Cumulative Sum agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.cumulative_sum.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.cumulative_sum.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.cumulative_sum.schema.help",{defaultMessage:"Schema to use for this aggregation"})},metricAgg:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.cumulative_sum.metricAgg.help",{defaultMessage:"Id for finding agg config to use for building parent pipeline aggregations"})},customMetric:{types:["agg_type"],help:g.i18n.translate("data.search.aggs.metrics.cumulative_sum.customMetric.help",{defaultMessage:"Agg config to use for building parent pipeline aggregations"})},buckets_path:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.cumulative_sum.buckets_path.help",{defaultMessage:"Path to the metric of interest"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.cumulative_sum.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.cumulative_sum.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a;const{id:s,enabled:r,schema:i,...n}=t;return{type:"agg_type",value:{id:s,enabled:r,schema:i,type:w.CUMULATIVE_SUM,params:{...n,customMetric:null===(a=t.customMetric)||void 0===a?void 0:a.value}}}}}),Ua=(e,t,a)=>{const s=e.getParam("customMetric"),r=e.getParam("metricAgg"),i=s||a&&a.getResponseAggById(r);s&&"count"!==s.type.name&&(t.parentAggs=(t.parentAggs||[]).concat(i)),t.params={buckets_path:"count"===i.type.name?"_count":i.id}},Ga=["!top_hits","!top_metrics","!percentiles","!percentile_ranks","!median","!std_dev","!geo_bounds","!geo_centroid","!filtered_metric","!single_percentile"],za=g.i18n.translate("data.search.aggs.metrics.parentPipelineAggregationsSubtypeTitle",{defaultMessage:"Parent Pipeline Aggregations"}),$a={subtype:za,params:()=>[{name:"metricAgg",default:"custom",write:Ua},{name:"customMetric",type:"agg",allowedAggs:Ga,makeAgg(e,t={type:"count"}){const a=e.aggConfigs.createAggConfig(t,{addToAggConfigs:!1});return a.id=e.id+"-metric",a},modifyAggConfigOnSearchRequestStart:ea("customMetric"),write:l.noop},{name:"buckets_path",write:l.noop}],getSerializedFormat(e){let t;return t=e.getParam("customMetric")||e.aggConfigs.byId(e.getParam("metricAgg")),t?t.type.getSerializedFormat(t):{}}},Va=g.i18n.translate("data.search.aggs.metrics.cumulativeSumLabel",{defaultMessage:"cumulative sum"}),Ka=g.i18n.translate("data.search.aggs.metrics.cumulativeSumTitle",{defaultMessage:"Cumulative Sum"}),Ha=()=>{const{subtype:e,params:t,getSerializedFormat:a}=$a;return new MetricAggType({name:w.CUMULATIVE_SUM,expressionName:Ba,title:Ka,makeLabel:e=>Zt(e,Va),subtype:e,params:[...t()],getSerializedFormat:a})},Ya="aggDerivative",Qa=()=>({name:Ya,help:g.i18n.translate("data.search.aggs.function.metrics.derivative.help",{defaultMessage:"Generates a serialized agg config for a Derivative agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.derivative.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.derivative.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.derivative.schema.help",{defaultMessage:"Schema to use for this aggregation"})},metricAgg:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.derivative.metricAgg.help",{defaultMessage:"Id for finding agg config to use for building parent pipeline aggregations"})},customMetric:{types:["agg_type"],help:g.i18n.translate("data.search.aggs.metrics.derivative.customMetric.help",{defaultMessage:"Agg config to use for building parent pipeline aggregations"})},buckets_path:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.derivative.buckets_path.help",{defaultMessage:"Path to the metric of interest"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.derivative.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.derivative.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a;const{id:s,enabled:r,schema:i,...n}=t;return{type:"agg_type",value:{id:s,enabled:r,schema:i,type:w.DERIVATIVE,params:{...n,customMetric:null===(a=t.customMetric)||void 0===a?void 0:a.value}}}}}),Wa=g.i18n.translate("data.search.aggs.metrics.derivativeLabel",{defaultMessage:"derivative"}),Ja=g.i18n.translate("data.search.aggs.metrics.derivativeTitle",{defaultMessage:"Derivative"}),Xa=()=>{const{subtype:e,params:t,getSerializedFormat:a}=$a;return new MetricAggType({name:w.DERIVATIVE,expressionName:Ya,title:Ja,makeLabel:e=>Zt(e,Wa),subtype:e,params:[...t()],getSerializedFormat:a})},Za="aggGeoBounds",es=()=>({name:Za,help:g.i18n.translate("data.search.aggs.function.metrics.geo_bounds.help",{defaultMessage:"Generates a serialized agg config for a Geo Bounds agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.geo_bounds.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.geo_bounds.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.geo_bounds.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.metrics.geo_bounds.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.geo_bounds.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.geo_bounds.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.GEO_BOUNDS,params:{...i}}}}}),ts=g.i18n.translate("data.search.aggs.metrics.geoBoundsTitle",{defaultMessage:"Geo Bounds"}),as=g.i18n.translate("data.search.aggs.metrics.geoBoundsLabel",{defaultMessage:"Geo Bounds"}),ss=()=>new MetricAggType({name:w.GEO_BOUNDS,expressionName:Za,title:ts,makeLabel:()=>as,params:[{name:"field",type:"field",filterFieldTypes:p.KBN_FIELD_TYPES.GEO_POINT}]}),rs="aggGeoCentroid",is=()=>({name:rs,help:g.i18n.translate("data.search.aggs.function.metrics.geo_centroid.help",{defaultMessage:"Generates a serialized agg config for a Geo Centroid agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.geo_centroid.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.geo_centroid.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.geo_centroid.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.metrics.geo_centroid.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.geo_centroid.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.geo_centroid.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.GEO_CENTROID,params:{...i}}}}}),ns=g.i18n.translate("data.search.aggs.metrics.geoCentroidTitle",{defaultMessage:"Geo Centroid"}),ls=g.i18n.translate("data.search.aggs.metrics.geoCentroidLabel",{defaultMessage:"Geo Centroid"}),os=()=>new MetricAggType({name:w.GEO_CENTROID,expressionName:rs,title:ns,makeLabel:()=>ls,params:[{name:"field",type:"field",filterFieldTypes:p.KBN_FIELD_TYPES.GEO_POINT}],getValue:(e,t)=>t[e.id]&&t[e.id].location}),gs="aggMax",us=()=>({name:gs,help:g.i18n.translate("data.search.aggs.function.metrics.max.help",{defaultMessage:"Generates a serialized agg config for a Max agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.max.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.max.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.max.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.metrics.max.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.max.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.max.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.MAX,params:{...i}}}}}),ds=g.i18n.translate("data.search.aggs.metrics.maxTitle",{defaultMessage:"Max"}),cs=()=>new MetricAggType({name:w.MAX,expressionName:gs,title:ds,makeLabel:e=>g.i18n.translate("data.search.aggs.metrics.maxLabel",{defaultMessage:"Max {field}",values:{field:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.DATE,p.KBN_FIELD_TYPES.HISTOGRAM]}]}),hs="aggMedian",ps=()=>({name:hs,help:g.i18n.translate("data.search.aggs.function.metrics.median.help",{defaultMessage:"Generates a serialized agg config for a Median agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.median.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.median.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.median.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.metrics.median.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.median.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.median.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.MEDIAN,params:{...i}}}}}),ms=g.i18n.translate("data.search.aggs.metrics.medianTitle",{defaultMessage:"Median"}),fs=()=>new MetricAggType({name:w.MEDIAN,expressionName:hs,dslName:"percentiles",title:ms,getValueType:()=>"number",makeLabel:e=>g.i18n.translate("data.search.aggs.metrics.medianLabel",{defaultMessage:"Median {field}",values:{field:e.getFieldDisplayName()}}),getValueBucketPath:e=>`${e.id}.50`,params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.DATE,p.KBN_FIELD_TYPES.HISTOGRAM]},{name:"percents",default:[50],shouldShow:()=>!1,serialize:()=>{}}],getValue(e,t){var a;return null===(a=t[e.id])||void 0===a?void 0:a.values["50.0"]}}),ys="aggSinglePercentile",bs=()=>({name:ys,help:g.i18n.translate("data.search.aggs.function.metrics.singlePercentile.help",{defaultMessage:"Generates a serialized agg config for a single percentile agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.singlePercentile.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.singlePercentile.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.singlePercentile.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.metrics.singlePercentile.field.help",{defaultMessage:"Field to use for this aggregation"})},percentile:{types:["number"],required:!0,help:g.i18n.translate("data.search.aggs.metrics.singlePercentile.percentile.help",{defaultMessage:"Percentile to fetch"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.singlePercentile.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.singlePercentile.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.SINGLE_PERCENTILE,params:{...i}}}}}),vs=g.i18n.translate("data.search.aggs.metrics.singlePercentileTitle",{defaultMessage:"Percentile"}),Ss=()=>new MetricAggType({name:w.SINGLE_PERCENTILE,expressionName:ys,dslName:"percentiles",title:vs,getValueType:()=>"number",makeLabel:e=>g.i18n.translate("data.search.aggs.metrics.singlePercentileLabel",{defaultMessage:"Percentile {field}",values:{field:e.getFieldDisplayName()}}),getValueBucketPath:e=>`${e.id}.${e.params.percentile}`,params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.DATE,p.KBN_FIELD_TYPES.HISTOGRAM]},{name:"percentile",default:95,write:(e,t)=>{t.params.percents=[e.params.percentile]}}],getValue(e,t){var a;let s=String(e.params.percentile);Number.isInteger(e.params.percentile)&&(s+=".0");const{values:r}=null!==(a=t[e.id])&&void 0!==a?a:{};return r?r[s]:NaN}}),_s="aggMin",Ts=()=>({name:_s,help:g.i18n.translate("data.search.aggs.function.metrics.min.help",{defaultMessage:"Generates a serialized agg config for a Min agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.min.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.min.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.min.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.metrics.min.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.min.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.min.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.MIN,params:{...i}}}}}),Es=g.i18n.translate("data.search.aggs.metrics.minTitle",{defaultMessage:"Min"}),Fs=()=>new MetricAggType({name:w.MIN,expressionName:_s,title:Es,makeLabel:e=>g.i18n.translate("data.search.aggs.metrics.minLabel",{defaultMessage:"Min {field}",values:{field:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.DATE,p.KBN_FIELD_TYPES.HISTOGRAM]}]}),Ms="aggMovingAvg",As=()=>({name:Ms,help:g.i18n.translate("data.search.aggs.function.metrics.moving_avg.help",{defaultMessage:"Generates a serialized agg config for a Moving Average agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.moving_avg.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.moving_avg.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.moving_avg.schema.help",{defaultMessage:"Schema to use for this aggregation"})},metricAgg:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.moving_avg.metricAgg.help",{defaultMessage:"Id for finding agg config to use for building parent pipeline aggregations"})},customMetric:{types:["agg_type"],help:g.i18n.translate("data.search.aggs.metrics.moving_avg.customMetric.help",{defaultMessage:"Agg config to use for building parent pipeline aggregations"})},window:{types:["number"],help:g.i18n.translate("data.search.aggs.metrics.moving_avg.window.help",{defaultMessage:'The size of window to "slide" across the histogram.'})},buckets_path:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.derivative.buckets_path.help",{defaultMessage:"Path to the metric of interest"})},script:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.moving_avg.script.help",{defaultMessage:"Id for finding agg config to use for building parent pipeline aggregations"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.moving_avg.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.moving_avg.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a;const{id:s,enabled:r,schema:i,...n}=t;return{type:"agg_type",value:{id:s,enabled:r,schema:i,type:w.MOVING_FN,params:{...n,customMetric:null===(a=t.customMetric)||void 0===a?void 0:a.value}}}}}),Is=g.i18n.translate("data.search.aggs.metrics.movingAvgTitle",{defaultMessage:"Moving Avg"}),ws=g.i18n.translate("data.search.aggs.metrics.movingAvgLabel",{defaultMessage:"moving avg"}),Rs=()=>{const{subtype:e,params:t,getSerializedFormat:a}=$a;return new MetricAggType({name:w.MOVING_FN,expressionName:Ms,dslName:"moving_fn",title:Is,makeLabel:e=>Zt(e,ws),subtype:e,getSerializedFormat:a,params:[...t(),{name:"window",default:5},{name:"script",default:"MovingFunctions.unweightedAvg(values)"}],getValue:(e,t)=>t[e.id]?t[e.id].value:null})},ks="aggPercentileRanks",xs=()=>({name:ks,help:g.i18n.translate("data.search.aggs.function.metrics.percentile_ranks.help",{defaultMessage:"Generates a serialized agg config for a Percentile Ranks agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.percentile_ranks.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.percentile_ranks.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.percentile_ranks.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.metrics.percentile_ranks.field.help",{defaultMessage:"Field to use for this aggregation"})},values:{types:["number"],multi:!0,help:g.i18n.translate("data.search.aggs.metrics.percentile_ranks.values.help",{defaultMessage:"Range of percentiles ranks"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.percentile_ranks.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.percentile_ranks.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.PERCENTILE_RANKS,params:{...i}}}}}),Ns=(e,t)=>e.$$_ResponseAggConfigClass?e.$$_ResponseAggConfigClass:e.$$_ResponseAggConfigClass=Ps(e,t),Ps=(e,t)=>{function a(t){const a=e.id;this.id=function(e,t){const a=String(t);return a.indexOf(".")>-1?e+"['"+a.replace(/[\\']/g,"\\$&")+"']":e+"."+a}(a,t),this.key=t,this.parentId=a}return a.prototype=Object.create(e),a.prototype.constructor=a,(0,l.assignIn)(a.prototype,t),a},Cs=(e,t)=>{var a;const{values:s}=null!==(a=t[e.parentId])&&void 0!==a?a:{},r=(0,l.find)(s,(({key:t})=>t===e.key));return r?r.value:NaN},Ls=e=>({makeLabel(){const{getDefaultInstance:t}=e(),a=this.getField(),s=a&&a.format||t(p.KBN_FIELD_TYPES.NUMBER),r=this.getParam("customLabel")||this.getFieldDisplayName();return g.i18n.translate("data.search.aggs.metrics.percentileRanks.valuePropsLabel",{defaultMessage:'Percentile rank {format} of "{label}"',values:{format:s.convert(this.key,"text"),label:r}})}}),Ds=({getFieldFormatsStart:e})=>new MetricAggType({name:w.PERCENTILE_RANKS,expressionName:ks,title:g.i18n.translate("data.search.aggs.metrics.percentileRanksTitle",{defaultMessage:"Percentile Ranks"}),makeLabel:e=>g.i18n.translate("data.search.aggs.metrics.percentileRanksLabel",{defaultMessage:"Percentile ranks of {field}",values:{field:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.HISTOGRAM]},{name:"values",default:[]},{write(e,t){t.params.keyed=!1}}],getResponseAggs(t){const a=Ns(t,Ls(e));return t.getParam("values").map((e=>new a(e)))},getSerializedFormat:e=>({id:"percent"}),getValue:(e,t)=>Cs(e,t)/100}),Os="aggPercentiles",qs=()=>({name:Os,help:g.i18n.translate("data.search.aggs.function.metrics.percentiles.help",{defaultMessage:"Generates a serialized agg config for a Percentiles agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.percentiles.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.percentiles.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.percentiles.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.metrics.percentiles.field.help",{defaultMessage:"Field to use for this aggregation"})},percents:{types:["number"],multi:!0,help:g.i18n.translate("data.search.aggs.metrics.percentiles.percents.help",{defaultMessage:"Range of percentiles ranks"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.percentiles.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.percentiles.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.PERCENTILES,params:{...i}}}}});const Bs={makeLabel(){const e=this.getParam("customLabel")||this.getFieldDisplayName();return g.i18n.translate("data.search.aggs.metrics.percentiles.valuePropsLabel",{defaultMessage:"{percentile} percentile of {label}",values:{percentile:(t=this.key,t+""+function(e){const t=Math.floor(parseFloat(e)),a=t%100;if(a>=11&&a<=13)return"th";const s=t%10;return 1===s?"st":2===s?"nd":3===s?"rd":"th"}(t)),label:e}});var t}},js=()=>new MetricAggType({name:w.PERCENTILES,expressionName:Os,title:g.i18n.translate("data.search.aggs.metrics.percentilesTitle",{defaultMessage:"Percentiles"}),getValueType:()=>"number",makeLabel:e=>g.i18n.translate("data.search.aggs.metrics.percentilesLabel",{defaultMessage:"Percentiles of {field}",values:{field:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.DATE,p.KBN_FIELD_TYPES.HISTOGRAM]},{name:"percents",default:[1,5,25,50,75,95,99]},{write(e,t){t.params.keyed=!1}}],getResponseAggs(e){const t=Ns(e,Bs);return e.getParam("percents").map((e=>new t(e)))},getValue:Cs}),Us="aggRate",Gs=()=>({name:Us,help:g.i18n.translate("data.search.aggs.function.metrics.rate.help",{defaultMessage:"Generates a serialized agg config for a Rate agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.rate.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.rate.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.rate.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.rate.field.help",{defaultMessage:"Field to use for this aggregation"})},unit:{types:["string"],required:!0,options:["second","minute","hour","day","week","month","quarter","year"],help:g.i18n.translate("data.search.aggs.metrics.rate.unit.help",{defaultMessage:"Unit to use for this aggregation"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.rate.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.rate.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.RATE,params:{...i}}}}}),zs=g.i18n.translate("data.search.aggs.metrics.rateTitle",{defaultMessage:"Rate"}),$s=()=>new MetricAggType({name:w.RATE,expressionName:Us,title:zs,getValueType:()=>"number",makeLabel:e=>g.i18n.translate("data.search.aggs.metrics.rateLabel",{defaultMessage:"Rate of {field} per {unit}",values:{field:e.getFieldDisplayName(),unit:e.getParam("unit")}}),params:[{name:"field",type:"field",required:!1,filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.HISTOGRAM]},{name:"unit",type:"string",displayName:g.i18n.translate("data.search.aggs.metrics.rate.unit.displayName",{defaultMessage:"Unit"}),required:!0,options:[{text:g.i18n.translate("data.search.aggs.metrics.rate.unit.second",{defaultMessage:"Second"}),value:"second"},{text:g.i18n.translate("data.search.aggs.metrics.rate.unit.minute",{defaultMessage:"Minute"}),value:"minute"},{text:g.i18n.translate("data.search.aggs.metrics.rate.unit.hour",{defaultMessage:"Hour"}),value:"hour"},{text:g.i18n.translate("data.search.aggs.metrics.rate.unit.day",{defaultMessage:"Day"}),value:"day"},{text:g.i18n.translate("data.search.aggs.metrics.rate.unit.week",{defaultMessage:"Week"}),value:"week"},{text:g.i18n.translate("data.search.aggs.metrics.rate.unit.month",{defaultMessage:"Month"}),value:"month"},{text:g.i18n.translate("data.search.aggs.metrics.rate.unit.quarter",{defaultMessage:"Quarter"}),value:"quarter"},{text:g.i18n.translate("data.search.aggs.metrics.rate.unit.year",{defaultMessage:"Year"}),value:"year"}]}]}),Vs="aggSinglePercentileRank",Ks=()=>({name:Vs,help:g.i18n.translate("data.search.aggs.function.metrics.singlePercentileRank.help",{defaultMessage:"Generates a serialized agg config for a single percentile rank agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.singlePercentileRank.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.singlePercentileRank.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.singlePercentileRank.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.metrics.singlePercentileRank.field.help",{defaultMessage:"Field to use for this aggregation"})},value:{types:["number"],required:!0,help:g.i18n.translate("data.search.aggs.metrics.singlePercentileRank.value.help",{defaultMessage:"Percentile rank value to fetch"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.singlePercentileRank.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.singlePercentileRank.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.SINGLE_PERCENTILE_RANK,params:{...i}}}}}),Hs=g.i18n.translate("data.search.aggs.metrics.singlePercentileRankTitle",{defaultMessage:"Percentile rank"}),Ys=()=>new MetricAggType({name:w.SINGLE_PERCENTILE_RANK,expressionName:Vs,dslName:"percentile_ranks",title:Hs,getValueType:()=>"number",makeLabel:e=>g.i18n.translate("data.search.aggs.metrics.singlePercentileRankLabel",{defaultMessage:"Percentile rank of {field}",values:{field:e.getFieldDisplayName()}}),getValueBucketPath:e=>`${e.id}.${e.params.value}`,getSerializedFormat:e=>({id:"percent"}),params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.HISTOGRAM]},{name:"value",default:0,write:(e,t)=>{t.params.values=[e.params.value]}}],getValue(e,t){var a;let s=String(e.params.value);Number.isInteger(e.params.value)&&(s+=".0");const{values:r}=null!==(a=t[e.id])&&void 0!==a?a:{};return r?r[s]/100:NaN}}),Qs="aggSerialDiff",Ws=()=>({name:Qs,help:g.i18n.translate("data.search.aggs.function.metrics.serial_diff.help",{defaultMessage:"Generates a serialized agg config for a Serial Differencing agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.serial_diff.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.serial_diff.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.serial_diff.schema.help",{defaultMessage:"Schema to use for this aggregation"})},metricAgg:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.serial_diff.metricAgg.help",{defaultMessage:"Id for finding agg config to use for building parent pipeline aggregations"})},customMetric:{types:["agg_type"],help:g.i18n.translate("data.search.aggs.metrics.serial_diff.customMetric.help",{defaultMessage:"Agg config to use for building parent pipeline aggregations"})},buckets_path:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.serial_diff.buckets_path.help",{defaultMessage:"Path to the metric of interest"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.serial_diff.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.serial_diff.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a;const{id:s,enabled:r,schema:i,...n}=t;return{type:"agg_type",value:{id:s,enabled:r,schema:i,type:w.SERIAL_DIFF,params:{...n,customMetric:null===(a=t.customMetric)||void 0===a?void 0:a.value}}}}}),Js=g.i18n.translate("data.search.aggs.metrics.serialDiffTitle",{defaultMessage:"Serial Diff"}),Xs=g.i18n.translate("data.search.aggs.metrics.serialDiffLabel",{defaultMessage:"serial diff"}),Zs=()=>{const{subtype:e,params:t,getSerializedFormat:a}=$a;return new MetricAggType({name:w.SERIAL_DIFF,expressionName:Qs,title:Js,makeLabel:e=>Zt(e,Xs),subtype:e,params:[...t()],getSerializedFormat:a})},er="aggStdDeviation",tr=()=>({name:er,help:g.i18n.translate("data.search.aggs.function.metrics.std_deviation.help",{defaultMessage:"Generates a serialized agg config for a Standard Deviation agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.std_deviation.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.std_deviation.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.std_deviation.schema.help",{defaultMessage:"Schema to use for this aggregation"})},showBounds:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.std_deviation.showBounds.help",{defaultMessage:"Specifies whether this aggregation should return upper and lower bound or the standard deviation itself"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.metrics.std_deviation.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.std_deviation.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.std_deviation.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.STD_DEV,params:{...i}}}}}),ar={valProp(){const e=this.getParam("customLabel");return this.keyedDetails(e)[this.key].valProp},makeLabel(){const e=this.getFieldDisplayName(),t=this.getParam("customLabel"),a=this.keyedDetails(t,e);return(0,l.get)(a,[this.key,"title"])},keyedDetails(e,t){const a=e||g.i18n.translate("data.search.aggs.metrics.standardDeviation.keyDetailsLabel",{defaultMessage:"Standard Deviation of {fieldDisplayName}",values:{fieldDisplayName:t}});return{std_lower:{valProp:["std_deviation_bounds","lower"],title:g.i18n.translate("data.search.aggs.metrics.standardDeviation.lowerKeyDetailsTitle",{defaultMessage:"Lower {label}",values:{label:a}})},std_upper:{valProp:["std_deviation_bounds","upper"],title:g.i18n.translate("data.search.aggs.metrics.standardDeviation.upperKeyDetailsTitle",{defaultMessage:"Upper {label}",values:{label:a}})}}}},sr=()=>new MetricAggType({name:w.STD_DEV,expressionName:er,dslName:"extended_stats",title:g.i18n.translate("data.search.aggs.metrics.standardDeviationTitle",{defaultMessage:"Standard Deviation"}),makeLabel:e=>g.i18n.translate("data.search.aggs.metrics.standardDeviationLabel",{defaultMessage:"Standard Deviation of {field}",values:{field:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:p.KBN_FIELD_TYPES.NUMBER},{name:"showBounds",type:"boolean",write:()=>{},shouldShow:()=>!1}],getResponseAggs(e){if(!1===e.getParam("showBounds"))return[e];const t=Ns(e,ar);return[new t("std_lower"),new t("std_upper")]},getValueBucketPath:e=>`${e.id}.std_deviation`,getValue(e,t){var a;return!1===e.getParam("showBounds")?null===(a=t[e.id])||void 0===a?void 0:a.std_deviation:(0,l.get)(t[e.parentId],e.valProp())}}),rr="aggSum",ir=()=>({name:rr,help:g.i18n.translate("data.search.aggs.function.metrics.sum.help",{defaultMessage:"Generates a serialized agg config for a Sum agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.sum.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.sum.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.sum.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.metrics.sum.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.sum.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.sum.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})},emptyAsNull:{types:["boolean"],help:g.i18n.translate("data.search.aggs.metrics.emptyAsNull.help",{defaultMessage:'If set to true, a missing value is treated as null in the resulting data table. If set to false, a "zero" is filled in'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.SUM,params:{...i}}}}}),nr=g.i18n.translate("data.search.aggs.metrics.sumTitle",{defaultMessage:"Sum"}),lr=()=>new MetricAggType({name:w.SUM,expressionName:rr,title:nr,getValueType:()=>"number",enableEmptyAsNull:!0,makeLabel:e=>g.i18n.translate("data.search.aggs.metrics.sumLabel",{defaultMessage:"Sum of {field}",values:{field:e.getFieldDisplayName()}}),isScalable:()=>!0,params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.HISTOGRAM]}]}),or="aggTopHit",gr=()=>({name:or,help:g.i18n.translate("data.search.aggs.function.metrics.top_hit.help",{defaultMessage:"Generates a serialized agg config for a Top Hit agg"}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.top_hit.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.top_hit.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.top_hit.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.metrics.top_hit.field.help",{defaultMessage:"Field to use for this aggregation"})},aggregate:{types:["string"],required:!0,options:["min","max","sum","average","concat"],help:g.i18n.translate("data.search.aggs.metrics.top_hit.aggregate.help",{defaultMessage:"Aggregate type"})},size:{types:["number"],help:g.i18n.translate("data.search.aggs.metrics.top_hit.size.help",{defaultMessage:"Max number of buckets to retrieve"})},sortOrder:{types:["string"],options:["desc","asc"],help:g.i18n.translate("data.search.aggs.metrics.top_hit.sortOrder.help",{defaultMessage:"Order in which to return the results: asc or desc"})},sortField:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.top_hit.sortField.help",{defaultMessage:"Field to order results by"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.top_hit.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.top_hit.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.TOP_HITS,params:{...i}}}}}),ur=e=>{const t=e.getParam("field");return t&&t.type&&t.type===p.KBN_FIELD_TYPES.NUMBER},dr=()=>new MetricAggType({name:w.TOP_HITS,expressionName:or,title:g.i18n.translate("data.search.aggs.metrics.topHitTitle",{defaultMessage:"Top Hit"}),getValueType:e=>{var t;return null===(t=e.getParam("field"))||void 0===t?void 0:t.type},makeLabel(e){const t=g.i18n.translate("data.search.aggs.metrics.topHit.lastPrefixLabel",{defaultMessage:"Last"}),a=g.i18n.translate("data.search.aggs.metrics.topHit.firstPrefixLabel",{defaultMessage:"First"});let s="desc"===e.getParam("sortOrder").value?t:a;const r=e.getParam("size");1!==r&&(s+=` ${r}`);const i=e.getParam("field");return`${s} ${i?i.displayName:""}`},params:[{name:"field",type:"field",onlyAggregatable:!1,filterFieldTypes:Object.values(p.KBN_FIELD_TYPES).filter((e=>e!==p.KBN_FIELD_TYPES.HISTOGRAM)),write(e,t){const a=e.getParam("field");t.params={},a.scripted?t.params.script_fields={[a.name]:{script:{source:a.script,lang:a.lang}}}:("_source"!==a.name&&(t.params.fields=[{field:a.name,...a.type===p.KBN_FIELD_TYPES.DATE&&{format:"date_time"}}]),t.params._source="_source"===a.name)}},{name:"aggregate",type:"optioned",options:[{text:g.i18n.translate("data.search.aggs.metrics.topHit.minLabel",{defaultMessage:"Min"}),isCompatible:ur,disabled:!0,value:"min"},{text:g.i18n.translate("data.search.aggs.metrics.topHit.maxLabel",{defaultMessage:"Max"}),isCompatible:ur,disabled:!0,value:"max"},{text:g.i18n.translate("data.search.aggs.metrics.topHit.sumLabel",{defaultMessage:"Sum"}),isCompatible:ur,disabled:!0,value:"sum"},{text:g.i18n.translate("data.search.aggs.metrics.topHit.averageLabel",{defaultMessage:"Average"}),isCompatible:ur,disabled:!0,value:"average"},{text:g.i18n.translate("data.search.aggs.metrics.topHit.concatenateLabel",{defaultMessage:"Concatenate"}),isCompatible:e=>"*"===o().get(e.params,"field.filterFieldTypes","*"),disabled:!0,value:"concat"}],write:o().noop},{name:"size",default:1},{name:"sortField",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.DATE,p.KBN_FIELD_TYPES.IP,p.KBN_FIELD_TYPES.STRING],default:e=>e.getIndexPattern().timeFieldName,write:o().noop},{name:"sortOrder",type:"optioned",default:"desc",options:[{text:g.i18n.translate("data.search.aggs.metrics.topHit.descendingLabel",{defaultMessage:"Descending"}),value:"desc"},{text:g.i18n.translate("data.search.aggs.metrics.topHit.ascendingLabel",{defaultMessage:"Ascending"}),value:"asc"}],write(e,t){const a=e.params.sortField,s=e.params.sortOrder;a.scripted?t.params.sort=[{_script:{script:{source:a.script,lang:a.lang},type:a.type,order:s.value}}]:t.params.sort=[{[a.name]:{order:s.value}}]}}],getValue(e,t){const a=o().get(t,`${e.id}.hits.hits`);if(!a||!a.length)return null;const s=e.getParam("field").name;let r=o().flatten(a.map((t=>"_source"===s?t._source:(0,p.flattenHit)(t,e.getIndexPattern())[s])));if(1===r.length&&(r=r[0]),Array.isArray(r)){if(!o().compact(r).length)return null;switch(e.getParam("aggregate").value){case"max":return o().max(r);case"min":return o().min(r);case"sum":return o().sum(r);case"average":return o().sum(r)/r.length}}return r},createFilter:D}),cr="aggTopMetrics",hr=()=>({name:cr,help:g.i18n.translate("data.search.aggs.function.metrics.topMetrics.help",{defaultMessage:"Generates a serialized aggregation configuration for Top metrics."}),type:"agg_type",args:{id:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.topMetrics.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:g.i18n.translate("data.search.aggs.metrics.topMetrics.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.topMetrics.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:g.i18n.translate("data.search.aggs.metrics.topMetrics.field.help",{defaultMessage:"Field to use for this aggregation"})},size:{types:["number"],help:g.i18n.translate("data.search.aggs.metrics.topMetrics.size.help",{defaultMessage:"Number of top values to retrieve"})},sortOrder:{types:["string"],options:["desc","asc"],help:g.i18n.translate("data.search.aggs.metrics.topMetrics.sortOrder.help",{defaultMessage:"Order in which to return the results: asc or desc"})},sortField:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.topMetrics.sortField.help",{defaultMessage:"Field to order results by"})},json:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.topMetrics.json.help",{defaultMessage:"Advanced JSON to include when the aggregation is sent to Elasticsearch"})},customLabel:{types:["string"],help:g.i18n.translate("data.search.aggs.metrics.topMetrics.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.TOP_METRICS,params:{...i}}}}}),pr=()=>new MetricAggType({name:w.TOP_METRICS,expressionName:cr,title:g.i18n.translate("data.search.aggs.metrics.topMetricsTitle",{defaultMessage:"Top metrics"}),getValueType:e=>{var t;return null===(t=e.getParam("field"))||void 0===t?void 0:t.type},makeLabel(e){const t="desc"===e.getParam("sortOrder").value,a=e.getParam("size"),s=e.getParam("field"),r=e.getParam("sortField");var i,n,l,o;return t?a>1?g.i18n.translate("data.search.aggs.metrics.topMetrics.descWithSizeLabel",{defaultMessage:'Last {size} "{fieldName}" values by "{sortField}"',values:{size:a,fieldName:null==s?void 0:s.displayName,sortField:null!==(i=null==r?void 0:r.displayName)&&void 0!==i?i:"_score"}}):g.i18n.translate("data.search.aggs.metrics.topMetrics.descNoSizeLabel",{defaultMessage:'Last "{fieldName}" value by "{sortField}"',values:{fieldName:null==s?void 0:s.displayName,sortField:null!==(n=null==r?void 0:r.displayName)&&void 0!==n?n:"_score"}}):a>1?g.i18n.translate("data.search.aggs.metrics.topMetrics.ascWithSizeLabel",{defaultMessage:'First {size} "{fieldName}" values by "{sortField}"',values:{size:a,fieldName:null==s?void 0:s.displayName,sortField:null!==(l=null==r?void 0:r.displayName)&&void 0!==l?l:"_score"}}):g.i18n.translate("data.search.aggs.metrics.topMetrics.ascNoSizeLabel",{defaultMessage:'First "{fieldName}" value by "{sortField}"',values:{fieldName:null==s?void 0:s.displayName,sortField:null!==(o=null==r?void 0:r.displayName)&&void 0!==o?o:"_score"}})},params:[{name:"field",type:"field",scriptable:!1,filterFieldTypes:[p.KBN_FIELD_TYPES.STRING,p.KBN_FIELD_TYPES.IP,p.KBN_FIELD_TYPES.BOOLEAN,p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.DATE],write(e,t){const a=e.getParam("field");t.params.metrics={field:a.name}}},{name:"size",default:1},{name:"sortField",type:"field",scriptable:!1,filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.DATE],default:e=>e.getIndexPattern().timeFieldName,write:o().noop},{name:"sortOrder",type:"optioned",default:"desc",options:[{text:g.i18n.translate("data.search.aggs.metrics.topMetrics.descendingLabel",{defaultMessage:"Descending"}),value:"desc"},{text:g.i18n.translate("data.search.aggs.metrics.topMetrics.ascendingLabel",{defaultMessage:"Ascending"}),value:"asc"}],write(e,t){const a=e.params.sortField,s=e.params.sortOrder;t.params.sort=a&&s?{[a.name]:s.value}:"_score"}}],getValueBucketPath(e){const t=e.getParam("field").name;return`${e.id}[${t}]`},getValue(e,t){var a,s;const r=e.getParam("field").name,i=null!==(a=null===(s=t[e.id])||void 0===s?void 0:s.top.map((e=>e.metrics[r])))&&void 0!==a?a:[];return 0===i.length?null:1===i.length?i[0]:i},createFilter:D}),mr=()=>({metrics:[{name:w.COUNT,fn:qa},{name:w.AVG,fn:Wt},{name:w.SUM,fn:lr},{name:w.MEDIAN,fn:fs},{name:w.SINGLE_PERCENTILE,fn:Ss},{name:w.SINGLE_PERCENTILE_RANK,fn:Ys},{name:w.MIN,fn:Fs},{name:w.MAX,fn:cs},{name:w.STD_DEV,fn:sr},{name:w.CARDINALITY,fn:xa},{name:w.VALUE_COUNT,fn:La},{name:w.PERCENTILES,fn:js},{name:w.PERCENTILE_RANKS,fn:Ds},{name:w.RATE,fn:$s},{name:w.TOP_HITS,fn:dr},{name:w.TOP_METRICS,fn:pr},{name:w.DERIVATIVE,fn:Xa},{name:w.CUMULATIVE_SUM,fn:Ha},{name:w.MOVING_FN,fn:Rs},{name:w.SERIAL_DIFF,fn:Zs},{name:w.AVG_BUCKET,fn:la},{name:w.SUM_BUCKET,fn:Ta},{name:w.MIN_BUCKET,fn:ya},{name:w.MAX_BUCKET,fn:ca},{name:w.FILTERED_METRIC,fn:Ia},{name:w.GEO_BOUNDS,fn:ss},{name:w.GEO_CENTROID,fn:os}],buckets:[{name:_.T.DATE_HISTOGRAM,fn:z},{name:_.T.HISTOGRAM,fn:ve},{name:_.T.RANGE,fn:He},{name:_.T.DATE_RANGE,fn:Q},{name:_.T.IP_PREFIX,fn:Ie},{name:_.T.IP_RANGE,fn:Pe},{name:_.T.TERMS,fn:bt},{name:_.T.MULTI_TERMS,fn:It},{name:_.T.RARE_TERMS,fn:xt},{name:_.T.FILTER,fn:se},{name:_.T.FILTERS,fn:ge},{name:_.T.SIGNIFICANT_TERMS,fn:Xe},{name:_.T.SIGNIFICANT_TEXT,fn:at},{name:_.T.GEOTILE_GRID,fn:he},{name:_.T.SAMPLER,fn:Ct},{name:_.T.DIVERSIFIED_SAMPLER,fn:Bt},{name:_.T.TIME_SERIES,fn:Vt}]}),fr=()=>[J,ie,Qe,et,Te,Re,V,ze,de,me,E,rt,zt,Ft,Rt,Dt,Ut,Yt,Xt,ga,pa,va,Fa,Ra,Pa,Oa,ja,Qa,es,is,us,ps,bs,Ks,Ts,As,xs,qs,Gs,Ws,tr,ir,gr,hr];class AggTypesRegistry{constructor(){(0,r.default)(this,"bucketAggs",new Map),(0,r.default)(this,"metricAggs",new Map),(0,r.default)(this,"legacyAggs",new Map),(0,r.default)(this,"setup",(()=>({registerBucket:(e,t)=>{if(this.bucketAggs.get(e)||this.metricAggs.get(e))throw new Error(`Agg has already been registered with name: ${e}`);this.bucketAggs.set(e,t)},registerMetric:(e,t)=>{if(this.bucketAggs.get(e)||this.metricAggs.get(e))throw new Error(`Agg has already been registered with name: ${e}`);this.metricAggs.set(e,t)},registerLegacy:(e,t)=>{if(this.legacyAggs.get(e)||this.legacyAggs.get(e))throw new Error(`Agg has already been registered with name: ${e}`);this.legacyAggs.set(e,t)}}))),(0,r.default)(this,"start",(e=>{const t=new Map,a=(a,s)=>{if(t.has(a))return t.get(a);const r=s(e);return t.set(a,r),r};return{get:e=>{const t=this.bucketAggs.get(e)||this.metricAggs.get(e)||this.legacyAggs.get(e);return t?a(e,t):void 0},getAll:()=>({buckets:Array.from(this.bucketAggs.entries()).map((([e,t])=>a(e,t))),metrics:Array.from(this.metricAggs.entries()).map((([e,t])=>a(e,t)))})}}))}}const yr=["dateFormat","dateFormat:scaled","dateFormat:tz",p.UI_SETTINGS.HISTOGRAM_BAR_TARGET,p.UI_SETTINGS.HISTOGRAM_MAX_BARS,p.UI_SETTINGS.SEARCH_QUERY_LANGUAGE,p.UI_SETTINGS.QUERY_ALLOW_LEADING_WILDCARDS,p.UI_SETTINGS.QUERY_STRING_OPTIONS,p.UI_SETTINGS.COURIER_IGNORE_FILTER_IF_FIELD_NOT_IN_INDEX];class AggsCommonService{constructor(e){(0,r.default)(this,"aggTypesRegistry",new AggTypesRegistry),this.aggExecutionContext=e}setup({registerFunction:e}){const t=this.aggTypesRegistry.setup(),a=mr();return a.buckets.forEach((({name:e,fn:a})=>t.registerBucket(e,a))),a.metrics.forEach((({name:e,fn:a})=>t.registerMetric(e,a))),fr().forEach((t=>e(t))),{types:t}}start({getConfig:e,fieldFormats:t,calculateBounds:a}){const s=this.aggTypesRegistry.start({getConfig:e,getFieldFormatsStart:()=>t,aggExecutionContext:this.aggExecutionContext,calculateBounds:a});return{types:s,calculateAutoTimeExpression:(0,B.JK)(e),createAggConfigs:(t,a,r)=>new AggConfigs(t,a,{...r,typesRegistry:s,aggExecutionContext:this.aggExecutionContext},e)}}}},5675:(e,t,a)=>{"use strict";a.d(t,{J:()=>AggParamType});var s=a(8915),r=a(1616),i=a(8409);class AggParamType extends i.L{constructor(e){super(e),(0,s.default)(this,"makeAgg",void 0),(0,s.default)(this,"allowedAggs",[]),e.allowedAggs&&(this.allowedAggs=e.allowedAggs),e.write||(this.write=(e,t)=>{e.params[this.name]&&e.params[this.name].length&&(t.params[this.name]=e.params[this.name])}),e.serialize||(this.serialize=e=>e.serialize()),e.deserialize||(this.deserialize=(e,t)=>{if(!t)throw new Error("aggConfig was not provided to AggParamType deserialize function");return this.makeAgg(t,e)}),e.toExpressionAst||(this.toExpressionAst=e=>{if(!e||!e.toExpressionAst)throw new Error("aggConfig was not provided to AggParamType toExpressionAst function");return e.toExpressionAst()}),this.makeAgg=e.makeAgg,this.getValueType=()=>r.C}}},8409:(e,t,a)=>{"use strict";a.d(t,{L:()=>BaseParamType});var s=a(8915);class BaseParamType{constructor(e){(0,s.default)(this,"name",void 0),(0,s.default)(this,"type",void 0),(0,s.default)(this,"displayName",void 0),(0,s.default)(this,"required",void 0),(0,s.default)(this,"advanced",void 0),(0,s.default)(this,"default",void 0),(0,s.default)(this,"write",void 0),(0,s.default)(this,"serialize",void 0),(0,s.default)(this,"deserialize",void 0),(0,s.default)(this,"toExpressionAst",void 0),(0,s.default)(this,"options",void 0),(0,s.default)(this,"getValueType",void 0),(0,s.default)(this,"modifyAggConfigOnSearchRequestStart",void 0),this.name=e.name,this.type=e.type,this.displayName=e.displayName||this.name,this.required=!0===e.required,this.advanced=e.advanced||!1,this.onChange=e.onChange,this.shouldShow=e.shouldShow,this.default=e.default,this.write=e.write||((e,t)=>{e.params[this.name]&&(t.params[this.name]=e.params[this.name]||this.default)}),this.serialize=e.serialize,this.deserialize=e.deserialize,this.toExpressionAst=e.toExpressionAst,this.options=e.options,this.modifyAggConfigOnSearchRequestStart=e.modifyAggConfigOnSearchRequestStart||function(){},this.getValueType=e.getValueType}}},6286:(e,t,a)=>{"use strict";a.d(t,{G:()=>FieldParamType});var s=a(8915),r=a(5008),i=a(1359),n=a(7674),l=a(8409),o=a(2023),g=a(2956);const u=(0,o.Ey)("type");class FieldParamType extends l.L{constructor(e){super(e),(0,s.default)(this,"required",!0),(0,s.default)(this,"scriptable",!0),(0,s.default)(this,"filterFieldTypes",void 0),(0,s.default)(this,"onlyAggregatable",void 0),(0,s.default)(this,"filterField",void 0),(0,s.default)(this,"getAvailableFields",(e=>e.getIndexPattern().fields.filter((e=>{const{onlyAggregatable:t,scriptable:a,filterFieldTypes:s,filterField:r}=this;return r?r(e):!(t&&(!e.aggregatable||(0,n.isNestedField)(e))||!a&&e.scripted)&&0!==u([e],s).length})))),this.filterFieldTypes=e.filterFieldTypes||"*",this.onlyAggregatable=!1!==e.onlyAggregatable,this.scriptable=!1!==e.scriptable,this.filterField=e.filterField,e.write||(this.write=(t,a)=>{const s=t.getField();if(!s){if(!1===e.required)return;throw new TypeError(r.i18n.translate("data.search.aggs.paramTypes.field.requiredFieldParameterErrorMessage",{defaultMessage:"{fieldParameter} is a required parameter",values:{fieldParameter:'"field"'}}))}const n=s.type===g.f.MISSING?s:this.getAvailableFields(t).find((e=>e.name===s.name));var l;if(!n)throw new i.SavedFieldTypeInvalidForAgg(r.i18n.translate("data.search.aggs.paramTypes.field.invalidSavedFieldParameterErrorMessage",{defaultMessage:'Saved field "{fieldParameter}" of data view "{indexPatternTitle}" is invalid for use with the "{aggType}" aggregation. Please select a new field.',values:{fieldParameter:s.name,aggType:null==t||null===(l=t.type)||void 0===l?void 0:l.title,indexPatternTitle:t.getIndexPattern().title}}));n.scripted?a.params.script={source:n.script,lang:n.lang}:a.params.field=n.name}),this.serialize=e=>e.name,this.deserialize=(e,t)=>{if(!t)throw new Error("aggConfig was not provided to FieldParamType deserialize function");return t.getIndexPattern().fields.getByName(e)||new n.DataViewField({type:g.f.MISSING,name:e,searchable:!1,aggregatable:!1})}}}},6490:(e,t,a)=>{"use strict";a.d(t,{O:()=>JsonParamType});var s=a(770),r=a.n(s),i=a(8409);class JsonParamType extends i.L{constructor(e){super(e),this.name=e.name||"json",e.write||(this.write=(e,t)=>{let a;const s=e.params[this.name];if(s){try{a=JSON.parse(function(e){const t=e.split('"""');for(let e=1;e<t.length-1;e+=2)t[e]=JSON.stringify(t[e]);return t.join("")}(s))}catch(e){return}t.params=function e(t,a){return r().isPlainObject(t)&&r().isPlainObject(a)?function(t,a){return r()(t).keys().union(r().keys(a)).transform((function(s,r){const i=e(t[r],a[r]);void 0!==i&&(s[r]=i)}),{}).value()}(t,a):Array.isArray(t)&&Array.isArray(a)?function(t,a){return r().times(Math.max(t.length,a.length),(function(s){return e(t[s],a[s])}))}(t,a):null!==a?void 0!==a?a:t:void 0}(t.params,a)}})}}},6252:(e,t,a)=>{"use strict";a.d(t,{o:()=>OptionedParamType});var s=a(8915),r=a(8409);class OptionedParamType extends r.L{constructor(e){super(e),(0,s.default)(this,"options",void 0),e.write||(this.write=(e,t)=>{t.params[this.name]=e.params[this.name].value}),e.serialize||(this.serialize=e=>e.value),e.deserialize||(this.deserialize=e=>this.options.find((t=>t.value===e))),this.options=e.options||[]}}},8201:(e,t,a)=>{"use strict";a.d(t,{l:()=>StringParamType});var s=a(8409);class StringParamType extends s.L{constructor(e){super(e),e.write||(this.write=(e,t)=>{e.params[this.name]&&e.params[this.name].length&&(t.params[this.name]=e.params[this.name])})}}},2023:(e,t,a)=>{"use strict";a.d(t,{zU:()=>InvalidEsCalendarIntervalError,mO:()=>InvalidEsIntervalFormatError,m8:()=>IpAddress,At:()=>H,I1:()=>p,L:()=>x,JK:()=>M,s9:()=>D,JN:()=>K,us:()=>m,Ce:()=>b,sp:()=>Y,nj:()=>c,P1:()=>T,vC:()=>V,Ey:()=>C,dr:()=>_,II:()=>E,p:()=>W});var s=a(1783),r=a.n(s),i=a(3789),n=a(232),l=a(6494),o=a.n(l),g=a(5008);class InvalidEsCalendarIntervalError extends Error{constructor(e,t,a,s){super(g.i18n.translate("data.parseEsInterval.invalidEsCalendarIntervalErrorMessage",{defaultMessage:"Invalid calendar interval: {interval}, value must be 1",values:{interval:e}})),this.interval=e,this.value=t,this.unit=a,this.type=s,this.name="InvalidEsCalendarIntervalError",this.value=t,this.unit=a,this.type=s,Error.captureStackTrace&&Error.captureStackTrace(this,InvalidEsCalendarIntervalError),Object.setPrototypeOf(this,InvalidEsCalendarIntervalError.prototype)}}class InvalidEsIntervalFormatError extends Error{constructor(e){super(g.i18n.translate("data.parseEsInterval.invalidEsIntervalFormatErrorMessage",{defaultMessage:"Invalid interval format: {interval}",values:{interval:e}})),this.interval=e,this.name="InvalidEsIntervalFormatError",Error.captureStackTrace&&Error.captureStackTrace(this,InvalidEsIntervalFormatError),Object.setPrototypeOf(this,InvalidEsIntervalFormatError.prototype)}}const u=new RegExp("^([1-9][0-9]*)\\s*("+o().units.join("|")+")$"),d=e=>{switch(e){case"minute":return"1m";case"hour":return"1h";case"day":return"1d";case"week":return"1w";case"month":return"1M";case"quarter":return"1q";case"year":return"1y"}return e};function c(e){const t=String(d(e)).trim().match(u);if(!t)throw new InvalidEsIntervalFormatError(e);const a=parseFloat(t[1]),s=t[2],r=o().unitsMap[s].type;if("calendar"===r&&1!==a)throw new InvalidEsCalendarIntervalError(e,a,s,r);return{value:a,unit:s,type:"mixed"===r&&1===a||"calendar"===r?"calendar":"fixed"}}const h={w:"7d",M:"30d",y:"365d"};function p(e,t){const{type:a,unit:s}=c(e);return"calendar"!==a||t?"calendar"===a?{fixed_interval:h[s]||e}:{fixed_interval:e}:{calendar_interval:e}}function m(e){try{return c(e),!0}catch{return!1}}function f(e,t){return 0===e?Math.abs(t):f(t%e,e)}function y(e,t){return Math.abs(e*t/f(e,t))}function b(e,t){return t?function(e,t){try{return function(e,t){const{unitsMap:a,unitsDesc:s}=o(),r=c(e),i=c(t);if(e===t)return e;const n=a[r.unit],l=a[i.unit];if(r.type!==i.type)throw Error(`Incompatible intervals: ${e} (${r.type}), ${t} (${i.type})`);if("calendar"===r.type||"calendar"===i.type)return n.weight>l.weight?`${r.value}${r.unit}`:`${i.value}${i.unit}`;const g=r.value*n.base,u=i.value*l.base,d=y(g,u);if(d===u)return t.replace(/\s/g,"");if(d===g)return e.replace(/\s/g,"");const h=s.find((e=>{const t=a[e];return!("calendar"===t.type||d%t.base!=0)}));if(!h)throw Error(`Unable to find common interval for: ${e}, ${t}`);return`${d/a[h].base}${h}`}(t,e)===e.replace(/\s/g,"")}catch(e){return!1}}(e,t):m(e)}var v=a(770);const S=new RegExp("^([0-9\\.]*)\\s*("+o().units.join("|")+")$"),_=e=>{if(e){const t=e.toString().trim().match(S);if(t)return{value:parseFloat(t[1])||1,unit:t[2]}}return null};function T(e){const t=_(e);if(!t)return null;try{const{value:e,unit:a}=t,s=r().duration(e,a),i=(0,v.find)(o().units,(e=>Math.abs(s.as(e))>=1));return o().units.indexOf(i)<o().units.indexOf(a)?s:r().duration(s.as(i),i)}catch(e){return null}}function E(e){const t=o().parse(e.from),a=o().parse(e.to,{roundUp:!0});if(t&&a)return{from:t.toDate(),to:a.toDate()}}var F=a(6763);function M(e){return function(t,a=F.B1,s=!0){const l=E(t);if(!l)return;const o=new n.t({"histogram:maxBars":e(i.j.HISTOGRAM_MAX_BARS),"histogram:barTarget":e(i.j.HISTOGRAM_BAR_TARGET),dateFormat:e("dateFormat"),"dateFormat:scaled":e("dateFormat:scaled")});o.setInterval(a),o.setBounds({min:r()(l.from),max:r()(l.to)});const g=o.getInterval();return s?g.expression:g}}var A=a(8915),I=a(2374),w=a(6034);const R=(e,t)=>t(e.address);var k=a(4611);function x(e){var t,a,s,r,i,n;class FieldFormatWithCache extends I.FieldFormat{constructor(...e){super(...e),(0,A.default)(this,"formatCache",new Map)}getCachedFormat(t){const a=this.formatCache.has(t),s=this.formatCache.get(t)||e(t);return a||this.formatCache.set(t,s),s}}return[(t=class AggsRangeFieldFormat extends FieldFormatWithCache{constructor(...e){super(...e),(0,A.default)(this,"textConvert",(e=>{const t=this._params;if(null==e)return"";if(e.label)return e.label;const a=t,s=this.getCachedFormat(a);let r=s.convert(e.gte),i=s.convert(e.lt);if(t.replaceInfinity&&null==a.id){const t="",a="+";r=isFinite(e.gte)?r:t,i=isFinite(e.lt)?i:a}return"arrow_right"===t.template?g.i18n.translate("data.aggTypes.buckets.ranges.rangesFormatMessageArrowRight",{defaultMessage:"{from}  {to}",values:{from:r,to:i}}):g.i18n.translate("data.aggTypes.buckets.ranges.rangesFormatMessage",{defaultMessage:"{gte} {from} and {lt} {to}",values:{gte:"",from:r,lt:"<",to:i}})}))}},(0,A.default)(t,"id","range"),(0,A.default)(t,"hidden",!0),t),(a=class AggsDateRangeFieldFormat extends FieldFormatWithCache{constructor(...e){super(...e),(0,A.default)(this,"textConvert",(e=>{if(null==e)return"";const t=this._params,a=this.getCachedFormat(t);return(0,w.N)(e,a.convert.bind(a))}))}},(0,A.default)(a,"id","date_range"),(0,A.default)(a,"hidden",!0),a),(s=class AggsIpPrefixFieldFormat extends FieldFormatWithCache{constructor(...e){super(...e),(0,A.default)(this,"textConvert",(e=>{if(null==e)return"";const t=this._params,a=this.getCachedFormat(t);return R(e,a.convert.bind(a))}))}},(0,A.default)(s,"id","ip_prefix"),(0,A.default)(s,"hidden",!0),s),(r=class AggsIpRangeFieldFormat extends FieldFormatWithCache{constructor(...e){super(...e),(0,A.default)(this,"textConvert",(e=>{if(null==e)return"";const t=this._params,a=this.getCachedFormat(t);return(0,k.Q)(e,a.convert.bind(a))}))}},(0,A.default)(r,"id","ip_range"),(0,A.default)(r,"hidden",!0),r),(i=class AggsTermsFieldFormat extends FieldFormatWithCache{constructor(...e){super(...e),(0,A.default)(this,"convert",((e,t)=>{const a=this._params,s=this.getCachedFormat(a);return"__other__"===e?`${a.otherBucketLabel}`:"__missing__"===e?`${a.missingBucketLabel}`:s.convert(e,t)})),(0,A.default)(this,"getConverterFor",(e=>t=>this.convert(t,e)))}},(0,A.default)(i,"id","terms"),(0,A.default)(i,"hidden",!0),i),(n=class AggsMultiTermsFieldFormat extends FieldFormatWithCache{constructor(...e){super(...e),(0,A.default)(this,"convert",((e,t)=>{var a,s,r;const i=this._params,n=i.paramsPerField.map((e=>this.getCachedFormat(e)));if("__other__"===String(e))return`${i.otherBucketLabel}`;const l=`${null!==(a=i.separator)&&void 0!==a?a:"  "}`;return null!==(s=null==e||null===(r=e.keys)||void 0===r?void 0:r.map(((e,a)=>n[a].convert(e,t))).join(l))&&void 0!==s?s:""})),(0,A.default)(this,"getConverterFor",(e=>t=>this.convert(t,e)))}},(0,A.default)(n,"id","multi_terms"),(0,A.default)(n,"hidden",!0),n)]}var N=a(6880),P=a.n(N);class IpAddress{constructor(e){(0,A.default)(this,"value",void 0);try{this.value=Array.isArray(e)?P().fromByteArray(e):P().parse(`${e}`)}catch{throw Error("Invalid IP address: "+e)}}toString(){return"ipv6"===this.value.kind()?this.value.toRFC5952String():this.value.toString()}}function C(e){return function(t,a=[]){if((0,v.isFunction)(a))return t.filter((t=>a(t[e])));if(Array.isArray(a)||(a=a.split(",")),0===a.length)return t;if(a.includes("*"))return t;const s=a.reduce(((e,t)=>{let a="include",s=t;return"!"===t.charAt(0)&&(a="exclude",s=t.substr(1)),e[a]||(e[a]=[]),e[a].push(s),e}),{});return t.filter((t=>{const a=t[e];return(!s.exclude||!s.exclude.includes(a))&&!(s.include&&!s.include.includes(a))}))}}var L=a(7278);function D(e,t,a,s,{shouldDetectTimeZone:r}={}){let i=e.time_zone;if(!i&&e.field){var n,l,o,g;const s="string"==typeof e.field?e.field:e.field.name;i=null===(n=t.typeMeta)||void 0===n||null===(l=n.aggs)||void 0===l||null===(o=l[a])||void 0===o||null===(g=o[s])||void 0===g?void 0:g.time_zone}return i||(0,L.fy)(s,r)}var O=a(5265);const q=["s","m","h","d","w","M","y"],B=/^(startAt|endAt)\((.+)\)$/,j=/^(\d+)\s*(\w)$/,U="invalid",G="previous",z="startAt",$=r().HTML5_FMT.DATETIME_LOCAL_MS+"Z",V=e=>{const t=e.trim();if(t===G)return G;const[,a,s]=t.match(j)||[],i=Number(a);return Number.isNaN(i)||!q.includes(s)?U:r().duration(Number(a),s)},K=e=>null!=e&&B.test(e),H={missingTimerange:"missingTimerange",notAbsoluteTimeShift:"notAbsoluteTimeShift",invalidDate:"invalidDate",shiftAfterTimeRange:"shiftAfterTimeRange"},Y=(e,t)=>{const a=e.trim();if(null==t)return{value:U,reason:H.missingTimerange};const s=W(a,t);if(s)return{value:U,reason:s};const{anchor:i,timestamp:n}=Q(a),l=r()(n,$,!0),o=r()(t.to).diff(r()(t.from)),g=i===z?l.add(o):l;return{value:r().duration(r()(t.to).diff(g)),reason:null}};function Q(e){const[,t,a]=e.match(B)||[];return{anchor:t,timestamp:a}}function W(e,t){const a=e.trim();if(!K(a))return H.notAbsoluteTimeShift;const{anchor:s,timestamp:i}=Q(a),n=r()(i,$,!0);if(!n.isValid())return H.invalidDate;if(t){const e=(0,O.qq)(t),a=r()(e.to).diff(r()(e.from));if(s===z&&n.isAfter(e.from)||n.subtract(a).isAfter(e.from))return H.shiftAfterTimeRange}}},4825:(e,t,a)=>{"use strict";a.d(t,{l:()=>g});var s=a(5008),r=a(5964),i=a(190),n=a(8370),l=a(5536),o=a(8351);const g=({getStartDependencies:e})=>({name:"eql",type:"eql_raw_response",inputTypes:["kibana_context","null"],allowCache:!0,help:s.i18n.translate("data.search.eql.help",{defaultMessage:"Run Elasticsearch request"}),args:{query:{types:["string"],aliases:["_","q","query"],help:s.i18n.translate("data.search.eql.q.help",{defaultMessage:"Query DSL"}),required:!0},index:{types:["string"],help:s.i18n.translate("data.search.eql.index.help",{defaultMessage:"ElasticSearch index to query"}),required:!0},size:{types:["number"],help:s.i18n.translate("data.search.eql.size.help",{defaultMessage:"ElasticSearch searchAPI size parameter"}),default:10},field:{types:["string"],help:s.i18n.translate("data.search.eql.field.help",{defaultMessage:"List of fields to retrieve"}),multi:!0,required:!1}},async fn(t,a,{inspectorAdapters:g,abortSignal:u,getKibanaRequest:d}){const{search:c,uiSettingsClient:h,dataViews:p}=await e(d),m={query:a.query,size:a.size,fields:a.field};if(t){const e=a.index?await p.create({title:a.index}):void 0,s=(0,o.F)(h),i=(0,r.buildEsQuery)(e,t.query||[],t.filters||[],s);m.filter=i}g.requests||(g.requests=new n.RequestAdapter);const f=g.requests.start(s.i18n.translate("data.search.dataRequest.title",{defaultMessage:"Data"}),{description:s.i18n.translate("data.search.es_search.dataRequest.description",{defaultMessage:"This request queries Elasticsearch to fetch the data for the visualization."})});f.stats({indexPattern:{label:s.i18n.translate("data.search.es_search.dataViewLabel",{defaultMessage:"Data view"}),value:a.index,description:s.i18n.translate("data.search.es_search.indexPatternDescription",{defaultMessage:"The data view that connected to the Elasticsearch indices."})}});try{const e=await(0,i.lastValueFrom)(c({params:{index:a.index,body:m}},{abortSignal:u,strategy:l.ky9})),t={};return f.stats(t).ok({json:e}),f.json(m),{type:"eql_raw_response",body:e.rawResponse}}catch(e){throw f.error({json:"attributes"in e?e.attributes:{message:e.message}}),e}}})},8700:(e,t,a)=>{"use strict";a.d(t,{u:()=>o});var s=a(5008),r=a(5964),i=a(190),n=a(8370),l=a(8351);const o=({getStartDependencies:e})=>({name:"esdsl",type:"es_raw_response",inputTypes:["kibana_context","null"],allowCache:!0,help:s.i18n.translate("data.search.esdsl.help",{defaultMessage:"Run Elasticsearch request"}),args:{dsl:{types:["string"],aliases:["_","q","query"],help:s.i18n.translate("data.search.esdsl.q.help",{defaultMessage:"Query DSL"}),required:!0},index:{types:["string"],help:s.i18n.translate("data.search.esdsl.index.help",{defaultMessage:"ElasticSearch index to query"}),required:!0},size:{types:["number"],help:s.i18n.translate("data.search.esdsl.size.help",{defaultMessage:"ElasticSearch searchAPI size parameter"}),default:10}},async fn(t,a,{inspectorAdapters:o,abortSignal:g,getKibanaRequest:u}){const{search:d,uiSettingsClient:c}=await e(u),h=JSON.parse(a.dsl);if(t){const e=(0,l.F)(c),a=(0,r.buildEsQuery)(void 0,t.query||[],t.filters||[],e);h.query&&a.bool.must.push(h.query),h.query=a}o.requests||(o.requests=new n.RequestAdapter);const p=o.requests.start(s.i18n.translate("data.search.dataRequest.title",{defaultMessage:"Data"}),{description:s.i18n.translate("data.search.es_search.dataRequest.description",{defaultMessage:"This request queries Elasticsearch to fetch the data for the visualization."})});p.stats({indexPattern:{label:s.i18n.translate("data.search.es_search.dataViewLabel",{defaultMessage:"Data view"}),value:a.index,description:s.i18n.translate("data.search.es_search.indexPatternDescription",{defaultMessage:"The data view that connected to the Elasticsearch indices."})}});try{const{rawResponse:e,requestParams:t}=await(0,i.lastValueFrom)(d({params:{index:a.index,size:a.size,body:h}},{abortSignal:g})),r={};return null!=e&&e.took&&(r.queryTime={label:s.i18n.translate("data.search.es_search.queryTimeLabel",{defaultMessage:"Query time"}),value:s.i18n.translate("data.search.es_search.queryTimeValue",{defaultMessage:"{queryTime}ms",values:{queryTime:e.took}}),description:s.i18n.translate("data.search.es_search.queryTimeDescription",{defaultMessage:"The time it took to process the query. Does not include the time to send the request or parse it in the browser."})}),null!=e&&e.hits&&(r.hitsTotal={label:s.i18n.translate("data.search.es_search.hitsTotalLabel",{defaultMessage:"Hits (total)"}),value:`${e.hits.total}`,description:s.i18n.translate("data.search.es_search.hitsTotalDescription",{defaultMessage:"The number of documents that match the query."})},r.hits={label:s.i18n.translate("data.search.es_search.hitsLabel",{defaultMessage:"Hits"}),value:`${e.hits.hits.length}`,description:s.i18n.translate("data.search.es_search.hitsDescription",{defaultMessage:"The number of documents returned by the query."})}),p.stats(r).ok({json:e,requestParams:t}),p.json(h),{type:"es_raw_response",body:e}}catch(e){throw p.error({json:"attributes"in e?e.attributes:{message:e.message}}),e}}})},8878:(e,t,a)=>{"use strict";a.d(t,{y:()=>b});var s=a(3313),r=a(5008),i=a(8370),n=a(6494),l=a.n(n),o=a(190);let g=function(e){return e.TIME_LITERAL="time_literal",e.FIELDS="fields",e.VALUES="values",e}({});const u=(e,t,a)=>{const s=((e,t)=>{const a=/\?_tstart/i.test(e),s=/\?_tend/i.test(e);if(t&&(a||s)){var r,i;const e={start:a?null===(r=l().parse(t.from))||void 0===r?void 0:r.toISOString():void 0,end:s?null===(i=l().parse(t.to))||void 0===i?void 0:i.toISOString():void 0},n=[];return null!=e&&e.start&&n.push({_tstart:e.start}),null!=e&&e.end&&n.push({_tend:e.end}),n}return[]})(e,t);return null!=a&&a.length&&(null==a||a.forEach((({key:e,value:t,type:a})=>{a===g.FIELDS?s.push({[e]:{identifier:t}}):s.push({[e]:t})}))),s};var d=a(1991);var c=a(770),h=a(5964),p=a(8351),m=a(1373),f=a(5536);function y(e){return["type","reason"].every((t=>t in e))?e:"error"in e?y(e.error):{}}const b=({getStartDependencies:e})=>({name:"esql",type:"datatable",inputTypes:["kibana_context","null"],help:r.i18n.translate("data.search.esql.help",{defaultMessage:"Queries Elasticsearch using ES|QL."}),args:{query:{aliases:["_","q"],types:["string"],help:r.i18n.translate("data.search.esql.query.help",{defaultMessage:"An ES|QL query."})},timeField:{aliases:["timeField"],types:["string"],help:r.i18n.translate("data.search.essql.timeField.help",{defaultMessage:"The time field to use in the time range filter set in the context."})},locale:{aliases:["locale"],types:["string"],help:r.i18n.translate("data.search.essql.locale.help",{defaultMessage:"The locale to use."})},titleForInspector:{aliases:["titleForInspector"],types:["string"],help:r.i18n.translate("data.search.esql.titleForInspector.help",{defaultMessage:"The title to show in Inspector."})},descriptionForInspector:{aliases:["descriptionForInspector"],types:["string"],help:r.i18n.translate("data.search.esql.descriptionForInspector.help",{defaultMessage:"The description to show in Inspector."})},ignoreGlobalFilters:{types:["boolean"],default:!1,help:r.i18n.translate("data.search.esql.ignoreGlobalFilters.help",{defaultMessage:"Whether to ignore or use global query and filters"})}},allowCache:{withSideEffects:(e,{inspectorAdapters:t})=>(0,f.nDt)(t)},fn:(t,{query:a,timeField:n,locale:l,titleForInspector:g,descriptionForInspector:b,ignoreGlobalFilters:v},{abortSignal:S,inspectorAdapters:_,getKibanaRequest:T})=>(0,o.defer)((()=>e((()=>{const e=null==T?void 0:T();if(!e)throw new Error("A KibanaRequest is required to run queries on the server. Please provide a request object to the expression execution params.");return e})))).pipe((0,o.switchMap)((({search:e,uiSettings:s})=>{const d={query:a,locale:l,include_ccs_metadata:!0};if(t){var c;const e=(0,p.F)(s),r=u(a,t.timeRange,t.esqlVariables);r.length&&(d.params=r);const i=t.timeRange&&(0,m.WB)(void 0,t.timeRange,{fieldName:n}),l=window.ELASTIC_ESQL_DELAY_SECONDS?{meta:{},query:{error_query:{indices:[{name:"*",error_type:"warning",stall_time_seconds:window.ELASTIC_ESQL_DELAY_SECONDS}]}}}:void 0,o=[...v?[]:null!==(c=t.filters)&&void 0!==c?c:[],...i?[i]:[],...l?[l]:[]];d.filter=(0,h.buildEsQuery)(void 0,t.query||[],o,e)}let T=Date.now();const E=()=>{_.requests||(_.requests=new i.RequestAdapter);const e=_.requests.start(null!=g?g:r.i18n.translate("data.search.dataRequest.title",{defaultMessage:"Data"}),{description:null!=b?b:r.i18n.translate("data.search.es_search.dataRequest.description",{defaultMessage:"This request queries Elasticsearch to fetch the data for the visualization."})},T);return T=Date.now(),e};return e({params:{...d,dropNullColumns:!0}},{abortSignal:S,strategy:f.mid}).pipe((0,o.catchError)((e=>{if(e.attributes){const{type:t,reason:a}=y(e.attributes);e.message="parsing_exception"===t?`Couldn't parse Elasticsearch ES|QL query. Check your query and try again. Error: ${a}`:`Unexpected error from Elasticsearch: ${t} - ${a}`}else e.message=`Unexpected error from Elasticsearch: ${e.message}`;return(0,o.throwError)((()=>e))})),(0,o.tap)({next(e){if((0,f.vQj)(e))return;const{rawResponse:t,requestParams:a}=e;E().stats({hits:{label:r.i18n.translate("data.search.es_search.hitsLabel",{defaultMessage:"Hits"}),value:`${t.values.length}`,description:r.i18n.translate("data.search.es_search.hitsDescription",{defaultMessage:"The number of documents returned by the query."})},...(null==t?void 0:t.took)&&{queryTime:{label:r.i18n.translate("data.search.es_search.queryTimeLabel",{defaultMessage:"Query time"}),value:r.i18n.translate("data.search.es_search.queryTimeValue",{defaultMessage:"{queryTime}ms",values:{queryTime:t.took}}),description:r.i18n.translate("data.search.es_search.queryTimeDescription",{defaultMessage:"The time it took to process the query. Does not include the time to send the request or parse it in the browser."})}}}).json(d).ok({json:{rawResponse:t},requestParams:a})},error(e){E().json(d).error({json:"attributes"in e?e.attributes:{message:e.message}})}}))})),(0,o.map)((({rawResponse:e,warning:r})=>{var i,n,l,o,g,u;const h=e.all_columns&&(null===(i=e.all_columns)||void 0===i?void 0:i.length)>e.columns.length,p=new Set(h&&(null===(n=e.columns)||void 0===n?void 0:n.map((({name:e})=>e)))||[]),m=function(e){var t;const{ast:a}=(0,d.parse)(e),s=a.find((({name:e})=>["from","metrics"].includes(e))),r=(null!==(t=null==s?void 0:s.args)&&void 0!==t?t:[]).filter((e=>"index"===e.sourceType));return null==r?void 0:r.map((e=>e.name)).join(",")}(a),y=null!==(l=null===(o=null!==(g=e.all_columns)&&void 0!==g?g:e.columns)||void 0===o?void 0:o.map((({name:e,type:a})=>({id:e,name:e,meta:{type:(0,s.s0)(a),esType:a,sourceParams:"date"===a?{appliedTimeRange:null==t?void 0:t.timeRange,params:{},indexPattern:m}:{indexPattern:m}},isNull:!!h&&!p.has(e)}))))&&void 0!==l?l:[],b=((e,t,a)=>{if(!t.length)return a;const s=(e=>{const{root:t}=(0,d.parse)(e);return d.Walker.params(t).map((e=>e.text.replace("?","")))})(e),r=new Set(s);return a.map((e=>{if(t.some((t=>t.value===e.id))){var a;const s=t.filter((t=>t.value===e.id)),i=s.find((e=>r.has(e.key)));e.variable=null!==(a=null==i?void 0:i.key)&&void 0!==a?a:""}})),a})(a,null!==(u=null==t?void 0:t.esqlVariables)&&void 0!==u?u:[],y);h&&b.sort(((e,t)=>Number(e.isNull)-Number(t.isNull)));const v=null==b?void 0:b.map((({name:e})=>e)),S=e.values.map((e=>(0,c.zipObject)(v,e)));return{type:"datatable",meta:{type:f.AV0,query:a,statistics:{totalCount:e.values.length}},columns:b,rows:S,warning:r}})))})},8686:(e,t,a)=>{"use strict";a.r(t),a.d(t,{adaptToExpressionValueFilter:()=>U,aggregateQueryToAst:()=>k,cidrFunction:()=>r,cidrToAst:()=>n,dateRangeFunction:()=>l,dateRangeToAst:()=>o,eqlRawResponse:()=>re,esRawResponse:()=>ae,existsFilterFunction:()=>H,extendedBoundsFunction:()=>u,extendedBoundsToAst:()=>d,fieldFunction:()=>$,filtersToAst:()=>X,functionWrapper:()=>q,geoBoundingBoxFunction:()=>c,geoBoundingBoxToAst:()=>m,geoPointFunction:()=>f,geoPointToAst:()=>h,getEqlFn:()=>ne.l,getEsaggsMeta:()=>O,getEsdslFn:()=>ie.u,getEsqlFn:()=>le.y,getSideEffectFunction:()=>G,handleEsaggsRequest:()=>D,ipPrefixFunction:()=>y,ipPrefixToAst:()=>b,ipRangeFunction:()=>v,ipRangeToAst:()=>S,kibana:()=>T,kibanaFilterFunction:()=>J,kibanaTimerangeFunction:()=>Z,kqlFunction:()=>E,luceneFunction:()=>F,numericalRangeFunction:()=>M,numericalRangeToAst:()=>A,phraseFilterFunction:()=>K,queryFilterFunction:()=>I,queryFilterToAst:()=>R,queryToAst:()=>w,rangeFilterFunction:()=>Y,rangeFunction:()=>z,removeFilterFunction:()=>Q,selectFilterFunction:()=>W,timerangeToAst:()=>x});var s=a(5008);const r={name:"cidr",type:"cidr",inputTypes:["null"],help:s.i18n.translate("data.search.functions.cidr.help",{defaultMessage:"Create a CIDR-based range"}),args:{mask:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.cidr.cidr.help",{defaultMessage:"Specify the CIDR block"})}},fn:(e,{mask:t})=>({mask:t,type:"cidr"})};var i=a(7876);const n=e=>(0,i.buildExpression)([(0,i.buildExpressionFunction)("cidr",e)]).toAst(),l={name:"dateRange",type:"date_range",inputTypes:["null"],help:s.i18n.translate("data.search.functions.dateRange.help",{defaultMessage:"Create a date range"}),args:{from:{types:["number","string"],help:s.i18n.translate("data.search.functions.dateRange.from.help",{defaultMessage:"Specify the starting date"})},to:{types:["number","string"],help:s.i18n.translate("data.search.functions.dateRange.to.help",{defaultMessage:"Specify the ending date"})}},fn:(e,{from:t,to:a})=>({from:t,to:a,type:"date_range"})},o=e=>(0,i.buildExpression)([(0,i.buildExpressionFunction)("dateRange",e)]).toAst();var g=a(770);const u={name:"extendedBounds",type:"extended_bounds",inputTypes:["null"],help:s.i18n.translate("data.search.functions.extendedBounds.help",{defaultMessage:"Create extended bounds"}),args:{min:{types:["number"],help:s.i18n.translate("data.search.functions.extendedBounds.min.help",{defaultMessage:"Specify the lower boundary value"})},max:{types:["number"],help:s.i18n.translate("data.search.functions.extendedBounds.max.help",{defaultMessage:"Specify the upper boundary value"})}},fn:(e,{min:t,max:a})=>({type:"extended_bounds",...(0,g.omitBy)({min:t,max:a},g.isNil)})},d=e=>(0,i.buildExpression)([(0,i.buildExpressionFunction)("extendedBounds",e)]).toAst(),c={name:"geoBoundingBox",type:"geo_bounding_box",inputTypes:["null"],help:s.i18n.translate("data.search.functions.geoBoundingBox.help",{defaultMessage:"Create a geo bounding box"}),args:{top:{types:["number"],help:s.i18n.translate("data.search.functions.geoBoundingBox.top.help",{defaultMessage:"Specify the top coordinate"})},left:{types:["number"],help:s.i18n.translate("data.search.functions.geoBoundingBox.left.help",{defaultMessage:"Specify the left coordinate"})},bottom:{types:["number"],help:s.i18n.translate("data.search.functions.geoBoundingBox.bottom.help",{defaultMessage:"Specify the bottom coordinate"})},right:{types:["number"],help:s.i18n.translate("data.search.functions.geoBoundingBox.right.help",{defaultMessage:"Specify the right coordinate"})},wkt:{types:["string"],help:s.i18n.translate("data.search.functions.geoBoundingBox.wkt.help",{defaultMessage:"Specify the Well-Known Text (WKT)"})},topLeft:{types:["geo_point"],help:s.i18n.translate("data.search.functions.geoBoundingBox.top_left.help",{defaultMessage:"Specify the top left corner"})},bottomRight:{types:["geo_point"],help:s.i18n.translate("data.search.functions.geoBoundingBox.bottom_right.help",{defaultMessage:"Specify the bottom right corner"})},topRight:{types:["geo_point"],help:s.i18n.translate("data.search.functions.geoBoundingBox.top_right.help",{defaultMessage:"Specify the top right corner"})},bottomLeft:{types:["geo_point"],help:s.i18n.translate("data.search.functions.geoBoundingBox.bottom_left.help",{defaultMessage:"Specify the bottom left corner"})}},fn(e,t){if(null!=(null==(a=t)?void 0:a.wkt))return{...(0,g.pick)(t,"wkt"),type:"geo_bounding_box"};var a;if(function(e){return null!=(null==e?void 0:e.top)&&null!=(null==e?void 0:e.left)&&null!=(null==e?void 0:e.bottom)&&null!=(null==e?void 0:e.right)}(t))return{...(0,g.pick)(t,["top","left","bottom","right"]),type:"geo_bounding_box"};if(function(e){return null!=(null==e?void 0:e.topLeft)&&null!=(null==e?void 0:e.bottomRight)||null!=(null==e?void 0:e.topRight)&&null!=(null==e?void 0:e.bottomLeft)}(t))return{...(0,g.chain)(t).pick(["topLeft","bottomRight","topRight","bottomLeft"]).omitBy(g.isNil).mapKeys(((e,t)=>(0,g.snakeCase)(t))).mapValues((({value:e})=>e)).value(),type:"geo_bounding_box"};throw new Error(s.i18n.translate("data.search.functions.geoBoundingBox.arguments.error",{defaultMessage:"At least one of the following groups of parameters must be provided: {parameters}.",values:{parameters:[["wkt"],["top","left","bottom","right"],["topLeft","bottomRight"],["topRight","bottomLeft"]].map((e=>e.join(", "))).join("; ")}}))}},h=e=>(0,i.buildExpression)([(0,i.buildExpressionFunction)("geoPoint","object"!=typeof e||Array.isArray(e)?{point:Array.isArray(e)?e:[e]}:e)]).toAst(),p=["top_left","bottom_right","top_right","bottom_left"],m=e=>(0,i.buildExpression)([(0,i.buildExpressionFunction)("geoBoundingBox",{...(0,g.omit)(e,p),...(0,g.chain)(e).pick(p).omitBy(g.isNil).mapKeys(((e,t)=>(0,g.camelCase)(t))).mapValues((e=>h(e))).value()})]).toAst(),f={name:"geoPoint",type:"geo_point",inputTypes:["null"],help:s.i18n.translate("data.search.functions.geoPoint.help",{defaultMessage:"Create a geo point"}),args:{lat:{types:["number"],help:s.i18n.translate("data.search.functions.geoPoint.lat.help",{defaultMessage:"Specify the latitude"})},lon:{types:["number"],help:s.i18n.translate("data.search.functions.geoPoint.lon.help",{defaultMessage:"Specify the longitude"})},point:{aliases:["_"],types:["number","string"],multi:!0,help:s.i18n.translate("data.search.functions.geoPoint.point.help",{defaultMessage:"Specify the point as a string with comma-separated coordinates or as two numeric values"})}},fn(e,{lat:t,lon:a,point:r}){if(null!=t&&null!=a)return{type:"geo_point",value:{lat:t,lon:a}};if(!r)throw new Error(s.i18n.translate("data.search.functions.geoPoint.arguments.error",{defaultMessage:'Either "lat" and "lon" or "point" parameters should be specified.'}));const[i]=r;if("string"==typeof i)return{value:i,type:"geo_point"};if(2!==r.length)throw new Error(s.i18n.translate("data.search.functions.geoPoint.point.error",{defaultMessage:"The point parameter should either be a string or two numeric values."}));return{type:"geo_point",value:[...r]}}},y={name:"ipPrefix",type:"ip_prefix",inputTypes:["null"],help:s.i18n.translate("data.search.functions.ipPrefix.help",{defaultMessage:"Create an IP prefix"}),args:{prefixLength:{types:["number"],help:s.i18n.translate("data.search.functions.ipPrefix.prefixLength.help",{defaultMessage:"Specify the length of the network prefix"})},isIpv6:{types:["boolean"],help:s.i18n.translate("data.search.functions.ipPrefix.isIpv6.help",{defaultMessage:"Specify whether the prefix applies to IPv6 addresses"})}},fn:(e,{prefixLength:t,isIpv6:a})=>({type:"ip_prefix",prefixLength:t,isIpv6:a})},b=e=>(0,i.buildExpression)([(0,i.buildExpressionFunction)("ipPrefix",e)]).toAst(),v={name:"ipRange",type:"ip_range",inputTypes:["null"],help:s.i18n.translate("data.search.functions.ipRange.help",{defaultMessage:"Create an IP range"}),args:{from:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.ipRange.from.help",{defaultMessage:"Specify the starting address"})},to:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.ipRange.to.help",{defaultMessage:"Specify the ending address"})}},fn:(e,{from:t,to:a})=>({from:t,to:a,type:"ip_range"})},S=e=>(0,i.buildExpression)([(0,i.buildExpressionFunction)("ipRange",e)]).toAst(),_=e=>e?Array.isArray(e)?e:[e]:[],T={name:"kibana",type:"kibana_context",inputTypes:["kibana_context","null"],help:s.i18n.translate("data.search.functions.kibana.help",{defaultMessage:"Gets kibana global context"}),args:{},fn(e,t,{getSearchContext:a}){var s;return{...e,type:"kibana_context",now:null!==(s=a().now)&&void 0!==s?s:Date.now(),query:[..._(a().query),..._((e||{}).query)],filters:[...a().filters||[],...(e||{}).filters||[]],timeRange:a().timeRange||(e?e.timeRange:void 0),esqlVariables:a().esqlVariables||(e?e.esqlVariables:void 0)}}},E={name:"kql",type:"kibana_query",inputTypes:["null"],help:s.i18n.translate("data.search.functions.kql.help",{defaultMessage:"Create kibana kql query"}),args:{q:{types:["string"],required:!0,aliases:["query","_"],help:s.i18n.translate("data.search.functions.kql.q.help",{defaultMessage:"Specify Kibana KQL free form text query"})}},fn:(e,t)=>({type:"kibana_query",language:"kuery",query:t.q})},F={name:"lucene",type:"kibana_query",inputTypes:["null"],help:s.i18n.translate("data.search.functions.lucene.help",{defaultMessage:"Create kibana lucene query"}),args:{q:{types:["string"],required:!0,aliases:["query","_"],help:s.i18n.translate("data.search.functions.lucene.q.help",{defaultMessage:"Specify Lucene free form text query"})}},fn:(e,t)=>({type:"kibana_query",language:"lucene",query:JSON.parse(t.q)})},M={name:"numericalRange",type:"numerical_range",inputTypes:["null"],help:s.i18n.translate("data.search.functions.numericalRange.help",{defaultMessage:"Create a numerical range"}),args:{from:{types:["number"],help:s.i18n.translate("data.search.functions.numericalRange.from.help",{defaultMessage:"Specify the starting value"})},to:{types:["number"],help:s.i18n.translate("data.search.functions.numericalRange.to.help",{defaultMessage:"Specify the ending value"})},label:{types:["string"],help:s.i18n.translate("data.search.functions.numericalRange.label.help",{defaultMessage:"Specify the range label"})}},fn:(e,{from:t,to:a,label:s})=>({type:"numerical_range",...(0,g.omitBy)({from:t,to:a,label:s},g.isNil)})},A=e=>(0,i.buildExpression)([(0,i.buildExpressionFunction)("numericalRange",e)]).toAst(),I={name:"queryFilter",type:"kibana_query_filter",inputTypes:["null"],help:s.i18n.translate("data.search.functions.queryFilter.help",{defaultMessage:"Create a query filter"}),args:{input:{types:["kibana_query"],aliases:["_"],required:!0,help:s.i18n.translate("data.search.functions.queryFilter.input.help",{defaultMessage:"Specify the query filter"})},label:{types:["string"],help:s.i18n.translate("data.search.functions.queryFilter.label.help",{defaultMessage:"Specify the filter label"})}},fn:(e,{input:t,label:a})=>({type:"kibana_query_filter",input:(0,g.omit)(t,"type"),...(0,g.omitBy)({label:a},g.isNil)})},w=e=>"kuery"===e.language?(0,i.buildExpression)([(0,i.buildExpressionFunction)("kql",{q:e.query})]).toAst():(0,i.buildExpression)([(0,i.buildExpressionFunction)("lucene",{q:JSON.stringify(e.query)})]).toAst(),R=({input:e,label:t})=>(0,i.buildExpression)([(0,i.buildExpressionFunction)("queryFilter",{label:t,input:w(e)})]).toAst(),k=({query:e,timeField:t,titleForInspector:a,descriptionForInspector:r})=>(0,i.buildExpressionFunction)("esql",{query:e.esql,timeField:t,locale:s.i18n.getLocale(),titleForInspector:a,descriptionForInspector:r}).toAst(),x=e=>(0,i.buildExpression)([(0,i.buildExpressionFunction)("timerange",e)]).toAst();var N=a(2607),P=a(190),C=a(4177),L=a(9235);const D=({abortSignal:e,aggs:t,filters:a,indexPattern:r,inspectorAdapters:i,query:n,searchSessionId:l,searchSourceService:o,timeFields:g,timeRange:u,disableWarningToasts:d,getNow:c,executionContext:h,title:p,description:m})=>(0,P.defer)((async()=>{var e;const s=null==c?void 0:c(),i=await o.create();i.setField("index",r),i.setField("size",0);const l=i.createChild({callParentStartHandlers:!0}),d=l.createChild({callParentStartHandlers:!0}),h=null==r||null===(e=r.getTimeField)||void 0===e?void 0:e.call(r),p=h?[h.name]:[],m=null!=g&&g.length?g:p;return t.setTimeRange(u),t.setForceNow(s),t.setTimeFields(m),Object.defineProperty(d,"history",{get:()=>i.history,set:e=>i.history=e}),d.setField("aggs",t),d.onRequestStart(((e,a)=>t.onSearchRequestStart(e,a))),u&&m.length>0&&l.setField("filter",(()=>t.getSearchSourceTimeFilter(s))),d.setField("filter",a),d.setField("query",n),{allTimeFields:m,forceNow:s,requestSearchSource:d}})).pipe((0,P.switchMap)((({allTimeFields:a,forceNow:r,requestSearchSource:n})=>n.fetch$({abortSignal:e,disableWarningToasts:d,sessionId:l,inspector:{adapter:i.requests,title:null!=p?p:s.i18n.translate("data.functions.esaggs.inspector.dataRequest.title",{defaultMessage:"Data"}),description:null!=m?m:s.i18n.translate("data.functions.esaggs.inspector.dataRequest.description",{defaultMessage:"This request queries Elasticsearch to fetch the data for the visualization."})},executionContext:h}).pipe((0,P.map)((({rawResponse:e})=>{const s=u?(0,C.calculateBounds)(u,{forceNow:r}):null,i={metricsAtAllLevels:t.hierarchical,partialRows:t.partialRows,timeRange:s?{from:s.min,to:s.max,timeFields:a}:void 0};return(0,L.AX)(t,e,i)})))))),O=()=>({name:"esaggs",type:"datatable",inputTypes:["kibana_context","null"],help:s.i18n.translate("data.functions.esaggs.help",{defaultMessage:"Run AggConfig aggregation"}),args:{index:{types:["index_pattern"],required:!0,help:s.i18n.translate("data.search.functions.esaggs.index.help",{defaultMessage:"Data view retrieved with indexPatternLoad"})},aggs:{types:["agg_type"],multi:!0,default:`{${(0,i.buildExpressionFunction)(N.OL7,{}).toString()}}`,help:s.i18n.translate("data.search.functions.esaggs.aggConfigs.help",{defaultMessage:"List of aggs configured with agg_type functions"})},metricsAtAllLevels:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.esaggs.metricsAtAllLevels.help",{defaultMessage:"Whether to include columns with metrics for each bucket level"})},partialRows:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.esaggs.partialRows.help",{defaultMessage:"Whether to return rows that only contain partial data"})},timeFields:{types:["string"],multi:!0,help:s.i18n.translate("data.search.functions.esaggs.timeFields.help",{defaultMessage:"Provide time fields to get the resolved time ranges for the query"})},probability:{types:["number"],default:1,help:s.i18n.translate("data.search.functions.esaggs.probability.help",{defaultMessage:"The probability that a document will be included in the aggregated data. Uses random sampler."})},samplerSeed:{types:["number"],help:s.i18n.translate("data.search.functions.esaggs.samplerSeed.help",{defaultMessage:"The seed to generate the random sampling of documents. Uses random sampler."})},ignoreGlobalFilters:{types:["boolean"],help:s.i18n.translate("data.search.functions.esaggs.ignoreGlobalFilters.help",{defaultMessage:"Whether to ignore or use global query and filters"})}}}),q=e=>{const t=(0,g.mapValues)(e.args,(e=>e.default));return(a,s={},r={})=>e.fn(a,{...t,...s},r)};function B(e){const{meta:t}=e,{group:a}=null!=t?t:{};return a}const j={range:function(e){var t;const{query:a}=e,{range:s}=null!=a?a:{},r=Object.keys(s)[0],{gte:i,lte:n}=null!==(t=s[r])&&void 0!==t?t:{};return{filterGroup:B(e),from:i,to:n,column:r,type:"filter",filterType:"time",and:[]}},term:function(e){var t;const{query:a}=e,{term:s}=null!=a?a:{},r=Object.keys(s)[0],{value:i}=null!==(t=s[r])&&void 0!==t?t:{};return{filterGroup:B(e),column:r,value:i,type:"filter",filterType:"exactly",and:[]}},luceneQueryString:function(e){const{query:t}=e,{query_string:a}=null!=t?t:{},{query:s}=a;return{filterGroup:B(e),query:s,type:"filter",filterType:"luceneQueryString",and:[]}}};function U(e){const{query:t={}}=e,a=Object.keys(t)[0],s=j[a];if(!s||"function"!=typeof s)throw new Error(`Unknown filter type: ${a}`);return s(e)}const G=e=>{const t=(e=>{var t;return null===(t=e.requests)||void 0===t?void 0:t.getRequestEntries()})(e);return()=>{var a;if(!t||0===t.length)return;const s=new Map(t.map((([e])=>[e.id,e]))),r=new WeakMap(t);null===(a=e.requests)||void 0===a||a.loadFromEntries(s,r)}},z={name:"range",type:"kibana_range",inputTypes:["null"],help:s.i18n.translate("data.search.functions.range.help",{defaultMessage:"Create kibana range filter"}),args:{gt:{types:["string","number"],help:s.i18n.translate("data.search.functions.range.gt.help",{defaultMessage:"Greater than"})},lt:{types:["string","number"],help:s.i18n.translate("data.search.functions.range.lt.help",{defaultMessage:"Less than"})},gte:{types:["string","number"],help:s.i18n.translate("data.search.functions.range.gte.help",{defaultMessage:"Greater or equal than"})},lte:{types:["string","number"],help:s.i18n.translate("data.search.functions.range.lte.help",{defaultMessage:"Less or equal than"})}},fn(e,t){if(void 0===t.lt&&void 0===t.lte)throw new Error("lt or lte must be provided");if(void 0===t.gt&&void 0===t.gte)throw new Error("gt or gte must be provided");return{type:"kibana_range",...t}}},$={name:"field",type:"kibana_field",inputTypes:["null"],help:s.i18n.translate("data.search.functions.field.help",{defaultMessage:"Create a Kibana field."}),args:{name:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.field.name.help",{defaultMessage:"Name of the field"})},type:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.field.type.help",{defaultMessage:"Type of the field"})},script:{types:["string"],help:s.i18n.translate("data.search.functions.field.script.help",{defaultMessage:"A field script, in case the field is scripted."})}},fn:(e,t)=>({type:"kibana_field",spec:{name:t.name,type:t.type,scripted:!!t.script,script:t.script}})};var V=a(5964);const K={name:"phraseFilter",type:"kibana_filter",inputTypes:["null"],help:s.i18n.translate("data.search.functions.phraseFilter.help",{defaultMessage:"Create kibana phrase or phrases filter"}),args:{field:{types:["kibana_field"],required:!0,help:s.i18n.translate("data.search.functions.phraseFilter.field.help",{defaultMessage:"Specify the field you want to filter on. Use `field` function."})},phrase:{types:["string"],multi:!0,required:!0,help:s.i18n.translate("data.search.functions.phraseFilter.phrase.help",{defaultMessage:"Specify the phrases"})},negate:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.phraseFilter.negate.help",{defaultMessage:"Should the filter be negated"})}},fn:(e,t)=>1===t.phrase.length?{type:"kibana_filter",...(0,V.buildFilter)({},t.field.spec,V.FILTERS.PHRASE,t.negate||!1,!1,t.phrase[0],null)}:{type:"kibana_filter",...(0,V.buildFilter)({},t.field.spec,V.FILTERS.PHRASES,t.negate||!1,!1,t.phrase,null)}},H={name:"existsFilter",type:"kibana_filter",inputTypes:["null"],help:s.i18n.translate("data.search.functions.existsFilter.help",{defaultMessage:"Create kibana exists filter"}),args:{field:{types:["kibana_field"],required:!0,help:s.i18n.translate("data.search.functions.existsFilter.field.help",{defaultMessage:"Specify the field you want to filter on. Use `field` function."})},negate:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.existsFilter.negate.help",{defaultMessage:"Should the filter be negated."})}},fn:(e,t)=>({type:"kibana_filter",...(0,V.buildFilter)({},t.field.spec,V.FILTERS.EXISTS,t.negate||!1,!1,{},null)})},Y={name:"rangeFilter",type:"kibana_filter",inputTypes:["null"],help:s.i18n.translate("data.search.functions.rangeFilter.help",{defaultMessage:"Create kibana range filter"}),args:{field:{types:["kibana_field"],required:!0,help:s.i18n.translate("data.search.functions.rangeFilter.field.help",{defaultMessage:"Specify the field you want to filter on. Use `field` function."})},range:{types:["kibana_range"],required:!0,help:s.i18n.translate("data.search.functions.rangeFilter.range.help",{defaultMessage:"Specify the range, use `range` function."})},negate:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.rangeFilter.negate.help",{defaultMessage:"Should the filter be negated"})}},fn:(e,t)=>({type:"kibana_filter",...(0,V.buildFilter)({},t.field.spec,V.FILTERS.RANGE,t.negate||!1,!1,{from:t.range.gt||t.range.gte,to:t.range.lt||t.range.lte},null)})},Q={name:"removeFilter",type:"kibana_context",inputTypes:["kibana_context"],help:s.i18n.translate("data.search.functions.removeFilter.help",{defaultMessage:"Removes filters from context"}),args:{group:{types:["string"],aliases:["_"],help:s.i18n.translate("data.search.functions.removeFilter.group.help",{defaultMessage:"Removes only filters belonging to the provided group"})},from:{types:["string"],help:s.i18n.translate("data.search.functions.removeFilter.from.help",{defaultMessage:"Removes only filters owned by the provided id"})},ungrouped:{types:["boolean"],aliases:["nogroup","nogroups"],default:!1,help:s.i18n.translate("data.search.functions.removeFilter.ungrouped.help",{defaultMessage:"Should filters without group be removed"})}},fn(e,{group:t,from:a,ungrouped:s}){var r;return{...e,filters:(null===(r=e.filters)||void 0===r?void 0:r.filter((({meta:e})=>{const r=!t&&!s||t===e.group||s&&!e.group,i=!a||a===e.controlledBy;return!r||!i})))||[]}}},W={name:"selectFilter",type:"kibana_context",inputTypes:["kibana_context"],help:s.i18n.translate("data.search.functions.selectFilter.help",{defaultMessage:"Selects filters from context"}),args:{group:{types:["string"],aliases:["_"],help:s.i18n.translate("data.search.functions.selectFilter.group.help",{defaultMessage:"Select only filters belonging to the provided group"}),multi:!0},from:{types:["string"],help:s.i18n.translate("data.search.functions.selectFilter.from.help",{defaultMessage:"Select only filters owned by the provided id"})},ungrouped:{types:["boolean"],aliases:["nogroup","nogroups"],default:!1,help:s.i18n.translate("data.search.functions.selectFilter.ungrouped.help",{defaultMessage:"Should filters without group be included"})}},fn(e,{group:t=[],ungrouped:a,from:s}){var r;return{...e,filters:(null===(r=e.filters)||void 0===r?void 0:r.filter((({meta:e})=>{const r=!t.length&&!a||e.group&&t.length&&t.includes(e.group)||a&&!e.group,i=!s||s===e.controlledBy;return r&&i})))||[]}}},J={name:"kibanaFilter",type:"kibana_filter",inputTypes:["null"],help:s.i18n.translate("data.search.functions.kibanaFilter.help",{defaultMessage:"Create kibana filter"}),args:{query:{types:["string"],aliases:["q","_"],required:!0,help:s.i18n.translate("data.search.functions.kibanaFilter.field.help",{defaultMessage:"Specify free form esdsl query"})},negate:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.kibanaFilter.negate.help",{defaultMessage:"Should the filter be negated"})},disabled:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.kibanaFilter.disabled.help",{defaultMessage:"Should the filter be disabled"})}},fn:(e,t)=>({type:"kibana_filter",meta:{negate:t.negate||!1,alias:"",disabled:t.disabled||!1},query:JSON.parse(t.query)})},X=e=>(Array.isArray(e)?e:[e]).map((e=>{const t=e.meta.type===V.FILTERS.COMBINED?(0,V.fromCombinedFilter)(e):e,{meta:a,$state:s,query:r,...n}=t;return(0,i.buildExpression)([(0,i.buildExpressionFunction)("kibanaFilter",{query:JSON.stringify(r||n),negate:a.negate,disabled:a.disabled})]).toAst()})),Z={name:"timerange",type:"timerange",inputTypes:["null"],help:s.i18n.translate("data.search.functions.timerange.help",{defaultMessage:"Create kibana timerange"}),args:{from:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.timerange.from.help",{defaultMessage:"Specify the start date"})},to:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.timerange.to.help",{defaultMessage:"Specify the end date"})},mode:{types:["string"],options:["absolute","relative"],help:s.i18n.translate("data.search.functions.timerange.mode.help",{defaultMessage:"Specify the mode (absolute or relative)"})}},fn:(e,t)=>({type:"timerange",from:t.from,to:t.to,mode:t.mode})};function ee(e,t=""){let a={};const s=[],r=t?t+".":"";return Object.keys(e).forEach((t=>{if(Array.isArray(e[t]))s.push(...e[t].map((e=>ee(e,r+t))).reduce(((e,t)=>(e.push(...t),e)),[]));else if("object"==typeof e[t]&&null!==e[t]){const i=ee(e[t],r+t);1===i.length?a={...a,...i[0]}:s.push(...i)}else a[r+t]=e[t]})),0===s.length?[a]:s.map((e=>({...e,...a})))}const te=e=>e.aggregations?ee(e.aggregations):e.hits.hits.map((e=>e.fields||e._source)).filter((e=>e)),ae={name:"es_raw_response",to:{datatable:e=>{var t;const a=te(e.body),s=a.length?Object.keys(a[0]).map((e=>({id:e,name:e,meta:{type:typeof a[0][e],field:e,params:{}}}))):[];return{type:"datatable",meta:{type:"esdsl",source:"*",statistics:{totalCount:"number"==typeof e.body.hits.total?e.body.hits.total:null===(t=e.body.hits.total)||void 0===t?void 0:t.value}},columns:s,rows:a}}}},se=(e,t)=>e.map((e=>e.fields||e._source)).filter((e=>e)).map((e=>(e=>{const t=(e,a=[])=>Object.keys(e).map((s=>{if("object"!=typeof e[s]||null===e[s]||Array.isArray(e[s])){const t=[...a,s].join(".");return{[t]:e[s]}}return t(e[s],[...a,s])})).flat();return Object.assign({},...t(e))})(e))).map((e=>(t&&(e.joinKeys=t),e))),re={name:"eql_raw_response",to:{datatable:e=>{var t;const a=(s=e.body.hits).sequences?s.sequences.flatMap((e=>se(e.events,e.join_keys))):se(s.events);var s;const r=a.length?Object.keys(a[0]).map((e=>({id:e,name:e,meta:{type:typeof a[0][e],field:e,params:{}}}))):[];return{type:"datatable",meta:{type:"eql",source:"*",statistics:{totalCount:null===(t=e.body.hits.total)||void 0===t?void 0:t.value}},columns:r,rows:a}}}};var ie=a(8700),ne=a(4825),le=a(8878)},5536:(e,t,a)=>{"use strict";a.d(t,{CuU:()=>s.CuU,dg3:()=>s.dg3,qLR:()=>s.qLR,TO1:()=>s.TO1,Jnb:()=>s.Jnb,sow:()=>s.sow,QJv:()=>s.QJv,fXy:()=>s.fXy,TDc:()=>s.TDc,Lnr:()=>s.Lnr,aiG:()=>s.aiG,buk:()=>s.buk,yAE:()=>s.yAE,RNT:()=>$,ky9:()=>z,mid:()=>H,fOT:()=>K,AV0:()=>Y,kAj:()=>j,Gwp:()=>s.Gwp,O0P:()=>s.O0P,zUd:()=>s.zUd,mOS:()=>s.mOS,m8W:()=>s.m8W,Oq5:()=>s.Oq5,zmd:()=>s.zmd,dY5:()=>s.dY5,mz6:()=>s.mz6,p0N:()=>s.p0N,o8K:()=>s.o8K,At2:()=>s.At2,e6x:()=>RequestFailure,z3F:()=>s.z3F,MXb:()=>O,VNk:()=>D,vZc:()=>s.vZc,UNd:()=>V,vdD:()=>L.v,Cyp:()=>SearchSource,zA1:()=>SearchSourceService,zmL:()=>L.z,UEL:()=>x,lug:()=>s.lug,tTJ:()=>s.tTJ,Nh9:()=>r.adaptToExpressionValueFilter,OBf:()=>s.OBf,hEG:()=>s.hEG,Efy:()=>s.Efy,lbX:()=>s.lbX,cUf:()=>s.cUf,v3f:()=>s.v3f,gdu:()=>s.gdu,Fb7:()=>s.Fb7,zAP:()=>s.zAP,e0w:()=>s.e0w,mZy:()=>s.mZy,rjA:()=>s.rjA,ZmW:()=>s.ZmW,OL7:()=>s.OL7,SsN:()=>s.SsN,PAj:()=>s.PAj,Ca8:()=>s.Ca8,vQh:()=>s.vQh,foF:()=>s.foF,C6H:()=>s.C6H,bgr:()=>s.bgr,i2N:()=>s.i2N,i5z:()=>s.i5z,TFY:()=>s.TFY,oXr:()=>s.oXr,tbp:()=>s.tbp,T1k:()=>s.T1k,om:()=>s.om,jfr:()=>s.jfr,ejh:()=>s.ejh,WVh:()=>s.WVh,dKG:()=>s.dKG,dHe:()=>s.dHe,W8J:()=>s.W8J,jsV:()=>s.jsV,qIu:()=>s.qIu,qew:()=>s.qew,Vjs:()=>s.Vjs,Du:()=>s.Du,CWM:()=>s.CWM,wB5:()=>s.wB5,Vzo:()=>s.Vzo,uC8:()=>s.uC8,jST:()=>s.jST,AJK:()=>s.AJK,rGL:()=>s.rGL,y3o:()=>s.y3o,ZO1:()=>s.ZO1,mgw:()=>s.mgw,VD$:()=>s.VD$,mXM:()=>s.mXM,Pp7:()=>s.Pp7,mU8:()=>s.mU8,tpD:()=>s.tpD,U6Y:()=>s.U6Y,jJm:()=>s.jJm,v0U:()=>s.v0U,qoF:()=>s.qoF,pMt:()=>s.pMt,ibD:()=>s.ibD,c9O:()=>s.c9O,xzq:()=>s.xzq,GFW:()=>s.GFW,tK_:()=>s.tK_,REs:()=>s.REs,si_:()=>s.si_,aw4:()=>s.aw4,HCP:()=>s.HCP,C98:()=>s.C98,nv7:()=>s.nv7,f90:()=>s.f90,AUv:()=>s.AUv,L69:()=>s.L69,mwK:()=>s.mwK,_Fq:()=>s._Fq,$Bi:()=>s.$Bi,FeO:()=>s.FeO,W3G:()=>s.W3G,Vog:()=>s.Vog,sAW:()=>s.sAW,UGU:()=>s.UGU,Rcq:()=>s.Rcq,_xq:()=>s._xq,FKr:()=>s.FKr,qZi:()=>s.qZi,NkJ:()=>s.NkJ,IQS:()=>s.IQS,zfq:()=>s.zfq,PSF:()=>r.aggregateQueryToAst,PX$:()=>s.PX$,B1X:()=>s.B1X,OI_:()=>s.OI_,u0$:()=>s.u0$,_er:()=>s._er,dtO:()=>r.cidrFunction,iJZ:()=>r.cidrToAst,N2Z:()=>s.N2Z,QyU:()=>s.QyU,kVi:()=>A,I1L:()=>s.I1L,Muh:()=>r.dateRangeFunction,lO1:()=>r.dateRangeToAst,iLg:()=>r.eqlRawResponse,uzQ:()=>r.esRawResponse,rk1:()=>r.existsFilterFunction,BUn:()=>r.extendedBoundsFunction,w1E:()=>r.extendedBoundsToAst,QDx:()=>E,rgn:()=>r.fieldFunction,tTg:()=>r.filtersToAst,Ucw:()=>P.Uc,i0A:()=>r.functionWrapper,TU9:()=>r.geoBoundingBoxFunction,y9c:()=>r.geoBoundingBoxToAst,aw$:()=>r.geoPointFunction,VNn:()=>r.geoPointToAst,F6S:()=>s.F6S,Obw:()=>s.Obw,LaZ:()=>s.LaZ,UeN:()=>s.UeN,ATn:()=>s.ATn,_h9:()=>s._h9,i23:()=>s.i23,HLz:()=>s.HLz,JKe:()=>s.JKe,Kd5:()=>s.Kd5,HAP:()=>s.HAP,YNN:()=>s.YNN,MUp:()=>s.MUp,H8h:()=>s.H8h,DqD:()=>s.DqD,qvY:()=>s.qvY,l5r:()=>r.getEqlFn,OD5:()=>v,KKF:()=>r.getEsaggsMeta,utN:()=>r.getEsdslFn,yhm:()=>r.getEsqlFn,mOK:()=>s.mOK,Bw4:()=>s.Bw4,Zy4:()=>s.Zy4,azA:()=>s.azA,nP5:()=>s.nP5,Bum:()=>s.Bum,IYs:()=>s.IYs,pSU:()=>s.pSU,aZK:()=>s.aZK,EzU:()=>s.EzU,oUU:()=>s.oUU,kY9:()=>s.kY9,Alz:()=>s.Alz,_Xw:()=>s._Xw,yyA:()=>s.yyA,aRc:()=>s.aRc,ZJo:()=>s.ZJo,XLV:()=>s.XLV,mvy:()=>s.mvy,EzV:()=>T,IH1:()=>s.IH1,c2H:()=>S,jb4:()=>s.jb4,nDt:()=>r.getSideEffectFunction,YHK:()=>s.YHK,czt:()=>s.czt,rFf:()=>s.rFf,vo0:()=>s.vo0,uSi:()=>s.uSi,JXX:()=>s.JXX,x0l:()=>s.x0l,OrF:()=>s.OrF,YhB:()=>s.YhB,cLp:()=>s.cLp,AmH:()=>U,fyU:()=>C.fy,c12:()=>s.c12,Q_w:()=>r.handleEsaggsRequest,s9S:()=>s.s9S,kiA:()=>I,WB4:()=>s.WB4,eYm:()=>r.ipPrefixFunction,dJ0:()=>r.ipPrefixToAst,rDs:()=>r.ipRangeFunction,IZ:()=>r.ipRangeToAst,E8Q:()=>C.E8,JNE:()=>s.JNE,za8:()=>s.za8,M3U:()=>s.M3U,itY:()=>s.itY,sy:()=>s.sy,HbO:()=>s.HbO,qSv:()=>s.qSv,vQj:()=>C.vQ,yPl:()=>N,Ehy:()=>s.Ehy,mgc:()=>s.mgc,Xjv:()=>s.Xjv,usJ:()=>s.usJ,Cec:()=>s.Cec,L1:()=>r.kibana,JjL:()=>r.kibanaFilterFunction,JW4:()=>r.kibanaTimerangeFunction,hnj:()=>r.kqlFunction,bOY:()=>r.luceneFunction,fYb:()=>s.fYb,wcW:()=>r.numericalRangeFunction,Lpc:()=>r.numericalRangeToAst,IJq:()=>s.IJq,$Ux:()=>s.$Ux,spt:()=>s.spt,njO:()=>s.njO,P15:()=>s.P15,zqr:()=>w,vC3:()=>s.vC3,SvO:()=>r.phraseFilterFunction,YV9:()=>B,EyB:()=>s.EyB,PFs:()=>r.queryFilterFunction,sjk:()=>r.queryFilterToAst,EW1:()=>r.queryToAst,ri9:()=>m,c$p:()=>r.rangeFilterFunction,EM$:()=>r.rangeFunction,LSk:()=>r.removeFilterFunction,EQP:()=>F,XIV:()=>r.selectFilterFunction,E1R:()=>G,gJ6:()=>s.gJ6,RRC:()=>s.RRC,drh:()=>s.drh,AXn:()=>P.AX,FUj:()=>P.FU,jZz:()=>P.jZ,zQf:()=>s.zQf,_Sh:()=>r.timerangeToAst,IIR:()=>s.IIR,pa7:()=>s.pa7});var s=a(2607),r=a(8686),i=a(7674),n=a(5964),l=a(770),o=a(8915);const g=__kbnSharedDeps__.SaferLodashSet;var u=a(190),d=a(1359),c=a(2374),h=a(7876);function p(e){if(["number"].includes(e))return"number";if(["string","boolean"].includes(e))return"string";throw new Error(`Unsupported script sort type: ${e}`)}async function m({dataView:e,sort:t,request:a}){let s=e.timeFieldName?[e.timeFieldName]:[];if(t){const e=Array.isArray(t)?t:[t];s.push(...e.flatMap((e=>Object.keys(e))))}for(const e of(null!==(r=a.query)&&void 0!==r?r:[]).filter(n.isOfQueryType)){var r;if(e.query&&"kuery"===e.language){const t=(0,n.fromKueryExpression)(e.query),a=(0,n.getKqlFieldNames)(t);s=s.concat(a)}}const{filters:i=[]}=a;for(const e of"function"==typeof i?i():i){var l;(0,n.isFilter)(e)&&null!=e&&null!==(l=e.meta)&&void 0!==l&&l.key&&!0!==e.meta.disabled&&s.push(e.meta.key)}const o=e.getSourceFiltering()&&e.getSourceFiltering().excludes.length?["*"]:s;return o.length?(await e.getFields({fieldName:o})).getFieldMapSorted():{}}var f=a(4177),y=a(3789);const b=`${Date.now()}`;function v(e,t=b){const a=e(y.j.COURIER_SET_REQUEST_PREFERENCE);if("sessionId"===a)return t;const s=e(y.j.COURIER_CUSTOM_REQUEST_PREFERENCE);return"custom"===a?s:void 0}function S(e,t){var a;const{getConfig:s}=t,r={preference:v(s)},{track_total_hits:i,...n}=e.body,l="string"!=typeof e.index?e.index:void 0;return{index:null!==(a=null==l?void 0:l.title)&&void 0!==a?a:`${e.index}`,body:n,track_total_hits:i,...(null==l?void 0:l.getAllowHidden())&&{expand_wildcards:"all"},...r}}class RequestFailure extends d.KbnError{constructor(e=null,t){super(`Request to Elasticsearch failed: ${JSON.stringify((null==t?void 0:t.rawResponse)||(null==e?void 0:e.message))}`),(0,o.default)(this,"resp",void 0),this.resp=t}}var _=a(5008);function T(e,t){var a;const s=(null==t?void 0:t.history)&&t.history[t.history.length-1],r={};if(e&&e.took&&(r.queryTime={label:_.i18n.translate("data.search.searchSource.queryTimeLabel",{defaultMessage:"Query time"}),value:_.i18n.translate("data.search.searchSource.queryTimeValue",{defaultMessage:"{queryTime}ms",values:{queryTime:e.took}}),description:_.i18n.translate("data.search.searchSource.queryTimeDescription",{defaultMessage:"The time it took to process the query. Does not include the time to send the request or parse it in the browser."})}),e&&void 0!==(null===(a=e.hits)||void 0===a?void 0:a.total)){let t;if("number"==typeof e.hits.total)t=`${e.hits.total}`;else{const a=e.hits.total;t="eq"===a.relation?`${a.value}`:`> ${a.value}`}r.hitsTotal={label:_.i18n.translate("data.search.searchSource.hitsTotalLabel",{defaultMessage:"Hits (total)"}),value:t,description:_.i18n.translate("data.search.searchSource.hitsTotalDescription",{defaultMessage:"The number of documents that match the query."})}}return e&&e.hits&&(r.hits={label:_.i18n.translate("data.search.searchSource.hitsLabel",{defaultMessage:"Hits"}),value:`${e.hits.hits.length}`,description:_.i18n.translate("data.search.searchSource.hitsDescription",{defaultMessage:"The number of documents returned by the query."})}),s&&(0===s.ms||s.ms)&&(r.requestTime={label:_.i18n.translate("data.search.searchSource.requestTimeLabel",{defaultMessage:"Request time"}),value:_.i18n.translate("data.search.searchSource.requestTimeValue",{defaultMessage:"{requestTime}ms",values:{requestTime:s.ms}}),description:_.i18n.translate("data.search.searchSource.requestTimeDescription",{defaultMessage:"The time of the request from the browser to Elasticsearch and back. Does not include the time the requested waited in the queue."})}),r}const E=e=>{let t={...e};const a=[];if(t.index)if("string"==typeof t.index){const e=t.index,s="kibanaSavedObjectMeta.searchSourceJSON.index";a.push({name:s,type:f.DATA_VIEW_SAVED_OBJECT_TYPE,id:e}),t={...t,indexRefName:s,index:void 0}}else{const{state:e,references:s}=i.DataViewPersistableStateService.extract(t.index);t.index=e,a.push(...s)}return t.filter&&(t={...t,filter:t.filter.map(((e,t)=>{if(!e.meta||!e.meta.index)return e;const s=`kibanaSavedObjectMeta.searchSourceJSON.filter[${t}].meta.index`;return a.push({name:s,type:f.DATA_VIEW_SAVED_OBJECT_TYPE,id:e.meta.index}),{...e,meta:{...e.meta,indexRefName:s,index:void 0}}}))}),[t,a]},F=["dateFormat:tz",f.UI_SETTINGS.COURIER_CUSTOM_REQUEST_PREFERENCE,f.UI_SETTINGS.COURIER_IGNORE_FILTER_IF_FIELD_NOT_IN_INDEX,f.UI_SETTINGS.COURIER_MAX_CONCURRENT_SHARD_REQUESTS,f.UI_SETTINGS.COURIER_SET_REQUEST_PREFERENCE,f.UI_SETTINGS.DOC_HIGHLIGHT,f.UI_SETTINGS.META_FIELDS,f.UI_SETTINGS.QUERY_ALLOW_LEADING_WILDCARDS,f.UI_SETTINGS.QUERY_STRING_OPTIONS,f.UI_SETTINGS.SEARCH_INCLUDE_FROZEN,f.UI_SETTINGS.SORT_OPTIONS],M=e=>(0,l.omitBy)(e,l.isNil);class SearchSource{constructor(e={},t){(0,o.default)(this,"id",(0,l.uniqueId)("data_source")),(0,o.default)(this,"shouldOverwriteDataViewType",!1),(0,o.default)(this,"overwriteDataViewType",void 0),(0,o.default)(this,"parent",void 0),(0,o.default)(this,"requestStartHandlers",[]),(0,o.default)(this,"inheritOptions",{}),(0,o.default)(this,"history",[]),(0,o.default)(this,"fields",void 0),(0,o.default)(this,"dependencies",void 0),(0,o.default)(this,"getFieldName",(e=>"string"==typeof e?e:null==e?void 0:e.field));const{parent:a,...s}=e;this.fields=s,this.dependencies=t,a&&this.setParent(new SearchSource(a,t))}setOverwriteDataViewType(e){!1===e?(this.shouldOverwriteDataViewType=!1,this.overwriteDataViewType=void 0):(this.shouldOverwriteDataViewType=!0,this.overwriteDataViewType=e)}setField(e,t){return null==t?this.removeField(e):(this.fields[e]=t,this)}removeField(e){return delete this.fields[e],this}setFields(e){return this.fields=e,this}getId(){return this.id}getFields(){return{...this.fields}}getField(e,t=!0){if(!t||void 0!==this.fields[e])return this.fields[e];const a=this.getParent();return a&&a.getField(e)}getActiveIndexFilter(){var e,t;const{filter:a,query:s}=this.getFields();let r=[];a&&(r=this.getFilters(a));const i=Array.isArray(s)?s.map((e=>e.query)):(0,n.isOfQueryType)(s)?null==s?void 0:s.query:void 0,o="string"==typeof i?this.parseActiveIndexPatternFromQueryString(i):null!==(e=null==i?void 0:i.reduce(((e,t)=>e.concat(this.parseActiveIndexPatternFromQueryString(t))),[]))&&void 0!==e?e:[],g=null===(t=r)||void 0===t?void 0:t.reduce(((e,t)=>{var a;const s=(0,n.isPhraseFilter)(t),r=(0,n.isPhrasesFilter)(t),i=s?null===(a=t.meta.params)||void 0===a?void 0:a.query:t.meta.params,o=Array.isArray(i)?i:[i];return(s||r)&&"_index"===t.meta.key&&!1===t.meta.disabled?!1===t.meta.negate?(0,l.concat)(e,o):(0,l.difference)(e,o):e}),o);return[...new Set([...g])]}getOwnField(e){return this.getField(e,!1)}create(){return new SearchSource({},this.dependencies)}createCopy(){const e=new SearchSource({},this.dependencies);return e.setFields({...this.fields}),e.setField("index",this.getField("index")),e.setParent(this.getParent()),e}createChild(e={}){const t=new SearchSource({},this.dependencies);return t.setParent(this,e),t}setParent(e,t={}){return this.parent=e,this.inheritOptions=t,this}getParent(){return this.parent}fetch$(e={}){const t=(0,u.defer)((()=>this.requestIsStarting(e))).pipe((0,u.switchMap)((()=>{const t=this.flatten();return this.history=[t],t.index&&(e.indexPattern=t.index),this.fetchSearch$(t,e)})),(0,u.tap)((e=>{if(!e||e.error)throw new RequestFailure(null,e)})),(0,u.shareReplay)());return this.inspectSearch(t,e)}async fetch(e={}){return(await(0,u.lastValueFrom)(this.fetch$(e))).rawResponse}onRequestStart(e){this.requestStartHandlers.push(e)}getSearchRequestBody(){return this.flatten().body}destroy(){this.requestStartHandlers.length=0}inspectSearch(e,t){const{id:a,title:s,description:r,adapter:i}=t.inspector||{title:""},n=null==i?void 0:i.start(s,{id:a,description:r,searchSessionId:t.sessionId}),l=()=>{try{null==n||n.json(this.getSearchRequestBody())}catch(e){}},o=e.pipe((0,u.first)(void 0,null),(0,u.tap)((()=>{null==n||n.stats(function(e){const t={},a=e.getField("index"),s=e.getActiveIndexFilter();return a&&(s.length>0&&(t.indexFilter={label:_.i18n.translate("data.search.searchSource.indexFilterLabel",{defaultMessage:"Index Pattern"}),value:s.join(", "),description:_.i18n.translate("data.search.searchSource.indexFilterDescription",{defaultMessage:"The active index pattern."})}),t.indexPattern={label:_.i18n.translate("data.search.searchSource.dataViewLabel",{defaultMessage:"Data view"}),value:a.title,description:_.i18n.translate("data.search.searchSource.dataViewDescription",{defaultMessage:"The data view that was queried."})},t.indexPatternId={label:_.i18n.translate("data.search.searchSource.dataViewIdLabel",{defaultMessage:"Data view ID"}),value:a.id,description:_.i18n.translate("data.search.searchSource.indexPatternIdDescription",{defaultMessage:"The ID in the {kibanaIndexPattern} index.",values:{kibanaIndexPattern:".kibana"}})}),t}(this)),l()})),(0,u.catchError)((()=>(l(),u.EMPTY))),(0,u.finalize)((()=>{o.unsubscribe()}))).subscribe(),g=e.pipe((0,u.catchError)((e=>(null==n||n.error({json:"attributes"in e?e.attributes:{message:e.message}}),u.EMPTY))),(0,u.last)(void 0,null),(0,u.tap)((e=>{if(e){const t=e.rawResponse;null==n||n.stats(T(t,this)),null==n||n.ok({json:e})}})),(0,u.finalize)((()=>{g.unsubscribe()}))).subscribe();return e}hasPostFlightRequests(){const e=this.getField("aggs");return e instanceof f.AggConfigs&&e.aggs.some((e=>e.enabled&&"function"==typeof e.type.postFlightRequest&&(e.params.otherBucket||e.params.missingBucket)))}postFlightTransform(e){const t=this.getField("aggs");return t instanceof f.AggConfigs?t.postFlightTransform(e):e}async fetchOthers(e,t){const a=this.getField("aggs");if(a instanceof f.AggConfigs)for(const r of a.aggs){var s;r.enabled&&"function"==typeof r.type.postFlightRequest&&(e=await r.type.postFlightRequest(e,a,r,this,null===(s=t.inspector)||void 0===s?void 0:s.adapter,t.abortSignal,t.sessionId,t.disableWarningToasts))}return e}fetchSearch$(e,t){const{search:a,getConfig:s,onResponse:r}=this.dependencies;return a({params:S(e,{getConfig:s}),indexType:e.indexType},t).pipe((0,u.switchMap)((e=>new u.Observable((a=>{if((0,f.isRunningResponse)(e))a.next(this.postFlightTransform(e));else if(this.hasPostFlightRequests()){a.next({...this.postFlightTransform(e),isPartial:!0,isRunning:!0});const s=(0,u.from)(this.fetchOthers(e.rawResponse,t)).subscribe({next:t=>{a.next(this.postFlightTransform({...e,rawResponse:t}))},error:e=>{a.error(e),s.unsubscribe()},complete:()=>{a.complete(),s.unsubscribe()}})}else a.next(this.postFlightTransform(e)),a.complete()})))),(0,u.map)((a=>(0,f.isRunningResponse)(a)?a:r(e,a,t))))}requestIsStarting(e={}){const t=[...this.requestStartHandlers];if(this.inheritOptions.callParentStartHandlers){let e=this.getParent();for(;e;)t.push(...e.requestStartHandlers),e=e.getParent()}return Promise.all(t.map((t=>t(this,e))))}mergeProp(e,t,a){if(null==(t="function"==typeof t?t(this):t)||!a)return;const s=(t,a)=>{e[t]=a},r=(t,a)=>{null==e.body[t]&&(e.body[t]=a)},{getConfig:i}=this.dependencies;switch(a){case"filter":return s("filters",("function"==typeof e.filters?e.filters():e.filters||[]).concat(t));case"query":return s(a,(e.query||[]).concat(t));case"fields":return r("fields",t);case"fieldsFromSource":return s(a,[...new Set((e.fieldsFromSource||[]).concat(t))]);case"index":case"type":case"highlightAll":return a&&null==e[a]&&s(a,t);case"searchAfter":return r("search_after",t);case"trackTotalHits":return r("track_total_hits",t);case"source":return r("_source",t);case"sort":return r(a,function(e,t,a={}){return(Array.isArray(e)?e:[e]).map((function(e){return function(e,t,a){const[[s,r]]=Object.entries(e),i="object"==typeof r?r:{order:r};if(t&&"string"!=typeof t&&!t.getRuntimeField(s)){const e=t.getScriptedField(s);if(e&&e.scripted&&"date"!==e.type)return{_script:{script:{source:e.script,lang:e.lang},type:p(e.type),...i}}}"string"==typeof a&&(a=JSON.parse(a));const{unmapped_type:n,...l}=a;return{[s]:{...i,..."_score"===s?l:a}}}(e,t,a)}))}(t,this.getField("index"),i(f.UI_SETTINGS.SORT_OPTIONS)));case"pit":return s(a,t);case"aggs":return t instanceof f.AggConfigs?r("aggs",t.toDsl()):r("aggs",t);default:return r(a,t)}}mergeProps(e=this,t={body:{}}){return Object.entries(this.fields).forEach((([e,a])=>{this.mergeProp(t,a,e)})),this.parent&&this.parent.mergeProps(e,t),t}getIndexType(e){var t;return this.shouldOverwriteDataViewType?this.overwriteDataViewType:null===(t=this.getDataView(e))||void 0===t?void 0:t.type}getDataView(e){return"string"!=typeof e?e:void 0}getFieldsWithoutSourceFilters(e,t){var a;if(!e)return t;const{fields:s}=e,r=e.getSourceFiltering();if(!r||0===(null===(a=r.excludes)||void 0===a?void 0:a.length)||0===t.length)return t;const i=r.excludes,n=t.find((e=>"*"===this.getFieldName(e))),l=(0,d.fieldWildcardFilter)(i,this.dependencies.getConfig(f.UI_SETTINGS.META_FIELDS)),o=e=>e&&l(e);return n?s.filter((e=>o(e.name))).map((e=>({field:e.name}))):t.filter((e=>o(this.getFieldName(e))))}getFieldFromDocValueFieldsOrIndexPattern(e,t,a){if("string"==typeof t)return t;const s=this.getFieldName(t),r=Object.assign({},e[s],t);if(!a)return r;const{fields:i}=a,n=i.getByType("date").find((e=>e.name===s));if(!n)return r;const{esTypes:l}=n;return null!=l&&l.includes("date_nanos")?r.format="strict_date_optional_time_nanos":null!=l&&l.includes("date")&&(r.format="strict_date_optional_time"),r}async loadDataViewFields(e){const t=this.mergeProps(this,{body:{}});return await m({dataView:e,request:t})}flatten(){var e,t;const{getConfig:a}=this.dependencies,s=null!==(e=a(f.UI_SETTINGS.META_FIELDS))&&void 0!==e?e:[],r=this.mergeProps();r.body=r.body||{};const{body:i,index:n}=r,o=this.getDataView(n),{docvalueFields:u,scriptFields:d,runtimeFields:h}=null!==(t=null==o?void 0:o.getComputedFields())&&void 0!==t?t:{docvalueFields:[],scriptFields:{},runtimeFields:{}},p=!!i.fields,m=n&&!Object.hasOwn(i,"_source")?null==o?void 0:o.getSourceFiltering():i._source,y=this.getFieldFilter({bodySourceExcludes:null==m?void 0:m.excludes,metaFields:s}),b=y(r.fieldsFromSource||[]),v=y(u),S=!!b.length,_=p||S?y(i.fields||[]):v,T=this.getUniqueFieldNames({fields:_,fieldsFromSource:b}),E=(()=>{const e=this.dependencies.scriptedFieldsEnabled?{...i.script_fields,...d}:{};return p||S?this.filterScriptFields({uniqFieldNames:T,scriptFields:e}):e})(),F=this.getRemainingFields({uniqFieldNames:T,scriptFields:E,runtimeFields:h,_source:m});i._source=m,S&&!(0,l.isEqual)(F,b)&&(0,g.setWith)(i,"_source.includes",F,(e=>(0,l.isObject)(e)?{}:e));const A=this.getBuiltEsQuery({index:n,query:r.query,filters:r.filters,getConfig:a,sort:i.sort}),I={...r.body,pit:r.pit,query:A,highlight:r.highlightAll&&A?(0,c.getHighlightRequest)(a(f.UI_SETTINGS.DOC_HIGHLIGHT)):void 0,_source:!(p&&!S)&&i._source,stored_fields:p||S?[...new Set(F)]:["*"],runtime_mappings:h,script_fields:E,fields:this.getFieldsList({index:o,fields:_,docvalueFields:i.docvalue_fields,fieldsFromSource:b,filteredDocvalueFields:v,metaFields:s,fieldListProvided:p,sourceFieldsProvided:S})};return M({...r,body:M(I),indexType:this.getIndexType(n),highlightAll:r.highlightAll&&A?void 0:r.highlightAll})}getFieldFilter({bodySourceExcludes:e,metaFields:t}){const a=(0,d.fieldWildcardFilter)(e,t);return e=>e.filter((e=>a(this.getFieldName(e))))}getUniqueFieldNames({fields:e,fieldsFromSource:t}){const a=e.map((e=>this.getFieldName(e)));return[...new Set([...a,...t])]}filterScriptFields({uniqFieldNames:e,scriptFields:t}){return e.includes("*")?t:(0,l.pick)(t,Object.keys(t).filter((t=>e.includes(t))))}getBuiltEsQuery({index:e,query:t=[],filters:a=[],getConfig:s,sort:r}){const i=(null!=r?r:[]).some((e=>Object.hasOwn(e,"_score"))),l={...(0,f.getEsQueryConfig)({get:s}),filtersInMustClause:i};return(0,n.buildEsQuery)(this.getDataView(e),t,"function"==typeof a?a():a,l)}getRemainingFields({uniqFieldNames:e,scriptFields:t,runtimeFields:a,_source:s}){return(0,l.difference)(e,[...Object.keys(t),...Object.keys(a)]).filter((e=>!(!e||s&&s.excludes&&s.excludes.includes(e))))}getFieldsList({index:e,fields:t,docvalueFields:a,fieldsFromSource:s,filteredDocvalueFields:r,metaFields:i,fieldListProvided:n,sourceFieldsProvided:l}){return n||l?l?[...t,...r.filter((e=>{const t=this.getFieldName(e);return s.includes(t)&&!(a||[]).map((e=>this.getFieldName(e))).includes(t)}))]:this.getUniqueFields({index:e,fields:t,metaFields:i,filteredDocvalueFields:r}):t}getUniqueFields({index:e,fields:t,metaFields:a,filteredDocvalueFields:s}){const r=this.getFieldsWithoutSourceFilters(e,t),i=(0,l.keyBy)(s,"field"),n=new Set(Object.keys(i)),o=new Set,g=[];for(const t of r.concat(s)){const s=this.getFieldName(t);a.includes(s)||o.has(s)||(o.add(s),n.has(s)?g.push("string"==typeof t?i[t]:this.getFieldFromDocValueFieldsOrIndexPattern(i,t,e)):g.push(t))}return g}getSerializedFields(e=!1){const{filter:t,aggs:a,parent:s,size:r,sort:i,index:n,...l}=this.getFields();let o={...l};if(n&&(o.index=n.isPersisted()?n.id:n.toMinimalSpec()),i&&(o.sort=Array.isArray(i)?i:[i]),t){const e=this.getFilters(t);o={...o,filter:e}}if(a){let e=a;"function"==typeof e&&(e=a()),e instanceof f.AggConfigs?o.aggs=e.getAll().map((e=>e.serialize())):o.aggs=e}return e&&this.getParent()&&(o.parent=this.getParent().getSerializedFields(e)),o}serialize(){const[e,t]=E(this.getSerializedFields());return{searchSourceJSON:JSON.stringify(e),references:t}}getFilters(e){return e?Array.isArray(e)?e:(0,l.isFunction)(e)?this.getFilters(e()):[e]:[]}toExpressionAst({asDatatable:e=!0}={}){const t=this.mergeProps(),{body:a,index:s,query:i}=t,l=this.getDataView(s),o="function"==typeof t.filters?t.filters():t.filters,g=(0,h.buildExpression)([(0,h.buildExpressionFunction)("kibana_context",{q:null==i?void 0:i.filter(n.isOfQueryType).map(r.queryToAst),filters:o&&(0,r.filtersToAst)(o)})]).toAst();if(!e)return g;const u=this.getField("aggs"),d="function"==typeof u?u():u,c=d instanceof f.AggConfigs?d:l&&d&&this.dependencies.aggs.createAggConfigs(l,d);return c?g.chain.push(...c.toExpressionAst().chain):g.chain.push((0,h.buildExpressionFunction)("esdsl",{size:null==a?void 0:a.size,dsl:JSON.stringify({}),index:"string"==typeof s?s:`${null==l?void 0:l.id}`}).toAst()),g}parseActiveIndexPatternFromQueryString(e){let t;const a=new Set,s=/\s?(_index)\s?:\s?[\'\"]?(\w+\-?\*?)[\'\"]?\s?(\w+)?/g;for(;null!==(t=s.exec(e));)t.index===s.lastIndex&&s.lastIndex++,t.forEach(((e,t)=>{2===t&&a.add(e)}));return[...a]}}const A=(e,t)=>{let a;const s=async(r={},n=!1)=>{const{index:l,parent:o,...g}=r,u={...g};if(r.index)if(n){a="string"==typeof r.index?await e.getDataViewLazy(r.index):await e.createDataViewLazy(r.index);const[s,n,l]=await Promise.all([a.toSpec(),t.dataViews.getShortDotsEnable(),t.dataViews.getMetaFields()]),o=new i.DataView({spec:s,fieldFormats:{},shortDotsEnable:n,metaFields:l});u.index=o}else u.index="string"==typeof r.index?await e.get(r.index):await e.create(r.index);return r.parent&&(u.parent=await s(r.parent)),u};return async(e={},r)=>{const i=await s(e,!!r),o=new SearchSource(i,t),g=o.getOwnField("query");if(void 0!==g&&o.setField("query",function(e){return(0,l.has)(e,"language")||"object"==typeof e&&(0,n.isOfAggregateQueryType)(e)?e:{query:e,language:"lucene"}}(g)),r&&a){var u;const e=await o.loadDataViewFields(a);null===(u=i.index)||void 0===u||u.fields.replaceAll(Object.values(e).map((e=>e.toSpec())))}return o}},I=(e,t)=>{const a={...e};if(e.indexRefName){const s=t.find((t=>t.name===e.indexRefName));if(!s)throw new Error(`Could not find reference for ${e.indexRefName}`);a.index=s.id,delete a.indexRefName}return e.index&&"string"!=typeof e.index&&(e.index=i.DataViewPersistableStateService.inject(e.index,t)),a.filter&&Array.isArray(a.filter)&&a.filter.forEach((e=>{if(!e.meta||!e.meta.indexRefName)return;const a=t.find((t=>t.name===e.meta.indexRefName));if(!a)throw new Error(`Could not find reference for ${e.meta.indexRefName}`);e.meta.index=a.id,delete e.meta.indexRefName})),a},w=e=>{let t;try{t=JSON.parse(e)}catch(t){throw new d.InvalidJSONProperty(`Invalid JSON in search source. ${t.message} JSON: ${e}`)}if(!t||"object"!=typeof t)throw new d.InvalidJSONProperty("Invalid JSON in search source.");return t};var R=a(71);const k=()=>{const e=(0,l.mapValues)((0,R.R9)(),(e=>t=>({...t,filter:e(t.filter)}))),t=(0,l.mapValues)(i.DataViewPersistableStateService.getAllMigrations(),(e=>t=>({...t,index:e(t.index)})));return(0,d.mergeMigrationFunctionMaps)((0,d.mergeMigrationFunctionMaps)({},e),t)};class SearchSourceService{setup(){return{getAllMigrations:k}}start(e,t){return{create:A(e,t),createLazy:(a={})=>A(e,t)(a,!0),createEmpty:()=>new SearchSource({},t),extract:e=>{const[t,a]=E(e);return{state:t,references:a}},inject:I,getAllMigrations:k,telemetry:()=>({})}}stop(){}}let x=function(e){return e.asc="asc",e.desc="desc",e}({});function N(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}var P=a(9235),C=a(7278),L=a(1036);const D="search-session",O="searchSessionsMgmtUiTable";var q=a(3721);const B=(e,t,{pollInterval:a,abortSignal:s}={})=>(0,u.defer)((()=>{const r=Date.now();if(null!=s&&s.aborted)throw new d.AbortError;t&&(null==s||s.addEventListener("abort",(()=>null==t?void 0:t().catch((e=>{q.error(e)}))),{once:!0}));const i=(s?(0,u.fromEvent)(s,"abort"):u.EMPTY).pipe((0,u.map)((()=>{throw new d.AbortError})));return(0,u.from)(e()).pipe((0,u.expand)((()=>{const t=Date.now()-r;return(0,u.timer)((e=>{if("number"==typeof a)return a;switch(!0){case e<1500:return 300;case e<5e3:return 1e3;case e<2e4:return 2500;default:return 5e3}})(t)).pipe((0,u.switchMap)(e))})),(0,u.tap)((e=>{if((0,f.isAbortResponse)(e))throw new d.AbortError})),(0,u.takeWhile)(f.isRunningResponse,!0),(0,u.takeUntil)(i))})),j="es";function U(e){const{total:t,failed:a,successful:s}=e._shards;return{total:t,loaded:a+s}}function G(e,{legacyHitsTotal:t=!0}={}){var a,s,r,i;if(!t)return e;const n=null!==(a=null===(s=e.hits)||void 0===s||null===(r=s.total)||void 0===r?void 0:r.value)&&void 0!==a?a:null===(i=e.hits)||void 0===i?void 0:i.total,l={...e.hits,total:n};return{...e,hits:l}}const z="eql",$="ese",V="sql",K="esql",H="esql_async",Y="es_ql"},1036:(e,t,a)=>{"use strict";a.d(t,{v:()=>s,z:()=>r});let s=function(e){return e.IN_PROGRESS="in_progress",e.ERROR="error",e.COMPLETE="complete",e.CANCELLED="cancelled",e.EXPIRED="expired",e}({}),r=function(e){return e.IN_PROGRESS="in_progress",e.ERROR="error",e.COMPLETE="complete",e}({})},9235:(e,t,a)=>{"use strict";a.d(t,{Uc:()=>n,AX:()=>v,FU:()=>o,jZ:()=>d});var s=a(770);const r=["_type","_source"];function i(e,t,a,r,n){for(const l in t){if(!Object.hasOwn(t,l))continue;const o=t[l],g=a+l,u=null==r?void 0:r.fields.getByName(g);if(!1===(null==n?void 0:n.shallow)){const t="nested"===(null==u?void 0:u.type);if(Array.isArray(o)&&!t){for(let t=0;t<o.length;t++){const a=o[t];(0,s.isPlainObject)(a)&&i(e,a,g+".",r,n)}continue}}else if(void 0!==e[g])continue;const d=u&&"conflict"!==u.type,c=!(0,s.isPlainObject)(o);d||c?e[g]?Array.isArray(e[g])?e[g].push(o):e[g]=[e[g],o]:e[g]=o:i(e,o,g+".",r,n)}}function n(e,t,a){const s={};if(i(s,e.fields||{},"",t,a),!1!==(null==a?void 0:a.source)&&e._source)i(s,e._source,"",t,a);else if(null!=a&&a.includeIgnoredValues&&e.ignored_field_values)for(const t in e.ignored_field_values){if(!Object.hasOwn(e.ignored_field_values,t))continue;const a=e.ignored_field_values[t];s[t]?Array.isArray(s[t])?s[t]=[...s[t],...a]:s[t]=[s[t],...a]:s[t]=a}if(null!=t&&t.metaFields)for(let a=0;a<(null==t?void 0:t.metaFields.length);a++){const i=null==t?void 0:t.metaFields[a];r.includes(i)||"_"!==i.charAt(0)||(s[i]=e[i])}return function(e,t,a){let s;return new Proxy(e,{defineProperty:(...e)=>(s=void 0,Reflect.defineProperty(...e)),deleteProperty:(...e)=>(s=void 0,Reflect.deleteProperty(...e)),ownKeys:e=>(s||(s=Reflect.ownKeys(e).sort(null!=a?a:l(t))),s)})}(s,t,null==a?void 0:a.flattenedFieldsComparator)}const l=e=>{const t=new Set(null==e?void 0:e.metaFields),a=new Map;let s,r;const i=(e,t)=>(s=a.get(e),void 0===s&&(s=e.toLowerCase(),a.set(e,s)),r=a.get(t),void 0===r&&(r=t.toLowerCase(),a.set(t,r)),s<r?-1:s>r?1:0);return(e,a)=>{if("symbol"==typeof e||"symbol"==typeof a)return 0;const s=t.has(e),r=t.has(a);return s&&r?i(e,a):s?1:r?-1:i(e,a)}},o=(e,t,a={})=>{const s=[],r=e.hits.hits.map((e=>{const r=n(e,t,a);if(r){for(const[e,a]of Object.entries(r)){const r=null==t?void 0:t.fields.getByName(e),i=(null==r?void 0:r.name)||e;if(!s.find((e=>e.id===i))){const e=(null==r?void 0:r.type)||typeof a,n=r&&(null==t?void 0:t.getFormatterForField(r));s.push({id:i,name:i,meta:{type:e,field:i,index:null==t?void 0:t.id,params:n?n.toJSON():void 0}})}}return r}})).filter((e=>e));return{type:"datatable",columns:s,rows:r}};var g=a(8915);const u=(e,t)=>{let a="";try{a=e.makeLabel()}catch(e){}return{aggConfig:e,id:`col-${t}-${e.id}`,name:a}};function d(e,t){if(t)return e.map(((e,t)=>u(e,t)));const a=[],r=(0,s.groupBy)(e,(e=>e.type.type));if(!r.buckets)return r.metrics.map(((e,t)=>u(e,t)));let i=0;return r.buckets.forEach((e=>{a.push(u(e,i++)),r.metrics.forEach((e=>{a.push(u(e,i++))}))})),a}class TabbedAggResponseWriter{constructor(e,t){(0,g.default)(this,"columns",void 0),(0,g.default)(this,"rows",[]),(0,g.default)(this,"bucketBuffer",[]),(0,g.default)(this,"metricBuffer",[]),(0,g.default)(this,"partialRows",void 0),(0,g.default)(this,"params",void 0),this.partialRows=t.partialRows||!1,this.params=t,this.columns=d(e.getResponseAggs(),!t.metricsAtAllLevels),this.rows=[]}row(){const e={};for(let t=0;t<this.bucketBuffer.length;t++){const a=this.bucketBuffer[t];e[a.id]=a.value}for(let t=0;t<this.metricBuffer.length;t++){const a=this.metricBuffer[t];e[a.id]=a.value}let t=!1;for(let a=0;a<this.columns.length;a++){const s=this.columns[a];if(!Object.hasOwn(e,s.id)){t=!0;break}}const a=t&&!this.partialRows;(0,s.isEmpty)(e)||a||this.rows.push(e)}response(){return{type:"datatable",columns:this.columns.map((e=>{var t,a,s,r,i,n,l,o,g,u,d,c;return{id:e.id,name:e.name,meta:{type:(null===(t=(a=e.aggConfig.type).getValueType)||void 0===t?void 0:t.call(a,e.aggConfig))||(null===(s=e.aggConfig.params.field)||void 0===s?void 0:s.type)||"number",field:null===(r=e.aggConfig.params.field)||void 0===r?void 0:r.name,index:null===(i=e.aggConfig.getIndexPattern())||void 0===i?void 0:i.title,params:e.aggConfig.toSerializedFieldFormat(),source:"esaggs",sourceParams:{hasPrecisionError:Boolean(e.hasPrecisionError),indexPatternId:null===(n=e.aggConfig.getIndexPattern())||void 0===n?void 0:n.id,appliedTimeRange:null!==(l=e.aggConfig.params.field)&&void 0!==l&&l.name&&this.params.timeRange&&this.params.timeRange.timeFields&&this.params.timeRange.timeFields.includes(null===(o=e.aggConfig.params.field)||void 0===o?void 0:o.name)?{from:null===(g=this.params.timeRange)||void 0===g||null===(u=g.from)||void 0===u?void 0:u.toISOString(),to:null===(d=this.params.timeRange)||void 0===d||null===(c=d.to)||void 0===c?void 0:c.toISOString()}:void 0,...e.aggConfig.serialize()}}}})),rows:this.rows}}}var c=a(2488),h=a.n(c),p=a(2607);const m=(e,t)=>(null==e?void 0:e.from)===(null==t?void 0:t.from)&&(null==e?void 0:e.to)===(null==t?void 0:t.to);class TabifyBuckets{constructor(e,t,a){(0,g.default)(this,"length",void 0),(0,g.default)(this,"objectMode",void 0),(0,g.default)(this,"buckets",void 0),(0,g.default)(this,"_keys",[]),e&&e.buckets?this.buckets=e.buckets:this.buckets=e?[e]:[],this.objectMode=(0,s.isPlainObject)(this.buckets),this.objectMode?(this._keys=(0,s.keys)(this.buckets),this.length=this._keys.length):this.length=this.buckets.length,this.length&&t&&(this.orderBucketsAccordingToParams(t.params),t.params.drop_partials&&this.dropPartials(t,a))}forEach(e){const t=this.buckets;if(this.objectMode)for(let a=0;a<this._keys.length;a++){const s=this._keys[a];e(t[s],s)}else for(let a=0;a<t.length;a++){const s=t[a];e(s,s.key)}}orderBucketsAccordingToParams(e){if(e.filters&&this.objectMode)this._keys=e.filters.map((e=>{const t=(0,s.get)(e,"input.query.query_string.query",e.input.query),a="string"==typeof t?t:JSON.stringify(t);return e.label||a||"*"}));else if(e.ranges&&this.objectMode)this._keys=e.ranges.map((e=>(0,s.findKey)(this.buckets,(t=>m(t,e)))));else if(e.ranges&&"date"!==e.field.type){let t=e.ranges;e.ipRangeType&&(t="mask"===e.ipRangeType?t.mask:t.fromTo),this.buckets=t.map((e=>e.mask?this.buckets.find((t=>t.key===e.mask)):this.buckets.find((t=>m(t,e)))))}}dropPartials(e,t){if(!t||this.buckets.length<=1||this.objectMode||!t.timeFields.includes(e.params.field.name))return;const a=e.params.used_interval?(0,p.P15)(e.serialize().params.used_interval):h().duration(this.buckets[1].key-this.buckets[0].key);this.buckets=this.buckets.filter((s=>!h().tz(s.key,e.aggConfigs.timeZone).isBefore(t.from)&&!h().tz(s.key,e.aggConfigs.timeZone).add(a).isAfter(t.to))),this.length=this.buckets.length}}function f(e,t,a,r,i,n){var l,o;const g=t.columns.shift();if(g){const u=g.aggConfig;if(u.getParam("scaleMetricValues")){const t=u.write(e);i*=t.metricScale||1}switch(u.type.type){case p.TO1.Buckets:const d=(0,s.get)(a,u.id),c=new TabifyBuckets(d,u,null==n?void 0:n.timeRange);(null===(l=(o=u.type).hasPrecisionError)||void 0===l?void 0:l.call(o,d))&&(g.hasPrecisionError=!0),c.length?c.forEach(((a,s)=>{const r=u.getKey(a,s),l=void 0!==r;l&&t.bucketBuffer.push({id:g.id,value:r}),f(e,t,a,u.getKey(a,s),i,n),l&&t.bucketBuffer.pop()})):null!=n&&n.partialRows?(t.columns.unshift(g),y(e,t,a,r,i),t.columns.shift()):t.row();break;case p.TO1.Metrics:let h=u.getValue(a);1!==i&&(h*=i),t.metricBuffer.push({id:g.id,value:h}),t.columns.length?f(e,t,a,r,i,n):t.row(),t.metricBuffer.pop()}t.columns.unshift(g)}}function y(e,t,a,s,r){const i=t.columns.shift();if(i){switch(i.aggConfig.type.type){case p.TO1.Metrics:return t.columns.unshift(i),void f(e,t,a,s,r);case p.TO1.Buckets:y(e,t,a,s,r)}t.columns.unshift(i)}}function b(e){return/doc_count_/.test(e)}function v(e,t,a){var s,r,i;const n=new TabbedAggResponseWriter(e,a||{});let l=!1;if(t.aggregations)for(const e in t.aggregations)if(b(e)){l=!0;break}const o={...e.isSamplingEnabled()?null===(s=t.aggregations)||void 0===s?void 0:s.sampling:t.aggregations,doc_count:null===(r=t.aggregations)||void 0===r?void 0:r.doc_count};var g;return o.doc_count||l||(o.doc_count=null===(g=t.hits)||void 0===g?void 0:g.total),f(e,n,o,"",1,a),{...n.response(),meta:{type:"esaggs",source:e.indexPattern.id,statistics:{totalCount:null===(i=t.hits)||void 0===i?void 0:i.total}}}}},7278:(e,t,a)=>{"use strict";a.d(t,{E8:()=>i,fy:()=>l,vQ:()=>n});var s=a(2488),r=a.n(s);const i=e=>!e||!("rawResponse"in e||"response"in e),n=e=>{var t;return null!==(t=null==e?void 0:e.isRunning)&&void 0!==t&&t},l=(e,t=!0)=>{const a=e("dateFormat:tz");if("Browser"===a){if(!t)return"UTC";const e=r().tz.guess(),a=r()().format("Z");return e||a}return null!=a?a:"UTC"}},7371:(e,t,a)=>{"use strict";a.d(t,{_:()=>s._,f:()=>s.f});var s=a(2956)},7243:(e,t,a)=>{"use strict";a.r(t),a.d(t,{APPLY_FILTER_TRIGGER:()=>yt,AggGroupLabels:()=>s.AggGroupLabels,AggGroupNames:()=>s.AggGroupNames,BUCKET_TYPES:()=>s.BUCKET_TYPES,DuplicateDataViewError:()=>s.DuplicateDataViewError,ES_FIELD_TYPES:()=>s.ES_FIELD_TYPES,FilterManager:()=>FilterManager,KBN_FIELD_TYPES:()=>s.KBN_FIELD_TYPES,METRIC_TYPES:()=>s.METRIC_TYPES,NowProvider:()=>NowProvider,QueryService:()=>QueryService,SEARCH_SESSIONS_MANAGEMENT_ID:()=>Te.j,SearchSessionState:()=>_e.Mv,SearchSource:()=>ye.Cyp,SortDirection:()=>ye.UEL,TimeHistory:()=>TimeHistory,UI_SETTINGS:()=>s.UI_SETTINGS,calculateBounds:()=>s.calculateBounds,connectToQueryState:()=>ne,createSavedQueryService:()=>G,exporters:()=>Ct,extractSearchSourceReferences:()=>ye.QDx,fieldList:()=>s.fieldList,flattenHit:()=>s.flattenHit,generateFilters:()=>R,getDefaultQuery:()=>d,getDisplayValueFromFilter:()=>P,getEsQueryConfig:()=>s.getEsQueryConfig,getFieldDisplayValueFromFilter:()=>N,getIndexPatternFromFilter:()=>x,getQueryLog:()=>g,getSearchParamsFromRequest:()=>ye.c2H,getTime:()=>s.getTime,indexPatterns:()=>Lt,injectSearchSourceReferences:()=>ye.kiA,isQuery:()=>s.isQuery,isRunningResponse:()=>s.isRunningResponse,isTimeRange:()=>s.isTimeRange,mapAndFlattenFilters:()=>A,noSearchSessionStorageCapabilityMessage:()=>Ae,parseSearchSourceJSON:()=>ye.zqr,plugin:()=>Ot,search:()=>Dt,syncGlobalQueryStateWithUrl:()=>oe,syncQueryStateWithUrl:()=>ge,tabifyAggResponse:()=>s.tabifyAggResponse,waitUntilNextSessionCompletes$:()=>Ie});var s=a(4177),r=a(8915),i=a(770),n=a.n(i),l=a(190);const o=(e,t)=>n().isEqual(e,t);class PersistedLog{constructor(e,t={},a){(0,r.default)(this,"name",void 0),(0,r.default)(this,"maxLength",void 0),(0,r.default)(this,"filterDuplicates",void 0),(0,r.default)(this,"isDuplicate",void 0),(0,r.default)(this,"storage",void 0),(0,r.default)(this,"items",void 0),(0,r.default)(this,"update$",new l.BehaviorSubject(void 0)),this.name=e,this.maxLength="string"==typeof t.maxLength?this.maxLength=parseInt(t.maxLength,10):t.maxLength,this.filterDuplicates=t.filterDuplicates||!1,this.isDuplicate=t.isDuplicate||o,this.storage=a,this.items=this.storage.get(this.name)||[],void 0===this.maxLength||isNaN(this.maxLength)||(this.items=n().take(this.items,this.maxLength))}add(e){return null==e||(this.filterDuplicates&&n().remove(this.items,(t=>this.isDuplicate(t,e))),this.items.unshift(e),this.maxLength&&!isNaN(this.maxLength)&&(this.items=n().take(this.items,this.maxLength)),this.storage.set(this.name,this.items),this.update$.next(void 0)),this.items}get(){return n().cloneDeep(this.items)}get$(){return this.update$.pipe((0,l.map)((()=>this.get())))}}function g(e,t,a,r){return new PersistedLog(`typeahead:${a}-${r}`,{maxLength:e.get(s.UI_SETTINGS.HISTORY_LIMIT),filterDuplicates:!0},t)}function u({storage:e,uiSettings:t}){return function(a,{language:s,query:r}){g(t,e,a,s).add(r)}}function d(e="kuery"){return{query:"",language:e}}var c=a(5964);const h=({$state:e},{$state:t})=>e.store===t.store?0:e.store===c.FilterStateStore.GLOBAL_STATE&&t.store!==c.FilterStateStore.GLOBAL_STATE?-1:1,p=e=>{if(!(0,c.isCombinedFilter)(e))throw e;const{type:t,key:a,params:s}=e.meta;return{type:t,key:a,params:s.map(M)}},m=e=>{var t;if((null===(t=e.meta)||void 0===t?void 0:t.type)===c.FILTERS.SPATIAL_FILTER)return{type:e.meta.type,key:void 0,value:void 0};throw e},f=e=>{if((0,c.isMatchAllFilter)(e))return{type:c.FILTERS.MATCH_ALL,key:e.meta.field,value:e.meta.formattedValue||"all"};throw e},y=e=>{if(!(e=>(0,c.isPhraseFilter)(e)||(0,c.isScriptedPhraseFilter)(e))(e))throw e;return(e=>{const t=(e=>(0,i.get)(e,["query","script","script","params","value"]))(e);return{key:Boolean(t)?e.meta.field||"":(0,c.getPhraseFilterField)(e),params:{query:t||(0,c.getPhraseFilterValue)(e)},type:c.FILTERS.PHRASE}})(e)},b=e=>{if(!(0,c.isPhrasesFilter)(e))throw e;const{type:t,key:a,params:s}=e.meta;return{type:t,key:a,value:s,params:s}};const v=e=>{if(!(e=>(0,c.isRangeFilter)(e)||(0,c.isScriptedRangeFilter)(e))(e))throw e;return function(e){const t=(0,c.isScriptedRangeFilter)(e),a=(t?e.meta.field:(e=>e.query.range&&Object.keys(e.query.range)[0])(e))||"",s=t?(0,i.get)(e.query,"script.script.params"):((e,t)=>(0,i.get)(e.query,["range",t]))(e,a);return{type:c.FILTERS.RANGE,key:a,value:s,params:s}}(e)},S=e=>{if((0,c.isExistsFilter)(e))return{type:c.FILTERS.EXISTS,value:c.FILTERS.EXISTS,key:(0,i.get)(e,"query.exists.field")};throw e},_=e=>{var t,a;if((0,c.isQueryStringFilter)(e))return{type:c.FILTERS.QUERY_STRING,key:"query",value:null===(t=e.query)||void 0===t||null===(a=t.query_string)||void 0===a?void 0:a.query};throw e},T=e=>{const t=/(^\$|meta)/,a=(0,i.find)((0,i.keys)(e),(e=>!e.match(t)));if(a)return{type:c.FILTERS.CUSTOM,key:a,value:JSON.stringify((0,i.get)(e,a,{}))};throw e},E=()=>{throw new Error("No mappings have been found for filter.")},F=(e,t=E)=>a=>{try{return e(a)}catch(e){if(e===a)return t(a);throw e}};function M(e){const t=[p,m,f,v,y,b,S,_,T],a=(0,i.reduceRight)(t,((e,t)=>F(t,e)),(()=>{throw new Error("No mappings have been found for filter.")})),s=(0,i.cloneDeep)(e),r=a(s);return s.meta=e.meta||{},s.meta.type=r.type,s.meta.key=r.key,s.meta.value=r.value,s.meta.params=r.params,s.meta.disabled=Boolean(s.meta.disabled),s.meta.negate=Boolean(s.meta.negate),s.meta.alias=s.meta.alias,s}const A=e=>(0,i.compact)((0,i.flatten)(e)).map((e=>(0,c.migrateFilter)(e))).map((e=>M(e)));var I=a(71);class FilterManager{constructor(e){(0,r.default)(this,"filters",[]),(0,r.default)(this,"updated$",new l.Subject),(0,r.default)(this,"fetch$",new l.Subject),(0,r.default)(this,"uiSettings",void 0),(0,r.default)(this,"extract",I.o6),(0,r.default)(this,"inject",I.WQ),(0,r.default)(this,"telemetry",I.Y9),(0,r.default)(this,"getAllMigrations",I.R9),this.uiSettings=e}mergeIncomingFilters(e){const t=e.globalFilters,a=e.appFilters,s=[];return n().each(a,(function(e,a){const r=n().find(t,(function(t){return(0,c.compareFilters)(t,e)}));if(!r)return s.push(e);n().assignIn(r.meta,e.meta)})),FilterManager.mergeFilters(s,t)}static mergeFilters(e,t){return(0,c.uniqFilters)(e.reverse().concat(t.reverse())).reverse()}static partitionFilters(e){const[t,a]=n().partition(e,c.isFilterPinned);return{globalFilters:t,appFilters:a}}handleStateUpdate(e){e.sort(h);const t=!(0,c.compareFilters)(this.filters,e,c.COMPARE_ALL_OPTIONS),a=(0,c.onlyDisabledFiltersChanged)(e,this.filters);this.filters=e,t&&(this.updated$.next(),a||this.fetch$.next())}getFilters(){return n().cloneDeep(this.filters)}getAppFilters(){const{appFilters:e}=this.getPartitionedFilters();return e}getGlobalFilters(){const{globalFilters:e}=this.getPartitionedFilters();return e}getPartitionedFilters(){return FilterManager.partitionFilters(this.getFilters())}getUpdates$(){return this.updated$.asObservable()}getFetches$(){return this.fetch$.asObservable()}addFilters(e,t=this.uiSettings.get(s.UI_SETTINGS.FILTERS_PINNED_BY_DEFAULT)){if(Array.isArray(e)||(e=[e]),0===e.length)return;const a=t?c.FilterStateStore.GLOBAL_STATE:c.FilterStateStore.APP_STATE;FilterManager.setFiltersStore(e,a);const r=A(e),i=FilterManager.partitionFilters(r),n=this.getPartitionedFilters();n.appFilters.push(...i.appFilters),n.globalFilters.push(...i.globalFilters);const l=this.mergeIncomingFilters(n);this.handleStateUpdate(l)}setFilters(e,t=this.uiSettings.get(s.UI_SETTINGS.FILTERS_PINNED_BY_DEFAULT)){const a=t?c.FilterStateStore.GLOBAL_STATE:c.FilterStateStore.APP_STATE;FilterManager.setFiltersStore(e,a);const r=A(e),i=FilterManager.partitionFilters(r),n=this.mergeIncomingFilters(i);this.handleStateUpdate(n)}setGlobalFilters(e){e=A(e),FilterManager.setFiltersStore(e,c.FilterStateStore.GLOBAL_STATE,!0);const{appFilters:t}=this.getPartitionedFilters(),a=this.mergeIncomingFilters({appFilters:t,globalFilters:e});this.handleStateUpdate(a)}setAppFilters(e){e=A(e),FilterManager.setFiltersStore(e,c.FilterStateStore.APP_STATE,!0);const{globalFilters:t}=this.getPartitionedFilters(),a=this.mergeIncomingFilters({globalFilters:t,appFilters:e});this.handleStateUpdate(a)}removeFilter(e){const t=n().findIndex(this.filters,(t=>n().isEqual(t.meta,e.meta)&&n().isEqual(t.query,e.query)));if(t>=0){const e=n().cloneDeep(this.filters);e.splice(t,1),this.handleStateUpdate(e)}}removeAll(){this.setFilters([])}static setFiltersStore(e,t,a=!1){n().map(e,(e=>{(a||void 0===e.$state)&&(e.$state={store:t})}))}}var w=a(3313);function R(e,t,a,s,r){a=Array.isArray(a)?n().uniq(a):[a];const i=n().isObject(t)?t:{name:t},l=i.name,o=e.getAppFilters(),g="-"===s;return n().chain(a).map((function(e){var t;return i.type===w.fM.DATE&&"string"==typeof e?{format:null!==(t=i.esTypes)&&void 0!==t&&t.includes("date_nanos")?"strict_date_optional_time_nanos":"date_time",gte:e,lte:e}:e})).map((e=>{const t=function(e,t,a){return n().find(e,(function(e){var s,r,i,l;if(e)return"_exists_"===t&&(0,c.isExistsFilter)(e)?e.query.exists.field===a:(0,c.isPhraseFilter)(e)?(0,c.getPhraseFilterField)(e)===t&&(0,c.getPhraseFilterValue)(e)===a:(0,c.isScriptedPhraseFilter)(e)?e.meta.field===t&&(null===(s=e.query)||void 0===s||null===(r=s.script)||void 0===r||null===(i=r.script)||void 0===i||null===(l=i.params)||void 0===l?void 0:l.value)===a:(0,c.isRangeFilter)(e)?(0,c.getFilterField)(e)===t&&n().isEqual(e.query.range[t],a):void 0}))}(o,l,e);return t&&function(e,t){e.meta.disabled=!1,e.meta.negate!==t&&(e.meta.negate=!e.meta.negate)}(t,g),null!=t?t:function(e){var t;if(((null===(t=i.type)||void 0===t?void 0:t.includes("range"))||i.type===w.fM.DATE)&&n().isObjectLike(e))return(0,c.buildFilter)(r,i,c.FILTERS.RANGE_FROM_VALUE,g,!1,e,null,c.FilterStateStore.APP_STATE);const a="_exists_"===l?c.FILTERS.EXISTS:c.FILTERS.PHRASE,s="_exists_"===l?{name:e}:i,o=null==e;return(0,c.buildFilter)(r,s,o?c.FILTERS.EXISTS:a,o?!g:g,!1,e,null,c.FilterStateStore.APP_STATE)}(e)})).value()}var k=a(5008);function x(e,t){return t.find((t=>t.id===e.meta.index))}function N(e,t){var a;const s=x(e,t);if(!s)return"";const r=(0,c.getFilterField)(e);if(!r)return"";const i=s.fields.find((e=>e.name===r));return i&&"customLabel"in i&&null!==(a=i.customLabel)&&void 0!==a?a:""}function P(e,t){var a;const s=x(e,t),r=(0,c.getFilterField)(e),n=null==s?void 0:s.fields.find((e=>e.name===r)),l=null==n?void 0:n.type,o=function(e,t){if(!e||!("getFormatterForField"in e)||!t)return;const a=e.fields.find((e=>e.name===t));if(!a)throw new Error(k.i18n.translate("data.filter.filterBar.fieldNotFound",{defaultMessage:"Field {key} not found in data view {dataView}",values:{key:t,dataView:e.title}}));return e.getFormatterForField(a)}(s,r);return(0,c.isPhraseFilter)(e)||(0,c.isScriptedPhraseFilter)(e)?function(e,t,a){var s,r;const i=null!==(s=e.meta.value)&&void 0!==s?s:null===(r=e.meta.params)||void 0===r?void 0:r.query,n="number"!==a||i?i:0;return null!=t&&t.convert?t.convert(n):void 0===n?"":`${n}`}(e,o,l):(0,c.isPhrasesFilter)(e)?function(e,t){return e.meta.params.map((e=>{var a;return null!==(a=null==t?void 0:t.convert(e))&&void 0!==a?a:e})).join(", ")}(e,o):(0,c.isRangeFilter)(e)||(0,c.isScriptedRangeFilter)(e)?function({meta:{params:e}},t){const a=t?t.getConverterFor("text"):i.identity,{gte:s,gt:r,lte:n,lt:l}=e||{},o=null!=s?s:r,g=null!=n?n:l;return void 0!==o&&void 0!==g?`${a(o)} to ${a(g)}`:void 0!==s?` ${a(s)}`:void 0!==r?`> ${a(r)}`:void 0!==n?` ${a(n)}`:void 0!==l?`< ${a(l)}`:"-"}(e,o):null!==(a=e.meta.value)&&void 0!==a?a:""}class TimefilterService{constructor(e){this.nowProvider=e}setup({uiSettings:e,storage:t,minRefreshInterval:a}){const r={timeDefaults:e.get(s.UI_SETTINGS.TIMEPICKER_TIME_DEFAULTS),refreshIntervalDefaults:e.get(s.UI_SETTINGS.TIMEPICKER_REFRESH_INTERVAL_DEFAULTS),minRefreshIntervalDefault:a},i=new TimeHistory(t);return{timefilter:new Timefilter(r,i,this.nowProvider),history:i}}start(){}stop(){}}var C=a(1783),L=a.n(C);const D=function(e){if(e)return e.valueOf()};function O(e,t){return n().isObject(e)&&n().isObject(t)?D(e.value)!==D(t.value)||D(e.pause)!==D(t.pause):!n().isEqual(e,t)}class Timefilter{constructor(e,t,a){(0,r.default)(this,"enabledUpdated$",new l.BehaviorSubject(!1)),(0,r.default)(this,"timeUpdate$",new l.Subject),(0,r.default)(this,"refreshIntervalUpdate$",new l.Subject),(0,r.default)(this,"fetch$",new l.Subject),(0,r.default)(this,"_time",void 0),(0,r.default)(this,"_isTimeTouched",!1),(0,r.default)(this,"_refreshInterval",void 0),(0,r.default)(this,"_minRefreshInterval",void 0),(0,r.default)(this,"_isRefreshIntervalTouched",!1),(0,r.default)(this,"_history",void 0),(0,r.default)(this,"_isTimeRangeSelectorEnabled",!1),(0,r.default)(this,"_isAutoRefreshSelectorEnabled",!1),(0,r.default)(this,"timeDefaults",void 0),(0,r.default)(this,"refreshIntervalDefaults",void 0),(0,r.default)(this,"autoRefreshLoop",(()=>{let e=0;const t=new l.Subject;let a,s=0;function r(){if(n(),0===s)return;const i=window.setTimeout((()=>{let s=e;t.next((()=>{i===a&&(s--,0===s&&r())}))}),s);a=i}function n(){window.clearTimeout(a),a=-1}const o=(0,l.fromEvent)(document,"visibilitychange").pipe((0,l.startWith)(document.visibilityState),(0,l.map)((()=>document.visibilityState)),(0,l.shareReplay)({refCount:!0,bufferSize:1})).pipe((0,l.filter)((e=>"visible"===e))),g=t.pipe((0,l.delayWhen)((()=>o)));return{stop:()=>{s=0,n()},start:t=>{s=t,e>0&&r()},loop$:(0,l.defer)((()=>(e++,r(),g.pipe((0,l.map)((e=>(0,i.once)(e))))))).pipe((0,l.finalize)((()=>{e--,0===e?n():r()})))}})()),(0,r.default)(this,"getEnabledUpdated$",(()=>this.enabledUpdated$.asObservable())),(0,r.default)(this,"getTimeUpdate$",(()=>this.timeUpdate$.asObservable())),(0,r.default)(this,"getRefreshIntervalUpdate$",(()=>this.refreshIntervalUpdate$.asObservable())),(0,r.default)(this,"getAutoRefreshFetch$",(()=>this.autoRefreshLoop.loop$)),(0,r.default)(this,"getFetch$",(()=>this.fetch$.asObservable())),(0,r.default)(this,"getTime",(()=>{const{from:e,to:t}=this._time;return{...this._time,from:L().isMoment(e)?e.toISOString():e,to:L().isMoment(t)?t.toISOString():t}})),(0,r.default)(this,"setTime",(e=>{const t=Object.assign(this.getTime(),e);var a,s;s=t,((a=this.getTime())&&s&&n().isObject(a)&&n().isObject(s)?D(a.to)===D(s.to)&&D(a.from)===D(s.from):n().isEqual(a,s))||(this._time={from:t.from,to:t.to},this._isTimeTouched=!0,this._history.add(this._time),this.timeUpdate$.next(),this.fetch$.next())})),(0,r.default)(this,"getRefreshInterval",(()=>n().clone(this._refreshInterval))),(0,r.default)(this,"getMinRefreshInterval",(()=>this._minRefreshInterval)),(0,r.default)(this,"setRefreshInterval",(e=>{const t=this.getRefreshInterval(),a={...t,...e};0===a.value&&(a.pause=!0),a.value<this._minRefreshInterval&&(a.value=this._minRefreshInterval);let s=!1===a.pause&&null!=t;(null==t?void 0:t.value)>0&&a.value<=0&&(s=!1),this._isRefreshIntervalTouched=this._isRefreshIntervalTouched||O(this.refreshIntervalDefaults,a),a.value<=0&&(a.value=0,a.pause=!s),this._refreshInterval={value:a.value,pause:a.pause},t&&O(t,a)&&(this.refreshIntervalUpdate$.next(),a.pause||0===a.value||this.fetch$.next()),this.autoRefreshLoop.stop(),a.pause||0===a.value||this.autoRefreshLoop.start(a.value)})),(0,r.default)(this,"createFilter",((e,t)=>(0,s.getTime)(e,t||this._time,{forceNow:this.nowProvider.get()}))),(0,r.default)(this,"createRelativeFilter",((e,t)=>(0,s.getRelativeTime)(e,t||this._time,{forceNow:this.nowProvider.get()}))),(0,r.default)(this,"enableTimeRangeSelector",(()=>{this._isTimeRangeSelectorEnabled=!0,this.enabledUpdated$.next(!0)})),(0,r.default)(this,"disableTimeRangeSelector",(()=>{this._isTimeRangeSelectorEnabled=!1,this.enabledUpdated$.next(!1)})),(0,r.default)(this,"enableAutoRefreshSelector",(()=>{this._isAutoRefreshSelectorEnabled=!0,this.enabledUpdated$.next(!0)})),(0,r.default)(this,"disableAutoRefreshSelector",(()=>{this._isAutoRefreshSelectorEnabled=!1,this.enabledUpdated$.next(!1)})),this.nowProvider=a,this._history=t,this.timeDefaults=e.timeDefaults,this.refreshIntervalDefaults={pause:0===e.refreshIntervalDefaults.value||e.refreshIntervalDefaults.pause,value:Math.max(e.refreshIntervalDefaults.value,e.minRefreshIntervalDefault)},this._minRefreshInterval=e.minRefreshIntervalDefault,this._time=e.timeDefaults,this.setRefreshInterval(e.refreshIntervalDefaults)}isTimeRangeSelectorEnabled(){return this._isTimeRangeSelectorEnabled}isAutoRefreshSelectorEnabled(){return this._isAutoRefreshSelectorEnabled}isTimeTouched(){return this._isTimeTouched}isRefreshIntervalTouched(){return this._isRefreshIntervalTouched}getAbsoluteTime(){return(0,s.getAbsoluteTimeRange)(this._time,{forceNow:this.nowProvider.get()})}getBounds(){return this.calculateBounds(this._time)}calculateBounds(e){return(0,s.calculateBounds)(e,{forceNow:this.nowProvider.get()})}getActiveBounds(){if(this.isTimeRangeSelectorEnabled())return this.getBounds()}getTimeDefaults(){return n().cloneDeep(this.timeDefaults)}getRefreshIntervalDefaults(){return n().cloneDeep(this.refreshIntervalDefaults)}}class TimeHistory{constructor(e){(0,r.default)(this,"history",void 0),this.history=new PersistedLog("kibana.timepicker.timeHistory",{maxLength:10,filterDuplicates:!0,isDuplicate:(e,t)=>e.from===t.from&&e.to===t.to},e)}add(e){if(!e||!e.from||!e.to)return;const t={from:L().isMoment(e.from)?e.from.toISOString():e.from,to:L().isMoment(e.to)?e.to.toISOString():e.to};this.history.add(t)}get(){return this.history.get()}get$(){return this.history.get$()}}var q=a(6494),B=a.n(q),j=a(2787);const U="1",G=e=>({isDuplicateTitle:async(t,a)=>(await e.post(`${j.nK}/_is_duplicate_title`,{body:JSON.stringify({title:t,id:a}),version:U})).isDuplicate,createQuery:async(t,{overwrite:a=!1}={})=>await e.post(`${j.nK}/_create`,{body:JSON.stringify(t),version:U}),updateQuery:async(t,a)=>await e.put(`${j.nK}/${t}`,{body:JSON.stringify(a),version:U}),findSavedQueries:async(t="",a=50,s=1)=>{const{total:r,savedQueries:i}=await e.post(`${j.nK}/_find`,{body:JSON.stringify({page:s,perPage:a,search:t}),version:U});return{total:r,queries:i}},getSavedQuery:t=>e.get(`${j.nK}/${t}`,{version:U}),deleteSavedQuery:t=>e.delete(`${j.nK}/${t}`,{version:U}),getSavedQueryCount:async()=>e.get(`${j.nK}/_count`,{version:U})});var z=a(1215);function $({timefilter:{timefilter:e},filterManager:t,queryString:a}){return{time:e.getTime(),refreshInterval:e.getRefreshInterval(),filters:t.getFilters(),query:a.getQuery()}}class QueryStringManager{constructor(e,t){(0,r.default)(this,"query$",void 0),(0,r.default)(this,"getUpdates$",(()=>this.query$.asObservable().pipe((0,l.skip)(1)))),(0,r.default)(this,"getQuery",(()=>this.query$.getValue())),(0,r.default)(this,"setQuery",(e=>{const t=this.query$.getValue();(0,i.isEqual)(e,t)||this.query$.next(e)})),(0,r.default)(this,"clearQuery",(()=>{this.setQuery(this.getDefaultQuery())})),this.storage=e,this.uiSettings=t,this.query$=new l.BehaviorSubject(this.getDefaultQuery())}getDefaultLanguage(){return this.storage.get(s.KIBANA_USER_QUERY_LANGUAGE_KEY)||this.uiSettings.get(s.UI_SETTINGS.SEARCH_QUERY_LANGUAGE)}getDefaultQuery(){return{query:"",language:this.getDefaultLanguage()}}formatQuery(e){return e?"string"==typeof e?{query:e,language:this.getDefaultLanguage()}:e:this.getDefaultQuery()}}const[V,K]=(0,z.createGetterSetter)("UiSettings"),[H,Y]=(0,z.createGetterSetter)("Overlays"),[Q,W]=(0,z.createGetterSetter)("IndexPatterns"),[J,X]=(0,z.createGetterSetter)("Search"),[Z,ee]=(0,z.createGetterSetter)("Theme");var te=a(1359);const ae=e=>{var t;const a=[],{state:s,references:r}=I.o6(null!==(t=e.filters)&&void 0!==t?t:[]);return a.push(...r),{state:{...e,filters:s},references:a}},se=(e,t)=>{var a;const s=I.WQ(null!==(a=e.filters)&&void 0!==a?a:[],t);return{...e,filters:s}},re=(e,t)=>{var a;return{...I.Y9(null!==(a=e.filters)&&void 0!==a?a:[],t)}},ie=()=>{const e=(0,i.mapValues)(I.R9(),(e=>t=>{var a;return{...t,filters:e(null!==(a=t.filters)&&void 0!==a?a:[])}}));return(0,te.mergeMigrationFunctionMaps)({},e)};class QueryService{constructor(e=5e3){(0,r.default)(this,"filterManager",void 0),(0,r.default)(this,"timefilter",void 0),(0,r.default)(this,"queryStringManager",void 0),(0,r.default)(this,"state$",void 0),(0,r.default)(this,"extract",ae),(0,r.default)(this,"inject",se),(0,r.default)(this,"telemetry",re),(0,r.default)(this,"getAllMigrations",ie),(0,r.default)(this,"migrateToLatest",(e=>(({state:e,version:t})=>{var a;const s=I.kr({state:null!==(a=e.filters)&&void 0!==a?a:[],version:t});return{...e,filters:s}})(e))),this.minRefreshInterval=e}setup({storage:e,uiSettings:t,nowProvider:a,minRefreshInterval:s=this.minRefreshInterval}){this.filterManager=new FilterManager(t);const r=new TimefilterService(a);return this.timefilter=r.setup({uiSettings:t,storage:e,minRefreshInterval:s}),this.queryStringManager=new QueryStringManager(e,t),this.state$=function({timefilter:e,filterManager:t,queryString:a}){const s=(0,z.createStateContainer)($({timefilter:e,filterManager:t,queryString:a}));return new l.Observable((r=>{let i={};const n=[a.getUpdates$().subscribe((()=>{i.query=!0,s.set({...s.get(),query:a.getQuery()})})),e.timefilter.getTimeUpdate$().subscribe((()=>{i.time=!0,s.set({...s.get(),time:e.timefilter.getTime()})})),e.timefilter.getRefreshIntervalUpdate$().subscribe((()=>{i.refreshInterval=!0,s.set({...s.get(),refreshInterval:e.timefilter.getRefreshInterval()})})),t.getUpdates$().subscribe((()=>{i.filters=!0;const{filters:e}=s.get(),a=null==e?void 0:e.filter((e=>(0,c.isFilterPinned)(e))),r=null==e?void 0:e.filter((e=>!(0,c.isFilterPinned)(e))),n=t.getGlobalFilters(),l=t.getAppFilters();a&&(0,c.compareFilters)(a,n,c.COMPARE_ALL_OPTIONS)||(i.globalFilters=!0),r&&(0,c.compareFilters)(r,l,c.COMPARE_ALL_OPTIONS)||(i.appFilters=!0),s.set({...s.get(),filters:t.getFilters()})})),s.state$.pipe((0,l.map)((e=>({state:e,changes:i}))),(0,l.tap)((()=>{i={}}))).subscribe(r)];return()=>{n.forEach((e=>e.unsubscribe()))}}))}({filterManager:this.filterManager,timefilter:this.timefilter,queryString:this.queryStringManager}).pipe((0,l.share)()),{filterManager:this.filterManager,timefilter:this.timefilter,queryString:this.queryStringManager,state$:this.state$,getState:()=>this.getQueryState(),...this.getPersistableStateMethods()}}start({storage:e,uiSettings:t,http:a}){return{addToQueryLog:u({storage:e,uiSettings:t}),filterManager:this.filterManager,queryString:this.queryStringManager,savedQueries:G(a),state$:this.state$,getState:()=>this.getQueryState(),timefilter:this.timefilter,getEsQuery:(e,t)=>{const a=this.timefilter.timefilter.createFilter(e,t);return(0,c.buildEsQuery)(e,this.queryStringManager.getQuery(),[...this.filterManager.getFilters(),...a?[a]:[]],(0,s.getEsQueryConfig)(V()))},...this.getPersistableStateMethods()}}stop(){}getQueryState(){return $({timefilter:this.timefilter,queryString:this.queryStringManager,filterManager:this.filterManager})}getPersistableStateMethods(){return{extract:this.extract.bind(this),inject:this.inject.bind(this),telemetry:this.telemetry.bind(this),migrateToLatest:this.migrateToLatest.bind(this),getAllMigrations:this.getAllMigrations.bind(this)}}}const ne=({timefilter:{timefilter:e},filterManager:t,queryString:a,state$:s},r,i)=>{const o=[];if(i.time&&o.push("time"),i.query&&o.push("query"),i.refreshInterval&&o.push("refreshInterval"),i.filters)switch(i.filters){case!0:o.push("filters");break;case c.FilterStateStore.APP_STATE:o.push("appFilters");break;case c.FilterStateStore.GLOBAL_STATE:o.push("globalFilters")}const g={...r.get()};let u=!1;i.time&&!n().isEqual(g.time,e.getTime())&&(g.time=e.getTime(),u=!0),i.refreshInterval&&!n().isEqual(g.refreshInterval,e.getRefreshInterval())&&(g.refreshInterval=e.getRefreshInterval(),u=!0),i.filters&&(!0===i.filters?g.filters&&(0,c.compareFilters)(g.filters,t.getFilters(),c.COMPARE_ALL_OPTIONS)||(g.filters=t.getFilters(),u=!0):i.filters===c.FilterStateStore.GLOBAL_STATE?g.filters&&(0,c.compareFilters)(g.filters,t.getGlobalFilters(),{...c.COMPARE_ALL_OPTIONS,state:!1})||(g.filters=t.getGlobalFilters(),u=!0):i.filters===c.FilterStateStore.APP_STATE&&(g.filters&&(0,c.compareFilters)(g.filters,t.getAppFilters(),{...c.COMPARE_ALL_OPTIONS,state:!1})||(g.filters=t.getAppFilters(),u=!0))),u&&r.set({...r.get(),...g});let d=!1;const h=[s.pipe((0,l.filter)((({changes:e,state:t})=>!d&&o.some((t=>e[t])))),(0,l.map)((({changes:s})=>{const r={};return i.time&&s.time&&(r.time=e.getTime()),i.query&&s.query&&(r.query=a.getQuery()),i.refreshInterval&&s.refreshInterval&&(r.refreshInterval=e.getRefreshInterval()),i.filters&&(!0===i.filters&&s.filters?r.filters=t.getFilters():i.filters===c.FilterStateStore.GLOBAL_STATE&&s.globalFilters?r.filters=t.getGlobalFilters():i.filters===c.FilterStateStore.APP_STATE&&s.appFilters&&(r.filters=t.getAppFilters())),r}))).subscribe((e=>{r.set({...r.get(),...e})})),r.state$.subscribe((s=>{if(d=!0,i.time){const t=function(e){if(!e)return!1;const t=B().parse(e.from),a=B().parse(e.to);return!!(t&&t.isValid()&&a&&a.isValid())}(s.time)?s.time:e.getTimeDefaults();n().isEqual(t,e.getTime())||e.setTime(n().cloneDeep(t))}if(i.refreshInterval){const t=s.refreshInterval||e.getRefreshIntervalDefaults();n().isEqual(t,e.getRefreshInterval())||e.setRefreshInterval(n().cloneDeep(t))}if(i.query){const e=s.query||a.getQuery();n().isEqual(e,a.getQuery())||a.setQuery(n().cloneDeep(e))}if(i.filters){const e=s.filters||[];!0===i.filters?(0,c.compareFilters)(e,t.getFilters(),c.COMPARE_ALL_OPTIONS)||t.setFilters(n().cloneDeep(e)):i.filters===c.FilterStateStore.APP_STATE?(0,c.compareFilters)(e,t.getAppFilters(),{...c.COMPARE_ALL_OPTIONS,state:!1})||t.setAppFilters(n().cloneDeep(e)):i.filters===c.FilterStateStore.GLOBAL_STATE&&((0,c.compareFilters)(e,t.getGlobalFilters(),{...c.COMPARE_ALL_OPTIONS,state:!1})||t.setGlobalFilters(n().cloneDeep(e)))}d=!1}))];return()=>{h.forEach((e=>e.unsubscribe()))}},le="_g",oe=(e,t)=>{const{timefilter:{timefilter:a},filterManager:s}=e,r={time:a.getTime(),refreshInterval:a.getRefreshInterval(),filters:s.getGlobalFilters()},i=t.get(le),n=Boolean(i&&Object.keys(i).length),l={...r,...i},o=(0,z.createStateContainer)(l),g=ne(e,o,{refreshInterval:!0,time:!0,filters:c.FilterStateStore.GLOBAL_STATE});i||t.set(le,l,{replace:!0}),o.set(l);const{start:u,stop:d}=(0,z.syncState)({stateStorage:t,stateContainer:{...o,set:e=>{e&&o.set(e)}},storageKey:le});return u(),{stop:()=>{g(),d()},hasInheritedQueryFromUrl:n}},ge=oe;var ue=a(7574),de=a(8686);function ce({getStartServices:e}){return function({getStartDependencies:e}){return()=>({...(0,de.getEsaggsMeta)(),allowCache:{withSideEffects:(e,{inspectorAdapters:t})=>(0,de.getSideEffectFunction)(t)},fn:(t,s,{inspectorAdapters:r,abortSignal:n,getSearchSessionId:o,getExecutionContext:g,getSearchContext:u})=>(0,l.defer)((async()=>{var t,r;const[{aggs:i,indexPatterns:n,searchSource:l,getNow:o},{handleEsaggsRequest:g}]=await Promise.all([e(),Promise.resolve().then(a.bind(a,8686))]),u=await n.create(s.index.value,!0);return{aggConfigs:i.createAggConfigs(u,null!==(t=null===(r=s.aggs)||void 0===r?void 0:r.map((e=>e.value)))&&void 0!==t?t:[],{hierarchical:s.metricsAtAllLevels,partialRows:s.partialRows,probability:s.probability,samplerSeed:s.samplerSeed}),indexPattern:u,searchSource:l,getNow:o,handleEsaggsRequest:g}})).pipe((0,l.switchMap)((({aggConfigs:e,indexPattern:a,searchSource:l,getNow:d,handleEsaggsRequest:c})=>{const{disableWarningToasts:h}=u();return c({abortSignal:n,aggs:e,filters:s.ignoreGlobalFilters?void 0:(0,i.get)(t,"filters",void 0),indexPattern:a,inspectorAdapters:r,query:s.ignoreGlobalFilters?void 0:(0,i.get)(t,"query",void 0),searchSessionId:o(),searchSourceService:l,timeFields:s.timeFields,timeRange:(0,i.get)(t,"timeRange",void 0),disableWarningToasts:h||!1,getNow:d,executionContext:g()})})))})}({getStartDependencies:async()=>{const[,,t]=await e(),{indexPatterns:a,search:s,nowProvider:r}=t;return{aggs:s.aggs,indexPatterns:a,searchSource:s.searchSource,getNow:()=>r.get()}}})}var he=a(8700),pe=a(8370),me=a(8351),fe=a(1373),ye=a(5536);function be(e){return e.replace(/[\(\)]/g,"_")}var ve=a(8878),Se=a(4825),_e=a(3731),Te=a(1225);var Ee=a(3721);class SessionService{constructor(e,t,a,s,i,{freezeState:n=!0}={freezeState:!0}){(0,r.default)(this,"state$",void 0),(0,r.default)(this,"state",void 0),(0,r.default)(this,"sessionMeta$",void 0),(0,r.default)(this,"_disableSaveAfterSearchesExpire$",new l.BehaviorSubject(!1)),(0,r.default)(this,"disableSaveAfterSearchesExpire$",void 0),(0,r.default)(this,"searchSessionInfoProvider",void 0),(0,r.default)(this,"searchSessionIndicatorUiConfig",void 0),(0,r.default)(this,"subscription",new l.Subscription),(0,r.default)(this,"currentApp",void 0),(0,r.default)(this,"hasAccessToSearchSessions",!1),(0,r.default)(this,"toastService",void 0),(0,r.default)(this,"lastSessionSnapshot",void 0),this.sessionsClient=a,this.nowProvider=s,this.usageCollector=i;const{stateContainer:o,sessionState$:g,sessionMeta$:u}=(0,_e.zQ)({freeze:n});this.state$=g,this.state=o,this.sessionMeta$=u,this.disableSaveAfterSearchesExpire$=(0,l.combineLatest)([this._disableSaveAfterSearchesExpire$,this.sessionMeta$.pipe((0,l.map)((e=>e.isContinued)))]).pipe((0,l.map)((([e,t])=>e||t)),(0,l.distinctUntilChanged)());const d=L().duration(e.config.get().search.sessions.notTouchedTimeout).asMilliseconds();this.subscription.add(this.state$.pipe((0,l.switchMap)((e=>e===_e.Mv.Completed?(0,l.merge)((0,l.of)(!1),(0,l.timer)(d).pipe((0,l.mapTo)(!0))):(0,l.of)(!1))),(0,l.distinctUntilChanged)(),(0,l.tap)((e=>{var t;e&&(null===(t=this.usageCollector)||void 0===t||t.trackSessionIndicatorSaveDisabled())}))).subscribe(this._disableSaveAfterSearchesExpire$)),this.subscription.add(u.pipe((0,l.map)((e=>e.startTime)),(0,l.distinctUntilChanged)()).subscribe((e=>{e?this.nowProvider.set(e):this.nowProvider.reset()}))),t().then((([t])=>{var a,s;this.hasAccessToSearchSessions=null===(a=t.application.capabilities.management)||void 0===a||null===(s=a.kibana)||void 0===s?void 0:s[Te.j],this.toastService=t.notifications.toasts,this.subscription.add(t.application.currentAppId$.subscribe((a=>{if(this.currentApp=a,!this.getSessionId())return;const s=`Application '${this.state.get().appName}' had an open session while navigating`;e.env.mode.dev?t.fatalErrors.add(s):Ee.warn(s)})))})),this.subscription.add(this.getSession$().pipe((0,l.switchMap)((e=>e?this.isStored()?l.EMPTY:this.hasAccess()&&this.isSessionStorageReady()?(()=>(0,l.timer)(3e4).pipe((0,l.mergeMap)((()=>{const t=this.state.get().trackedSearches.filter((e=>!e.searchMeta.isStored&&e.state===_e.KJ.Completed&&e.searchMeta.lastPollingTime.getTime()<Date.now()-5e3));return(0,l.from)(Promise.all(t.map((t=>t.searchDescriptor.poll().catch((t=>{Ee.warn("Error while polling search to keep it alive. Considering that it is no longer possible to extend a session.",t),this.isCurrentSession(e)&&this._disableSaveAfterSearchesExpire$.next(!0)}))))))})),(0,l.repeat)(),(0,l.takeUntil)(this.disableSaveAfterSearchesExpire$.pipe((0,l.filter)((e=>e))))))():l.EMPTY:l.EMPTY))).subscribe((()=>{})))}hasAccess(){return this.hasAccessToSearchSessions}trackSearch(e){return this.state.transitions.trackSearch(e,{lastPollingTime:new Date,isStored:!1}),{complete:()=>{if(this.state.transitions.completeSearch(e),this.isStored()){const t=this.state.selectors.getSearch(e);t&&!t.searchMeta.isStored&&t.searchDescriptor.poll().catch((e=>{Ee.warn("Failed to extend search after it was completed",e)}))}},error:()=>{this.state.transitions.errorSearch(e)},beforePoll:()=>{var t,a;const s=this.state.selectors.getSearch(e);return this.state.transitions.updateSearchMeta(e,{lastPollingTime:new Date}),[{isSearchStored:null!==(t=null==s||null===(a=s.searchMeta)||void 0===a?void 0:a.isStored)&&void 0!==t&&t},({isSearchStored:t})=>{this.state.transitions.updateSearchMeta(e,{isStored:t})}]}}}destroy(){this.subscription.unsubscribe(),this.clear(),this.lastSessionSnapshot=void 0}getSessionId(){return this.state.get().sessionId}getSession$(){return this.state.state$.pipe((0,l.startWith)(this.state.get()),(0,l.map)((e=>e.sessionId)),(0,l.distinctUntilChanged)())}isStored(){return this.state.get().isStored}isRestore(){return this.state.get().isRestore}start(){if(!this.currentApp)throw new Error("this.currentApp is missing");return this.state.transitions.start({appName:this.currentApp}),this.getSessionId()}restore(e){this.state.transitions.restore(e),this.refreshSearchSessionSavedObject()}continue(e){var t,a;(null===(t=this.lastSessionSnapshot)||void 0===t?void 0:t.sessionId)===e?(this.state.set({...this.lastSessionSnapshot,appName:this.currentApp,trackedSearches:[],isContinued:!0}),this.lastSessionSnapshot=void 0):Ee.warn(`Continue search session: last known search session id: "${null===(a=this.lastSessionSnapshot)||void 0===a?void 0:a.sessionId}", but received ${e}`)}clear(){const e=this.state.get().appName;e&&e!==this.currentApp?Ee.warn(`Skip clearing session "${this.getSessionId()}" because it belongs to a different app. current: "${this.currentApp}", owner: "${e}"`):(this.getSessionId()&&(this.lastSessionSnapshot=this.state.get()),this.state.transitions.clear(),this.searchSessionInfoProvider=void 0,this.searchSessionIndicatorUiConfig=void 0)}async cancel(){const e=this.isStored();this.state.get().trackedSearches.filter((e=>e.state===_e.KJ.InProgress)).forEach((e=>{e.searchDescriptor.abort()})),this.state.transitions.cancel(),e&&await this.sessionsClient.delete(this.state.get().sessionId)}async save(){const e=this.getSessionId();if(!e)throw new Error("No current session");const t=this.state.get().appName;if(!t)throw new Error("No current session app");if(!this.hasAccess())throw new Error("No access to search sessions");const a=this.searchSessionInfoProvider;if(!a)throw new Error("No info provider for current session");const[s,{initialState:r,restoreState:i,id:n}]=await Promise.all([a.getName(),a.getLocatorData()]),l=(g=s,(u={sessionStartTime:this.state.get().startTime,appendStartTime:a.appendSessionStartTimeToName}).sessionStartTime&&u.appendStartTime&&(g=function(e,t){return`${e} - ${L()(t).format("L @ LT")}`}(g,u.sessionStartTime)),g),o=await this.sessionsClient.create({name:l,appId:t,locatorId:n,restoreState:i,initialState:r,sessionId:e});var g,u;if(this.isCurrentSession(e)){this.state.transitions.store(o);const t=this.state.get().trackedSearches.filter((e=>e.state!==_e.KJ.Errored&&!e.searchMeta.isStored)),a=Promise.all(t.map((e=>e.searchDescriptor.poll().catch((e=>{Ee.warn("Failed to extend search after session was saved",e)})))));this.state.get().trackedSearches.filter((e=>e.searchDescriptor.onSavingSession)).forEach((t=>t.searchDescriptor.onSavingSession({sessionId:e,isRestore:this.isRestore(),isStored:this.isStored()}).catch((e=>{Ee.warn('Failed to execute "onSavingSession" handler after session was saved',e)})))),await a}}async renameCurrentSession(e){const t=this.getSessionId();if(t&&this.state.get().isStored){let s=!1;try{await this.sessionsClient.rename(t,e),s=!0}catch(e){var a;null===(a=this.toastService)||void 0===a||a.addError(e,{title:k.i18n.translate("data.searchSessions.sessionService.sessionEditNameError",{defaultMessage:"Failed to edit name of the search session"})})}s&&t===this.getSessionId()&&await this.refreshSearchSessionSavedObject()}}isCurrentSession(e){return!!e&&this.getSessionId()===e}getSearchOptions(e){if(!e)return null;if(!this.hasAccessToSearchSessions)return null;const t=this.isCurrentSession(e);return{sessionId:e,isRestore:!!t&&this.isRestore(),isStored:!!t&&this.isStored()}}enableStorage(e,t){this.searchSessionInfoProvider={appendSessionStartTimeToName:!0,...e},this.searchSessionIndicatorUiConfig=t}isSessionStorageReady(){return!!this.searchSessionInfoProvider}getSearchSessionIndicatorUiConfig(){return{isDisabled:()=>({disabled:!1}),...this.searchSessionIndicatorUiConfig}}async refreshSearchSessionSavedObject(){const e=this.getSessionId();if(e&&this.state.get().isStored)try{const t=await this.sessionsClient.get(e);this.getSessionId()===e&&this.state.transitions.setSearchSessionSavedObject(t)}catch(e){var t;null===(t=this.toastService)||void 0===t||t.addError(e,{title:k.i18n.translate("data.searchSessions.sessionService.sessionObjectFetchError",{defaultMessage:"Failed to fetch search session info"})})}}}const Fe="1",Me={version:Fe};class SessionsClient{constructor(e){(0,r.default)(this,"http",void 0),this.http=e.http}get(e){return this.http.get(`/internal/session/${encodeURIComponent(e)}`,Me)}create({name:e,appId:t,locatorId:a,initialState:s,restoreState:r,sessionId:i}){return this.http.post("/internal/session",{version:Fe,body:JSON.stringify({name:e,appId:t,locatorId:a,initialState:s,restoreState:r,sessionId:i})})}find(e){return this.http.post("/internal/session/_find",{version:Fe,body:JSON.stringify(e)})}update(e,t){return this.http.put(`/internal/session/${encodeURIComponent(e)}`,{version:Fe,body:JSON.stringify(t)})}async rename(e,t){await this.update(e,{name:t})}async extend(e,t){await this.http.post(`/internal/session/${encodeURIComponent(e)}/_extend`,{version:Fe,body:JSON.stringify({expires:t})})}delete(e){return this.http.delete(`/internal/session/${encodeURIComponent(e)}`,Me)}}const Ae=k.i18n.translate("data.searchSessionIndicator.noCapability",{defaultMessage:"You don't have permissions to create search sessions."});function Ie(e,{waitForIdle:t=1e3}={waitForIdle:1e3}){return e.state$.pipe((0,l.skipUntil)(e.state$.pipe((0,l.first)((e=>e===_e.Mv.None)))),(0,l.skipUntil)(e.state$.pipe((0,l.first)((e=>e===_e.Mv.Loading)))),(0,l.debounceTime)(t),(0,l.first)((e=>e===_e.Mv.Completed||e===_e.Mv.BackgroundCompleted)))}var we=a(9472),Re=a(2798),ke=a(6215);const xe=__kbnSharedDeps__.KbnSearchErrors,Ne="data_search_timeout",Pe="timeout_ms",Ce="execution_context";var Le=a(4286),De=a.n(Le),Oe=a(1319),qe=a(6791);let Be=function(e){return e[e.CONTACT=0]="CONTACT",e[e.CHANGE=1]="CHANGE",e}({});class SearchTimeoutError extends te.KbnError{constructor(e,t){super(`Request timeout: ${JSON.stringify(null==e?void 0:e.message)}`),(0,r.default)(this,"mode",void 0),this.mode=t}getMessage(){switch(this.mode){case Be.CONTACT:return k.i18n.translate("data.search.timeoutContactAdmin",{defaultMessage:"Your query has timed out. Contact your system administrator to increase the run time."});case Be.CHANGE:return k.i18n.translate("data.search.timeoutIncreaseSetting",{defaultMessage:"Your query has timed out. Increase run time with the search timeout advanced setting."})}}getActionText(){if(this.mode===Be.CHANGE)return k.i18n.translate("data.search.timeoutIncreaseSettingActionText",{defaultMessage:"Edit setting"})}onClick(e){this.mode===Be.CHANGE&&e.navigateToApp("management",{path:"/kibana/settings"})}getErrorMessage(e){const t=this.getActionText();return(0,qe.jsx)(De().Fragment,null,this.getMessage(),t&&(0,qe.jsx)(De().Fragment,null,(0,qe.jsx)(Oe.EuiSpacer,{size:"s"}),(0,qe.jsx)(Oe.EuiText,{textAlign:"right"},(0,qe.jsx)(Oe.EuiButton,{color:"danger",onClick:()=>this.onClick(e),size:"s","data-test-subj":"searchTimeoutError"},t))))}}var je=a(5879);function Ue(e){const{rawResponse:t}=e,{_clusters:a}=t;if(a){const s=Object.fromEntries(Object.keys(a.details).map((e=>[e,"running"!==a.details[e].status?a.details[e]:{...a.details[e],status:"partial",timed_out:!0}])));return{...e,isRunning:!1,rawResponse:{...t,timed_out:!0,_clusters:{...a,details:s}}}}return{...e,isRunning:!1,rawResponse:{...t,timed_out:!0}}}class SearchResponseCache{constructor(e,t){(0,r.default)(this,"responseCache",void 0),(0,r.default)(this,"cacheSize",0),this.maxItems=e,this.maxCacheSizeMB=t,this.responseCache=new Map}byteToMb(e){return e/1048576}deleteItem(e,t=!0){const a=this.responseCache.get(e);a&&(t&&a.subs.unsubscribe(),this.cacheSize-=a.size,this.responseCache.delete(e))}setItem(e,t){this.deleteItem(e,!1),this.cacheSize+=t.size,this.responseCache.set(e,t)}clear(){this.cacheSize=0,this.responseCache.forEach((e=>{e.subs.unsubscribe()})),this.responseCache.clear()}shrink(){for(;this.responseCache.size>this.maxItems||this.byteToMb(this.cacheSize)>this.maxCacheSizeMB;){const[e]=[...this.responseCache.keys()];this.deleteItem(e)}}has(e){return this.responseCache.has(e)}set(e,t){if(this.responseCache.has(e))throw new Error("duplicate key");const{response$:a,searchAbortController:s}=t,r={response$:a,searchAbortController:s,subs:new l.Subscription,size:0};this.setItem(e,r),r.subs.add(a.subscribe({next:t=>{const a=new Blob([JSON.stringify(t)]).size;this.byteToMb(a)<this.maxCacheSizeMB?(this.setItem(e,{...r,size:a}),this.shrink()):this.deleteItem(e)},error:t=>{this.deleteItem(e)}})),this.shrink()}get(e){const t=this.responseCache.get(e);if(t)return this.setItem(e,t),{response$:t.response$,searchAbortController:t.searchAbortController}}}let Ge=function(e){return e.Timeout="timeout",e}({});class SearchAbortController{constructor(e){(0,r.default)(this,"inputAbortSignals",new Array),(0,r.default)(this,"abortController",new AbortController),(0,r.default)(this,"timeoutSub",void 0),(0,r.default)(this,"destroyed",!1),(0,r.default)(this,"reason",void 0),(0,r.default)(this,"abortHandler",(()=>{this.inputAbortSignals.every((e=>e.aborted))&&(this.abortController.abort(),this.cleanup())})),e&&(this.timeoutSub=(0,l.timer)(e).subscribe((()=>{this.reason=Ge.Timeout,this.abortController.abort(),this.timeoutSub.unsubscribe()})))}cleanup(){var e;this.destroyed||(this.destroyed=!0,null===(e=this.timeoutSub)||void 0===e||e.unsubscribe(),this.inputAbortSignals.forEach((e=>{e.removeEventListener("abort",this.abortHandler)})))}addAbortSignal(e){this.destroyed||(this.inputAbortSignals.push(e),e.aborted?this.abortHandler():e.addEventListener("abort",this.abortHandler))}getSignal(){return this.abortController.signal}abort(){this.cleanup(),this.abortController.abort()}isTimeout(){return this.reason===Ge.Timeout}}const ze=__kbnSharedDeps__.KbnCryptoBrowser;var $e=a(9457),Ve=a.n($e),Ke=a(3721);class SearchInterceptor{constructor(e){(0,r.default)(this,"uiSettingsSubs",[]),(0,r.default)(this,"searchTimeout",void 0),(0,r.default)(this,"responseCache",new SearchResponseCache(50,10)),(0,r.default)(this,"pendingCount$",new l.BehaviorSubject(0)),(0,r.default)(this,"application",void 0),(0,r.default)(this,"docLinks",void 0),(0,r.default)(this,"inspector",void 0),(0,r.default)(this,"startRenderServices",void 0),(0,r.default)(this,"showTimeoutErrorToast",((e,t)=>{this.deps.toasts.addDanger({title:"Timed out",text:(0,ke.Pv)(e.getErrorMessage(this.application),this.startRenderServices)})})),(0,r.default)(this,"showTimeoutErrorMemoized",(0,i.memoize)(this.showTimeoutErrorToast,((e,t)=>t))),(0,r.default)(this,"showRestoreWarningToast",(e=>{var t;this.deps.toasts.addWarning({title:"Your search session is still running",text:(0,ke.Pv)((t=this.docLinks,(0,qe.jsx)(De().Fragment,null,(0,qe.jsx)(Oe.EuiSpacer,{size:"s"}),"It needs more time to fully render. You can wait here or come back to it later.",(0,qe.jsx)(Oe.EuiSpacer,{size:"m"}),(0,qe.jsx)(Oe.EuiText,{textAlign:"right"},(0,qe.jsx)(Oe.EuiLink,{href:t.links.search.sessionLimits,color:"warning",target:"_blank","data-test-subj":"searchSessionIncompleteWarning",external:!0},(0,qe.jsx)(je.FormattedMessage,{id:"data.searchSession.warning.readDocs",defaultMessage:"Read More"}))))),this.startRenderServices)},{toastLifeTimeMs:6e4})})),(0,r.default)(this,"showRestoreWarning",(0,i.memoize)(this.showRestoreWarningToast)),(0,r.default)(this,"showTimeoutError",((e,t)=>{t?this.showTimeoutErrorMemoized(e,t):this.showTimeoutErrorToast(e,t)})),this.deps=e,this.deps.http.addLoadingCountSource(this.pendingCount$),this.deps.startServices.then((([e,t])=>{const{application:a,docLinks:s,...r}=e;this.application=a,this.docLinks=s,this.startRenderServices=r,this.inspector=t.inspector})),this.searchTimeout=e.uiSettings.get(s.UI_SETTINGS.SEARCH_TIMEOUT),this.uiSettingsSubs.push(e.uiSettings.get$(s.UI_SETTINGS.SEARCH_TIMEOUT).subscribe((e=>{this.searchTimeout=e})))}stop(){this.responseCache.clear(),this.uiSettingsSubs.forEach((e=>e.unsubscribe()))}getTimeoutMode(){var e;return null!==(e=this.application.capabilities.advancedSettings)&&void 0!==e&&e.save?Be.CHANGE:Be.CONTACT}createRequestHash$(e,t){const{sessionId:a}=t,{preference:s,...r}=e.params||{},i={...r,sessionId:a};if(!a)return(0,l.of)(void 0);const n=this.deps.session.getSearchOptions(t.sessionId);return null!=n&&n.isRestore?(0,l.of)(void 0):(0,l.from)(async function(e){return(new ze.Sha256).update(Ve()(e),"utf8").digest("hex")}(i))}handleSearchError(e,t,a,s){if(s||"Request timed out"===e.message){const t=new SearchTimeoutError(e,this.getTimeoutMode());return this.showTimeoutError(t,null==a?void 0:a.sessionId),t}if(e instanceof z.AbortError)return e;if((0,xe.isEsError)(e)){const s=()=>{var s,r,i,n,l;const o=null!==(s=null==a||null===(r=a.inspector)||void 0===r?void 0:r.id)&&void 0!==s?s:(0,we.v4)(),g=null!==(i=null==a||null===(n=a.inspector)||void 0===n?void 0:n.adapter)&&void 0!==i?i:new Re.RequestAdapter;if(null==a||null===(l=a.inspector)||void 0===l||!l.adapter){const a=g.start(k.i18n.translate("data.searchService.anonymousRequestTitle",{defaultMessage:"Request"}),{id:o});a.json(t),a.error({json:e.attributes})}this.inspector.open({requests:g},{options:{initialRequestId:o,initialTabs:["clusters","response"]}})};return(0,xe.createEsError)(e,s,{application:this.application,docLinks:this.docLinks},null==a?void 0:a.indexPattern)}return e instanceof Error?e:new Error(e.message)}getSerializableOptions(e){const{sessionId:t,...a}=e||{},s={},r={...a,...this.deps.session.getSearchOptions(t)};return void 0!==r.sessionId&&(s.sessionId=r.sessionId),void 0!==r.isRestore&&(s.isRestore=r.isRestore),void 0!==r.retrieveResults&&(s.retrieveResults=r.retrieveResults),void 0!==r.legacyHitsTotal&&(s.legacyHitsTotal=r.legacyHitsTotal),void 0!==r.strategy&&(s.strategy=r.strategy),void 0!==r.isStored&&(s.isStored=r.isStored),void 0!==r.isSearchStored&&(s.isSearchStored=r.isSearchStored),void 0!==r.executionContext&&(s.executionContext=r.executionContext),s}runSearch$({id:e,...t},a,r){const{sessionId:n,strategy:o}=a,g=()=>{var s;const[{isSearchStored:i},l]=null!==(s=null==u?void 0:u.beforePoll())&&void 0!==s?s:[{isSearchStored:!1},()=>{}];return this.runSearch({id:e,...t},{...a,...this.deps.session.getSearchOptions(n),abortSignal:r.getSignal(),isSearchStored:i}).then((e=>{var t;return l({isSearchStored:null!==(t=e.isStored)&&void 0!==t&&t}),e})).catch((e=>{throw l({isSearchStored:!1}),e}))},u=this.deps.session.isCurrentSession(n)?this.deps.session.trackSearch({abort:()=>r.abort(),poll:async()=>{e&&await g()}}):void 0;let d=this.deps.session.isCurrentSession(n)&&this.deps.session.isStored();const c=this.deps.session.isCurrentSession(n)&&this.deps.session.state$.pipe((0,l.skip)(1),(0,l.filter)((e=>this.deps.session.isCurrentSession(n)&&e===_e.Mv.BackgroundLoading)),(0,l.take)(1)).subscribe((()=>{d=!0})),h=(0,i.once)((()=>this.deps.http.delete(`/internal/search/${o}/${e}`,{version:"1"}))),p=async()=>{if(e&&!d&&!r.isTimeout())try{await h()}catch(e){Ke.error(e)}};let m;return(0,s.pollSearch)(g,p,{pollInterval:this.deps.searchConfig.asyncSearch.pollInterval,...a,abortSignal:r.getSignal()}).pipe((0,l.tap)((t=>{!m&&t.requestParams&&(m=t.requestParams),e=t.id,(0,s.isRunningResponse)(t)||null==u||u.complete()})),(0,l.map)((e=>m?{...e,requestParams:m}:e)),(0,l.catchError)((s=>r.isTimeout()?(this.startRenderServices.analytics.reportEvent(Ne,{[Pe]:this.searchTimeout,[Ce]:a.executionContext}),(0,l.from)(this.runSearch({id:e,...t},{...a,retrieveResults:!0})).pipe((0,l.map)(Ue),(0,l.tap)((async()=>{var e,r;await h(),this.handleSearchError(s,null!==(e=null==t||null===(r=t.params)||void 0===r?void 0:r.body)&&void 0!==e?e:{},a,!0)})))):(null==u||u.error(),p(),(0,l.throwError)(s)))),(0,l.finalize)((()=>{r.cleanup(),c&&c.unsubscribe()})),(0,l.shareReplay)(1))}runSearch(e,t){const{abortSignal:a}=t||{},{executionContext:r,strategy:i,...n}=this.getSerializableOptions(t);return this.deps.http.post(`/internal/search/${i}${e.id?`/${e.id}`:""}`,{version:"1",signal:a,context:this.deps.executionContext.withGlobalContext(r),body:JSON.stringify({...e,...n,stream:i===s.ESQL_ASYNC_SEARCH_STRATEGY||i===s.ENHANCED_ES_SEARCH_STRATEGY||void 0===i}),asResponse:!0}).then((e=>{var t,a,r,l;const o=null===(t=e.response)||void 0===t?void 0:t.headers.get("warning"),g=e.body&&"requestParams"in e.body?e.body.requestParams:JSON.parse((null===(a=e.response)||void 0===a?void 0:a.headers.get("kbn-search-request-params"))||"{}"),u=e.body&&"isRestored"in e.body?e.body.isRestored:"?1"===(null===(r=e.response)||void 0===r?void 0:r.headers.get("kbn-search-is-restored"));if(e.body&&"error"in e.body)throw{attributes:{error:e.body.error,rawResponse:e.body,requestParams:g,isRestored:u}};switch(i){case s.ENHANCED_ES_SEARCH_STRATEGY:if(null!==(l=e.body)&&void 0!==l&&l.rawResponse)return e.body;const t=e.body,a=(0,s.shimHitsTotal)(t.response,{legacyHitsTotal:n.legacyHitsTotal});return{id:t.id,isPartial:t.is_partial,isRunning:t.is_running,rawResponse:a,warning:o,requestParams:g,isRestored:u,...(0,s.getTotalLoaded)(a)};case s.ESQL_ASYNC_SEARCH_STRATEGY:const r=e.body;return{id:r.id,rawResponse:r,isPartial:r.is_partial,isRunning:r.is_running,warning:o};default:return e.body}})).catch((e=>{throw null!=e&&e.body?e.body:e}))}getSearchResponse$(e,t,a){var s;const r=a?this.responseCache.get(a):void 0,i=(null==r?void 0:r.searchAbortController)||new SearchAbortController(this.searchTimeout);i.addAbortSignal(null!==(s=t.abortSignal)&&void 0!==s?s:(new AbortController).signal);const n=(null==r?void 0:r.response$)||this.runSearch$(e,t,i);return a&&!this.responseCache.has(a)&&this.responseCache.set(a,{response$:n,searchAbortController:i}),{response$:n,searchAbortController:i}}search({id:e,...t},a={}){const r={...a};r.strategy||(r.strategy=s.ENHANCED_ES_SEARCH_STRATEGY);const{sessionId:i,abortSignal:n}=r;return this.createRequestHash$(t,r).pipe((0,l.switchMap)((e=>{const{searchAbortController:a,response$:s}=this.getSearchResponse$(t,r,e);this.pendingCount$.next(this.pendingCount$.getValue()+1);const o=(n?(0,l.fromEvent)(n,"abort"):l.EMPTY).pipe((0,l.map)((()=>{throw new z.AbortError})));return s.pipe((0,l.takeUntil)(o),(0,l.catchError)((e=>{var s,i;return(0,l.throwError)(this.handleSearchError(e,null!==(s=null==t||null===(i=t.params)||void 0===i?void 0:i.body)&&void 0!==s?s:{},r,a.isTimeout()))})),(0,l.tap)((e=>{i&&i===this.deps.session.getSessionId()&&this.deps.session.isRestore()&&!1===e.isRestored&&this.showRestoreWarning(i)})),(0,l.finalize)((()=>{this.pendingCount$.next(this.pendingCount$.getValue()-1)})))})))}showError(e){if(e instanceof z.AbortError||e instanceof SearchTimeoutError)return;const t=(0,xe.renderSearchError)(e);t?this.deps.toasts.addDanger({title:t.title,text:(0,ke.Pv)(t.body,this.startRenderServices)}):this.deps.toasts.addError(e,{title:"Search Error"})}}const He=k.i18n.translate("searchResponseWarnings.viewDetailsButtonLabel",{defaultMessage:"View details",description:"View warning details button label"});function Ye(e){const t=new Set;return e.forEach((e=>{Object.keys(e.clusters).forEach((a=>{"successful"!==e.clusters[a].status&&t.add(a)}))})),t}function Qe(e){const t=Ye(e),a=k.i18n.translate("searchResponseWarnings.title.clustersClause",{defaultMessage:"Problem with {nonSuccessfulClustersCount} {nonSuccessfulClustersCount, plural, one {cluster} other {clusters}}",values:{nonSuccessfulClustersCount:t.size}});return e.length<=1?a:k.i18n.translate("searchResponseWarnings.title.clustersClauseAndRequestsClause",{defaultMessage:"{clustersClause} in {requestsCount} requests",values:{clustersClause:a,requestsCount:e.length}})}function We(e){return Ye(e).size<=1?k.i18n.translate("searchResponseWarnings.description.singleCluster",{defaultMessage:"This cluster had issues returning data and results might be incomplete."}):k.i18n.translate("searchResponseWarnings.description.multipleClusters",{defaultMessage:"These clusters had issues returning data and results might be incomplete."})}function Je({callback:e,request:t,requestId:a,requestName:s,requestAdapter:r,response:i,services:n}){const l=function(e,t,a,s,r){const i=[];var n;return(e._clusters?e._clusters.partial>0||e._clusters.skipped>0||e._clusters.running>0:"timed_out"in e&&e.timed_out||"_shards"in e&&e._shards.failed>0)&&i.push({type:"incomplete",requestName:s,clusters:e._clusters?null!==(n=e._clusters.details)&&void 0!==n?n:{}:{"(local)":{status:"partial",indices:"",took:e.took,timed_out:"timed_out"in e&&e.timed_out,..."_shards"in e?{_shards:e._shards,failures:e._shards.failures}:{}}},openInInspector:()=>{t.open({requests:a},{options:{initialRequestId:r,initialTabs:["clusters","response"]}})}}),i}(i,n.inspector,r,s,a);if(0===l.length)return;const o=e?function(e,t,a,s,r){const i=[];return e.forEach((e=>{(null==t?void 0:t(e,{requestId:r,request:a,response:s}))||i.push(e)})),i}(l,e,t,i,a):l;if(0===o.length)return;const g=o.filter((e=>"incomplete"===e.type));if(0===g.length)return;const[u]=g;n.notifications.toasts.addWarning({title:Qe([u]),text:(0,ke.Pv)((0,qe.jsx)(De().Fragment,null,(0,qe.jsx)(Oe.EuiText,{size:"s"},We([u])),(0,qe.jsx)(Oe.EuiButtonEmpty,{color:"primary",flush:"left",onClick:()=>{u.openInInspector()},"data-test-subj":"viewWarningBtn"},He)),n)})}var Xe=a(8887),Ze=a(4882),et=a(6721),tt=a(2607);class AggsService{constructor(){(0,r.default)(this,"aggsCommonService",new tt.fXy({shouldDetectTimeZone:!0})),(0,r.default)(this,"getConfig",void 0),(0,r.default)(this,"subscriptions",[]),(0,r.default)(this,"nowProvider",void 0),(0,r.default)(this,"calculateBounds",(e=>(0,s.calculateBounds)(e,{forceNow:this.nowProvider.get()})))}setup({registerFunction:e,uiSettings:t,nowProvider:a}){return this.nowProvider=a,this.getConfig=function(e,t,a){const s={};return t.forEach((t=>{a.push(e.get$(t).subscribe((e=>{s[t]=e})))})),e=>s[e]}(t,tt.PX$,this.subscriptions),this.aggsCommonService.setup({registerFunction:e})}start({indexPatterns:e,fieldFormats:t}){const{calculateAutoTimeExpression:a,types:s,createAggConfigs:r}=this.aggsCommonService.start({getConfig:this.getConfig,getIndexPattern:e.get,calculateBounds:this.calculateBounds,fieldFormats:t});return{calculateAutoTimeExpression:a,createAggConfigs:r,types:s}}stop(){this.subscriptions.forEach((e=>e.unsubscribe())),this.subscriptions=[]}}const at=__kbnSharedDeps__.KbnAnalytics;let st=function(e){return e.QUERY_TIMED_OUT="queryTimedOut",e.SESSION_INDICATOR_TOUR_LOADING="sessionIndicatorTourLoading",e.SESSION_INDICATOR_TOUR_RESTORED="sessionIndicatorTourRestored",e.SESSION_INDICATOR_SAVE_DISABLED="sessionIndicatorSaveDisabled",e.SESSION_SENT_TO_BACKGROUND="sessionSentToBackground",e.SESSION_SAVED_RESULTS="sessionSavedResults",e.SESSION_VIEW_RESTORED="sessionViewRestored",e.SESSION_IS_RESTORED="sessionIsRestored",e.SESSION_RELOADED="sessionReloaded",e.SESSION_EXTENDED="sessionExtended",e.SESSION_CANCELLED="sessionCancelled",e.SESSION_DELETED="sessionDeleted",e.SESSION_VIEW_LIST="sessionViewList",e.SESSIONS_LIST_LOADED="sessionsListLoaded",e}({});var rt=a(3856),it=a(7880),nt=a(7005),lt=a(3185);const ot=()=>(0,qe.jsx)(Oe.EuiDelayRender,null,(0,qe.jsx)(Oe.EuiLoadingSpinner,null)),gt=De().lazy((()=>a.e(677).then(a.bind(a,4677)))),ut=De().forwardRef(((e,t)=>(0,qe.jsx)(De().Suspense,{fallback:(0,qe.jsx)(ot,null)},(0,qe.jsx)(gt,(0,lt.default)({},e,{ref:t}))))),dt="data.searchSession.tour.takingTooLong",ct="data.searchSession.tour.restore";function ht(e,t){try{return Boolean(e.get(t))}catch(e){return!0}}function pt(e,t){try{e.set(t,!0)}catch(e){return!0}}const mt=({sessionService:e,application:t,storage:a,usageCollector:s,basePath:r,tourDisabled:n})=>{const o=r.prepend("/app/management/kibana/search_sessions"),g=e.state$.pipe((0,l.debounce)((e=>(0,l.timer)(e===_e.Mv.None?50:300))));return()=>{const r=(0,it.A)(g,_e.Mv.None),l=e.getSearchSessionIndicatorUiConfig().isDisabled(),u=(0,it.A)(e.disableSaveAfterSearchesExpire$,!1),[d,c]=(0,Le.useState)(null),h=(0,Le.useCallback)((e=>{null!==e&&c(e)}),[]);let p=!1,m="",f=!1,y="";u&&(p=!0,m=k.i18n.translate("data.searchSessionIndicator.disabledDueToTimeoutMessage",{defaultMessage:"Search session results expired."})),l.disabled&&(p=!0,m=l.reasonText),e.hasAccess()||(f=p=!0,y=m=k.i18n.translate("data.searchSessionIndicator.disabledDueToDisabledGloballyMessage",{defaultMessage:"You don't have permissions to manage search sessions"}));const{markOpenedDone:b,markRestoredDone:v}=function(e,t,a,s,r,n){const l=(0,Le.useCallback)((()=>{pt(e,dt)}),[e]),o=(0,Le.useCallback)((()=>{pt(e,ct)}),[e]),g=(0,Le.useCallback)((0,i.once)((()=>null==n?void 0:n.trackSessionIndicatorTourLoading())),[n,a]),u=(0,Le.useCallback)((0,i.once)((()=>null==n?void 0:n.trackSessionIndicatorTourRestored())),[n,a]);return(0,Le.useEffect)((()=>{if(s)return;if(r)return;if(!t)return;let i;return a===_e.Mv.Loading&&(ht(e,dt)||(i=window.setTimeout((()=>{g(),t.openPopover()}),1e4))),a===_e.Mv.Restored&&(ht(e,ct)||(u(),t.openPopover())),()=>{clearTimeout(i)}}),[e,t,a,s,r,l,o,n,u,g]),{markOpenedDone:l,markRestoredDone:o}}(a,d,r,p,n,s),S=(0,Le.useCallback)((e=>{b(),e===_e.Mv.Restored&&v()}),[b,v]),_=(0,Le.useCallback)((()=>{p||(null==s||s.trackSessionSentToBackground(),e.save())}),[p]),T=(0,Le.useCallback)((()=>{p||(null==s||s.trackSessionSavedResults(),e.save())}),[p]),E=(0,Le.useCallback)((()=>{null==s||s.trackSessionCancelled(),e.cancel()}),[]),F=(0,Le.useCallback)((()=>{null==s||s.trackViewSessionsList()}),[]);(0,Le.useEffect)((()=>{r===_e.Mv.Restored&&(null==s||s.trackSessionIsRestored())}),[r]);const{name:M,startTime:A,completedTime:I,canceledTime:w}=(0,it.A)(e.sessionMeta$,{state:r,isContinued:!1}),R=(0,Le.useCallback)((async t=>{await e.renameCurrentSession(t)}),[]);return e.isSessionStorageReady()?(0,qe.jsx)(nt.V,{coreStart:{application:t}},(0,qe.jsx)(ut,{ref:h,state:r,saveDisabled:p,saveDisabledReasonText:m,managementDisabled:f,managementDisabledReasonText:y,onContinueInBackground:_,onSaveResults:T,onCancel:E,onOpened:S,onViewSearchSessions:F,viewSearchSessionsLink:o,searchSessionName:M,saveSearchSessionNameFn:R,startedTime:A,completedTime:I,canceledTime:w})):null}};class SearchService{constructor(e){(0,r.default)(this,"aggsService",new AggsService),(0,r.default)(this,"searchSourceService",new ye.zA1),(0,r.default)(this,"searchInterceptor",void 0),(0,r.default)(this,"usageCollector",void 0),(0,r.default)(this,"sessionService",void 0),(0,r.default)(this,"sessionsClient",void 0),this.initializerContext=e}setup(e,{expressions:t,usageCollection:a,nowProvider:s,management:r}){const{http:n,getStartServices:o,notifications:g,uiSettings:u,executionContext:d}=e;this.usageCollector=((e,t)=>{const a=(a,s)=>async()=>{const r=await(async()=>{const[{application:t}]=await e();return t.currentAppId$.pipe((0,l.first)()).toPromise()})();return null==t?void 0:t.reportUiCounter(r,a,s)};return{trackQueryTimedOut:a(at.METRIC_TYPE.LOADED,st.QUERY_TIMED_OUT),trackSessionIndicatorTourLoading:a(at.METRIC_TYPE.LOADED,st.SESSION_INDICATOR_TOUR_LOADING),trackSessionIndicatorTourRestored:a(at.METRIC_TYPE.LOADED,st.SESSION_INDICATOR_TOUR_RESTORED),trackSessionIndicatorSaveDisabled:a(at.METRIC_TYPE.LOADED,st.SESSION_INDICATOR_SAVE_DISABLED),trackSessionSentToBackground:a(at.METRIC_TYPE.CLICK,st.SESSION_SENT_TO_BACKGROUND),trackSessionSavedResults:a(at.METRIC_TYPE.CLICK,st.SESSION_SAVED_RESULTS),trackSessionViewRestored:a(at.METRIC_TYPE.CLICK,st.SESSION_VIEW_RESTORED),trackSessionIsRestored:a(at.METRIC_TYPE.CLICK,st.SESSION_IS_RESTORED),trackSessionReloaded:a(at.METRIC_TYPE.CLICK,st.SESSION_RELOADED),trackSessionExtended:a(at.METRIC_TYPE.CLICK,st.SESSION_EXTENDED),trackSessionCancelled:a(at.METRIC_TYPE.CLICK,st.SESSION_CANCELLED),trackSessionDeleted:a(at.METRIC_TYPE.CLICK,st.SESSION_DELETED),trackViewSessionsList:a(at.METRIC_TYPE.CLICK,st.SESSION_VIEW_LIST),trackSessionsListLoaded:a(at.METRIC_TYPE.LOADED,st.SESSIONS_LIST_LOADED)}})(o,a),this.sessionsClient=new SessionsClient({http:n}),this.sessionService=new SessionService(this.initializerContext,o,this.sessionsClient,s,this.usageCollector),this.searchInterceptor=new SearchInterceptor({toasts:g.toasts,executionContext:d,http:n,uiSettings:u,startServices:o(),usageCollector:this.usageCollector,session:this.sessionService,searchConfig:this.initializerContext.config.get().search}),t.registerFunction(ce({getStartServices:o})),t.registerFunction(ye.L1),t.registerFunction(ye.dtO),t.registerFunction(ye.Muh),t.registerFunction(ye.BUn),t.registerFunction(ye.eYm),t.registerFunction(ye.rDs),t.registerFunction(ye.bOY),t.registerFunction(ye.hnj),t.registerFunction(ye.JW4),t.registerFunction(ye.rgn),t.registerFunction(ye.wcW),t.registerFunction(ye.TU9),t.registerFunction(ye.aw$),t.registerFunction(ye.EM$),t.registerFunction(ye.JjL),t.registerFunction(ye.rk1),t.registerFunction(ye.PFs),t.registerFunction(ye.c$p),t.registerFunction(ye.LSk),t.registerFunction(ye.XIV),t.registerFunction(ye.SvO),t.registerFunction(function({getStartServices:e}){return(0,he.u)({getStartDependencies:async()=>{const[t,,{search:a}]=await e();return{uiSettingsClient:t.uiSettings,search:a.search}}})}({getStartServices:o})),t.registerFunction(function({getStartServices:e}){return(({getStartDependencies:e})=>{const t={name:"essql",type:"datatable",inputTypes:["kibana_context","null"],allowCache:!0,help:k.i18n.translate("data.search.essql.help",{defaultMessage:"Queries Elasticsearch using Elasticsearch SQL."}),args:{query:{aliases:["_","q"],types:["string"],help:k.i18n.translate("data.search.essql.query.help",{defaultMessage:"An Elasticsearch SQL query."})},parameter:{aliases:["param"],types:["string","number","boolean"],multi:!0,help:k.i18n.translate("data.search.essql.parameter.help",{defaultMessage:"A parameter to be passed to the SQL query."})},count:{types:["number"],help:k.i18n.translate("data.search.essql.count.help",{defaultMessage:"The number of documents to retrieve. For better performance, use a smaller data set."}),default:1e3},timezone:{aliases:["tz"],types:["string"],default:"UTC",help:k.i18n.translate("data.search.essql.timezone.help",{defaultMessage:"The timezone to use for date operations. Valid ISO8601 formats and UTC offsets both work."})},timeField:{aliases:["timeField"],types:["string"],help:k.i18n.translate("data.search.essql.timeField.help",{defaultMessage:"The time field to use in the time range filter set in the context."})}},fn:(t,{count:a,parameter:s,query:r,timeField:n,timezone:o},{abortSignal:g,inspectorAdapters:u,getKibanaRequest:d})=>(0,l.defer)((()=>e((()=>{const e=null==d?void 0:d();if(!e)throw new Error("A KibanaRequest is required to run queries on the server. Please provide a request object to the expression execution params.");return e})))).pipe((0,l.switchMap)((({nowProvider:e,search:i,uiSettings:d})=>{const h={query:r,fetch_size:a,time_zone:o,params:s,field_multi_value_leniency:!0};if(t){var p;const a=(0,me.F)(d),s=t.timeRange&&(0,fe.WB)(void 0,t.timeRange,{fieldName:n,forceNow:null==e?void 0:e.get()});h.filter=(0,c.buildEsQuery)(void 0,t.query||[],[...null!==(p=t.filters)&&void 0!==p?p:[],...s?[s]:[]],a)}let m=Date.now();const f=()=>{u.requests||(u.requests=new pe.RequestAdapter);const e=u.requests.start(k.i18n.translate("data.search.dataRequest.title",{defaultMessage:"Data"}),{description:k.i18n.translate("data.search.es_search.dataRequest.description",{defaultMessage:"This request queries Elasticsearch to fetch the data for the visualization."})},m);return m=Date.now(),e};return i({params:h},{abortSignal:g,strategy:ye.UNd}).pipe((0,l.catchError)((e=>{if(e.attributes){const{type:t,reason:a}=e.attributes;e.message="parsing_exception"===t?`Couldn't parse Elasticsearch SQL query. You may need to add double quotes to names containing special characters. Check your query and try again. Error: ${a}`:`Unexpected error from Elasticsearch: ${t} - ${a}`}else e.message=`Unexpected error from Elasticsearch: ${e.message}`;return(0,l.throwError)((()=>e))})),(0,l.tap)({next({rawResponse:e,requestParams:t,took:a}){f().stats({hits:{label:k.i18n.translate("data.search.es_search.hitsLabel",{defaultMessage:"Hits"}),value:`${e.rows.length}`,description:k.i18n.translate("data.search.es_search.hitsDescription",{defaultMessage:"The number of documents returned by the query."})},queryTime:{label:k.i18n.translate("data.search.es_search.queryTimeLabel",{defaultMessage:"Query time"}),value:k.i18n.translate("data.search.es_search.queryTimeValue",{defaultMessage:"{queryTime}ms",values:{queryTime:a}}),description:k.i18n.translate("data.search.es_search.queryTimeDescription",{defaultMessage:"The time it took to process the query. Does not include the time to send the request or parse it in the browser."})}}).json(h).ok({json:e,requestParams:t})},error(e){f().error({json:"attributes"in e?e.attributes:{message:e.message}})}}))})),(0,l.map)((({rawResponse:e})=>{var t,a;const s=null!==(t=null===(a=e.columns)||void 0===a?void 0:a.map((({name:e,type:t})=>({id:be(e),name:be(e),meta:{type:(0,w.s0)(t)}}))))&&void 0!==t?t:[],r=s.map((({name:e})=>e));return{type:"datatable",meta:{type:"essql"},columns:s,rows:e.rows.map((e=>(0,i.zipObject)(r,e)))}})))};return t})({async getStartDependencies(){const[{uiSettings:t},,{nowProvider:a,search:{search:s}}]=await e();return{nowProvider:a,search:s,uiSettings:t}}})}({getStartServices:o})),t.registerFunction(function({getStartServices:e}){return(0,ve.y)({async getStartDependencies(){const[{uiSettings:t},,{nowProvider:a,search:{search:s}}]=await e();return{nowProvider:a,search:s,uiSettings:t}}})}({getStartServices:o})),t.registerFunction(function({getStartServices:e}){return(0,Se.l)({getStartDependencies:async()=>{const[t,,{search:a,indexPatterns:s}]=await e();return{uiSettingsClient:t.uiSettings,search:a.search,dataViews:s}}})}({getStartServices:o})),t.registerType(ye.uzQ),t.registerType(ye.iLg);const h=this.aggsService.setup({uiSettings:u,registerFunction:t.registerFunction,nowProvider:s});this.initializerContext.config.get().search.aggs.shardDelay.enabled&&(h.types.registerBucket(Ze.v,Ze.V),t.registerFunction(et.H));const p=this.initializerContext.config.get();if(p.search.sessions.enabled){const t=p.search.sessions;(0,rt._)(e,{searchUsageCollector:this.usageCollector,sessionsClient:this.sessionsClient,management:r},t,this.initializerContext.env.packageInfo.version)}return{aggs:h,usageCollector:this.usageCollector,session:this.sessionService,sessionsClient:this.sessionsClient}}start({http:e,uiSettings:t,chrome:a,application:s,notifications:r,...i},{fieldFormats:n,indexPatterns:o,inspector:g,screenshotMode:u,scriptedFieldsEnabled:d}){const c=(e,t={})=>this.searchInterceptor.search(e,t),h=new l.BehaviorSubject(0);e.addLoadingCountSource(h);const p=this.aggsService.start({fieldFormats:n,indexPatterns:o}),m={inspector:g,notifications:r,...i},f={aggs:p,getConfig:t.get.bind(t),search:c,dataViews:o,onResponse:(e,t,a)=>{if(!a.disableWarningToasts){var s,r,i,n;const{rawResponse:l}=t,o=null!==(s=a.inspector)&&void 0!==s&&s.title?a.inspector.title:k.i18n.translate("data.searchService.anonymousRequestTitle",{defaultMessage:"Request"}),g=null!==(r=a.inspector)&&void 0!==r&&r.adapter?null===(i=a.inspector)||void 0===i?void 0:i.adapter:new Xe.RequestAdapter;if(null===(n=a.inspector)||void 0===n||!n.adapter){const a=g.start(o,{id:e.id});a.json(e.body),a.ok({json:t})}Je({request:e.body,requestAdapter:g,requestId:e.id,requestName:o,response:l,services:m})}return t},scriptedFieldsEnabled:d};return this.initializerContext.config.get().search.sessions.enabled&&a.setBreadcrumbsAppendExtension({content:(0,ke.Pv)(De().createElement(mt({sessionService:this.sessionService,application:s,basePath:e.basePath,storage:new z.Storage(window.localStorage),usageCollector:this.usageCollector,tourDisabled:u.isScreenshotMode()})),i)}),{aggs:p,search:c,showError:e=>{this.searchInterceptor.showError(e)},showWarnings:(e,t)=>{null==e||e.getRequests().forEach((a=>{var s,r;const i=null===(s=a.response)||void 0===s||null===(r=s.json)||void 0===r?void 0:r.rawResponse;i&&Je({callback:t,request:a.json,requestAdapter:e,requestId:a.id,requestName:a.name,response:i,services:m})}))},session:this.sessionService,sessionsClient:this.sessionsClient,searchSource:this.searchSourceService.start(o,f)}}stop(){this.aggsService.stop(),this.searchSourceService.stop(),this.searchInterceptor.stop()}}var ft=a(151);class NowProvider{constructor(){(0,r.default)(this,"nowFromUrl",function(){const e=function(){const e=window.location.href.split("?");return e.length<=1?{}:(0,ft.parse)(e[1],{sort:!1})}().forceNow;if(!e)return;const t=Date.parse(e);if(isNaN(t))throw new Error(`forceNow query parameter, ${e}, can't be parsed by Date.parse`);return new Date(t)}()),(0,r.default)(this,"now",void 0)}get(){return this.nowFromUrl?this.nowFromUrl:this.now?this.now:new Date}set(e){this.now=e}reset(){this.now=void 0}}const yt="FILTER_TRIGGER",bt={id:yt,title:k.i18n.translate("data.triggers.applyFilterTitle",{defaultMessage:"Apply filter"}),description:k.i18n.translate("data.triggers.applyFilterDescription",{defaultMessage:"When kibana filter is applied. Could be a single value or a range filter."})};a(9011);var vt=a(1991);function St(e,t){return`${e}\n${t}`}const _t=async(e,t,a)=>{var s;if(!(e&&e.columns&&e.columns[t]&&e.columns[t].meta&&"esaggs"===e.columns[t].meta.source&&null!==(s=e.columns[t].meta.sourceParams)&&void 0!==s&&s.indexPatternId))return;const r=e.columns[t],{indexPatternId:i,...n}=e.columns[t].meta.sourceParams,l=J().aggs.createAggConfigs(await Q().get(i),[n]).aggs[0];let o=[];const g=a>-1?e.rows[a][r.id]:null;if(null!=g&&l.isFilterable()){if("terms"!==l.type.name&&"multi_terms"!==l.type.name||!l.params.otherBucket)o=l.createFilter(g);else{const s=((e,t,a)=>{if(-1===a)return[];const s=e.rows.filter((s=>e.columns.every(((r,i)=>s[r.id]===e.rows[a][r.id]||i>=t)))).map((a=>a[e.columns[t].id]));return[...new Set(s.filter((e=>{const t="__other__"!==String(e),a="__missing__"!==String(e);return t&&a})))]})(e,t,a);o=l.createFilter(g,{terms:s})}if(o)return Array.isArray(o)||(o=[o]),o}},Tt=async({data:e,negate:t})=>{const a=[];return await Promise.all(e.filter((e=>e)).map((async e=>{const{table:s,column:r,row:i}=e,n=await _t(s,r,i)||[];n&&n.forEach((e=>{t&&(e=(0,c.toggleFilterNegated)(e)),a.push(e)}))}))),n().uniqWith(A(a),((e,t)=>(0,c.compareFilters)(e,t,c.COMPARE_ALL_OPTIONS)))},Et=({data:e,query:t,negate:a})=>{var s;if(!t)return;const r=e.filter((e=>{var t,a,s,r;return e&&"date"!==(null===(t=e.table)||void 0===t||null===(a=t.columns)||void 0===a||null===(s=a[e.column])||void 0===s||null===(r=s.meta)||void 0===r?void 0:r.type)}));if(!r.length)return;const{table:i,column:n,row:l}=r[r.length-1];if(null!=i&&null!==(s=i.columns)&&void 0!==s&&s[n]){var o;const e=i.columns[n],s=l>-1?i.rows[l][e.id]:null;if(null==s)return;return function(e,t,a,s,r){if(Array.isArray(a))return;let i;switch(s){case"is_not_null":i=" is not null";break;case"is_null":i=" is null";break;case"-":i="!=";break;default:i="=="}let n="string"==typeof a?`"${a.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')}"`:a,l=`\`${t.replace(/`/g,"``")}\``;"string"!==r&&"number"!==r&&"boolean"!==r&&(l=`${l}::string`),"is_not_null"!==s&&"is_null"!==s||(l=`\`${String(t)}\``,n="");const{ast:o}=(0,vt.getAstAndSyntaxErrors)(e);if("where"===o[o.length-1].name){const a=o[o.length-1].text;if(a.includes(t)&&a.includes(String(n))){const a=e.split("|"),s=a[a.length-1].match(new RegExp(t+"(.*)"+String(n)));if(s){var g;const t=null===(g=s[1])||void 0===g?void 0:g.trim().replace("`","").toLowerCase();if(!["==","!=","is not null","is null"].includes(t.trim()))return St(e,`and ${l}${i}${n}`);if(t===i.trim())return e;{const a=s[0].trim(),r=a.replace(t,i);return e.replace(a,r)}}}return St(e,`AND ${l}${i}${n}`)}return St(e,`| WHERE ${l}${i}${n}`)}(t.esql,e.name,s,a?"-":"+",null===(o=e.meta)||void 0===o?void 0:o.type)}};async function Ft(e){const t=e.table.columns[e.column];if(!t||!t.meta)return[];const{field:a,indexPattern:s}=await(async e=>{const t=e.table.columns[e.column];var a,s,r;if((0,c.isOfAggregateQueryType)(e.query))return{field:new ue.DataViewField({name:t.name,type:null!==(a=null===(s=t.meta)||void 0===s?void 0:s.type)&&void 0!==a?a:"unknown",esTypes:null!==(r=t.meta)&&void 0!==r&&r.esType?[t.meta.esType]:void 0,searchable:!0,aggregatable:!1}),indexPattern:void 0};if(t.meta&&"sourceParams"in t.meta){const{indexPatternId:e,...a}=t.meta.sourceParams,s=await Q().get(e);return{field:J().aggs.createAggConfigs(s,[a]).aggs[0].params.field,indexPattern:s}}return{field:void 0,indexPattern:void 0}})(e);if(!a||e.range.length<=1)return[];const r=e.range[0],n=(0,i.last)(e.range);if(r===n)return[];const l="date"===a.type,o={gte:l?L()(r).toISOString():r,lt:l?L()(n).toISOString():n};return l&&(o.format="strict_date_optional_time"),A([(0,c.buildRangeFilter)(a,o,s)])}const Mt=e=>!!e,At=async({data:e,negate:t})=>{if(!e||0===e.length)return;const a=(await Promise.all(e.map((async e=>{var a;const{table:s,cells:r,relation:n}=e,l=null==s||null===(a=s.meta)||void 0===a?void 0:a.source;if(!l)return;const o=(await Promise.all(r.map((async({column:e,row:t})=>await _t(s,e,t))))).flat().filter(Mt),g=(0,i.uniqWith)(A(o),((e,t)=>(0,c.compareFilters)(e,t,c.COMPARE_ALL_OPTIONS)));if(0===g.length)return;if(1===g.length)return t?[(0,c.toggleFilterNegated)(g[0])]:g;if(!n)return t?g.map((e=>(0,c.toggleFilterNegated)(e))):g;const u=g.every((e=>e.meta.alias))?g.map((e=>e.meta.alias)).join(` ${n} `):"";return(0,c.buildCombinedFilter)(n,g,{id:l},void 0,t,u)})))).flat().filter(Mt);return 0!==a.length?a:void 0};var It=a(3721);const wt="ACTION_SELECT_RANGE";var Rt=a(3721);const kt="ACTION_VALUE_CLICK",xt="ACTION_MULTI_VALUE_CLICK",Nt=(0,Le.lazy)((()=>a.e(325).then(a.bind(a,9325)))),Pt=e=>t=>(0,qe.jsx)(Nt,{adapters:t.adapters,title:t.title,uiSettings:e().uiSettings,fieldFormats:e().fieldFormats,uiActions:e().uiActions,isFilterable:e().isFilterable,options:t.options});class DataPublicPlugin{constructor(e){(0,r.default)(this,"searchService",void 0),(0,r.default)(this,"queryService",void 0),(0,r.default)(this,"storage",void 0),(0,r.default)(this,"nowProvider",void 0),this.searchService=new SearchService(e),this.queryService=new QueryService(e.config.get().query.timefilter.minRefreshInterval),this.storage=new z.Storage(window.localStorage),this.nowProvider=new NowProvider}setup(e,{expressions:t,uiActions:a,usageCollection:r,inspector:i,fieldFormats:n,management:l}){const o=(0,z.createStartServicesGetter)(e.getStartServices);ee(e.theme);const g=this.searchService.setup(e,{usageCollection:r,expressions:t,management:l,nowProvider:this.nowProvider}),u=this.queryService.setup({uiSettings:e.uiSettings,storage:this.storage,nowProvider:this.nowProvider});var d;return a.registerTrigger(bt),i.registerView((d=()=>({uiActions:o().plugins.uiActions,uiSettings:o().core.uiSettings,fieldFormats:o().self.fieldFormats,isFilterable:o().self.datatableUtilities.isFilterable}),{title:k.i18n.translate("data.inspector.table.dataTitle",{defaultMessage:"Data"}),order:10,help:k.i18n.translate("data.inspector.table..dataDescriptionTooltip",{defaultMessage:"View the data behind the visualization"}),shouldShow:e=>Boolean(e.tables),component:Pt(d)})),n.register((0,s.getAggsFormats)((e=>o().plugins.fieldFormats.deserialize(e)))),e.analytics.registerEventType({eventType:Ne,schema:{[Pe]:{type:"long",_meta:{description:"The time (in ms) before the search request was aborted due to timeout (search:timeout advanced setting)"}},[Ce]:{type:"pass_through",_meta:{description:"Execution context of the search request that timed out"}}}}),{search:g,query:u}}start(e,{uiActions:t,fieldFormats:a,dataViews:r,inspector:i,screenshotMode:n}){const{uiSettings:l,overlays:o}=e;Y(o),K(l),W(r);const g=this.queryService.start({storage:this.storage,http:e.http,uiSettings:l}),u=this.searchService.start(e,{fieldFormats:a,indexPatterns:r,inspector:i,screenshotMode:n,scriptedFieldsEnabled:r.scriptedFieldsEnabled});var d;X(u),t.addTriggerAction("SELECT_RANGE_TRIGGER",(d=()=>({uiActions:t}),{type:wt,id:wt,shouldAutoExecute:async()=>!0,execute:async e=>{try{const t=await Ft(e.data);t.length>0&&await d().uiActions.getTrigger(yt).exec({filters:t,embeddable:e.embeddable,timeFieldName:e.data.timeFieldName})}catch(e){It.warn("Error [ACTION_SELECT_RANGE]: can't extract filters from action context")}}})),t.addTriggerAction("VALUE_CLICK_TRIGGER",function(e){return{type:kt,id:kt,shouldAutoExecute:async()=>!0,isCompatible:async e=>e.data.query&&(0,c.isOfAggregateQueryType)(e.data.query)?null!=await Et(e.data):(await Tt(e.data)).length>0,execute:async t=>{try{if(t.data.query&&(0,c.isOfAggregateQueryType)(t.data.query)){const a=Et(t.data);await e().uiActions.getTrigger("UPDATE_ESQL_QUERY_TRIGGER").exec({queryString:a})}else{const a=await Tt(t.data);a.length>0&&await e().uiActions.getTrigger(yt).exec({filters:a,embeddable:t.embeddable,timeFieldName:t.data.timeFieldName})}}catch(e){Rt.warn("Error [ACTION_EMIT_APPLY_FILTER_TRIGGER]: can't extract filters from action context")}}}}((()=>({uiActions:t})))),t.addTriggerAction("MULTI_VALUE_CLICK_TRIGGER",{type:xt,id:xt,shouldAutoExecute:async()=>!0,isCompatible:async e=>{const t=await At(e.data);return Boolean(t)},execute:async({data:e})=>{const t=await At(e);if(!t||0===(null==t?void 0:t.length))return;const{filterManager:a,timefilter:{timefilter:s}}=g;if(e.timeFieldName){const{timeRangeFilter:r,restOfFilters:i}=(0,c.extractTimeFilter)(e.timeFieldName,t);a.addFilters(i),r&&s.setTime((0,c.convertRangeFilterToTimeRange)(r))}else a.addFilters(t)}});const h=new s.DatatableUtilitiesService(u.aggs,r,a);return{actions:{createFiltersFromValueClickAction:Tt,createFiltersFromRangeSelectAction:Ft,createFiltersFromMultiValueClickAction:At},datatableUtilities:h,fieldFormats:a,indexPatterns:r,dataViews:r,query:g,search:u,nowProvider:this.nowProvider}}stop(){this.queryService.stop(),this.searchService.stop()}}const Ct={datatableToCSV:s.datatableToCSV,CSV_MIME_TYPE:s.CSV_MIME_TYPE,cellHasFormulas:s.cellHasFormulas,tableHasFormulas:s.tableHasFormulas},Lt={ILLEGAL_CHARACTERS_KEY:ue.ILLEGAL_CHARACTERS_KEY,CONTAINS_SPACES_KEY:ue.CONTAINS_SPACES_KEY,ILLEGAL_CHARACTERS_VISIBLE:ue.ILLEGAL_CHARACTERS_VISIBLE,ILLEGAL_CHARACTERS:ue.ILLEGAL_CHARACTERS,isFilterable:s.isFilterable,isNestedField:s.isNestedField,isMultiField:s.isMultiField,getFieldSubtypeMulti:s.getFieldSubtypeMulti,getFieldSubtypeNested:s.getFieldSubtypeNested,validate:ue.validateDataView},Dt={aggs:{CidrMask:s.CidrMask,dateHistogramInterval:s.dateHistogramInterval,intervalOptions:s.intervalOptions,InvalidEsCalendarIntervalError:s.InvalidEsCalendarIntervalError,InvalidEsIntervalFormatError:s.InvalidEsIntervalFormatError,IpAddress:s.IpAddress,isDateHistogramBucketAggConfig:s.isDateHistogramBucketAggConfig,isNumberType:s.isNumberType,isStringType:s.isStringType,isType:s.isType,isValidEsInterval:s.isValidEsInterval,isValidInterval:s.isValidInterval,parentPipelineType:s.parentPipelineType,parseEsInterval:s.parseEsInterval,parseInterval:s.parseInterval,propFilter:s.propFilter,siblingPipelineType:s.siblingPipelineType,termsAggFilter:s.termsAggFilter,toAbsoluteDates:s.toAbsoluteDates,boundsDescendingRaw:s.boundsDescendingRaw,calcAutoIntervalLessThan:s.calcAutoIntervalLessThan},getResponseInspectorStats:s.getResponseInspectorStats,tabifyAggResponse:s.tabifyAggResponse,tabifyGetColumns:s.tabifyGetColumns};function Ot(e){return new DataPublicPlugin(e)}},1225:(e,t,a)=>{"use strict";a.d(t,{j:()=>s});const s="search_sessions"},3731:(e,t,a)=>{"use strict";a.d(t,{KJ:()=>g,Mv:()=>o,zQ:()=>c});var s=a(9472),r=a(4513),i=a.n(r),n=a(190),l=a(1215);let o=function(e){return e.None="none",e.Loading="loading",e.Completed="completed",e.BackgroundLoading="backgroundLoading",e.BackgroundCompleted="backgroundCompleted",e.Restored="restored",e.Canceled="canceled",e}({}),g=function(e){return e.InProgress="inProgress",e.Completed="completed",e.Errored="errored",e}({});const u={start:e=>({appName:e})=>({sessionId:void 0,appName:void 0,isStored:!1,isRestore:!1,isCanceled:!1,isContinued:!1,isStarted:!1,trackedSearches:[],sessionId:(0,s.v4)(),startTime:new Date,appName:e}),restore:e=>e=>({sessionId:void 0,appName:void 0,isStored:!1,isRestore:!1,isCanceled:!1,isContinued:!1,isStarted:!1,trackedSearches:[],sessionId:e,isRestore:!0,isStored:!0}),clear:e=>()=>({sessionId:void 0,appName:void 0,isStored:!1,isRestore:!1,isCanceled:!1,isContinued:!1,isStarted:!1,trackedSearches:[]}),store:e=>t=>{if(!e.sessionId)throw new Error("Can't store session. Missing sessionId");if(e.isStored||e.isRestore)throw new Error("Can't store because current session is already stored\"");return{...e,isStored:!0,searchSessionSavedObject:t}},trackSearch:e=>(t,a={})=>{if(!e.sessionId)throw new Error("Can't track search. Missing sessionId");return{...e,isStarted:!0,trackedSearches:e.trackedSearches.concat({state:g.InProgress,searchDescriptor:t,searchMeta:a}),completedTime:void 0}},removeSearch:e=>t=>{const a=e.trackedSearches.filter((e=>e.searchDescriptor!==t));return{...e,trackedSearches:a,completedTime:0===a.filter((e=>e.state!==g.InProgress)).length?new Date:e.completedTime}},completeSearch:e=>t=>({...e,trackedSearches:e.trackedSearches.map((e=>e.searchDescriptor===t?{...e,state:g.Completed}:e))}),errorSearch:e=>t=>({...e,trackedSearches:e.trackedSearches.map((e=>e.searchDescriptor===t?{...e,state:g.Errored}:e))}),updateSearchMeta:e=>(t,a)=>({...e,trackedSearches:e.trackedSearches.map((e=>e.searchDescriptor===t?{...e,searchMeta:{...e.searchMeta,...a}}:e))}),cancel:e=>()=>{if(!e.sessionId)throw new Error("Can't cancel searches. Missing sessionId");if(e.isRestore)throw new Error("Can't cancel searches when restoring older searches");return{...e,pendingSearches:[],isCanceled:!0,canceledTime:new Date,isStored:!1,searchSessionSavedObject:void 0}},setSearchSessionSavedObject:e=>t=>{if(!e.sessionId)throw new Error("Can't add search session saved object session into the state. Missing sessionId");if(e.sessionId!==t.attributes.sessionId)throw new Error("Can't add search session saved object session into the state. SessionIds don't match.");return{...e,searchSessionSavedObject:t}}},d={getState:e=>()=>{if(!e.sessionId)return o.None;if(!e.isStarted)return o.None;if(e.isCanceled)return o.Canceled;const t=e.trackedSearches.filter((e=>e.state===g.InProgress));switch(!0){case e.isRestore:return t.length>0?o.BackgroundLoading:o.Restored;case e.isStored:return t.length>0?o.BackgroundLoading:o.BackgroundCompleted;default:return t.length>0?o.Loading:o.Completed}return o.None},getMeta(e){const t=this.getState(e)();return()=>{var a,s,r;return{state:t,name:null===(a=e.searchSessionSavedObject)||void 0===a?void 0:a.attributes.name,startTime:null!==(s=e.searchSessionSavedObject)&&void 0!==s&&s.attributes.created?new Date(null===(r=e.searchSessionSavedObject)||void 0===r?void 0:r.attributes.created):e.startTime,completedTime:e.completedTime,canceledTime:e.canceledTime,isContinued:e.isContinued}}},getSearch:e=>t=>{var a;return null!==(a=e.trackedSearches.find((e=>e.searchDescriptor===t)))&&void 0!==a?a:null}},c=({freeze:e=!0}={freeze:!0})=>{const t=(0,l.createStateContainer)({sessionId:void 0,appName:void 0,isStored:!1,isRestore:!1,isCanceled:!1,isContinued:!1,isStarted:!1,trackedSearches:[]},u,d,e?void 0:{freeze:e=>e}),a=t.state$.pipe((0,n.map)((()=>t.selectors.getMeta())),(0,n.distinctUntilChanged)(i()),(0,n.shareReplay)(1)),s=a.pipe((0,n.map)((e=>e.state)),(0,n.distinctUntilChanged)());return{stateContainer:t,sessionState$:s,sessionMeta$:a}}},3856:(e,t,a)=>{"use strict";a.d(t,{_:()=>i,u:()=>r});var s=a(5008);const r={id:a(1225).j,getI18nName:()=>s.i18n.translate("data.mgmt.searchSessions.appTitle",{defaultMessage:"Search Sessions"})};function i(e,t,s,i){t.management.sections.section.kibana.registerApp({id:r.id,title:r.getI18nName(),order:1.75,mount:async r=>{const{SearchSessionsMgmtApp:n}=await a.e(515).then(a.bind(a,1515));return new n(e,t,s,i,r).mountManagementSection()}})}},1816:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var s=a(8721),r=a.n(s),i=a(186),n=a.n(i)()(r());n.push([e.id,".insDataTableFormat__filter{opacity:0}.insDataTableFormat__filter:focus,.insDataTableFormat__table tr:hover .insDataTableFormat__filter{opacity:1}",""]);const l=n},7063:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var s=a(8721),r=a.n(s),i=a(186),n=a.n(i)()(r());n.push([e.id,".insDataTableFormat__filter{opacity:0}.insDataTableFormat__filter:focus,.insDataTableFormat__table tr:hover .insDataTableFormat__filter{opacity:1}",""]);const l=n},186:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var a="",s=void 0!==t[5];return t[4]&&(a+="@supports (".concat(t[4],") {")),t[2]&&(a+="@media ".concat(t[2]," {")),s&&(a+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),a+=e(t),s&&(a+="}"),t[2]&&(a+="}"),t[4]&&(a+="}"),a})).join("")},t.i=function(e,a,s,r,i){"string"==typeof e&&(e=[[null,e,void 0]]);var n={};if(s)for(var l=0;l<this.length;l++){var o=this[l][0];null!=o&&(n[o]=!0)}for(var g=0;g<e.length;g++){var u=[].concat(e[g]);s&&n[u[0]]||(void 0!==i&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=i),a&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=a):u[2]=a),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),t.push(u))}},t}},8721:e=>{"use strict";e.exports=function(e){return e[1]}},6214:e=>{"use strict";var t="%[a-f0-9]{2}",a=new RegExp("("+t+")|([^%]+?)","gi"),s=new RegExp("("+t+")+","gi");function r(e,t){try{return[decodeURIComponent(e.join(""))]}catch(e){}if(1===e.length)return e;t=t||1;var a=e.slice(0,t),s=e.slice(t);return Array.prototype.concat.call([],r(a),r(s))}function i(e){try{return decodeURIComponent(e)}catch(i){for(var t=e.match(a)||[],s=1;s<t.length;s++)t=(e=r(t,s).join("")).match(a)||[];return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"","%FF%FE":""},a=s.exec(e);a;){try{t[a[0]]=decodeURIComponent(a[0])}catch(e){var r=i(a[0]);r!==a[0]&&(t[a[0]]=r)}a=s.exec(e)}t["%C2"]="";for(var n=Object.keys(t),l=0;l<n.length;l++){var o=n[l];e=e.replace(new RegExp(o,"g"),t[o])}return e}(e)}}},4513:e=>{"use strict";e.exports=function e(t,a){if(t===a)return!0;if(t&&a&&"object"==typeof t&&"object"==typeof a){if(t.constructor!==a.constructor)return!1;var s,r,i;if(Array.isArray(t)){if((s=t.length)!=a.length)return!1;for(r=s;0!=r--;)if(!e(t[r],a[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===a.source&&t.flags===a.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===a.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===a.toString();if((s=(i=Object.keys(t)).length)!==Object.keys(a).length)return!1;for(r=s;0!=r--;)if(!Object.prototype.hasOwnProperty.call(a,i[r]))return!1;for(r=s;0!=r--;){var n=i[r];if(!e(t[n],a[n]))return!1}return!0}return t!=t&&a!=a}},6880:function(e){!function(t){"use strict";const a="(0?\\d+|0x[a-f0-9]+)",s={fourOctet:new RegExp(`^${a}\\.${a}\\.${a}\\.${a}$`,"i"),threeOctet:new RegExp(`^${a}\\.${a}\\.${a}$`,"i"),twoOctet:new RegExp(`^${a}\\.${a}$`,"i"),longValue:new RegExp(`^${a}$`,"i")},r=new RegExp("^0[0-7]+$","i"),i=new RegExp("^0x[a-f0-9]+$","i"),n="%[0-9a-z]{1,}",l="(?:[0-9a-f]+::?)+",o={zoneIndex:new RegExp(n,"i"),native:new RegExp(`^(::)?(${l})?([0-9a-f]+)?(::)?(${n})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${a}\\.${a}\\.${a}\\.${a}(${n})?)$`,"i"),transitional:new RegExp(`^((?:${l})|(?:::)(?:${l})?)${a}\\.${a}\\.${a}\\.${a}(${n})?$`,"i")};function g(e,t){if(e.indexOf("::")!==e.lastIndexOf("::"))return null;let a,s,r=0,i=-1,n=(e.match(o.zoneIndex)||[])[0];for(n&&(n=n.substring(1),e=e.replace(/%.+$/,""));(i=e.indexOf(":",i+1))>=0;)r++;if("::"===e.substr(0,2)&&r--,"::"===e.substr(-2,2)&&r--,r>t)return null;for(s=t-r,a=":";s--;)a+="0:";return":"===(e=e.replace("::",a))[0]&&(e=e.slice(1)),":"===e[e.length-1]&&(e=e.slice(0,-1)),{parts:t=function(){const t=e.split(":"),a=[];for(let e=0;e<t.length;e++)a.push(parseInt(t[e],16));return a}(),zoneId:n}}function u(e,t,a,s){if(e.length!==t.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let r,i=0;for(;s>0;){if(r=a-s,r<0&&(r=0),e[i]>>r!=t[i]>>r)return!1;s-=a,i+=1}return!0}function d(e){if(i.test(e))return parseInt(e,16);if("0"===e[0]&&!isNaN(parseInt(e[1],10))){if(r.test(e))return parseInt(e,8);throw new Error(`ipaddr: cannot parse ${e} as octal`)}return parseInt(e,10)}function c(e,t){for(;e.length<t;)e=`0${e}`;return e}const h={};h.IPv4=function(){function e(e){if(4!==e.length)throw new Error("ipaddr: ipv4 octet count should be 4");let t,a;for(t=0;t<e.length;t++)if(a=e[t],!(0<=a&&a<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=e}return e.prototype.SpecialRanges={unspecified:[[new e([0,0,0,0]),8]],broadcast:[[new e([255,255,255,255]),32]],multicast:[[new e([224,0,0,0]),4]],linkLocal:[[new e([169,254,0,0]),16]],loopback:[[new e([127,0,0,0]),8]],carrierGradeNat:[[new e([100,64,0,0]),10]],private:[[new e([10,0,0,0]),8],[new e([172,16,0,0]),12],[new e([192,168,0,0]),16]],reserved:[[new e([192,0,0,0]),24],[new e([192,0,2,0]),24],[new e([192,88,99,0]),24],[new e([198,51,100,0]),24],[new e([203,0,113,0]),24],[new e([240,0,0,0]),4]]},e.prototype.kind=function(){return"ipv4"},e.prototype.match=function(e,t){let a;if(void 0===t&&(a=e,e=a[0],t=a[1]),"ipv4"!==e.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return u(this.octets,e.octets,8,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const a={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};let s,r,i;for(s=3;s>=0;s-=1){if(r=this.octets[s],!(r in a))return null;if(i=a[r],t&&0!==i)return null;8!==i&&(t=!0),e+=i}return 32-e},e.prototype.range=function(){return h.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){return this.octets.slice(0)},e.prototype.toIPv4MappedAddress=function(){return h.IPv6.parse(`::ffff:${this.toString()}`)},e.prototype.toNormalizedString=function(){return this.toString()},e.prototype.toString=function(){return this.octets.join(".")},e}(),h.IPv4.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),a=t[0].toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),r=[];let i=0;for(;i<4;)r.push(parseInt(a[i],10)|255^parseInt(s[i],10)),i++;return new this(r)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},h.IPv4.isIPv4=function(e){return null!==this.parser(e)},h.IPv4.isValid=function(e){try{return new this(this.parser(e)),!0}catch(e){return!1}},h.IPv4.isValidFourPartDecimal=function(e){return!(!h.IPv4.isValid(e)||!e.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},h.IPv4.networkAddressFromCIDR=function(e){let t,a,s,r,i;try{for(t=this.parseCIDR(e),s=t[0].toByteArray(),i=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),r=[],a=0;a<4;)r.push(parseInt(s[a],10)&parseInt(i[a],10)),a++;return new this(r)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},h.IPv4.parse=function(e){const t=this.parser(e);if(null===t)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(t)},h.IPv4.parseCIDR=function(e){let t;if(t=e.match(/^(.+)\/(\d+)$/)){const e=parseInt(t[2]);if(e>=0&&e<=32){const a=[this.parse(t[1]),e];return Object.defineProperty(a,"toString",{value:function(){return this.join("/")}}),a}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},h.IPv4.parser=function(e){let t,a,r;if(t=e.match(s.fourOctet))return function(){const e=t.slice(1,6),s=[];for(let t=0;t<e.length;t++)a=e[t],s.push(d(a));return s}();if(t=e.match(s.longValue)){if(r=d(t[1]),r>4294967295||r<0)throw new Error("ipaddr: address outside defined range");return function(){const e=[];let t;for(t=0;t<=24;t+=8)e.push(r>>t&255);return e}().reverse()}return(t=e.match(s.twoOctet))?function(){const e=t.slice(1,4),a=[];if(r=d(e[1]),r>16777215||r<0)throw new Error("ipaddr: address outside defined range");return a.push(d(e[0])),a.push(r>>16&255),a.push(r>>8&255),a.push(255&r),a}():(t=e.match(s.threeOctet))?function(){const e=t.slice(1,5),a=[];if(r=d(e[2]),r>65535||r<0)throw new Error("ipaddr: address outside defined range");return a.push(d(e[0])),a.push(d(e[1])),a.push(r>>8&255),a.push(255&r),a}():null},h.IPv4.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>32)throw new Error("ipaddr: invalid IPv4 prefix length");const t=[0,0,0,0];let a=0;const s=Math.floor(e/8);for(;a<s;)t[a]=255,a++;return s<4&&(t[s]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},h.IPv6=function(){function e(e,t){let a,s;if(16===e.length)for(this.parts=[],a=0;a<=14;a+=2)this.parts.push(e[a]<<8|e[a+1]);else{if(8!==e.length)throw new Error("ipaddr: ipv6 part count should be 8 or 16");this.parts=e}for(a=0;a<this.parts.length;a++)if(s=this.parts[a],!(0<=s&&s<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");t&&(this.zoneId=t)}return e.prototype.SpecialRanges={unspecified:[new e([0,0,0,0,0,0,0,0]),128],linkLocal:[new e([65152,0,0,0,0,0,0,0]),10],multicast:[new e([65280,0,0,0,0,0,0,0]),8],loopback:[new e([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new e([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new e([0,0,0,0,0,65535,0,0]),96],rfc6145:[new e([0,0,0,0,65535,0,0,0]),96],rfc6052:[new e([100,65435,0,0,0,0,0,0]),96],"6to4":[new e([8194,0,0,0,0,0,0,0]),16],teredo:[new e([8193,0,0,0,0,0,0,0]),32],reserved:[[new e([8193,3512,0,0,0,0,0,0]),32]]},e.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},e.prototype.kind=function(){return"ipv6"},e.prototype.match=function(e,t){let a;if(void 0===t&&(a=e,e=a[0],t=a[1]),"ipv6"!==e.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return u(this.parts,e.parts,16,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const a={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};let s,r;for(let i=7;i>=0;i-=1){if(s=this.parts[i],!(s in a))return null;if(r=a[s],t&&0!==r)return null;16!==r&&(t=!0),e+=r}return 128-e},e.prototype.range=function(){return h.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){let e;const t=[],a=this.parts;for(let s=0;s<a.length;s++)e=a[s],t.push(e>>8),t.push(255&e);return t},e.prototype.toFixedLengthString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(c(this.parts[t].toString(16),4));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");const e=this.parts.slice(-2),t=e[0],a=e[1];return new h.IPv4([t>>8,255&t,a>>8,255&a])},e.prototype.toNormalizedString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(this.parts[t].toString(16));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toRFC5952String=function(){const e=/((^|:)(0(:|$)){2,})/g,t=this.toNormalizedString();let a,s=0,r=-1;for(;a=e.exec(t);)a[0].length>r&&(s=a.index,r=a[0].length);return r<0?t:`${t.substring(0,s)}::${t.substring(s+r)}`},e.prototype.toString=function(){return this.toNormalizedString().replace(/((^|:)(0(:|$))+)/,"::")},e}(),h.IPv6.isIPv6=function(e){return null!==this.parser(e)},h.IPv6.isValid=function(e){if("string"==typeof e&&-1===e.indexOf(":"))return!1;try{const t=this.parser(e);return new this(t.parts,t.zoneId),!0}catch(e){return!1}},h.IPv6.parse=function(e){const t=this.parser(e);if(null===t.parts)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(t.parts,t.zoneId)},h.IPv6.parseCIDR=function(e){let t,a,s;if((a=e.match(/^(.+)\/(\d+)$/))&&(t=parseInt(a[2]),t>=0&&t<=128))return s=[this.parse(a[1]),t],Object.defineProperty(s,"toString",{value:function(){return this.join("/")}}),s;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},h.IPv6.parser=function(e){let t,a,s,r,i,n;if(s=e.match(o.deprecatedTransitional))return this.parser(`::ffff:${s[1]}`);if(o.native.test(e))return g(e,8);if((s=e.match(o.transitional))&&(n=s[6]||"",t=g(s[1].slice(0,-1)+n,6),t.parts)){for(i=[parseInt(s[2]),parseInt(s[3]),parseInt(s[4]),parseInt(s[5])],a=0;a<i.length;a++)if(r=i[a],!(0<=r&&r<=255))return null;return t.parts.push(i[0]<<8|i[1]),t.parts.push(i[2]<<8|i[3]),{parts:t.parts,zoneId:t.zoneId}}return null},h.fromByteArray=function(e){const t=e.length;if(4===t)return new h.IPv4(e);if(16===t)return new h.IPv6(e);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},h.isValid=function(e){return h.IPv6.isValid(e)||h.IPv4.isValid(e)},h.parse=function(e){if(h.IPv6.isValid(e))return h.IPv6.parse(e);if(h.IPv4.isValid(e))return h.IPv4.parse(e);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},h.parseCIDR=function(e){try{return h.IPv6.parseCIDR(e)}catch(t){try{return h.IPv4.parseCIDR(e)}catch(e){throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},h.process=function(e){const t=this.parse(e);return"ipv6"===t.kind()&&t.isIPv4MappedAddress()?t.toIPv4Address():t},h.subnetMatch=function(e,t,a){let s,r,i,n;for(r in null==a&&(a="unicast"),t)if(Object.prototype.hasOwnProperty.call(t,r))for(i=t[r],!i[0]||i[0]instanceof Array||(i=[i]),s=0;s<i.length;s++)if(n=i[s],e.kind()===n[0].kind()&&e.match.apply(e,n))return r;return a},e.exports?e.exports=h:t.ipaddr=h}(this)},9457:(e,t,a)=>{var s="undefined"!=typeof JSON?JSON:a(5895);e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var a=t.space||"";"number"==typeof a&&(a=Array(a+1).join(" "));var n,l="boolean"==typeof t.cycles&&t.cycles,o=t.replacer||function(e,t){return t},g=t.cmp&&(n=t.cmp,function(e){return function(t,a){var s={key:t,value:e[t]},r={key:a,value:e[a]};return n(s,r)}}),u=[];return function e(t,n,d,c){var h=a?"\n"+new Array(c+1).join(a):"",p=a?": ":":";if(d&&d.toJSON&&"function"==typeof d.toJSON&&(d=d.toJSON()),void 0!==(d=o.call(t,n,d))){if("object"!=typeof d||null===d)return s.stringify(d);if(r(d)){for(var m=[],f=0;f<d.length;f++){var y=e(d,f,d[f],c+1)||s.stringify(null);m.push(h+a+y)}return"["+m.join(",")+h+"]"}if(-1!==u.indexOf(d)){if(l)return s.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}u.push(d);var b=i(d).sort(g&&g(d));for(m=[],f=0;f<b.length;f++){var v=e(d,n=b[f],d[n],c+1);if(v){var S=s.stringify(n)+p+v;m.push(h+a+S)}}return u.splice(u.indexOf(d),1),"{"+m.join(",")+h+"}"}}({"":e},"",e,0)};var r=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},i=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},a=[];for(var s in e)t.call(e,s)&&a.push(s);return a}},5895:(e,t,a)=>{t.parse=a(8560),t.stringify=a(2734)},8560:e=>{var t,a,s,r,i={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},n=function(e){throw{name:"SyntaxError",message:e,at:t,text:s}},l=function(e){return e&&e!==a&&n("Expected '"+e+"' instead of '"+a+"'"),a=s.charAt(t),t+=1,a},o=function(){var e,t="";for("-"===a&&(t="-",l("-"));a>="0"&&a<="9";)t+=a,l();if("."===a)for(t+=".";l()&&a>="0"&&a<="9";)t+=a;if("e"===a||"E"===a)for(t+=a,l(),"-"!==a&&"+"!==a||(t+=a,l());a>="0"&&a<="9";)t+=a,l();if(e=+t,isFinite(e))return e;n("Bad number")},g=function(){var e,t,s,r="";if('"'===a)for(;l();){if('"'===a)return l(),r;if("\\"===a)if(l(),"u"===a){for(s=0,t=0;t<4&&(e=parseInt(l(),16),isFinite(e));t+=1)s=16*s+e;r+=String.fromCharCode(s)}else{if("string"!=typeof i[a])break;r+=i[a]}else r+=a}n("Bad string")},u=function(){for(;a&&a<=" ";)l()};r=function(){switch(u(),a){case"{":return function(){var e,t={};if("{"===a){if(l("{"),u(),"}"===a)return l("}"),t;for(;a;){if(e=g(),u(),l(":"),Object.hasOwnProperty.call(t,e)&&n('Duplicate key "'+e+'"'),t[e]=r(),u(),"}"===a)return l("}"),t;l(","),u()}}n("Bad object")}();case"[":return function(){var e=[];if("["===a){if(l("["),u(),"]"===a)return l("]"),e;for(;a;){if(e.push(r()),u(),"]"===a)return l("]"),e;l(","),u()}}n("Bad array")}();case'"':return g();case"-":return o();default:return a>="0"&&a<="9"?o():function(){switch(a){case"t":return l("t"),l("r"),l("u"),l("e"),!0;case"f":return l("f"),l("a"),l("l"),l("s"),l("e"),!1;case"n":return l("n"),l("u"),l("l"),l("l"),null}n("Unexpected '"+a+"'")}()}},e.exports=function(e,i){var l;return s=e,t=0,a=" ",l=r(),u(),a&&n("Syntax error"),"function"==typeof i?function e(t,a){var s,r,n=t[a];if(n&&"object"==typeof n)for(s in n)Object.prototype.hasOwnProperty.call(n,s)&&(void 0!==(r=e(n,s))?n[s]=r:delete n[s]);return i.call(t,a,n)}({"":l},""):l}},2734:e=>{var t,a,s,r=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function n(e){return r.lastIndex=0,r.test(e)?'"'+e.replace(r,(function(e){var t=i[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+e+'"'}function l(e,r){var i,o,g,u,d,c=t,h=r[e];switch(h&&"object"==typeof h&&"function"==typeof h.toJSON&&(h=h.toJSON(e)),"function"==typeof s&&(h=s.call(r,e,h)),typeof h){case"string":return n(h);case"number":return isFinite(h)?String(h):"null";case"boolean":case"null":return String(h);case"object":if(!h)return"null";if(t+=a,d=[],"[object Array]"===Object.prototype.toString.apply(h)){for(u=h.length,i=0;i<u;i+=1)d[i]=l(i,h)||"null";return g=0===d.length?"[]":t?"[\n"+t+d.join(",\n"+t)+"\n"+c+"]":"["+d.join(",")+"]",t=c,g}if(s&&"object"==typeof s)for(u=s.length,i=0;i<u;i+=1)"string"==typeof(o=s[i])&&(g=l(o,h))&&d.push(n(o)+(t?": ":":")+g);else for(o in h)Object.prototype.hasOwnProperty.call(h,o)&&(g=l(o,h))&&d.push(n(o)+(t?": ":":")+g);return g=0===d.length?"{}":t?"{\n"+t+d.join(",\n"+t)+"\n"+c+"}":"{"+d.join(",")+"}",t=c,g}}e.exports=function(e,r,i){var n;if(t="",a="","number"==typeof i)for(n=0;n<i;n+=1)a+=" ";else"string"==typeof i&&(a=i);if(s=r,r&&"function"!=typeof r&&("object"!=typeof r||"number"!=typeof r.length))throw new Error("JSON.stringify");return l("",{"":e})}},151:(e,t,a)=>{"use strict";const s=a(8136),r=a(6214),i=a(1536);function n(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function l(e,t){return t.encode?t.strict?s(e):encodeURIComponent(e):e}function o(e,t){return t.decode?r(e):e}function g(e){return Array.isArray(e)?e.sort():"object"==typeof e?g(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function u(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function d(e){const t=(e=u(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function c(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function h(e,t){n((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const a=function(e){let t;switch(e.arrayFormat){case"index":return(e,a,s)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===s[e]&&(s[e]={}),s[e][t[1]]=a):s[e]=a};case"bracket":return(e,a,s)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==s[e]?s[e]=[].concat(s[e],a):s[e]=[a]:s[e]=a};case"comma":case"separator":return(t,a,s)=>{const r="string"==typeof a&&a.split("").indexOf(e.arrayFormatSeparator)>-1?a.split(e.arrayFormatSeparator).map((t=>o(t,e))):null===a?a:o(a,e);s[t]=r};default:return(e,t,a)=>{void 0!==a[e]?a[e]=[].concat(a[e],t):a[e]=t}}}(t),s=Object.create(null);if("string"!=typeof e)return s;if(!(e=e.trim().replace(/^[?#&]/,"")))return s;for(const r of e.split("&")){let[e,n]=i(t.decode?r.replace(/\+/g," "):r,"=");n=void 0===n?null:["comma","separator"].includes(t.arrayFormat)?n:o(n,t),a(o(e,t),n,s)}for(const e of Object.keys(s)){const a=s[e];if("object"==typeof a&&null!==a)for(const e of Object.keys(a))a[e]=c(a[e],t);else s[e]=c(a,t)}return!1===t.sort?s:(!0===t.sort?Object.keys(s).sort():Object.keys(s).sort(t.sort)).reduce(((e,t)=>{const a=s[t];return Boolean(a)&&"object"==typeof a&&!Array.isArray(a)?e[t]=g(a):e[t]=a,e}),Object.create(null))}t.extract=d,t.parse=h,t.stringify=(e,t)=>{if(!e)return"";n((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const a=a=>t.skipNull&&null==e[a]||t.skipEmptyString&&""===e[a],s=function(e){switch(e.arrayFormat){case"index":return t=>(a,s)=>{const r=a.length;return void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?a:null===s?[...a,[l(t,e),"[",r,"]"].join("")]:[...a,[l(t,e),"[",l(r,e),"]=",l(s,e)].join("")]};case"bracket":return t=>(a,s)=>void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?a:null===s?[...a,[l(t,e),"[]"].join("")]:[...a,[l(t,e),"[]=",l(s,e)].join("")];case"comma":case"separator":return t=>(a,s)=>null==s||0===s.length?a:0===a.length?[[l(t,e),"=",l(s,e)].join("")]:[[a,l(s,e)].join(e.arrayFormatSeparator)];default:return t=>(a,s)=>void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?a:null===s?[...a,l(t,e)]:[...a,[l(t,e),"=",l(s,e)].join("")]}}(t),r={};for(const t of Object.keys(e))a(t)||(r[t]=e[t]);const i=Object.keys(r);return!1!==t.sort&&i.sort(t.sort),i.map((a=>{const r=e[a];return void 0===r?"":null===r?l(a,t):Array.isArray(r)?r.reduce(s(a),[]).join("&"):l(a,t)+"="+l(r,t)})).filter((e=>e.length>0)).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[a,s]=i(e,"#");return Object.assign({url:a.split("?")[0]||"",query:h(d(e),t)},t&&t.parseFragmentIdentifier&&s?{fragmentIdentifier:o(s,t)}:{})},t.stringifyUrl=(e,a)=>{a=Object.assign({encode:!0,strict:!0},a);const s=u(e.url).split("?")[0]||"",r=t.extract(e.url),i=t.parse(r,{sort:!1}),n=Object.assign(i,e.query);let o=t.stringify(n,a);o&&(o=`?${o}`);let g=function(e){let t="";const a=e.indexOf("#");return-1!==a&&(t=e.slice(a)),t}(e.url);return e.fragmentIdentifier&&(g=`#${l(e.fragmentIdentifier,a)}`),`${s}${o}${g}`}},6943:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(4286),r="undefined"!=typeof window?s.useLayoutEffect:s.useEffect;t.default=r},7880:(e,t,a)=>{"use strict";var s=a(1941),r=a(4286),i=s.__importDefault(a(6943));t.A=function(e,t){var a=r.useState(t),s=a[0],n=a[1];return i.default((function(){var t=e.subscribe(n);return function(){return t.unsubscribe()}}),[e]),s}},1536:e=>{"use strict";e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const a=e.indexOf(t);return-1===a?[e]:[e.slice(0,a),e.slice(a+t.length)]}},8136:e=>{"use strict";e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))},2197:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>y});var s=a(7264),r=a.n(s),i=a(6449),n=a.n(i),l=a(4811),o=a.n(l),g=a(4272),u=a.n(g),d=a(8332),c=a.n(d),h=a(4745),p=a.n(h),m=a(1816),f={};f.styleTagTransform=p(),f.setAttributes=u(),f.insert=o().bind(null,"head"),f.domAPI=n(),f.insertStyleElement=c(),r()(m.A,f);const y=m.A&&m.A.locals?m.A.locals:void 0},5120:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>y});var s=a(7264),r=a.n(s),i=a(6449),n=a.n(i),l=a(4811),o=a.n(l),g=a(4272),u=a.n(g),d=a(8332),c=a.n(d),h=a(4745),p=a.n(h),m=a(7063),f={};f.styleTagTransform=p(),f.setAttributes=u(),f.insert=o().bind(null,"head"),f.domAPI=n(),f.insertStyleElement=c(),r()(m.A,f);const y=m.A&&m.A.locals?m.A.locals:void 0},7264:e=>{"use strict";var t=[];function a(e){for(var a=-1,s=0;s<t.length;s++)if(t[s].identifier===e){a=s;break}return a}function s(e,s){for(var i={},n=[],l=0;l<e.length;l++){var o=e[l],g=s.base?o[0]+s.base:o[0],u=i[g]||0,d="".concat(g," ").concat(u);i[g]=u+1;var c=a(d),h={css:o[1],media:o[2],sourceMap:o[3],supports:o[4],layer:o[5]};if(-1!==c)t[c].references++,t[c].updater(h);else{var p=r(h,s);s.byIndex=l,t.splice(l,0,{identifier:d,updater:p,references:1})}n.push(d)}return n}function r(e,t){var a=t.domAPI(t);return a.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;a.update(e=t)}else a.remove()}}e.exports=function(e,r){var i=s(e=e||[],r=r||{});return function(e){e=e||[];for(var n=0;n<i.length;n++){var l=a(i[n]);t[l].references--}for(var o=s(e,r),g=0;g<i.length;g++){var u=a(i[g]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}i=o}}},4811:e=>{"use strict";var t={};e.exports=function(e,a){var s=function(e){if(void 0===t[e]){var a=document.querySelector(e);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(e){a=null}t[e]=a}return t[e]}(e);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(a)}},8332:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},4272:(e,t,a)=>{"use strict";e.exports=function(e){var t=a.nc;t&&e.setAttribute("nonce",t)}},6449:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(a){!function(e,t,a){var s="";a.supports&&(s+="@supports (".concat(a.supports,") {")),a.media&&(s+="@media ".concat(a.media," {"));var r=void 0!==a.layer;r&&(s+="@layer".concat(a.layer.length>0?" ".concat(a.layer):""," {")),s+=a.css,r&&(s+="}"),a.media&&(s+="}"),a.supports&&(s+="}");var i=a.sourceMap;i&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(s,e,t.options)}(t,e,a)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},4745:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},930:(e,t,a)=>{a.p=window.__kbnPublicPath__.data},9011:(e,t,a)=>{switch(window.__kbnThemeTag__){case"borealislight":return a(2197);case"borealisdark":return a(5120)}},7674:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/dataViews/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},7574:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/dataViews/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},7876:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/expressions/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},2374:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/fieldFormats/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},8370:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/inspector/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},8887:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/inspector/common/adapters/request");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},2798:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/inspector/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},409:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},1359:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/kibanaUtils/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},1215:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},7888:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/share/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},3721:(e,t,a)=>{e.exports=a(2497)(4971)},3185:(e,t,a)=>{e.exports=a(2497)(51858)},8915:(e,t,a)=>{e.exports=a(2497)(67493)},1319:e=>{"use strict";e.exports=__kbnSharedDeps__.ElasticEui},6791:e=>{"use strict";e.exports=__kbnSharedDeps__.EmotionReact},9424:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnCodeEditor},6494:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnDatemath},5964:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnEsQuery},1991:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnEsqlAst},5008:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18n},5879:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18nReact},482:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnReactKibanaContextRender},770:e=>{"use strict";e.exports=__kbnSharedDeps__.Lodash},1783:e=>{"use strict";e.exports=__kbnSharedDeps__.Moment},2488:e=>{"use strict";e.exports=__kbnSharedDeps__.MomentTimezone},4286:e=>{"use strict";e.exports=__kbnSharedDeps__.React},2874:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactDom},190:e=>{"use strict";e.exports=__kbnSharedDeps__.Rxjs},1941:e=>{"use strict";e.exports=__kbnSharedDeps__.TsLib},9472:e=>{"use strict";e.exports=__kbnSharedDeps__.Uuid},2497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},a={};function s(e){var r=a[e];if(void 0!==r)return r.exports;var i=a[e]={id:e,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.exports}s.m=t,s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,a)=>(s.f[a](e,t),t)),[])),s.u=e=>"data.chunk."+e+".js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},s.l=(t,a,r,i)=>{if(e[t])e[t].push(a);else{var n,l;if(void 0!==r)for(var o=document.getElementsByTagName("script"),g=0;g<o.length;g++){var u=o[g];if(u.getAttribute("src")==t){n=u;break}}n||(l=!0,(n=document.createElement("script")).charset="utf-8",n.timeout=120,s.nc&&n.setAttribute("nonce",s.nc),n.src=t),e[t]=[a];var d=(a,s)=>{n.onerror=n.onload=null,clearTimeout(c);var r=e[t];if(delete e[t],n.parentNode&&n.parentNode.removeChild(n),r&&r.forEach((e=>e(s))),a)return a(s)},c=setTimeout(d.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=d.bind(null,n.onerror),n.onload=d.bind(null,n.onload),l&&document.head.appendChild(n)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");if(a.length)for(var r=a.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=a[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{var e={543:0};s.f.j=(t,a)=>{var r=s.o(e,t)?e[t]:void 0;if(0!==r)if(r)a.push(r[2]);else{var i=new Promise(((a,s)=>r=e[t]=[a,s]));a.push(r[2]=i);var n=s.p+s.u(t),l=new Error;s.l(n,(a=>{if(s.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var i=a&&("load"===a.type?"missing":a.type),n=a&&a.target&&a.target.src;l.message="Loading chunk "+t+" failed.\n("+i+": "+n+")",l.name="ChunkLoadError",l.type=i,l.request=n,r[1](l)}}),"chunk-"+t,t)}};var t=(t,a)=>{var r,i,[n,l,o]=a,g=0;if(n.some((t=>0!==e[t]))){for(r in l)s.o(l,r)&&(s.m[r]=l[r]);o&&o(s)}for(t&&t(a);g<n.length;g++)i=n[g],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0},a=self.data_bundle_jsonpfunction=self.data_bundle_jsonpfunction||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})(),s.nc=void 0,s(930),__kbnBundles__.define("plugin/data/public",s,7243),__kbnBundles__.define("plugin/data/common",s,4177)})();