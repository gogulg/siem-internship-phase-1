(()=>{var e,t={264:(e,t,s)=>{"use strict";s.d(t,{L:()=>n,R:()=>a});const a="table";let n=function(e){return e.SUM="sum",e.AVG="avg",e.MIN="min",e.MAX="max",e.COUNT="count",e}({})},213:(e,t,s)=>{"use strict";s.r(t),s.d(t,{plugin:()=>y});var a=s(915),n=s(107),r=s(8),i=s(500),o=s(264),l=s(77);const c=()=>({name:"kibana_table",type:"render",inputTypes:["datatable"],help:r.i18n.translate("visTypeTable.function.help",{defaultMessage:"Table visualization"}),args:{metrics:{types:["vis_dimension"],help:r.i18n.translate("visTypeTable.function.args.metricsHelpText",{defaultMessage:"Metrics dimensions config"}),required:!0,multi:!0},buckets:{types:["vis_dimension"],help:r.i18n.translate("visTypeTable.function.args.bucketsHelpText",{defaultMessage:"Buckets dimensions config"}),multi:!0},splitColumn:{types:["vis_dimension"],help:r.i18n.translate("visTypeTable.function.args.splitColumnHelpText",{defaultMessage:"Split by column dimension config"})},splitRow:{types:["vis_dimension"],help:r.i18n.translate("visTypeTable.function.args.splitRowHelpText",{defaultMessage:"Split by row dimension config"})},percentageCol:{types:["string"],help:r.i18n.translate("visTypeTable.function.args.percentageColHelpText",{defaultMessage:"Name of column to show percentage for"}),default:""},perPage:{types:["number"],default:"",help:r.i18n.translate("visTypeTable.function.args.perPageHelpText",{defaultMessage:"The number of rows at a table page is used for pagination"})},row:{types:["boolean"],help:r.i18n.translate("visTypeTable.function.args.rowHelpText",{defaultMessage:'Row value is used for split table mode. Set to "true" to split by row'})},showPartialRows:{types:["boolean"],help:"",default:!1},showMetricsAtAllLevels:{types:["boolean"],help:"",default:!1},showToolbar:{types:["boolean"],help:r.i18n.translate("visTypeTable.function.args.showToolbarHelpText",{defaultMessage:'Set to "true" to show grid\'s toolbar with "Export" button'}),default:!1},showTotal:{types:["boolean"],help:r.i18n.translate("visTypeTable.function.args.showTotalHelpText",{defaultMessage:'Set to "true" to show the total row'}),default:!1},title:{types:["string"],help:r.i18n.translate("visTypeTable.function.args.titleHelpText",{defaultMessage:"The visualization title. The title is used for CSV export as a default file name"})},totalFunc:{types:["string"],help:r.i18n.translate("visTypeTable.function.args.totalFuncHelpText",{defaultMessage:"Specifies calculating function for the total row. Possible options are: "})},autoFitRowToContent:{types:["boolean"],help:"",default:!1}},fn(e,t,s){var a,n,c,u,p,d;const b=(0,l.WG)(e,t),g={rows:null!==(a=null==b||null===(n=b.table)||void 0===n?void 0:n.rows)&&void 0!==a?a:e.rows,columns:null!==(c=null==b||null===(u=b.table)||void 0===u?void 0:u.columns)&&void 0!==c?c:e.columns,type:"datatable"};if(null!=s&&null!==(p=s.inspectorAdapters)&&void 0!==p&&p.tables){const e=[[t.metrics,r.i18n.translate("visTypeTable.function.dimension.metrics",{defaultMessage:"Metrics"})],[t.buckets,r.i18n.translate("visTypeTable.function.adimension.buckets",{defaultMessage:"Buckets"})]];t.splitColumn&&e.push([[t.splitColumn],r.i18n.translate("visTypeTable.function.dimension.splitColumn",{defaultMessage:"Split by column"})]),t.splitRow&&e.push([[t.splitRow],r.i18n.translate("visTypeTable.function.dimension.splitRow",{defaultMessage:"Split by row"})]);const a=(0,i.prepareLogTable)(g,e);s.inspectorAdapters.tables.logDatatable("default",a)}return{type:"render",as:"table_vis",value:{visData:b,visType:o.R,visConfig:{...t,title:null!==(d=s.variables.embeddableTitle)&&void 0!==d?d:t.title},canNavigateToLens:s.variables.canNavigateToLens}}}});var u=s(286);const p=__kbnSharedDeps__.ReactDom,d=__kbnSharedDeps__.KbnAnalytics,b=__kbnSharedDeps__.KbnReactKibanaContextRender;var g=s(791);const m=(0,u.lazy)((()=>s.e(213).then(s.bind(s,594))));var f=s(627),v=s(319);const h=(0,u.lazy)((()=>s.e(496).then(s.bind(s,496))));var _=s(904);const T=e=>{const t=(0,_.buildExpressionFunction)("visdimension",{accessor:e.accessor});return e.format&&(t.addArgument("format",e.format.id),t.addArgument("formatParams",JSON.stringify(e.format.params))),(0,_.buildExpression)([t])},w={name:o.R,title:r.i18n.translate("visTypeTable.tableVisTitle",{defaultMessage:"Data table"}),icon:"visTable",description:r.i18n.translate("visTypeTable.tableVisDescription",{defaultMessage:"Display data in rows and columns."}),getSupportedTriggers:()=>[i.VIS_EVENT_TO_TRIGGER.filter],visConfig:{defaults:{perPage:10,showPartialRows:!1,showMetricsAtAllLevels:!1,showTotal:!1,showToolbar:!1,totalFunc:"sum",percentageCol:"",autoFitRowToContent:!1}},editorConfig:{enableDataViewChange:!0,optionsTemplate:e=>(0,g.jsx)(u.Suspense,{fallback:(0,g.jsx)(v.EuiLoadingSpinner,null)},(0,g.jsx)(h,e)),schemas:[{group:f.AggGroupNames.Metrics,name:"metric",title:r.i18n.translate("visTypeTable.tableVisEditorConfig.schemas.metricTitle",{defaultMessage:"Metric"}),aggFilter:["!geo_centroid","!geo_bounds","!filtered_metric","!single_percentile","!single_percentile_rank"],aggSettings:{top_hits:{allowStrings:!0}},min:1,defaults:[{type:"count",schema:"metric"}]},{group:f.AggGroupNames.Buckets,name:"bucket",title:r.i18n.translate("visTypeTable.tableVisEditorConfig.schemas.bucketTitle",{defaultMessage:"Split rows"}),aggFilter:["!filter","!sampler","!diversified_sampler","!multi_terms","!significant_text","!rare_terms"]},{group:f.AggGroupNames.Buckets,name:"split",title:r.i18n.translate("visTypeTable.tableVisEditorConfig.schemas.splitTitle",{defaultMessage:"Split table"}),min:0,max:1,aggFilter:["!filter","!sampler","!diversified_sampler","!multi_terms","!significant_text","!rare_terms"]}]},fetchDatatable:!0,toExpressionAst:(e,t)=>{var s;const a=(0,i.getVisSchemas)(e,t),n=((e,t)=>{const s=[...e.metric];if(e.bucket&&t.showPartialRows&&!t.showMetricsAtAllLevels){const t=s.length/e.bucket.length;s.splice(0,t*e.bucket.length-t)}return s})(a,e.params),r={perPage:e.params.perPage,percentageCol:e.params.percentageCol,row:e.params.row,showPartialRows:e.params.showPartialRows,showMetricsAtAllLevels:e.params.showMetricsAtAllLevels,showToolbar:e.params.showToolbar,showTotal:e.params.showTotal,autoFitRowToContent:e.params.autoFitRowToContent,totalFunc:e.params.totalFunc,title:e.title,metrics:n.map(T),buckets:null===(s=a.bucket)||void 0===s?void 0:s.map(T)},o=(0,_.buildExpressionFunction)("kibana_table",r);return a.split_column&&o.addArgument("splitColumn",T(a.split_column[0])),a.split_row&&o.addArgument("splitRow",T(a.split_row[0])),(0,_.buildExpression)([o]).toAst()},hasPartialRows:e=>e.params.showPartialRows,hierarchicalData:e=>e.params.showPartialRows||e.params.showMetricsAtAllLevels,requiresSearch:!0,navigateToLens:async(e,t)=>{const{convertToLens:a}=await s.e(529).then(s.bind(s,529));return e?a(e,t):null},getExpressionVariables:async(e,t)=>{const{convertToLens:a}=await s.e(529).then(s.bind(s,529));return{canNavigateToLens:Boolean(null!=e&&e.params?await a(e,t):null)}}};class TableVisPlugin{constructor(e){(0,a.default)(this,"initializerContext",void 0),this.initializerContext=e}setup(e,t){const{readOnly:s}=this.initializerContext.config.get();(async(e,{expressions:t,visualizations:s},a)=>{const[n,{usageCollection:r}]=await e.getStartServices();t.registerFunction(c),t.registerRenderer(((e,t)=>({name:"table_vis",reuseDomNode:!0,render:async(s,{visData:a,visConfig:n,canNavigateToLens:r},o)=>{var l;o.onDestroy((()=>{(0,p.unmountComponentAtNode)(s)}));const c=0===(null===(l=a.table)||void 0===l?void 0:l.rows.length)||!a.table&&0===a.tables.length,u=()=>{const e=(e=>{if(e){var t;const s=e=>e.type?e:e.child?s(e.child):void 0;return null===(t=s(e))||void 0===t?void 0:t.type}})(o.getExecutionContext()),s="agg_based";if(e){const n=[`render_${s}_table`,a.table?void 0:`render_${s}_table_split`,r?`render_${s}_table_convertable`:void 0].filter(Boolean);t.reportUiCounter(e,d.METRIC_TYPE.COUNT,n)}o.done()};(0,p.render)((0,g.jsx)(b.KibanaRenderContextProvider,e,(0,g.jsx)(i.VisualizationContainer,{"data-test-subj":"tbvChartContainer",handlers:o,renderComplete:u,showNoResult:c},(0,g.jsx)(m,{core:e,handlers:o,visData:a,visConfig:n,renderComplete:u}))),s)}}))(n,r)),s.createBaseVisualization({...w,disableCreate:a,disableEdit:a})})(e,t,Boolean(s))}start(e,{fieldFormats:t,dataViews:s}){(0,n.hX)(t),(0,n.LB)(s)}}function y(e){return new TableVisPlugin(e)}},107:(e,t,s)=>{"use strict";s.d(t,{LB:()=>c,hX:()=>r,tz:()=>n,xE:()=>l});var a=s(215);const[n,r]=(0,a.createGetterSetter)("FieldFormats"),[i,o]=(0,a.createGetterSetter)("UsageCollection",!1),[l,c]=(0,a.createGetterSetter)("dataViews")},77:(e,t,s)=>{"use strict";s.d(t,{WG:()=>b,WQ:()=>n,tz:()=>o});var a=s(286);const n=(e,t)=>{const[s,n]=(0,a.useState)({pageIndex:0,pageSize:e.perPage||0}),r=(0,a.useCallback)((e=>n((t=>({...t,pageSize:e,pageIndex:0})))),[]),i=(0,a.useCallback)((e=>n((t=>({...t,pageIndex:e})))),[]);return(0,a.useEffect)((()=>{const s=e.perPage||0,a=Math.ceil(t/s)-1;n((e=>({pageIndex:e.pageIndex>a?a:e.pageIndex,pageSize:s})))}),[e.perPage,t]),(0,a.useMemo)((()=>s.pageSize?{...s,onChangeItemsPerPage:r,onChangePage:i}:void 0),[r,i,s])};var r=s(770);const i={columnIndex:null,direction:null},o=e=>{const[t,s]=(0,a.useState)((null==e?void 0:e.get("vis.params.sort"))||i),[n,o]=(0,a.useState)((null==e?void 0:e.get("vis.params.colWidth"))||[]),l=(0,a.useRef)({columnsWidth:null==e?void 0:e.get("vis.params.colWidth"),sort:null==e?void 0:e.get("vis.params.sort"),pendingUpdate:!1}),c=(0,a.useCallback)(((t=i)=>{s(t||i),l.current.sort=t,l.current.pendingUpdate=!0,setTimeout((()=>{null==e||e.set("vis.params.sort",t),l.current.pendingUpdate=!1}))}),[e]),u=(0,a.useCallback)((t=>{o((s=>{const a=[...s],n=s.findIndex((e=>e.colIndex===t.colIndex));return n>=0?a[n]=t:a.push(t),l.current.columnsWidth=a,l.current.pendingUpdate=!0,setTimeout((()=>{null==e||e.set("vis.params.colWidth",a),l.current.pendingUpdate=!1})),a}))}),[e]);return(0,a.useEffect)((()=>{const t=(0,r.debounce)((()=>{if(l.current.pendingUpdate)return;const{vis:t}=null==e?void 0:e.getChanges();(0,r.isEqual)(null==t?void 0:t.params.colWidth,l.current.columnsWidth)||(l.current.columnsWidth=null==t?void 0:t.params.colWidth,o((null==t?void 0:t.params.colWidth)||[])),(0,r.isEqual)(null==t?void 0:t.params.sort,l.current.sort)||(l.current.sort=null==t?void 0:t.params.sort,s((null==t?void 0:t.params.sort)||i))}));return null==e||e.on("change",t),()=>{null==e||e.off("change",t)}}),[e]),{columnsWidth:n,sort:t,setColumnsWidth:u,setSort:c}};var l=s(107),c=s(8);function u(e,t){const{columns:s,rows:a,formattedColumns:n}=e,i=(0,r.findIndex)(s,{name:t});if(i<0)return e;const{id:o}=s[i],{sumTotal:u}=n[o],p=`${o}-percents`,d=(0,l.tz)().deserialize({id:"percent"}),b=c.i18n.translate("visTypeTable.params.percentageTableColumnName",{defaultMessage:"{title} percentages",values:{title:t}}),g=function(e,t,s){const a=[...e];return a.splice(t+1,0,s),a}(s,i,{name:b,id:p,meta:{type:"number",params:{id:"percent"}}}),m={...n,[p]:{title:b,formatter:d,filterable:!1}};return{columns:g,rows:a.map((e=>({[p]:e[o]/u,...e}))),formattedColumns:m}}var p=s(264);const d=(e,t)=>{const{buckets:s,metrics:a}=t,n=e.columns.reduce(((n,i,o)=>{var c;const u=null==s?void 0:s.find((({accessor:e})=>e===o)),d=u||a.find((({accessor:e})=>e===o));if(!d)return n;const b=(0,l.tz)().deserialize(d.format),g={title:i.name,formatter:b,filterable:!!u},m="date"===d.format.id||"date"===(null===(c=d.format.params)||void 0===c?void 0:c.id);if(b.allowsNumericalAggregations||m||t.totalFunc===p.L.COUNT){const s=e.rows.reduce(((e,t)=>void 0===t[i.id]?e:e+t[i.id]),0);switch(g.sumTotal=s,t.totalFunc){case p.L.SUM:m||(g.formattedTotal=b.convert(s),g.total=s);break;case p.L.AVG:if(!m){const t=s/e.rows.length;g.formattedTotal=b.convert(t),g.total=t}break;case p.L.MIN:{const t=(0,r.chain)(e.rows).map(i.id).min().value();g.formattedTotal=b.convert(t),g.total=t;break}case p.L.MAX:{const t=(0,r.chain)(e.rows).map(i.id).max().value();g.formattedTotal=b.convert(t),g.total=t;break}case p.L.COUNT:{const t=e.rows.length;g.formattedTotal=t,g.total=t;break}}}return n[i.id]=g,n}),{});return{columns:e.columns.filter((e=>n[e.id])),rows:e.rows,formattedColumns:n}};function b(e,t){const s=[];let a,n;const r=t.splitColumn||t.splitRow;if(r){n=t.splitRow?"row":"column";const a=r.accessor,i=(0,l.tz)().deserialize(r.format),o=e.columns[a],c={};let p=0;e.rows.forEach((t=>{const a=t[o.id];if(!Object.hasOwn(c,a)){c[a]=p++;const t={title:`${i.convert(a)}: ${o.name}`,table:{columns:e.columns,rows:[],formattedColumns:{}}};s.push(t)}const n=c[a];s[n].table.rows.push(t)})),s.forEach((e=>{e.table=d(e.table,t),t.percentageCol&&(e.table=u(e.table,t.percentageCol))}))}else a=d(e,t),t.percentageCol&&(a=u(a,t.percentageCol));return{direction:n,table:a,tables:s}}},461:(e,t,s)=>{s.p=window.__kbnPublicPath__.visTypeTable},627:(e,t,s)=>{s.r(t);var a=__kbnBundles__.get("plugin/data/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},904:(e,t,s)=>{s.r(t);var a=__kbnBundles__.get("plugin/expressions/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},409:(e,t,s)=>{s.r(t);var a=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},215:(e,t,s)=>{s.r(t);var a=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},888:(e,t,s)=>{s.r(t);var a=__kbnBundles__.get("plugin/share/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},499:(e,t,s)=>{s.r(t);var a=__kbnBundles__.get("plugin/visDefaultEditor/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},587:(e,t,s)=>{s.r(t);var a=__kbnBundles__.get("plugin/visualizations/common/convert_to_lens");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},500:(e,t,s)=>{s.r(t);var a=__kbnBundles__.get("plugin/visualizations/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},915:(e,t,s)=>{e.exports=s(497)(67493)},927:e=>{"use strict";e.exports=__kbnSharedDeps__.Classnames},319:e=>{"use strict";e.exports=__kbnSharedDeps__.ElasticEui},791:e=>{"use strict";e.exports=__kbnSharedDeps__.EmotionReact},8:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18n},879:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18nReact},803:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnUiTheme},770:e=>{"use strict";e.exports=__kbnSharedDeps__.Lodash},286:e=>{"use strict";e.exports=__kbnSharedDeps__.React},472:e=>{"use strict";e.exports=__kbnSharedDeps__.Uuid},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},s={};function a(e){var n=s[e];if(void 0!==n)return n.exports;var r=s[e]={id:e,exports:{}};return t[e](r,r.exports,a),r.exports}a.m=t,a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,s)=>(a.f[s](e,t),t)),[])),a.u=e=>"visTypeTable.chunk."+e+".js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},a.l=(t,s,n,r)=>{if(e[t])e[t].push(s);else{var i,o;if(void 0!==n)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var u=l[c];if(u.getAttribute("src")==t){i=u;break}}i||(o=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,a.nc&&i.setAttribute("nonce",a.nc),i.src=t),e[t]=[s];var p=(s,a)=>{i.onerror=i.onload=null,clearTimeout(d);var n=e[t];if(delete e[t],i.parentNode&&i.parentNode.removeChild(i),n&&n.forEach((e=>e(a))),s)return s(a)},d=setTimeout(p.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=p.bind(null,i.onerror),i.onload=p.bind(null,i.onload),o&&document.head.appendChild(i)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");if(s.length)for(var n=s.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=s[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={153:0};a.f.j=(t,s)=>{var n=a.o(e,t)?e[t]:void 0;if(0!==n)if(n)s.push(n[2]);else{var r=new Promise(((s,a)=>n=e[t]=[s,a]));s.push(n[2]=r);var i=a.p+a.u(t),o=new Error;a.l(i,(s=>{if(a.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var r=s&&("load"===s.type?"missing":s.type),i=s&&s.target&&s.target.src;o.message="Loading chunk "+t+" failed.\n("+r+": "+i+")",o.name="ChunkLoadError",o.type=r,o.request=i,n[1](o)}}),"chunk-"+t,t)}};var t=(t,s)=>{var n,r,[i,o,l]=s,c=0;if(i.some((t=>0!==e[t]))){for(n in o)a.o(o,n)&&(a.m[n]=o[n]);l&&l(a)}for(t&&t(s);c<i.length;c++)r=i[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0},s=self.visTypeTable_bundle_jsonpfunction=self.visTypeTable_bundle_jsonpfunction||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),a.nc=void 0,a(461),__kbnBundles__.define("plugin/visTypeTable/public",a,213)})();