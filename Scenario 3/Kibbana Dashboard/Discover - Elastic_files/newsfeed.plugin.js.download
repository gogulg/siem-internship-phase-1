(()=>{var e={528:(e,t,s)=>{"use strict";s.r(t),s.d(t,{NewsfeedApiEndpoint:()=>I,plugin:()=>E});var r=s(915);const n=__kbnSharedDeps__.Rxjs,a=__kbnSharedDeps__.ReactDom;var i=s.n(a),o=s(286),l=s.n(o);const u=__kbnSharedDeps__.Moment;var d=s.n(u);const c=__kbnSharedDeps__.KbnReactKibanaContextRender,h=__kbnSharedDeps__.ElasticEui,f=__kbnSharedDeps__.KbnI18n;var p=s(880),m=s(185);const g=__kbnSharedDeps__.KbnI18nReact,b=__kbnSharedDeps__.EmotionReact,w=()=>(0,b.jsx)(h.EuiEmptyPrompt,{iconType:"documents",titleSize:"s","data-test-subj":"emptyNewsfeed",title:(0,b.jsx)("h2",null,(0,b.jsx)(g.FormattedMessage,{id:"newsfeed.emptyPrompt.noNewsTitle",defaultMessage:"No news?"})),body:(0,b.jsx)("p",null,(0,b.jsx)(g.FormattedMessage,{id:"newsfeed.emptyPrompt.noNewsText",defaultMessage:"If your Kibana instance doesn’t have internet access, ask your administrator to disable this feature. Otherwise, we’ll keep trying to fetch the news."}))}),S=({showPlainSpinner:e})=>(0,b.jsx)(h.EuiEmptyPrompt,{title:e?(0,b.jsx)(h.EuiLoadingSpinner,{size:"xl"}):(0,b.jsx)(h.EuiLoadingElastic,{size:"xl"}),body:(0,b.jsx)("p",null,(0,b.jsx)(g.FormattedMessage,{id:"newsfeed.loadingPrompt.gettingNewsText",defaultMessage:"Getting the latest news..."}))}),v=e=>{const{newsFetchResult:t,setFlyoutVisible:s}=(0,o.useContext)(x),r=(0,o.useCallback)((()=>s(!1)),[s]),{showPlainSpinner:n,isServerless:a,...i}=e;return(0,b.jsx)(h.EuiPortal,null,(0,b.jsx)(h.EuiFlyout,(0,m.default)({},i,{onClose:r,size:"s","aria-labelledby":"flyoutSmallTitle",className:"kbnNews__flyout","data-test-subj":"NewsfeedFlyout"}),(0,b.jsx)(h.EuiFlyoutHeader,{hasBorder:!0},(0,b.jsx)(h.EuiTitle,{size:"s"},(0,b.jsx)("h2",{id:"flyoutSmallTitle"},(0,b.jsx)(g.FormattedMessage,{id:"newsfeed.flyoutList.whatsNewTitle",defaultMessage:"What's new at Elastic"})))),(0,b.jsx)(h.EuiFlyoutBody,{className:"kbnNews__flyoutAlerts"},t?t.feedItems.length>0?t.feedItems.map((e=>(0,b.jsx)(h.EuiHeaderAlert,{key:e.hash,title:e.title,text:e.description,"data-test-subj":"newsHeadAlert",action:(0,b.jsx)(h.EuiLink,{target:"_blank",href:e.linkUrl,external:!0},e.linkText),date:e.publishOn.format("DD MMMM YYYY"),badge:e.badge?(0,b.jsx)(h.EuiBadge,{color:"hollow"},e.badge):void 0}))):(0,b.jsx)(w,null):(0,b.jsx)(S,{showPlainSpinner:e.showPlainSpinner})),(0,b.jsx)(h.EuiFlyoutFooter,null,(0,b.jsx)(h.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},(0,b.jsx)(h.EuiFlexItem,{grow:!1},(0,b.jsx)(h.EuiButtonEmpty,{iconType:"cross",onClick:r,flush:"left"},(0,b.jsx)(g.FormattedMessage,{id:"newsfeed.flyoutList.closeButtonLabel",defaultMessage:"Close"}))),(0,b.jsx)(h.EuiFlexItem,{grow:!1},t&&!a?(0,b.jsx)(h.EuiText,{color:"subdued",size:"s"},(0,b.jsx)("p",null,(0,b.jsx)(g.FormattedMessage,{id:"newsfeed.flyoutList.versionTextLabel",defaultMessage:"{version}",values:{version:`Version ${t.kibanaVersion}`}}))):null)))))},x=l().createContext({}),_=({newsfeedApi:e,hasCustomBranding$:t,isServerless:s})=>{const[r,n]=(0,o.useState)(!1),[a,i]=(0,o.useState)(null),u=(0,p.A)(t,!1),d=(0,o.useMemo)((()=>!!a&&a.hasNew),[a]),c=(0,o.useRef)(null);(0,o.useEffect)((()=>{const t=e.fetchResults$.subscribe((e=>{i(e)}));return()=>t.unsubscribe()}),[e]);const m=(0,o.useCallback)((()=>{a&&e.markAsRead(a.feedItems.map((e=>e.hash))),n(!r)}),[e,a,r]);return(0,b.jsx)(x.Provider,{value:{setFlyoutVisible:n,newsFetchResult:a}},(0,b.jsx)(l().Fragment,null,(0,b.jsx)(h.EuiHeaderSectionItemButton,{ref:e=>c.current=e,"data-test-subj":"newsfeed","aria-controls":"keyPadMenu","aria-expanded":r,"aria-haspopup":"true","aria-label":d?f.i18n.translate("newsfeed.headerButton.unreadAriaLabel",{defaultMessage:"Newsfeed menu - unread items available"}):f.i18n.translate("newsfeed.headerButton.readAriaLabel",{defaultMessage:"Newsfeed menu - all items read"}),notification:!!d||null,onClick:m},(0,b.jsx)(h.EuiIcon,{type:"cheer",size:"m"})),r?(0,b.jsx)(v,{isServerless:s,focusTrapProps:{shards:[c]},showPlainSpinner:u}):null))},y=e=>!d()(e.expire_on).isBefore(Date.now())&&!d()(e.publish_on).isAfter(Date.now()),j=e=>![e.title,e.description,e.linkText,e.linkUrl,e.publishOn,e.hash].includes(void 0);class NewsfeedApiDriver{constructor(e,t,s,n){(0,r.default)(this,"kibanaVersion",void 0),(0,r.default)(this,"loadedTime",d()().utc()),this.userLanguage=t,this.fetchInterval=s,this.storage=n,this.kibanaVersion=e.replace(/^(\d+\.\d+\.\d+).*/,"$1")}shouldFetch(){const e=this.storage.getLastFetchTime();if(!e)return!0;const t=d()(e);if(this.loadedTime.diff(t)>0)return!0;const s=d().utc();return d().duration(s.diff(t)).asMilliseconds()>this.fetchInterval}fetchNewsfeedItems(e){const t=e.pathTemplate.replace("{VERSION}",this.kibanaVersion),s=(e.urlRoot||"https://feeds.elastic.co")+t,r=new Request(s,{method:"GET"});return n.from(window.fetch(r).then((async e=>{const{items:t}=await e.json();return this.convertResponse(t)})))}convertResponse(e){const t=((e,t)=>e.filter(y).map((e=>((e,t)=>{const{expire_on:s,publish_on:r,languages:n,title:a,description:i,link_text:o,link_url:l,badge:u,hash:c}=e;let h=t;return n&&n.includes(h)||(h="en"),{title:a[h],description:i[h],linkText:null!=o?o[h]:null,linkUrl:l[h],badge:null!=u?u[h]:null,publishOn:d()(r),expireOn:d()(s),hash:c.slice(0,10)}})(e,t))).filter(j))(e,this.userLanguage),s=this.storage.setFetchedItems(t.map((e=>e.hash)));return{error:null,kibanaVersion:this.kibanaVersion,hasNew:s,feedItems:t}}}class NeverFetchNewsfeedApiDriver{shouldFetch(){return!1}fetchNewsfeedItems(){throw new Error("Not implemented!")}}class NewsfeedStorage{constructor(e){(0,r.default)(this,"lastFetchStorageKey",void 0),(0,r.default)(this,"readStatusStorageKey",void 0),(0,r.default)(this,"unreadStatus$",void 0),this.lastFetchStorageKey=N(e,"lastFetch"),this.readStatusStorageKey=N(e,"readStatus"),this.unreadStatus$=new n.BehaviorSubject(k(this.getReadStatus()))}getLastFetchTime(){const e=localStorage.getItem(this.lastFetchStorageKey);if(e)return d()(e,"x").toDate()}setLastFetchTime(e){localStorage.setItem(this.lastFetchStorageKey,JSON.stringify(e.getTime()))}setFetchedItems(e){const t=this.getReadStatus(),s={};return e.forEach((e=>{var r;s[e]=null!==(r=t[e])&&void 0!==r&&r})),this.setReadStatus(s)}markItemsAsRead(e){const t=this.getReadStatus();return e.forEach((e=>{t[e]=!0})),this.setReadStatus(t)}isAnyUnread(){return this.unreadStatus$.value}isAnyUnread$(){return this.unreadStatus$.asObservable()}getReadStatus(){try{return JSON.parse(localStorage.getItem(this.readStatusStorageKey)||"{}")}catch(e){return{}}}setReadStatus(e){const t=k(e);return this.unreadStatus$.next(k(e)),localStorage.setItem(this.readStatusStorageKey,JSON.stringify(e)),t}}const k=e=>Object.values(e).some((e=>!e)),N=(e,t)=>`newsfeed.${e}.${t}`;let I=function(e){return e.KIBANA="kibana",e.KIBANA_ANALYTICS="kibana-analytics",e.SECURITY_SOLUTION="security-solution",e.OBSERVABILITY="observability",e}({});class NewsfeedPublicPlugin{constructor(e){(0,r.default)(this,"isServerless",void 0),(0,r.default)(this,"kibanaVersion",void 0),(0,r.default)(this,"config",void 0),(0,r.default)(this,"stop$",new n.ReplaySubject(1)),this.isServerless="serverless"===e.env.packageInfo.buildFlavor,this.kibanaVersion=e.env.packageInfo.version;const t=e.config.get();this.config=Object.freeze({...t,mainInterval:d().duration(t.mainInterval),fetchInterval:d().duration(t.fetchInterval)})}setup(e){return{}}start(e,{screenshotMode:t}){const s=t.isScreenshotMode(),r=this.createNewsfeedApi(this.config,I.KIBANA,s);return e.chrome.navControls.registerRight({order:1e3,mount:t=>this.mount(r,t,e)}),{createNewsFeed$:e=>{const t=Object.assign({},this.config,{service:{...this.config.service,pathTemplate:`/${e}/v{VERSION}.json`}}),{fetchResults$:r}=this.createNewsfeedApi(t,e,s);return r}}}stop(){this.stop$.next()}createNewsfeedApi(e,t,s){const r=function(e,t,s,r){const a=new NewsfeedStorage(s),i=e.mainInterval.asMilliseconds(),o=(()=>{if(r)return new NeverFetchNewsfeedApiDriver;const s=f.i18n.getLocale(),n=e.fetchInterval.asMilliseconds();return new NewsfeedApiDriver(t,s,n,a)})(),l=(0,n.timer)(0,i).pipe((0,n.filter)((()=>o.shouldFetch())),(0,n.mergeMap)((()=>o.fetchNewsfeedItems(e.service).pipe((0,n.catchError)((e=>(window.console.error(e),(0,n.of)({error:e,kibanaVersion:t,hasNew:!1,feedItems:[]}))))))),(0,n.tap)((()=>a.setLastFetchTime(new Date))));return{fetchResults$:(0,n.combineLatest)([l,a.isAnyUnread$()]).pipe((0,n.map)((([e,t])=>({...e,hasNew:!e.error&&t})))),markAsRead:e=>{a.markItemsAsRead(e)}}}(e,this.kibanaVersion,t,s);return{markAsRead:r.markAsRead,fetchResults$:r.fetchResults$.pipe((0,n.takeUntil)(this.stop$),(0,n.catchError)((()=>n.of(null))))}}mount(e,t,s){const r=s.customBranding.hasCustomBranding$;return i().render((0,b.jsx)(c.KibanaRenderContextProvider,s,(0,b.jsx)(_,{newsfeedApi:e,hasCustomBranding$:r,isServerless:this.isServerless})),t),()=>i().unmountComponentAtNode(t)}}function E(e){return new NewsfeedPublicPlugin(e)}},943:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(286),n="undefined"!=typeof window?r.useLayoutEffect:r.useEffect;t.default=n},880:(e,t,s)=>{"use strict";var r=s(941),n=s(286),a=r.__importDefault(s(943));t.A=function(e,t){var s=n.useState(t),r=s[0],i=s[1];return a.default((function(){var t=e.subscribe(i);return function(){return t.unsubscribe()}}),[e]),r}},599:(e,t,s)=>{s.p=window.__kbnPublicPath__.newsfeed},185:(e,t,s)=>{e.exports=s(497)(51858)},915:(e,t,s)=>{e.exports=s(497)(67493)},286:e=>{"use strict";e.exports=__kbnSharedDeps__.React},941:e=>{"use strict";e.exports=__kbnSharedDeps__.TsLib},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},t={};function s(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,s),a.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=r[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),s(599),__kbnBundles__.define("plugin/newsfeed/public",s,528)})();