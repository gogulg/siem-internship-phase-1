(()=>{var e,t={5815:(e,t,n)=>{"use strict";n.d(t,{a:()=>a}),n(4286);var r=n(1319),s=n(6791),i={name:"d16ppa",styles:"z-index:auto;flex:1;display:flex;flex-direction:column;height:100%;min-height:$euiSizeL+2px;position:relative;justify-content:center;align-items:center"};const a=e=>(0,s.jsx)(r.EuiPanel,{css:i,role:"figure",paddingSize:"none",hasShadow:e.showShadow,hasBorder:e.showBorder,"data-test-subj":e.dataTestSubj},(0,s.jsx)(r.EuiLoadingChart,{size:"l"}))},8055:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Fn:()=>r.Fn,Registry:()=>r.Registry,addRegistries:()=>r.addRegistries,castProvider:()=>r.castProvider,fromExpression:()=>r.fromExpression,getByAlias:()=>r.getByAlias,getType:()=>r.getType,isAst:()=>r.isAst,isAstWithMeta:()=>r.isAstWithMeta,parse:()=>r.parse,register:()=>r.register,registryFactory:()=>r.registryFactory,safeElementFromExpression:()=>r.safeElementFromExpression,toExpression:()=>r.toExpression});var r=n(1570)},1570:(e,t,n)=>{"use strict";function r(e){return"object"==typeof(null==e?void 0:e.node)}function s(e){return"object"==typeof e&&"expression"===(null==e?void 0:e.type)}function i(e,t,n,r){var s=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(s,i.prototype),s.expected=t,s.found=n,s.location=r,s.name="SyntaxError",s}function a(e,t,n){return n=n||" ",e.length>t?e:(t-=e.length,e+(n+=n.repeat(t)).slice(0,t))}n.r(t),n.d(t,{Fn:()=>b,Registry:()=>Registry,addRegistries:()=>C,castProvider:()=>x,fromExpression:()=>u,getByAlias:()=>w,getType:()=>c,isAst:()=>s,isAstWithMeta:()=>r,parse:()=>o,register:()=>T,registryFactory:()=>S,safeElementFromExpression:()=>l,toExpression:()=>v}),function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(i,Error),i.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var n,r=null;for(n=0;n<e.length;n++)if(e[n].source===this.location.source){r=e[n].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,i=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(s):s,o=this.location.source+":"+i.line+":"+i.column;if(r){var u=this.location.end,l=a("",i.line.toString().length," "),c=r[s.line-1],p=(s.line===u.line?u.column:c.length+1)-s.column||1;t+="\n --\x3e "+o+"\n"+l+" |\n"+i.line+" | "+c+"\n"+l+" | "+a("",s.column-1," ")+a("",p,"^")}else t+="\n at "+o}return t},i.buildMessage=function(e,t){var n={literal:function(e){return'"'+s(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?i(e[0])+"-"+i(e[1]):i(e)}));return"["+(e.inverted?"^":"")+t.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function s(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+r(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+r(e)}))}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+r(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+r(e)}))}function a(e){return n[e.type](e)}return"Expected "+function(e){var t,n,r=e.map(a);if(r.sort(),r.length>0){for(t=1,n=1;t<r.length;t++)r[t-1]!==r[t]&&(r[n]=r[t],n++);r.length=n}switch(r.length){case 1:return r[0];case 2:return r[0]+" or "+r[1];default:return r.slice(0,-1).join(", ")+", or "+r[r.length-1]}}(e)+" but "+function(e){return e?'"'+s(e)+'"':"end of input"}(t)+" found."};const o=function(e,t){var n,r={},s=(t=void 0!==t?t:{}).grammarSource,a={expression:je,argument:Fe},o=je,u="|",l="=",c="$",p="{",d="}",h='"',f="'",m="//",g="/*",v="*/",y="\\",b=/^[a-zA-Z0-9_\-]/,x=/^[ \t\r\n]/,w=/^[^\n]/,E=/^[\t-\n\r "$'-)<->[-\]`{-}]/,C=/^[^"'(){}<>[\]$`|= \t\n\r]/,T=/^["\\]/,S=/^[^"]/,A=/^['\\]/,j=/^[^']/,_=we("|",!1),M=Ce("function"),F=we("=",!1),R=we("$",!1),O=we("{",!1),$=we("}",!1),N=Ee([["a","z"],["A","Z"],["0","9"],"_","-"],!1,!1),k=Ce("literal"),L=we('"',!1),P=we("'",!1),I=Ee([" ","\t","\r","\n"],!1,!1),H=we("//",!1),z=Ee(["\n"],!0,!1),q=we("/*",!1),D=we("*/",!1),U={type:"any"},B=we("\\",!1),G=Ee([["\t","\n"],"\r"," ",'"',"$",["'",")"],["<",">"],["[","]"],"`",["{","}"]],!1,!1),W=Ee(['"',"'","(",")","{","}","<",">","[","]","$","`","|","="," ","\t","\n","\r"],!0,!1),V=Ee(['"',"\\"],!1,!1),X=Ee(['"'],!0,!1),Y=Ee(["'","\\"],!1,!1),J=Ee(["'"],!0,!1),K=function(e,t){return t},Z=function(e,t){return Ie({type:"expression",chain:e?[e].concat(t):[]},be(),xe())},Q=function(e,t){return Ie({type:"function",function:e,arguments:t},be(),xe())},ee=function(e,t){return{name:e,value:t}},te=function(e){return{name:"_",value:e}},ne=function(e){return e},re=function(e){return Ie(e,be(),xe())},se=function(e){return e},ie=function(e){return e.reduce(((e,{name:t,value:n})=>({...e,[t]:(e[t]||[]).concat(n)})),{})},ae=function(e){return e.join("")},oe=function(e){return e.join("")},ue=function(e){return e.join("")},le=function(e){var t=e.join("");return"null"===t?null:"true"===t||"false"!==t&&(isNaN(Number(t))?t:Number(t))},ce=function(e){return e},pe=function(e){return e},de=function(e){return e},he=0|t.peg$currPos,fe=he,me=[{line:1,column:1}],ge=he,ve=t.peg$maxFailExpected||[],ye=0|t.peg$silentFails;if(t.startRule){if(!(t.startRule in a))throw new Error("Can't start parsing from rule \""+t.startRule+'".');o=a[t.startRule]}function be(){return e.substring(fe,he)}function xe(){return Se(fe,he)}function we(e,t){return{type:"literal",text:e,ignoreCase:t}}function Ee(e,t,n){return{type:"class",parts:e,inverted:t,ignoreCase:n}}function Ce(e){return{type:"other",description:e}}function Te(t){var n,r=me[t];if(r)return r;if(t>=me.length)n=me.length-1;else for(n=t;!me[--n];);for(r={line:(r=me[n]).line,column:r.column};n<t;)10===e.charCodeAt(n)?(r.line++,r.column=1):r.column++,n++;return me[t]=r,r}function Se(e,t,n){var r=Te(e),i=Te(t),a={source:s,start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:i.line,column:i.column}};return n&&s&&"function"==typeof s.offset&&(a.start=s.offset(a.start),a.end=s.offset(a.end)),a}function Ae(e){he<ge||(he>ge&&(ge=he,ve=[]),ve.push(e))}function je(){var t,n,s,i,a,o;for(t=he,Oe(),(n=_e())===r&&(n=null),s=[],i=he,124===e.charCodeAt(he)?(a=u,he++):(a=r,0===ye&&Ae(_)),a!==r?(Oe(),(o=_e())!==r?(fe=i,i=K(n,o)):(he=i,i=r)):(he=i,i=r);i!==r;)s.push(i),i=he,124===e.charCodeAt(he)?(a=u,he++):(a=r,0===ye&&Ae(_)),a!==r?(Oe(),(o=_e())!==r?(fe=i,i=K(n,o)):(he=i,i=r)):(he=i,i=r);return fe=t,Z(n,s)}function _e(){var e,t,n;return ye++,e=he,(t=Re())!==r?(n=function(){var e,t,n,s;for(e=he,t=[],n=he,Oe()!==r&&(s=Me())!==r?(fe=n,n=se(s)):(he=n,n=r);n!==r;)t.push(n),n=he,Oe()!==r&&(s=Me())!==r?(fe=n,n=se(s)):(he=n,n=r);return(n=Oe())===r&&(n=null),fe=e,e=ie(t)}(),fe=e,e=Q(t,n)):(he=e,e=r),ye--,e===r&&(t=r,0===ye&&Ae(M)),e}function Me(){var t,n,s,i;return t=he,(n=Re())!==r?(Oe(),61===e.charCodeAt(he)?(s=l,he++):(s=r,0===ye&&Ae(F)),s!==r?(Oe(),(i=Fe())!==r?(fe=t,t=ee(n,i)):(he=t,t=r)):(he=t,t=r)):(he=t,t=r),t===r&&(t=he,(n=Fe())!==r&&(fe=t,n=te(n)),t=n),t}function Fe(){var t,n,s,i,a;return t=he,36===e.charCodeAt(he)?(n=c,he++):(n=r,0===ye&&Ae(R)),n===r&&(n=null),123===e.charCodeAt(he)?(s=p,he++):(s=r,0===ye&&Ae(O)),s!==r&&(i=je())!==r?(125===e.charCodeAt(he)?(a=d,he++):(a=r,0===ye&&Ae($)),a!==r?(fe=t,t=ne(i)):(he=t,t=r)):(he=t,t=r),t===r&&(t=he,n=function(){var t;return ye++,t=function(){var t,n,s,i;if(t=he,34===e.charCodeAt(he)?(n=h,he++):(n=r,0===ye&&Ae(L)),n!==r){for(s=[],i=Le();i!==r;)s.push(i),i=Le();34===e.charCodeAt(he)?(i=h,he++):(i=r,0===ye&&Ae(L)),i!==r?(fe=t,t=oe(s)):(he=t,t=r)}else he=t,t=r;if(t===r)if(t=he,39===e.charCodeAt(he)?(n=f,he++):(n=r,0===ye&&Ae(P)),n!==r){for(s=[],i=Pe();i!==r;)s.push(i),i=Pe();39===e.charCodeAt(he)?(i=f,he++):(i=r,0===ye&&Ae(P)),i!==r?(fe=t,t=ue(s)):(he=t,t=r)}else he=t,t=r;return t}(),t===r&&(t=function(){var e,t,n,s;if(e=he,t=he,ye++,n=Ne(),ye--,n===r?t=void 0:(he=t,t=r),t!==r){if(n=[],(s=ke())!==r)for(;s!==r;)n.push(s),s=ke();else n=r;n!==r?(fe=e,e=le(n)):(he=e,e=r)}else he=e,e=r;return e}()),ye--,t===r&&0===ye&&Ae(k),t}(),n!==r&&(fe=t,n=re(n)),t=n),t}function Re(){var t,n,s;if(t=he,n=[],s=e.charAt(he),b.test(s)?he++:(s=r,0===ye&&Ae(N)),s!==r)for(;s!==r;)n.push(s),s=e.charAt(he),b.test(s)?he++:(s=r,0===ye&&Ae(N));else n=r;return n!==r&&(fe=t,n=ae(n)),n}function Oe(){var e,t;if(e=[],(t=$e())===r&&(t=Ne()),t!==r)for(;t!==r;)e.push(t),(t=$e())===r&&(t=Ne());else e=r;return e}function $e(){var t;return t=e.charAt(he),x.test(t)?he++:(t=r,0===ye&&Ae(I)),t}function Ne(){var t;return(t=function(){var t,n,s,i;if(t=he,e.substr(he,2)===m?(n=m,he+=2):(n=r,0===ye&&Ae(H)),n!==r){for(s=[],i=e.charAt(he),w.test(i)?he++:(i=r,0===ye&&Ae(z));i!==r;)s.push(i),i=e.charAt(he),w.test(i)?he++:(i=r,0===ye&&Ae(z));t=n=[n,s]}else he=t,t=r;return t}())===r&&(t=function(){var t,n,s,i,a,o;if(t=he,e.substr(he,2)===g?(n=g,he+=2):(n=r,0===ye&&Ae(q)),n!==r){for(s=[],i=he,a=he,ye++,e.substr(he,2)===v?(o=v,he+=2):(o=r,0===ye&&Ae(D)),ye--,o===r?a=void 0:(he=a,a=r),a!==r?(e.length>he?(o=e.charAt(he),he++):(o=r,0===ye&&Ae(U)),o!==r?i=a=[a,o]:(he=i,i=r)):(he=i,i=r);i!==r;)s.push(i),i=he,a=he,ye++,e.substr(he,2)===v?(o=v,he+=2):(o=r,0===ye&&Ae(D)),ye--,o===r?a=void 0:(he=a,a=r),a!==r?(e.length>he?(o=e.charAt(he),he++):(o=r,0===ye&&Ae(U)),o!==r?i=a=[a,o]:(he=i,i=r)):(he=i,i=r);e.substr(he,2)===v?(i=v,he+=2):(i=r,0===ye&&Ae(D)),i===r&&(i=null),t=n=[n,s,i]}else he=t,t=r;return t}()),t}function ke(){var t,n,s;return t=he,92===e.charCodeAt(he)?(n=y,he++):(n=r,0===ye&&Ae(B)),n!==r?(s=e.charAt(he),E.test(s)?he++:(s=r,0===ye&&Ae(G)),s!==r?(fe=t,t=ce(s)):(he=t,t=r)):(he=t,t=r),t===r&&(t=e.charAt(he),C.test(t)?he++:(t=r,0===ye&&Ae(W))),t}function Le(){var t,n,s;return t=he,92===e.charCodeAt(he)?(n=y,he++):(n=r,0===ye&&Ae(B)),n!==r?(s=e.charAt(he),T.test(s)?he++:(s=r,0===ye&&Ae(V)),s!==r?(fe=t,t=pe(s)):(he=t,t=r)):(he=t,t=r),t===r&&(t=e.charAt(he),S.test(t)?he++:(t=r,0===ye&&Ae(X))),t}function Pe(){var t,n,s;return t=he,92===e.charCodeAt(he)?(n=y,he++):(n=r,0===ye&&Ae(B)),n!==r?(s=e.charAt(he),A.test(s)?he++:(s=r,0===ye&&Ae(Y)),s!==r?(fe=t,t=de(s)):(he=t,t=r)):(he=t,t=r),t===r&&(t=e.charAt(he),j.test(t)?he++:(t=r,0===ye&&Ae(J))),t}function Ie(e,n,{start:{offset:r},end:{offset:s}}){return t.addMeta?{node:e,text:n,start:r,end:s}:e}if(n=o(),t.peg$library)return{peg$result:n,peg$currPos:he,peg$FAILED:r,peg$maxFailExpected:ve,peg$maxFailPos:ge};if(n!==r&&he===e.length)return n;throw n!==r&&he<e.length&&Ae({type:"end"}),function(e,t,n){return new i(i.buildMessage(e,t),e,t,n)}(ve,ge<e.length?e.charAt(ge):null,ge<e.length?Se(ge,ge+1):Se(ge,ge))};function u(e,t="expression"){try{return o(String(e),{startRule:t})}catch(e){throw new Error(`Unable to parse expression: ${e.message}`)}}function l(e){try{return u(e)}catch(e){return u("markdown\n\"## Crud.\nCanvas could not parse this element's expression. I am so sorry this error isn't more useful. I promise it will be soon.\n\nThanks for understanding,\n#### Management\n\"")}}function c(e){if(null==e)return"null";if("object"==typeof e){if(!e.type)throw new Error("Objects must have a type property");return e.type}return typeof e}var p=n(770);function d(e,t){let n="",i=0;return function(e,t){const n=[[o(e,{addMeta:!0}),t]],i=[];function a(e,t){(0,p.zip)(e.node.chain,t.chain).forEach((([e,t])=>{if(!e||!t||(null==e?void 0:e.node.function)!==(null==t?void 0:t.function))throw Error("Expression changes are not supported.");!function(e,t){if((0,p.xor)(Object.keys(e.node.arguments),Object.keys(t.arguments)).length)throw Error("Function changes are not supported.");(0,p.forEach)(e.node.arguments,((e,n)=>{!function(e,t){if(e.length!==t.length)throw Error("Arguments changes are not supported.");(0,p.zip)(e,t).forEach((([e,t])=>function(e,t){r(e)&&s(t)?a(e,t):e.node!==t&&i.push({type:"value",source:e,target:t})}(e,t)))}(e,t.arguments[n])}))}(e,t)}))}for(;n.length;)a(...n.shift());return i}(e,t).sort((({source:e},{source:t})=>e.start-t.start)).forEach((function(t){var s;if("value"!==(null==(s=t)?void 0:s.type))throw new Error("Cannot apply patch for the change.");!function(t){if(r(t.source))throw new Error("Patching sub-expressions is not supported.");n+=`${e.substring(i,t.source.start)}${v(t.target,"argument")}`,i=t.source.end}(t)})),n+=e.substring(i),n}function h(e,t,n=0){const r=c(e);function s(e,t){return null==e||"_"===e?t:`${e}=${t}`}if("string"===r)return s(t,`"${e.replace(/[\\"]/g,"\\$&")}"`);if("boolean"===r||"null"===r||"number"===r)return s(t,`${e}`);if("expression"===r)return s(t,`{${g(e.chain,n+1)}}`);throw new Error(`Invalid argument type in AST: ${r}`)}function f({arguments:e},t=0){if(null==e||"object"!=typeof e||Array.isArray(e))throw new Error("Arguments can only be an object");return Object.keys(e).map((n=>e[n].reduce(((e,r)=>{const s=h(r,n,t),i=e.split("\n").pop().length;return 0===t&&i+s.length>80?`${e}\n  ${s}`:i>0?`${e} ${s}`:s}),"")))}function m(e,t){var n;return`${e} ${null!==(n=null==t?void 0:t.join(" "))&&void 0!==n?n:""}`.trim()}function g(e,t=0){if(!e)throw new Error("Expressions must contain a chain");const n=t>0?" | ":"\n| ";return e.map((e=>{if("function"!==c(e))return;const{function:n}=e;if(!n)throw new Error("Functions must have a function name");return m(n,f(e,t))})).join(n)}function v(e,t="expression"){const{type:n,source:r}="string"==typeof t?{type:t}:t;if(r&&s(e))return d(r,e);if("argument"===n)return h(e);const i=c(e);if("expression"===i){const{chain:t}=e;if(!Array.isArray(t))throw new Error("Expressions must contain a chain");return g(t)}if("function"===i){const{function:t}=e;return m(t,f(e))}throw new Error("Expression must be an expression or argument function")}function y(e){if("_"===e.name)throw Error("Arg names must not be _. Use it in aliases instead.");this.name=e.name,this.required=e.required||!1,this.help=e.help||"",this.types=e.types||[],this.default=e.default,this.aliases=e.aliases||[],this.multi=null!=e.multi&&e.multi,this.resolve=null==e.resolve||e.resolve,this.options=e.options||[],this.accepts=t=>!this.types.length||(0,p.includes)(e.types,t)}function b(e){this.name=e.name,this.type=e.type,this.aliases=e.aliases||[],this.fn=(...t)=>Promise.resolve(e.fn(...t)),this.help=e.help||"",this.args=(0,p.mapValues)(e.args||{},((e,t)=>new y({name:t,...e}))),this.context=e.context||{},this.accepts=e=>!this.context.types||(0,p.includes)(this.context.types,e)}function x(e){return function(t,n){if(!n||0===n.length)return t;const r=c(t);if(n.includes(r))return t;const s=e[r];for(let i=0;i<n.length;i++){if(s&&s.castsTo(n[i]))return s.to(t,n[i],e);const a=e[n[i]];if(a&&a.castsFrom(r))return a.from(t,e)}throw new Error(`Can not cast '${r}' to any of '${n.join(", ")}'`)}}function w(e,t){const n=t.toLowerCase();return Object.values(e).find((({name:e,aliases:t})=>e.toLowerCase()===n||(t||[]).some((e=>e.toLowerCase()===n))))}var E=n(8915);class Registry{constructor(e="name"){if((0,E.default)(this,"_prop",void 0),(0,E.default)(this,"_indexed",void 0),"string"!=typeof e)throw new Error("Registry property name must be a string");this._prop=e,this._indexed=new Object}wrapper(e){return e}register(e){const t="function"==typeof e?e():e;if("object"!=typeof t||!t[this._prop])throw new Error(`Registered functions must return an object with a ${this._prop} property`);this._indexed[t[this._prop].toLowerCase()]=this.wrapper(t)}toJS(){return Object.keys(this._indexed).reduce(((e,t)=>(e[t]=this.get(t),e)),{})}toArray(){return Object.keys(this._indexed).map((e=>this.get(e)))}get(e){if(void 0===e)return null;const t=e.toLowerCase();return this._indexed[t]?(0,p.clone)(this._indexed[t]):null}getProp(){return this._prop}reset(){this._indexed=new Object}}function C(e,t){return Object.keys(t).forEach((n=>{if(e[n])throw new Error(`There is already a registry named "${n}".`);e[n]=t[n]})),e}function T(e,t){return Object.keys(t).forEach((n=>{if(!e[n])throw new Error(`There is no registry named "${n}".`);if(!e[n].register)throw new Error(`Registry "${n}" must have a register function.`);t[n].forEach((t=>e[n].register(t)))})),e}function S(e){return{registries:()=>e,register:t=>T(e,t)}}},5078:(e,t,n)=>{"use strict";n.d(t,{R:()=>i,q:()=>s});var r=n(5008);function s(e,t){return(t||[]).map((t=>null==e[t]?"":String(e[t]))).join("|")}function i(e,t,n,s,i={allowColumnOverwrite:!1}){if(!i.allowColumnOverwrite&&e.columns.some((e=>e.id===t)))throw new Error(r.i18n.translate("expressions.functions.seriesCalculations.columnConflictMessage",{defaultMessage:"Specified outputColumnId {columnId} already exists. Please pick another column id.",values:{columnId:t}}));const a=e.columns.find((e=>e.id===n));if(!a)return;const o={...a,id:t,name:s||t},u=[...e.columns],l=n===t?0:1,c=n===t?1:0;return u.splice(u.indexOf(a)+l,c,o),u}},9904:(e,t,n)=>{"use strict";n.d(t,{N:()=>ExpressionType});var r=n(8915),s=n(2998);class ExpressionType{constructor(e){(0,r.default)(this,"name",void 0),(0,r.default)(this,"namespace",void 0),(0,r.default)(this,"help",void 0),(0,r.default)(this,"validate",void 0),(0,r.default)(this,"create",void 0),(0,r.default)(this,"serialize",void 0),(0,r.default)(this,"deserialize",void 0),(0,r.default)(this,"definition",void 0),(0,r.default)(this,"getToFn",(e=>this.definition.to?this.definition.to[e]||this.definition.to["*"]:void 0)),(0,r.default)(this,"getFromFn",(e=>this.definition.from?this.definition.from[e]||this.definition.from["*"]:void 0)),(0,r.default)(this,"castsTo",(e=>"function"==typeof this.getToFn(e))),(0,r.default)(this,"castsFrom",(e=>"function"==typeof this.getFromFn(e))),(0,r.default)(this,"to",((e,t,n)=>{const r=(0,s.P)(e);if(r!==this.name)throw new Error(`Can not cast object of type '${r}' using '${this.name}'`);if(!this.castsTo(t))throw new Error(`Can not cast '${r}' to '${t}'`);return this.getToFn(t)(e,n)})),(0,r.default)(this,"from",((e,t)=>{const n=(0,s.P)(e);if(!this.castsFrom(n))throw new Error(`Can not cast '${this.name}' from ${n}`);return this.getFromFn(n)(e,t)}));const{name:t,help:n,deserialize:i,serialize:a,validate:o,namespace:u}=e;this.name=t,this.namespace=u,this.help=n||"",this.validate=o||(()=>{}),this.create=e.create,this.serialize=a,this.deserialize=i,this.definition=e}}},2998:(e,t,n)=>{"use strict";function r(e){if(null==e)return"null";if(Array.isArray(e))throw new Error("Unexpected array value encountered.");if("object"!=typeof e)return typeof e;const{type:t}=e;if(!t)throw new Error("Objects must have a type property");return t}n.d(t,{P:()=>r})},5878:(e,t,n)=>{"use strict";n.d(t,{NR:()=>a.N,Uq:()=>o.Uq,zM:()=>o.zM,lR:()=>o.lR,z3:()=>o.z3,pb:()=>o.pb,Pw:()=>r.P,Sl:()=>o.Sl,hj:()=>o.hj,cC:()=>o.cC,sJ:()=>o.sJ,bu:()=>o.bu,ai:()=>o.ai,yA:()=>o.yA,y1:()=>o.y1,XX:()=>o.XX,SQ:()=>i,cW:()=>o.cW,Yj:()=>o.Yj,iF:()=>o.iF,Fv:()=>o.Fv,xk:()=>o.xk,_n:()=>u});var r=n(2998);const s=e=>e,i=e=>({serialize:t=>(e[(0,r.P)(t)].serialize||s)(t),deserialize:t=>(e[(0,r.P)(t)].deserialize||s)(t)});var a=n(9904),o=n(9543);function u({type:e,...t}){return t}},2730:(e,t,n)=>{"use strict";n.d(t,{c:()=>i,z:()=>a});var r=n(2998);const s="error",i=e=>{try{return"error"===(0,r.P)(e)}catch(e){}return!1},a={name:s,to:{render:e=>({type:"render",as:s,value:{error:e.error,info:e.info}})}}},9543:(e,t,n)=>{"use strict";n.d(t,{Uq:()=>v,zM:()=>s,lR:()=>u,z3:()=>l.z,pb:()=>c,Sl:()=>p,hj:()=>o,cC:()=>l.c,sJ:()=>d,bu:()=>f,ai:()=>m,yA:()=>y,y1:()=>b,XX:()=>w,cW:()=>E,Yj:()=>C,iF:()=>T,Fv:()=>j,xk:()=>A});const r="boolean",s={name:r,from:{null:()=>!1,number:e=>Boolean(e),string:e=>Boolean(e)},to:{render:e=>({type:"render",as:"text",value:{text:`${e}`}}),datatable:e=>({type:"datatable",columns:[{id:"value",name:"value",meta:{type:r}}],rows:[{value:e}]})}};var i=n(770);const a="datatable",o=e=>"datatable"===(null==e?void 0:e.type),u={name:a,validate:e=>{if(!e.columns)throw new Error("datatable must have a columns array, even if it is empty");if(!e.rows)throw new Error("datatable must have a rows array, even if it is empty")},serialize:e=>{const{columns:t,rows:n}=e;return{...e,rows:n.map((e=>t.map((t=>e[t.name]))))}},deserialize:e=>{const{columns:t,rows:n}=e;return{...e,rows:n.map((e=>(0,i.zipObject)((0,i.map)(t,"name"),e)))}},from:{null:()=>({type:a,meta:{},rows:[],columns:[]}),pointseries:e=>({type:a,meta:{},rows:e.rows,columns:(0,i.map)(e.columns,((e,t)=>({id:t,name:e.expression,meta:{type:e.type}})))})},to:{render:e=>({type:"render",as:"table",value:{datatable:e,paginate:!0,perPage:10,showHeader:!0}}),pointseries:e=>{const t=["x","y","color","size","text"],n=e.columns.filter((e=>t.includes(e.id))),r=e.rows.map((e=>(0,i.pick)(e,t)));return{type:"pointseries",columns:n.reduce(((e,t)=>(e[t.name]={type:t.meta.type,expression:t.name,role:"dimension"},e)),{}),rows:r}}}};var l=n(2730);const c={name:"filter",from:{null:()=>({type:"filter",filterType:"filter",meta:{},and:[]})}},p={name:"image",to:{render:e=>({type:"render",as:"image",value:e})}},d={name:"null",from:{"*":()=>null}};var h=n(5008);const f={name:"num",from:{null:()=>({type:"num",value:0}),boolean:e=>({type:"num",value:Number(e)}),string:e=>{const t=Number(e);if(Number.isNaN(t))throw new Error(h.i18n.translate("expressions.types.number.fromStringConversionErrorMessage",{defaultMessage:'Can\'t typecast "{string}" string to number',values:{string:e}}));return{type:"num",value:t}},"*":e=>({type:"num",value:Number(e)})},to:{render:({value:e})=>({type:"render",as:"text",value:{text:`${e}`}}),datatable:({value:e})=>({type:"datatable",columns:[{id:"value",name:"value",meta:{type:"number"}}],rows:[{value:e}]})}},m={name:"number",from:{null:()=>0,boolean:e=>Number(e),string:e=>{const t=Number(e);if(Number.isNaN(t))throw new Error(h.i18n.translate("expressions.types.number.fromStringConversionErrorMessage",{defaultMessage:'Can\'t typecast "{string}" string to number',values:{string:e}}));return t}},to:{render:e=>({type:"render",as:"text",value:{text:`${e}`}}),datatable:e=>({type:"datatable",columns:[{id:"value",name:"value",meta:{type:"number"}}],rows:[{value:e}]})}},g="pointseries",v={X:"x",Y:"y",COLOR:"color",SIZE:"size",TEXT:"text"},y={name:g,from:{null:()=>({type:g,rows:[],columns:{}})},to:{render:(e,t)=>({type:"render",as:"table",value:{datatable:t.datatable.from(e,t),showHeader:!0}})}},b={name:"range",from:{null:()=>({type:"range",from:0,to:0})},to:{render:e=>({type:"render",as:"text",value:{text:(null==e?void 0:e.label)||`from ${e.from} to ${e.to}`}})}},x="render",w={name:x,from:{"*":e=>({type:x,as:"debug",value:e})}},E={name:"shape",to:{render:e=>({type:"render",as:"shape",value:e})}},C={name:"string",from:{null:()=>"",boolean:e=>String(e),number:e=>String(e)},to:{render:e=>({type:"render",as:"text",value:{text:e}}),datatable:e=>({type:"datatable",columns:[{id:"value",name:"value",meta:{type:"string"}}],rows:[{value:e}]})}},T={name:"style",from:{null:()=>({type:"style",spec:{},css:""})}};function S(e){return null==e?"null":Array.isArray(e)?e.length?S(e[0]):"unknown":["boolean","number","object","string"].includes(typeof e)?typeof e:"unknown"}const A={name:"ui_setting",to:{boolean:({value:e})=>Boolean(e),number:({value:e})=>Number(e),string:({value:e})=>String(null!=e?e:""),render:({value:e})=>({type:"render",as:"text",value:{text:"object"==typeof e&&null!==e?JSON.stringify(e):String(null!=e?e:"")}}),datatable:({key:e,value:t})=>({type:"datatable",columns:[{id:e,name:e,meta:{type:S(t)}}],rows:(Array.isArray(t)?t:[t]).map((t=>({[e]:t})))})}},j=[s,u,l.z,c,p,d,f,m,y,b,w,E,C,T,A]},2664:(e,t,n)=>{"use strict";n.r(t),n.d(t,{americanTypewriter:()=>r,arial:()=>s,baskerville:()=>i,bookAntiqua:()=>a,brushScript:()=>o,chalkboard:()=>u,didot:()=>l,fonts:()=>x,futura:()=>c,gillSans:()=>p,helveticaNeue:()=>d,hoeflerText:()=>h,inter:()=>f,lucidaGrande:()=>m,myriad:()=>g,openSans:()=>v,optima:()=>y,palatino:()=>b});const r={label:"American Typewriter",value:"'American Typewriter', 'Courier New', Courier, Monaco, mono"},s={label:"Arial",value:"Arial, sans-serif"},i={label:"Baskerville",value:"Baskerville, Georgia, Garamond, 'Times New Roman', Times, serif"},a={label:"Book Antiqua",value:"'Book Antiqua', Georgia, Garamond, 'Times New Roman', Times, serif"},o={label:"Brush Script",value:"'Brush Script MT', 'Comic Sans', sans-serif"},u={label:"Chalkboard",value:"Chalkboard, 'Comic Sans', sans-serif"},l={label:"Didot",value:"Didot, Georgia, Garamond, 'Times New Roman', Times, serif"},c={label:"Futura",value:"Futura, Impact, Helvetica, Arial, sans-serif"},p={label:"Gill Sans",value:"'Gill Sans', 'Lucida Grande', 'Lucida Sans Unicode', Verdana, Helvetica, Arial, sans-serif"},d={label:"Helvetica Neue",value:"'Helvetica Neue', Helvetica, Arial, sans-serif"},h={label:"Hoefler Text",value:"'Hoefler Text', Garamond, Georgia, 'Times New Roman', Times, serif"},f={label:"Inter",value:"'Inter', 'Inter UI', -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'"},m={label:"Lucida Grande",value:"'Lucida Grande', 'Lucida Sans Unicode', Lucida, Verdana, Helvetica, Arial, sans-serif"},g={label:"Myriad",value:"Myriad, Helvetica, Arial, sans-serif"},v={label:"Open Sans",value:"'Open Sans', Helvetica, Arial, sans-serif"},y={label:"Optima",value:"Optima, 'Lucida Grande', 'Lucida Sans Unicode', Verdana, Helvetica, Arial, sans-serif"},b={label:"Palatino",value:"Palatino, 'Book Antiqua', Georgia, Garamond, 'Times New Roman', Times, serif"},x=[r,s,i,a,o,u,l,c,p,d,h,f,m,g,v,y,b]},4552:(e,t,n)=>{"use strict";n.r(t),n.d(t,{BackgroundRepeat:()=>r,BackgroundSize:()=>s,ExpressionFunction:()=>ExpressionFunction,ExpressionRenderer:()=>ExpressionRenderer,ExpressionType:()=>C.NR,ExpressionsInspectorAdapter:()=>ExpressionsInspectorAdapter,ExpressionsService:()=>ExpressionsService,FontSizeUnit:()=>c,FontStyle:()=>i,FontWeight:()=>a,Overflow:()=>o,PointSeriesColumnNames:()=>C.Uq,TablesAdapter:()=>TablesAdapter,TextAlignment:()=>u,TextDecoration:()=>l,americanTypewriter:()=>E.americanTypewriter,arial:()=>E.arial,baskerville:()=>E.baskerville,bookAntiqua:()=>E.bookAntiqua,boolean:()=>C.zM,brushScript:()=>E.brushScript,buildExpression:()=>b,buildExpressionFunction:()=>h,buildResultColumns:()=>X.R,chalkboard:()=>E.chalkboard,clog:()=>j,createDefaultInspectorAdapters:()=>me,createError:()=>ae,createExecutionContainer:()=>ie,createExecutorContainer:()=>Q,createMockContext:()=>he,createTable:()=>M,cumulativeSum:()=>N,datatable:()=>C.lR,defaultState:()=>J,derivative:()=>L,didot:()=>E.didot,error:()=>C.z3,executionPureTransitions:()=>re,filter:()=>C.pb,font:()=>F,fonts:()=>E.fonts,format:()=>d,formatExpression:()=>x,futura:()=>E.futura,getBucketIdentifier:()=>X.q,getByAlias:()=>ue,getType:()=>C.Pw,getUiSettingFnBrowser:()=>q,getUiSettingFnServer:()=>D,gillSans:()=>E.gillSans,helveticaNeue:()=>E.helveticaNeue,hoeflerText:()=>E.hoeflerText,image:()=>C.Sl,inter:()=>E.inter,isDatatable:()=>C.hj,isExpressionAst:()=>v,isExpressionAstBuilder:()=>g,isExpressionValueError:()=>C.cC,lucidaGrande:()=>E.lucidaGrande,mapColumn:()=>V,math:()=>B,mathColumn:()=>G,movingAverage:()=>P,myriad:()=>E.myriad,nullType:()=>C.sJ,num:()=>C.bu,number:()=>C.ai,openSans:()=>E.openSans,optima:()=>E.optima,overallMetric:()=>k,palatino:()=>E.palatino,parse:()=>m,parseExpression:()=>w,pointseries:()=>C.yA,pureSelectors:()=>Z,pureTransitions:()=>K,range:()=>C.y1,render:()=>C.XX,serializeProvider:()=>C.SQ,shape:()=>C.cW,string:()=>C.Yj,style:()=>C.iF,theme:()=>$,typeSpecs:()=>C.Fv,uiSetting:()=>C.xk,unboxExpressionValue:()=>C._n,variable:()=>O,variableSet:()=>R});let r=function(e){return e.REPEAT="repeat",e.REPEAT_NO="no-repeat",e.REPEAT_X="repeat-x",e.REPEAT_Y="repeat-y",e.ROUND="round",e.SPACE="space",e}({}),s=function(e){return e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover",e}({}),i=function(e){return e.ITALIC="italic",e.NORMAL="normal",e}({}),a=function(e){return e.NORMAL="normal",e.BOLD="bold",e.BOLDER="bolder",e.LIGHTER="lighter",e.ONE="100",e.TWO="200",e.THREE="300",e.FOUR="400",e.FIVE="500",e.SIX="600",e.SEVEN="700",e.EIGHT="800",e.NINE="900",e}({}),o=function(e){return e.AUTO="auto",e.HIDDEN="hidden",e.SCROLL="scroll",e.VISIBLE="visible",e}({}),u=function(e){return e.CENTER="center",e.JUSTIFY="justify",e.LEFT="left",e.RIGHT="right",e}({}),l=function(e){return e.NONE="none",e.UNDERLINE="underline",e}({}),c=function(e){return e.PX="px",e.PT="pt",e}({});const{toExpression:p}=function(e){if(e&&e.__esModule&&void 0!==e.default){for(var t in e)"default"!==t&&"__esModule"!==t&&e.default[t]!==e[t]&&(e.default[t]=e[t]);return e.default}return e}(n(8055));function d(e,t){return p(e,t)}function h(e,t){const n=Object.entries(t).reduce(((e,[t,n])=>(Array.isArray(n)?e[t]=n.map((e=>v(e)?b(e):e)):void 0!==n?e[t]=v(n)?[b(n)]:[n]:delete e[t],e)),{...t});return{type:"expression_function_builder",name:e,arguments:n,addArgument(e,t){return void 0!==t&&(Object.hasOwn(n,e)||(n[e]=[]),n[e].push(t)),this},getArgument(e){if(Object.hasOwn(n,e))return n[e]},replaceArgument(e,t){if(!Object.hasOwn(n,e))throw new Error("Argument to replace does not exist on this function");return n[e]=t,this},removeArgument(e){return delete n[e],this},toAst:()=>({type:"function",function:e,arguments:Object.entries(n).reduce(((e,[t,n])=>(e[t]=n.map((e=>g(e)?e.toAst():e)),e)),{})}),toString(){return d({type:"expression",chain:[this.toAst()]},"expression")}}}const{parse:f}=function(e){if(e&&e.__esModule&&void 0!==e.default){for(var t in e)"default"!==t&&"__esModule"!==t&&e.default[t]!==e[t]&&(e.default[t]=e[t]);return e.default}return e}(n(8055));function m(e,t){try{return f(String(e),{startRule:t})}catch(e){throw new Error(`Unable to parse expression: ${e.message}`)}}function g(e){return"expression_builder"===(null==e?void 0:e.type)}function v(e){return"expression"===(null==e?void 0:e.type)}const y=e=>({type:"expression",chain:e.map((e=>e.toAst()))});function b(e){const t=e=>e.map((e=>h(e.function,e.arguments))),n=e?"string"==typeof(r=e)?t(m(r,"expression").chain):Array.isArray(r)?r:t(r.chain):[];var r;return{type:"expression_builder",functions:n,findFunction:e=>n.reduce(((t,n)=>(Object.values(n.arguments).forEach((n=>{n.forEach((n=>{g(n)&&(t=t.concat(n.findFunction(e)))}))})),n.name===e&&t.push(n),t)),[]),toAst(){if(n.length<1)throw new Error("Functions have not been added to the expression builder");return y(n)},toString(){if(n.length<1)throw new Error("Functions have not been added to the expression builder");return d(y(n),"expression")}}}function x(e){return d(e,"expression")}function w(e){return m(e,"expression")}var E=n(2664),C=n(5878),T=n(8915);class ExpressionFunctionParameter{constructor(e,t){(0,T.default)(this,"name",void 0),(0,T.default)(this,"required",void 0),(0,T.default)(this,"help",void 0),(0,T.default)(this,"types",void 0),(0,T.default)(this,"default",void 0),(0,T.default)(this,"aliases",void 0),(0,T.default)(this,"deprecated",void 0),(0,T.default)(this,"multi",void 0),(0,T.default)(this,"resolve",void 0),(0,T.default)(this,"strict",void 0),(0,T.default)(this,"options",void 0);const{required:n,help:r,types:s,aliases:i,deprecated:a,multi:o,options:u,resolve:l,strict:c}=t;if("_"===e)throw Error("Arg names must not be _. Use it in aliases instead.");this.name=e,this.required=!!n,this.help=r||"",this.types=s||[],this.default=t.default,this.aliases=i||[],this.deprecated=!!a,this.multi=!!o,this.options=u||[],this.resolve=null==l||l,this.strict=c}accepts(e){var t;return!(null!==(t=this.types)&&void 0!==t&&t.length)||this.types.includes(e)}}var S=n(770);class ExpressionFunction{constructor(e){(0,T.default)(this,"name",void 0),(0,T.default)(this,"namespace",void 0),(0,T.default)(this,"aliases",void 0),(0,T.default)(this,"type",void 0),(0,T.default)(this,"allowCache",void 0),(0,T.default)(this,"fn",void 0),(0,T.default)(this,"help",void 0),(0,T.default)(this,"args",{}),(0,T.default)(this,"inputTypes",void 0),(0,T.default)(this,"disabled",void 0),(0,T.default)(this,"deprecated",void 0),(0,T.default)(this,"telemetry",void 0),(0,T.default)(this,"extract",void 0),(0,T.default)(this,"inject",void 0),(0,T.default)(this,"migrations",void 0),(0,T.default)(this,"accepts",(e=>{var t,n;return null===(t=null===(n=this.inputTypes)||void 0===n?void 0:n.includes(e))||void 0===t||t}));const{name:t,type:n,aliases:r,fn:s,help:i,args:a,inputTypes:o,context:u,disabled:l,deprecated:c,telemetry:p,inject:d,extract:h,migrations:f,namespace:m,allowCache:g}=e;this.name=t,this.namespace=m,this.type=n,this.aliases=r||[],this.fn=s,this.help=i||"",this.inputTypes=o||(null==u?void 0:u.types),this.allowCache=g&&"boolean"!=typeof g?g:Boolean(g),this.disabled=l||!1,this.deprecated=!!c,this.telemetry=p||((e,t)=>t),this.inject=d||S.identity,this.extract=h||(e=>({state:e,references:[]})),this.migrations=f||{};for(const[e,t]of Object.entries(a||{}))this.args[e]=new ExpressionFunctionParameter(e,t)}}var A=n(3721);const j={name:"clog",args:{},help:"Outputs the _input_ in the console. This function is for debug purposes",fn:e=>(A.log(e),e)};var _=n(5008);const M={name:"createTable",type:"datatable",inputTypes:["null"],help:_.i18n.translate("expressions.functions.createTableHelpText",{defaultMessage:"Creates a datatable with a list of columns, and 1 or more empty rows. To populate the rows, use {mapColumnFn} or {mathColumnFn}.",values:{mathColumnFn:"`mathColumn`",mapColumnFn:"`mapColumn`"}}),args:{ids:{types:["string"],help:_.i18n.translate("expressions.functions.createTable.args.idsHelpText",{defaultMessage:"Column ids to generate in positional order. ID represents the key in the row."}),required:!1,multi:!0},names:{types:["string"],help:_.i18n.translate("expressions.functions.createTable.args.nameHelpText",{defaultMessage:"Column names to generate in positional order. Names are not required to be unique, and default to the ID if not provided."}),required:!1,multi:!0},rowCount:{types:["number"],help:_.i18n.translate("expressions.functions.createTable.args.rowCountText",{defaultMessage:"The number of empty rows to add to the table, to be assigned a value later"}),default:1,required:!1}},fn(e,t){var n;const r=[];return(null!==(n=t.ids)&&void 0!==n?n:[]).map(((e,n)=>{var s,i;r.push({id:e,name:null!==(s=null===(i=t.names)||void 0===i?void 0:i[n])&&void 0!==s?s:e,meta:{type:"null"}})})),{columns:r,rows:[...Array(t.rowCount)].map((()=>({}))),type:"datatable"}}},F={name:"font",aliases:[],type:"style",help:_.i18n.translate("expressions.functions.fontHelpText",{defaultMessage:"Create a font style."}),inputTypes:["null"],args:{align:{default:'{ theme "font.align" default="left" }',help:_.i18n.translate("expressions.functions.font.args.alignHelpText",{defaultMessage:"The horizontal text alignment."}),options:Object.values(u),types:["string"]},color:{default:'{ theme "font.color" }',help:_.i18n.translate("expressions.functions.font.args.colorHelpText",{defaultMessage:"The text color."}),types:["string"]},family:{default:`{ theme "font.family" default="${E.openSans.value}" }`,help:_.i18n.translate("expressions.functions.font.args.familyHelpText",{defaultMessage:"An acceptable {css} web font string",values:{css:"CSS"}}),types:["string"]},italic:{default:'{ theme "font.italic" default=false }',help:_.i18n.translate("expressions.functions.font.args.italicHelpText",{defaultMessage:"Italicize the text?"}),options:[!0,!1],types:["boolean"]},lHeight:{default:'{ theme "font.lHeight" }',aliases:["lineHeight"],help:_.i18n.translate("expressions.functions.font.args.lHeightHelpText",{defaultMessage:"The line height in pixels"}),types:["number","null"]},size:{default:'{ theme "font.size" default=14 }',help:_.i18n.translate("expressions.functions.font.args.sizeHelpText",{defaultMessage:"The font size"}),types:["number"]},sizeUnit:{default:"px",help:_.i18n.translate("expressions.functions.font.args.sizeUnitHelpText",{defaultMessage:"The font size unit"}),types:["string"],options:["px","pt"]},underline:{default:'{ theme "font.underline" default=false }',help:_.i18n.translate("expressions.functions.font.args.underlineHelpText",{defaultMessage:"Underline the text?"}),options:[!0,!1],types:["boolean"]},weight:{default:'{ theme "font.weight" default="normal" }',help:_.i18n.translate("expressions.functions.font.args.weightHelpText",{defaultMessage:"The font weight. For example, {list}, or {end}.",values:{list:Object.values(a).slice(0,-1).map((e=>`\`"${e}"\``)).join(", "),end:`\`"${Object.values(a).slice(-1)[0]}"\``}}),options:Object.values(a),types:["string"]}},fn:(e,t)=>{if(!Object.values(a).includes(t.weight))throw new Error(_.i18n.translate("expressions.functions.font.invalidFontWeightErrorMessage",{defaultMessage:"Invalid font weight: ''{weight}''",values:{weight:t.weight}}));if(!Object.values(u).includes(t.align))throw new Error(_.i18n.translate("expressions.functions.font.invalidTextAlignmentErrorMessage",{defaultMessage:"Invalid text alignment: ''{align}''",values:{align:t.align}}));const n=null!=t.lHeight?`${t.lHeight}px`:"1",r=[c.PX,c.PT];if(t.sizeUnit&&!r.includes(t.sizeUnit))throw new Error(_.i18n.translate("expressions.functions.font.invalidSizeUnitErrorMessage",{defaultMessage:"Invalid size unit: ''{sizeUnit}''",values:{sizeUnit:t.sizeUnit}}));const s={fontFamily:t.family,fontWeight:t.weight,fontStyle:t.italic?i.ITALIC:i.NORMAL,textDecoration:t.underline?l.UNDERLINE:l.NONE,textAlign:t.align,fontSize:`${t.size}${t.sizeUnit}`,lineHeight:n};return t.color&&(s.color=t.color),{type:"style",spec:s,css:(o=s,o?Object.keys(o).map((e=>e.trim().replace(/([a-z])([A-Z])/g,"$1-$2").replace(/\W/g,(e=>/[À-ž]/.test(e)?e:"-")).replace(/^-+|-+$/g,"").toLowerCase().concat(":").concat(String(o[e])))).join(";"):"")};var o}},R={name:"var_set",help:_.i18n.translate("expressions.functions.varset.help",{defaultMessage:"Updates the Kibana global context."}),args:{name:{types:["string"],aliases:["_"],required:!0,multi:!0,help:_.i18n.translate("expressions.functions.varset.name.help",{defaultMessage:"Specify the name of the variable."})},value:{aliases:["val"],multi:!0,help:_.i18n.translate("expressions.functions.varset.val.help",{defaultMessage:"Specify the value for the variable. When unspecified, the input context is used."})}},fn(e,t,n){const{variables:r}=n;return t.name.forEach(((n,s)=>{var i;r[n]=void 0===(null===(i=t.value)||void 0===i?void 0:i[s])?e:t.value[s]})),e}},O={name:"var",help:_.i18n.translate("expressions.functions.var.help",{defaultMessage:"Updates the Kibana global context."}),args:{name:{types:["string"],aliases:["_"],required:!0,help:_.i18n.translate("expressions.functions.var.name.help",{defaultMessage:"Specify the name of the variable."})}},fn(e,t,n){const{variables:r}=n;return r[t.name]}},$={name:"theme",aliases:[],help:_.i18n.translate("expressions.functions.themeHelpText",{defaultMessage:"Reads a theme setting."}),inputTypes:["null"],args:{variable:{aliases:["_"],help:_.i18n.translate("expressions.functions.theme.args.variableHelpText",{defaultMessage:"Name of the theme variable to read."}),required:!0,types:["string"]},default:{help:_.i18n.translate("expressions.functions.theme.args.defaultHelpText",{defaultMessage:"default value in case theming info is not available."})}},fn:(e,t,n)=>{const r=n.variables.theme||{};return(0,S.get)(r,t.variable,t.default)}},N={name:"cumulative_sum",type:"datatable",inputTypes:["datatable"],help:_.i18n.translate("expressions.functions.cumulativeSum.help",{defaultMessage:"Calculates the cumulative sum of a column in a data table"}),args:{by:{help:_.i18n.translate("expressions.functions.cumulativeSum.args.byHelpText",{defaultMessage:"Column to split the cumulative sum calculation by"}),multi:!0,types:["string"],required:!1},inputColumnId:{help:_.i18n.translate("expressions.functions.cumulativeSum.args.inputColumnIdHelpText",{defaultMessage:"Column to calculate the cumulative sum of"}),types:["string"],required:!0},outputColumnId:{help:_.i18n.translate("expressions.functions.cumulativeSum.args.outputColumnIdHelpText",{defaultMessage:"Column to store the resulting cumulative sum in"}),types:["string"],required:!0},outputColumnName:{help:_.i18n.translate("expressions.functions.cumulativeSum.args.outputColumnNameHelpText",{defaultMessage:"Name of the column to store the resulting cumulative sum in"}),types:["string"],required:!1}},async fn(e,t){const{cumulativeSumFn:r}=await n.e(20).then(n.bind(n,4020));return r(e,t)}},k={name:"overall_metric",type:"datatable",inputTypes:["datatable"],help:_.i18n.translate("expressions.functions.overallMetric.help",{defaultMessage:"Calculates the overall sum, min, max or average of a column in a data table"}),args:{by:{help:_.i18n.translate("expressions.functions.overallMetric.args.byHelpText",{defaultMessage:"Column to split the overall calculation by"}),multi:!0,types:["string"],required:!1},metric:{help:_.i18n.translate("expressions.functions.overallMetric.metricHelpText",{defaultMessage:"Metric to calculate"}),types:["string"],options:["sum","min","max","average"]},inputColumnId:{help:_.i18n.translate("expressions.functions.overallMetric.args.inputColumnIdHelpText",{defaultMessage:"Column to calculate the overall metric of"}),types:["string"],required:!0},outputColumnId:{help:_.i18n.translate("expressions.functions.overallMetric.args.outputColumnIdHelpText",{defaultMessage:"Column to store the resulting overall metric in"}),types:["string"],required:!0},outputColumnName:{help:_.i18n.translate("expressions.functions.overallMetric.args.outputColumnNameHelpText",{defaultMessage:"Name of the column to store the resulting overall metric in"}),types:["string"],required:!1}},async fn(e,t){const{overallMetricFn:r}=await n.e(71).then(n.bind(n,3071));return r(e,t)}},L={name:"derivative",type:"datatable",inputTypes:["datatable"],help:_.i18n.translate("expressions.functions.derivative.help",{defaultMessage:"Calculates the derivative of a column in a data table"}),args:{by:{help:_.i18n.translate("expressions.functions.derivative.args.byHelpText",{defaultMessage:"Column to split the derivative calculation by"}),multi:!0,types:["string"],required:!1},inputColumnId:{help:_.i18n.translate("expressions.functions.derivative.args.inputColumnIdHelpText",{defaultMessage:"Column to calculate the derivative of"}),types:["string"],required:!0},outputColumnId:{help:_.i18n.translate("expressions.functions.derivative.args.outputColumnIdHelpText",{defaultMessage:"Column to store the resulting derivative in"}),types:["string"],required:!0},outputColumnName:{help:_.i18n.translate("expressions.functions.derivative.args.outputColumnNameHelpText",{defaultMessage:"Name of the column to store the resulting derivative in"}),types:["string"],required:!1}},async fn(e,t){const{derivativeFn:r}=await n.e(30).then(n.bind(n,4030));return r(e,t)}},P={name:"moving_average",type:"datatable",inputTypes:["datatable"],help:_.i18n.translate("expressions.functions.movingAverage.help",{defaultMessage:"Calculates the moving average of a column in a data table"}),args:{by:{help:_.i18n.translate("expressions.functions.movingAverage.args.byHelpText",{defaultMessage:"Column to split the moving average calculation by"}),multi:!0,types:["string"],required:!1},inputColumnId:{help:_.i18n.translate("expressions.functions.movingAverage.args.inputColumnIdHelpText",{defaultMessage:"Column to calculate the moving average of"}),types:["string"],required:!0},outputColumnId:{help:_.i18n.translate("expressions.functions.movingAverage.args.outputColumnIdHelpText",{defaultMessage:"Column to store the resulting moving average in"}),types:["string"],required:!0},outputColumnName:{help:_.i18n.translate("expressions.functions.movingAverage.args.outputColumnNameHelpText",{defaultMessage:"Name of the column to store the resulting moving average in"}),types:["string"],required:!1},window:{help:_.i18n.translate("expressions.functions.movingAverage.args.windowHelpText",{defaultMessage:'The size of window to "slide" across the histogram.'}),types:["number"],default:5}},async fn(e,t){const{movingAverageFn:r}=await n.e(227).then(n.bind(n,7227));return r(e,t)}},I={name:"uiSetting",help:_.i18n.translate("expressions.functions.uiSetting.help",{defaultMessage:"Returns a UI settings parameter value."}),args:{default:{help:_.i18n.translate("expressions.functions.uiSetting.args.default",{defaultMessage:"A default value in case of the parameter is not set."})},parameter:{aliases:["_"],help:_.i18n.translate("expressions.functions.uiSetting.args.parameter",{defaultMessage:"The parameter name."}),required:!0,types:["string"]}}},H=new Error(_.i18n.translate("expressions.functions.uiSetting.error.kibanaRequest",{defaultMessage:"A KibanaRequest is required to get UI settings on the server. Please provide a request object to the expression execution params."})),z=e=>new Error(_.i18n.translate("expressions.functions.uiSetting.error.parameter",{defaultMessage:'Invalid parameter "{parameter}".',values:{parameter:e}}));function q({getStartDependencies:e}){return{...I,async fn(t,{default:n,parameter:r},{getKibanaRequest:s}){const{uiSettings:i}=await e((()=>{const e=null==s?void 0:s();if(!e)throw H;return e}));try{return{type:"ui_setting",key:r,value:await i.get(r,n)}}catch{throw z(r)}}}}function D({getStartDependencies:e}){return{...I,async fn(t,{parameter:n},{getKibanaRequest:r}){const{uiSettings:s}=await e((()=>{const e=null==r?void 0:r();if(!e)throw H;return e}));try{return{type:"ui_setting",key:n,value:await s.get(n)}}catch{throw z(n)}}}}const U="`TinyMath`",B={name:"math",type:void 0,inputTypes:["number","datatable"],help:_.i18n.translate("expressions.functions.mathHelpText",{defaultMessage:"Interprets a {TINYMATH} math expression using a {TYPE_NUMBER} or {DATATABLE} as {CONTEXT}. The {DATATABLE} columns are available by their column name. If the {CONTEXT} is a number it is available as {value}.",values:{TINYMATH:U,CONTEXT:"_context_",DATATABLE:"`datatable`",value:"`value`",TYPE_NUMBER:"`number`"}}),args:{expression:{aliases:["_"],types:["string"],help:_.i18n.translate("expressions.functions.math.args.expressionHelpText",{defaultMessage:"An evaluated {TINYMATH} expression. See {TINYMATH_URL}.",values:{TINYMATH:U,TINYMATH_URL:"https://www.elastic.co/guide/en/kibana/current/canvas-tinymath-functions.html"}})},onError:{types:["string"],options:["throw","false","zero","null"],help:_.i18n.translate("expressions.functions.math.args.onErrorHelpText",{defaultMessage:"In case the {TINYMATH} evaluation fails or returns NaN, the return value is specified by onError. When `'throw'`, it will throw an exception, terminating expression execution (default).",values:{TINYMATH:U}})}},fn:async(e,t)=>{const{mathFn:r}=await n.e(123).then(n.bind(n,9123));return r(e,t)}},G={name:"mathColumn",type:"datatable",inputTypes:["datatable"],help:_.i18n.translate("expressions.functions.mathColumnHelpText",{defaultMessage:"Adds a column by evaluating {tinymath} on each row. This function is optimized for math and performs better than using a math expression in {mapColumnFn}.",values:{mapColumnFn:"`mapColumn`",tinymath:"`TinyMath`"}}),args:{...B.args,id:{types:["string"],help:_.i18n.translate("expressions.functions.mathColumn.args.idHelpText",{defaultMessage:"id of the resulting column. Must be unique."}),required:!0},name:{types:["string"],aliases:["_","column"],help:_.i18n.translate("expressions.functions.mathColumn.args.nameHelpText",{defaultMessage:"The name of the resulting column. Names are not required to be unique."}),required:!0},castColumns:{types:["string"],multi:!0,help:_.i18n.translate("expressions.functions.mathColumn.args.castColumnsHelpText",{defaultMessage:"The ids of columns to cast to numbers before applying the formula"}),required:!1},copyMetaFrom:{types:["string","null"],help:_.i18n.translate("expressions.functions.mathColumn.args.copyMetaFromHelpText",{defaultMessage:"If set, the meta object from the specified column id is copied over to the specified target column. If the column doesn't exist it silently fails."}),required:!1,default:null}},fn:async(e,t,n)=>{var r;const s=[...e.columns];if(s.findIndex((({id:e})=>e===t.id))>-1)throw new Error(_.i18n.translate("expressions.functions.mathColumn.uniqueIdError",{defaultMessage:"ID must be unique"}));const i=await Promise.all(e.rows.map((async r=>{let s=r;t.castColumns&&(s={...r},t.castColumns.forEach((e=>{switch(typeof r[e]){case"string":const t=Number(new Date(s[e]));return isNaN(t)?void(s[e]=Number(s[e])):void(s[e]=t);case"boolean":return void(s[e]=Number(s[e]))}})));const i=await B.fn({...e,columns:e.columns,rows:[s]},{expression:t.expression,onError:t.onError},n);if(Array.isArray(i)){if(1===i.length)return{...r,[t.id]:i[0]};throw new Error(_.i18n.translate("expressions.functions.mathColumn.arrayValueError",{defaultMessage:"Cannot perform math on array values at {name}",values:{name:t.name}}))}return{...r,[t.id]:i}})));let a="null";if(i.length)for(const e of i){const n=(0,C.Pw)(e[t.id]);if("null"!==n){a=n;break}}const o={id:t.id,name:null!==(r=t.name)&&void 0!==r?r:t.id,meta:{type:a,params:{id:a}}};if(t.copyMetaFrom){const e=s.find((({id:e})=>e===t.copyMetaFrom));o.meta={...o.meta,...(null==e?void 0:e.meta)||{}}}return s.push(o),{...e,columns:s,rows:i}}};var W=n(190);const V={name:"mapColumn",aliases:["mc"],type:"datatable",inputTypes:["datatable"],help:_.i18n.translate("expressions.functions.mapColumnHelpText",{defaultMessage:"Adds a column calculated as the result of other columns. Changes are made only when you provide arguments.See also {alterColumnFn} and {staticColumnFn}.",values:{alterColumnFn:"`alterColumn`",staticColumnFn:"`staticColumn`"}}),args:{id:{types:["string","null"],help:_.i18n.translate("expressions.functions.mapColumn.args.idHelpText",{defaultMessage:"An optional id of the resulting column. When no id is provided, the id will be looked up from the existing column by the provided name argument. If no column with this name exists yet, a new column with this name and an identical id will be added to the table."}),required:!1,default:null},name:{types:["string"],aliases:["_","column"],help:_.i18n.translate("expressions.functions.mapColumn.args.nameHelpText",{defaultMessage:"The name of the resulting column. Names are not required to be unique."}),required:!0},expression:{types:["boolean","number","string","null"],resolve:!1,aliases:["exp","fn","function"],help:_.i18n.translate("expressions.functions.mapColumn.args.expressionHelpText",{defaultMessage:"An expression that is executed on every row, provided with a single-row {DATATABLE} context and returning the cell value.",values:{DATATABLE:"`datatable`"}}),required:!0},copyMetaFrom:{types:["string","null"],help:_.i18n.translate("expressions.functions.mapColumn.args.copyMetaFromHelpText",{defaultMessage:"If set, the meta object from the specified column id is copied over to the specified target column. If the column doesn't exist it silently fails."}),required:!1,default:null}},fn(e,t){var n,r,s;const i=t.copyMetaFrom?e.columns.find((({id:e})=>e===t.copyMetaFrom)):void 0,a=e.columns.findIndex((({id:e,name:n})=>t.id?e===t.id:n===t.name)),o=-1===a?e.columns.length:a,u=null!==(n=null!==(r=null===(s=e.columns[o])||void 0===s?void 0:s.id)&&void 0!==r?r:t.id)&&void 0!==n?n:t.name;return(0,W.defer)((()=>(0,W.combineLatest)(e.rows.map((n=>t.expression({...e,columns:[...e.columns],rows:[n]}).pipe((0,W.map)((e=>({...n,[u]:e}))),(0,W.defaultIfEmpty)(n))))))).pipe((0,W.defaultIfEmpty)([]),(0,W.map)((n=>{var r;let s="null";for(const e of n){const t=(0,C.Pw)(e[u]);if("null"!==t){s=t;break}}const a=[...e.columns];return a[o]={id:u,name:t.name,meta:{type:s,params:{id:s},...null!==(r=null==i?void 0:i.meta)&&void 0!==r?r:{}}},{...e,columns:a,rows:n}})))}};var X=n(5078);class ExpressionRenderer{constructor(e){(0,T.default)(this,"name",void 0),(0,T.default)(this,"namespace",void 0),(0,T.default)(this,"displayName",void 0),(0,T.default)(this,"help",void 0),(0,T.default)(this,"validate",void 0),(0,T.default)(this,"reuseDomNode",void 0),(0,T.default)(this,"render",void 0);const{name:t,displayName:n,help:r,validate:s,reuseDomNode:i,render:a,namespace:o}=e;this.name=t,this.namespace=o,this.displayName=n||t,this.help=r||"",this.validate=s||(()=>{}),this.reuseDomNode=Boolean(i),this.render=a}}class ExpressionRendererRegistry{constructor(){(0,T.default)(this,"renderers",new Map)}register(e){"function"==typeof e&&(e=e());const t=new ExpressionRenderer(e);this.renderers.set(t.name,t)}get(e){return this.renderers.get(e)||null}toJS(){return this.toArray().reduce(((e,t)=>(e[t.name]=t,e)),{})}toArray(){return[...this.renderers.values()]}}var Y=n(136);const J={functions:{},types:{},context:{}},K={addFunction:e=>t=>({...e,functions:{...e.functions,[t.name]:t}}),addType:e=>t=>({...e,types:{...e.types,[t.name]:t}})},Z={getFunction:e=>t=>e.functions[t]||null,getType:e=>t=>e.types[t]||null,getContext:({context:e})=>()=>e},Q=(e=J)=>(0,Y.createStateContainer)(e,K,Z);var ee=n(1359);const te=__kbnSharedDeps__.KbnStd,ne={...J,state:"not-started",ast:{type:"expression",chain:[]}},re={start:e=>()=>({...e,state:"pending"}),setResult:e=>t=>({...e,state:"result",result:t}),setError:e=>t=>({...e,state:"error",error:t})},se=e=>e,ie=(e=ne)=>(0,Y.createStateContainer)(e,re,{},{freeze:se}),ae=e=>({type:"error",error:{stack:void 0,message:"string"==typeof e?e:String(e.message),name:"object"==typeof e&&e.name||"Error",original:e instanceof Error?e:"object"==typeof e&&"original"in e&&e.original instanceof Error?e.original:void 0}}),oe="*";function ue(e,t,n){const r=t.toLowerCase();return Object.values(e).find((({name:e,aliases:t,namespace:s})=>!!e&&(!(e.toLowerCase()!==r||s&&n!==oe&&s!==n)||(t||[]).some((e=>e.toLowerCase()===r&&(!s||n===oe||s===n))))))}var le=n(4335);function ce(e,t){return e.get(pe(e,t))}function pe(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var de=new WeakMap;class TablesAdapter extends le.EventEmitter{constructor(...e){var t,n,r;super(...e),r={},function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t=this,n=de),n.set(t,r),(0,T.default)(this,"allowCsvExport",!1),(0,T.default)(this,"initialSelectedTable",void 0)}logDatatable(e,t){ce(de,this)[e]=t,this.emit("change",this.tables)}reset(){var e,t;t={},(e=de).set(pe(e,this),t),this.emit("change",this.tables)}get tables(){return ce(de,this)}}class ExpressionsInspectorAdapter extends le.EventEmitter{constructor(...e){super(...e),(0,T.default)(this,"_ast",{})}logAST(e){this._ast=e,this.emit("change",this._ast)}get ast(){return this._ast}}const he=()=>({getSearchContext:()=>({}),getSearchSessionId:()=>{},types:{},variables:{},abortSignal:{},inspectorAdapters:{}});var fe=n(8370);const me=()=>({requests:new fe.RequestAdapter,tables:new TablesAdapter,expression:new ExpressionsInspectorAdapter});var ge=n(2730);class ExecutionContract{get isPending(){const{state:e,result:t}=this.execution.state.get();return!("error"===e||"result"===e&&(null==t||!t.partial))}constructor(e){(0,T.default)(this,"execution",void 0),(0,T.default)(this,"cancel",(()=>{this.execution.cancel()})),(0,T.default)(this,"getData",(()=>this.execution.result.pipe((0,W.catchError)((({name:e,message:t,stack:n})=>(0,W.of)({partial:!1,result:{type:"error",error:{name:e,message:t,stack:n}}})))))),(0,T.default)(this,"getExpression",(()=>this.execution.expression)),(0,T.default)(this,"getAst",(()=>this.execution.state.get().ast)),(0,T.default)(this,"inspect",(()=>this.execution.inspectorAdapters)),this.execution=e}}function ve(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var ye=new WeakSet;class Execution{get inspectorAdapters(){return this.context.inspectorAdapters}constructor(e,t,n=new Map){var r,s;(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(r=this,s=ye),s.add(r),(0,T.default)(this,"state",void 0),(0,T.default)(this,"input",null),(0,T.default)(this,"input$",new W.ReplaySubject(1)),(0,T.default)(this,"context",void 0),(0,T.default)(this,"abortController",new AbortController),(0,T.default)(this,"hasStarted",!1),(0,T.default)(this,"result",void 0),(0,T.default)(this,"childExecutions",[]),(0,T.default)(this,"cacheTimeout",3e4),(0,T.default)(this,"contract",void 0),(0,T.default)(this,"expression",void 0),this.execution=e,this.logger=t,this.functionCache=n;const{executor:i}=e;if(this.contract=new ExecutionContract(this),!e.ast&&!e.expression)throw new TypeError("Execution params should contain at least .ast or .expression key.");if(e.ast&&e.expression)throw new TypeError("Execution params cannot contain both .ast and .expression key.");this.expression=e.expression||x(e.ast);const a=e.ast||w(this.expression);this.state=ie({...i.state,state:"not-started",ast:a});const o=e.params.inspectorAdapters||me();this.context={getSearchContext:()=>this.execution.params.searchContext||{},getSearchSessionId:()=>e.params.searchSessionId,getKibanaRequest:e.params.kibanaRequest?()=>e.params.kibanaRequest:void 0,variables:e.params.variables||{},allowCache:this.execution.params.allowCache,types:i.getTypes(),abortSignal:this.abortController.signal,inspectorAdapters:o,logDatatable:(e,t)=>{o.tables[e]=t},isSyncColorsEnabled:()=>e.params.syncColors,isSyncCursorEnabled:()=>e.params.syncCursor,isSyncTooltipsEnabled:()=>e.params.syncTooltips,...e.executor.context,getExecutionContext:()=>e.params.executionContext},this.result=this.input$.pipe((0,W.switchMap)((e=>{return this.invokeChain(this.state.get().ast.chain,e).pipe((n=this.abortController.signal,e=>new W.Observable((t=>{const r=()=>{t.error(new ee.AbortError)};t.add(e.subscribe(t)),t.add((()=>n.removeEventListener("abort",r))),n.addEventListener("abort",r),n.aborted&&r()}))),(e=>new W.Observable((t=>{let n;t.add(e.subscribe({next:e=>{n={result:e,partial:!0},t.next(n)},error:e=>t.error(e),complete:()=>{n&&(n.partial=!1),t.complete()}})),t.add((()=>{n=void 0}))}))),this.execution.params.partial&&this.execution.params.throttle?(t=this.execution.params.throttle,e=>new W.Observable((n=>{let r,s=!1;const i=()=>{s&&(n.next(r),s=!1,r=void 0)};let a;const o=(0,W.timer)(0,t).pipe((0,W.takeWhile)((()=>s)),(0,W.finalize)((()=>{n.remove(a),a=void 0})));n.add(e.subscribe({next:e=>{r=e,s=!0,a||(a=o.subscribe(i),n.add(a))},error:e=>n.error(e),complete:()=>{i(),n.complete()}})),n.add((()=>{s=!1,r=void 0}))}))):W.identity);var t,n})),(0,W.catchError)((e=>this.abortController.signal.aborted?(this.childExecutions.forEach((e=>e.cancel())),(0,W.of)({result:ae({message:"The expression was aborted.",name:"AbortError"}),partial:!1})):(0,W.throwError)(e))),(0,W.tap)({next:e=>{var t;null===(t=this.context.inspectorAdapters.expression)||void 0===t||t.logAST(this.state.get().ast),this.state.transitions.setResult(e)},error:e=>this.state.transitions.setError(e)}),(0,W.shareReplay)(1))}cancel(){this.abortController.abort()}start(e=null,t){if(this.hasStarted)throw new Error("Execution already started.");var n;return this.hasStarted=!0,this.input=e,this.state.transitions.start(),t||null===(n=this.context.inspectorAdapters.requests)||void 0===n||n.reset(),(0,W.isObservable)(e)?e.subscribe(this.input$):(0,te.isPromise)(e)?(0,W.from)(e).subscribe(this.input$):(0,W.of)(e).subscribe(this.input$),this.result}invokeChain([e,...t],n){return e?(0,W.defer)((()=>{const{function:r,arguments:s}=e,i=ue(this.state.get().functions,r,this.execution.params.namespace);if(!i)throw ae({name:"fn not found",message:_.i18n.translate("expressions.execution.functionNotFound",{defaultMessage:"Function {fnName} could not be found.",values:{fnName:r}})});if(i.disabled)throw ae({name:"fn is disabled",message:_.i18n.translate("expressions.execution.functionDisabled",{defaultMessage:"Function {fnName} is disabled.",values:{fnName:r}})});var a;i.deprecated&&(null===(a=this.logger)||void 0===a||a.warn(`Function '${r}' is deprecated`)),this.execution.params.debug&&(e.debug={input:n,args:{},duration:0,fn:i.name,success:!0});const o=this.execution.params.debug?(0,ee.now)():0;return this.resolveArgs(i,n,s).pipe((0,W.switchMap)((s=>((0,ge.c)(s)?(0,W.throwError)(s.error):(0,W.of)(s)).pipe((0,W.tap)((t=>{var n;return this.execution.params.debug&&Object.assign(null!==(n=e.debug)&&void 0!==n?n:{},{args:t})})),(0,W.switchMap)((e=>this.invokeFunction(i,n,e))),this.execution.params.partial?W.identity:(0,W.last)(),(0,W.switchMap)((e=>"error"===(0,C.Pw)(e)?(0,W.throwError)(e):(0,W.of)(e))),(0,W.tap)((t=>{var n;return this.execution.params.debug&&Object.assign(null!==(n=e.debug)&&void 0!==n?n:{},{output:t})})),(0,W.switchMap)((e=>this.invokeChain(t,e))),(0,W.catchError)((t=>{const n=ae(t);var s;return n.error.message=`[${r}] > ${n.error.message}`,this.execution.params.debug&&Object.assign(null!==(s=e.debug)&&void 0!==s?s:{},{error:n,rawError:t,success:!1}),(0,W.of)(n)}))))),(0,W.finalize)((()=>{var t;this.execution.params.debug&&Object.assign(null!==(t=e.debug)&&void 0!==t?t:{},{duration:(0,ee.now)()-o})})))})).pipe((0,W.catchError)((e=>(0,W.of)(e)))):(0,W.of)(n)}invokeFunction(e,t,n){let r,s,i=!1;return(0,W.of)(t).pipe((0,W.map)((t=>this.cast(t,e.inputTypes))),(0,W.switchMap)((t=>{const{hash:s,value:i,valid:a}=ve(ye,this,be).call(this,e,t,n);var o;if(r=s,a)return null===(o=i.sideEffectFn)||void 0===o||o.call(i),(0,W.of)(i.value);const u=e.fn(t,n,this.context);return(0,W.of)(u)})),(0,W.switchMap)((e=>(0,W.isObservable)(e)?e:(0,W.from)((0,te.isPromise)(e)?e:[e]))),(0,W.map)((t=>{const n=(0,C.Pw)(t),r=e.type;if(r&&n!==r)throw new Error(`Function '${e.name}' should return '${r}', actually returned '${n}'`);const i=this.context.types[e.type];if(i&&i.validate)try{i.validate(t)}catch(t){throw new Error(`Output of '${e.name}' is not a valid type '${e.type}': ${t}`)}return s=t,t})),(0,W.finalize)((()=>{if(i&&r){const t=ve(ye,this,xe).call(this,e,n);for(;this.functionCache.size>=1e3;)this.functionCache.delete(this.functionCache.keys().next().value);this.functionCache.set(r,{value:s,time:Date.now(),sideEffectFn:t})}}))).pipe((0,W.tap)({complete:()=>i=!0}))}cast(e,t){if(null==t||!t.length)return e;const n=(0,C.Pw)(e);if(t.includes(n))return e;const{types:r}=this.state.get(),s=r[n];for(const i of t){if(null!=s&&s.castsTo(i))return s.to(e,i,r);const t=r[i];if(null!=t&&t.castsFrom(n))return t.from(e,r)}throw ae({name:"invalid value",message:`Can not cast '${n}' to any of '${t.join(", ")}'`})}validate(e,t){var n;if(null!==(n=t.options)&&void 0!==n&&n.length&&!t.options.includes(e)){var r;const n=`Value '${e}' is not among the allowed options for argument '${t.name}': '${t.options.join("', '")}'`;if(t.strict)throw ae({message:n,name:"invalid argument"});null===(r=this.logger)||void 0===r||r.warn(n)}}resolveArgs(e,t,n){return(0,W.defer)((()=>{const{args:r}=e,s=(0,S.reduce)(n,((t,n,s)=>{const i=ue(r,s);if(!i)throw ae({name:"unknown argument",message:`Unknown argument '${s}' passed to function '${e.name}'`});var a;return i.deprecated&&!t[i.name]&&(null===(a=this.logger)||void 0===a||a.warn(`Argument '${s}' is deprecated in function '${e.name}'`)),t[i.name]=(t[i.name]||[]).concat(n),t}),{});for(const{default:t,name:n,required:i}of Object.values(r))if(n in s||void 0===t||(s[n]=[m(t,"argument")]),i&&!(n in s))throw ae({name:"missing argument",message:`${e.name} requires the "${n}" argument`});const i=(0,S.mapValues)(s,((e,n)=>e.map((e=>(s=t)=>this.interpret(e,s).pipe((0,W.pluck)("result"),(0,W.switchMap)((e=>(0,ge.c)(e)?(0,W.of)(e):(0,W.of)(e).pipe((0,W.map)((e=>this.cast(e,r[n].types))),(0,W.tap)((e=>this.validate(e,r[n]))),(0,W.catchError)((e=>(0,W.of)(e))))))))))),a=(0,S.keys)(i);return a.length?(0,W.combineLatest)(a.map((e=>{const t=i[e];return t.length?r[e].resolve?(0,W.combineLatest)(t.map((e=>e()))).pipe((0,W.map)((e=>{var t;return null!==(t=e.find(ge.c))&&void 0!==t?t:e}))):(0,W.of)(t):(0,W.of)([])}))).pipe((0,W.map)((e=>{var t;return null!==(t=e.find(ge.c))&&void 0!==t?t:(0,S.mapValues)((0,S.zipObject)(a,e),((e,t)=>r[t].multi?e:(0,S.last)(e)))}))):(0,W.from)([{}])})).pipe((0,W.catchError)((e=>(0,W.of)(e))))}interpret(e,t){switch((0,C.Pw)(e)){case"expression":const n=this.execution.executor.createExecution(e,{...this.execution.params,variables:this.context.variables});return this.childExecutions.push(n),n.start(t,!0);case"string":case"number":case"null":case"boolean":return(0,W.of)({result:e,partial:!1});default:return(0,W.throwError)(new Error(`Unknown AST object: ${JSON.stringify(e)}`))}}}function be(e,t,n){if(!e.allowCache||!this.context.allowCache)return{hash:void 0,value:void 0,valid:!1};const r=(0,ee.calculateObjectHash)([e.name,t,n,this.context.getSearchContext()]),s=this.functionCache.get(r);return r&&s?{hash:r,value:s,valid:Boolean(s&&Date.now()-s.time<this.cacheTimeout)}:{hash:r,value:void 0,valid:!1}}function xe(e,t){var n,r;if(e.allowCache&&"boolean"!=typeof e.allowCache)return null===(n=(r=e.allowCache).withSideEffects)||void 0===n?void 0:n.call(r,t,this.context)}var we=n(9904),Ee=n(9543);class TypesRegistry{constructor(e){this.executor=e}register(e){this.executor.registerType(e)}get(e){var t;return null!==(t=this.executor.getType(e))&&void 0!==t?t:null}toJS(){return this.executor.getTypes()}toArray(){return Object.values(this.toJS())}}class FunctionsRegistry{constructor(e){this.executor=e}register(e){this.executor.registerFunction(e)}get(e){var t;return null!==(t=this.executor.getFunction(e))&&void 0!==t?t:null}toJS(){return this.executor.getFunctions()}toArray(){return Object.values(this.toJS())}}class Executor{static createWithDefaults(e,t){const n=new Executor(e,t);for(const e of Ee.Fv)n.registerType(e);return n}constructor(e,t,n=new Map){(0,T.default)(this,"container",void 0),(0,T.default)(this,"functions",void 0),(0,T.default)(this,"types",void 0),(0,T.default)(this,"functionCache",void 0),this.logger=e,this.functions=new FunctionsRegistry(this),this.types=new TypesRegistry(this),this.container=Q(t),this.functionCache=n}get state(){return this.container.get()}registerFunction(e){const t=new ExpressionFunction("object"==typeof e?e:e());this.container.transitions.addFunction(t)}getFunction(e,t){const n=this.container.get().functions[e];if(null==n||!n.namespace||n.namespace===t)return n}getFunctions(e){const t=Object.entries(this.container.get().functions).filter((([t,n])=>!n.namespace||n.namespace===e));return Object.fromEntries(t)}registerType(e){const t=new we.N("object"==typeof e?e:e());this.container.transitions.addType(t)}getType(e){return this.container.get().types[e]}getTypes(){return this.container.get().types}get context(){return this.container.selectors.getContext()}run(e,t,n={}){return this.createExecution(e,n).start(t)}createExecution(e,t={}){const n={params:t,executor:this,functionCache:this.functionCache};return"string"==typeof e?n.expression=e:n.ast=e,new Execution(n,this.logger,this.functionCache)}walkAst(e,t){const n=this.container.get().functions;for(const r of e.chain){const{function:e,arguments:s}=r,i=ue(n,e,oe);i&&(r.arguments=(0,S.mapValues)(s,(e=>e.map((e=>null!=e&&"object"==typeof e?this.walkAst(e,t):e)))),t(i,r))}return e}walkAstAndTransform(e,t){var n;let r=0;const s=this.container.get().functions;return null!==(n=e.chain.reduce(((e,n,i)=>{const a=i+r,{function:o,arguments:u}=n,l=ue(s,o,oe);if(!l)return e;n.arguments=(0,S.mapValues)(u,(e=>e.map((e=>null!=e&&"object"==typeof e?this.walkAstAndTransform(e,t):e))));const c=t(l,n);if("function"===c.type){const t=a>0?e.chain.slice(0,a):[],n=e.chain.slice(a+1);return{...e,chain:[...t,c,...n]}}if("expression"===c.type){const{chain:t}=c,n=a>0?e.chain.slice(0,a):[],s=e.chain.slice(a+1);return r+=t.length-1,{...e,chain:[...n,...t,...s]}}return e}),e))&&void 0!==n?n:e}inject(e,t){let n=0;return this.walkAst((0,S.cloneDeep)(e),((e,r)=>{r.arguments=e.inject(r.arguments,t.filter((e=>e.name.includes(`l${n}_`))).map((e=>({...e,name:e.name.replace(`l${n}_`,"")})))),n++}))}extract(e){let t=0;const n=[];return{state:this.walkAst((0,S.cloneDeep)(e),((e,r)=>{const{state:s,references:i}=e.extract(r.arguments);r.arguments=s,n.push(...i.map((e=>({...e,name:`l${t}_${e.name}`})))),t+=1})),references:n}}telemetry(e,t){return this.walkAst((0,S.cloneDeep)(e),((e,n)=>{t=e.telemetry(n.arguments,t)})),t}getAllMigrations(){const e=new Set(Object.values(this.container.get().functions).map((e=>{const t="function"==typeof e.migrations?e.migrations():e.migrations||{};return Object.keys(t)})).flat(1)),t={};return e.forEach((e=>{t[e]=t=>({...this.migrate(t,e)})})),t}migrateToLatest(e){return(0,ee.migrateToLatest)(this.getAllMigrations(),e)}migrate(e,t){return this.walkAstAndTransform((0,S.cloneDeep)(e),((e,n)=>{const r="function"==typeof e.migrations?e.migrations():e.migrations||{};return r[t]?r[t](n):n}))}}class ExpressionsServiceFork{constructor(e,t){this.namespace=e,this.expressionsService=t,this.registerFunction=this.registerFunction.bind(this),this.registerRenderer=this.registerRenderer.bind(this),this.registerType=this.registerType.bind(this),this.run=this.run.bind(this),this.execute=this.execute.bind(this),this.getFunction=this.getFunction.bind(this),this.getFunctions=this.getFunctions.bind(this)}registerFunction(e){return"function"==typeof e&&(e=e()),this.expressionsService.registerFunction({...e,namespace:this.namespace})}registerRenderer(e){return"function"==typeof e&&(e=e()),this.expressionsService.registerRenderer({...e,namespace:this.namespace})}registerType(e){return"function"==typeof e&&(e=e()),this.expressionsService.registerType({...e,namespace:this.namespace})}run(e,t,n){return this.expressionsService.run(e,t,{...n,namespace:this.namespace})}execute(e,t,n){return this.expressionsService.execute(e,t,{...n,namespace:this.namespace})}getFunction(e){return this.expressionsService.getFunction(e,this.namespace)}getFunctions(){return this.expressionsService.getFunctions(this.namespace)}setup(){return{...this.expressionsService,registerFunction:this.registerFunction,registerRenderer:this.registerRenderer,registerType:this.registerType}}start(){return{...this.expressionsService,run:this.run,execute:this.execute,getFunction:this.getFunction,getFunctions:this.getFunctions}}}class ExpressionsService{constructor({logger:e,executor:t=Executor.createWithDefaults(e),renderers:n=new ExpressionRendererRegistry}={}){(0,T.default)(this,"executor",void 0),(0,T.default)(this,"renderers",void 0),(0,T.default)(this,"getFunction",((e,t)=>this.executor.getFunction(e,t))),(0,T.default)(this,"getFunctions",(e=>this.executor.getFunctions(e))),(0,T.default)(this,"getRenderer",(e=>(this.assertStart(),this.renderers.get(e)))),(0,T.default)(this,"getRenderers",(()=>(this.assertStart(),this.renderers.toJS()))),(0,T.default)(this,"getType",(e=>(this.assertStart(),this.executor.getType(e)))),(0,T.default)(this,"getTypes",(()=>this.executor.getTypes())),(0,T.default)(this,"registerFunction",(e=>this.executor.registerFunction(e))),(0,T.default)(this,"registerType",(e=>this.executor.registerType(e))),(0,T.default)(this,"registerRenderer",(e=>this.renderers.register(e))),(0,T.default)(this,"fork",(e=>(this.assertSetup(),new ExpressionsServiceFork(e,this)))),(0,T.default)(this,"execute",((e,t,n)=>{this.assertStart();const r=this.executor.createExecution(e,n);return r.start(t),r.contract})),(0,T.default)(this,"run",((e,t,n)=>(this.assertStart(),this.executor.run(e,t,n)))),(0,T.default)(this,"telemetry",((e,t={})=>this.executor.telemetry(e,t))),(0,T.default)(this,"extract",(e=>this.executor.extract(e))),(0,T.default)(this,"inject",((e,t)=>this.executor.inject(e,t))),(0,T.default)(this,"getAllMigrations",(()=>this.executor.getAllMigrations())),(0,T.default)(this,"migrateToLatest",(e=>this.executor.migrateToLatest(e))),this.executor=t,this.renderers=n}isStarted(){return ExpressionsService.started.has(this)}assertSetup(){if(this.isStarted())throw new Error("The expression service is already started and can no longer be configured.")}assertStart(){if(!this.isStarted())throw new Error("The expressions service has not started yet.")}setup(...e){for(const e of[j,M,F,R,O,$,N,L,P,k,V,B,G])this.registerFunction(e);return this}start(...e){return ExpressionsService.started.add(this),this}stop(){ExpressionsService.started.delete(this)}}(0,T.default)(ExpressionsService,"started",new WeakSet)},3855:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Plugin:()=>ExpressionsPublicPlugin,buildExpression:()=>h.buildExpression,buildExpressionFunction:()=>h.buildExpressionFunction,createDefaultInspectorAdapters:()=>h.createDefaultInspectorAdapters,formatExpression:()=>h.formatExpression,isExpressionAstBuilder:()=>h.isExpressionAstBuilder,parseExpression:()=>h.parseExpression,plugin:()=>f,useExpressionRenderer:()=>d.Z});var r=n(8915),s=n(770),i=n(2294),a=n(4286),o=n(5815),u=n(6791);const l=(0,a.lazy)((async()=>{const{ReactExpressionRenderer:e}=await Promise.resolve().then(n.bind(n,6835));return{default:e}})),c=e=>(0,u.jsx)(a.Suspense,{fallback:(0,u.jsx)(o.a,null)},(0,u.jsx)(l,e));var p=n(3721);class ExpressionsPublicPlugin{constructor(e){(0,r.default)(this,"expressions",new i.F7({logger:ExpressionsPublicPlugin.logger}))}setup(e){const{expressions:t}=this,{renderers:n}=t;(0,i.i3)(n),(0,i.H$)(t);const r=t.setup((0,s.pick)(e,"getStartServices"));return Object.freeze(r)}start(e){(0,i.d_)(e.notifications);const{expressions:t}=this,r={...t.start(),loader:async(e,t,r)=>{const{ExpressionLoader:s}=await Promise.resolve().then(n.bind(n,151));return new s(e,t,r)},render:async(e,t,r)=>{const{ExpressionRenderHandler:s}=await Promise.resolve().then(n.bind(n,969)),i=new s(e,r);return i.render(t),i},ReactExpressionRenderer:c};return Object.freeze(r)}stop(){this.expressions.stop()}}(0,r.default)(ExpressionsPublicPlugin,"logger",{...p,fatal:p.error,get(){return this},isLevelEnabled:()=>!0});var d=n(6835),h=n(4552);function f(e){return new ExpressionsPublicPlugin(e)}},151:(e,t,n)=>{"use strict";n.d(t,{ExpressionLoader:()=>ExpressionLoader});var r=n(8915),s=n(190),i=n(770),a=n(969),o=n(2294);class ExpressionLoader{constructor(e,t,n){(0,r.default)(this,"data$",void 0),(0,r.default)(this,"update$",void 0),(0,r.default)(this,"render$",void 0),(0,r.default)(this,"events$",void 0),(0,r.default)(this,"loading$",void 0),(0,r.default)(this,"execution",void 0),(0,r.default)(this,"renderHandler",void 0),(0,r.default)(this,"dataSubject",void 0),(0,r.default)(this,"loadingSubject",void 0),(0,r.default)(this,"data",void 0),(0,r.default)(this,"params",{}),(0,r.default)(this,"subscription",void 0),(0,r.default)(this,"loadData",((e,t)=>{var n;null===(n=this.subscription)||void 0===n||n.unsubscribe(),this.execution&&this.execution.isPending&&this.execution.cancel(),this.setParams(t),this.execution=(0,o.jH)().execute(e,t.context,{searchContext:t.searchContext,variables:t.variables||{},inspectorAdapters:t.inspectorAdapters,searchSessionId:t.searchSessionId,debug:t.debug,syncColors:t.syncColors,syncCursor:null==t?void 0:t.syncCursor,syncTooltips:t.syncTooltips,executionContext:t.executionContext,partial:t.partial,throttle:t.throttle,allowCache:t.allowCache}),this.subscription=this.execution.getData().pipe((0,s.delay)(0)).subscribe((e=>this.dataSubject.next(e)))})),this.dataSubject=new s.Subject,this.data$=this.dataSubject.asObservable(),this.loadingSubject=new s.BehaviorSubject(!1),this.loading$=this.loadingSubject.asObservable().pipe((0,s.shareReplay)(1),(0,s.filter)((e=>!0===e)),(0,s.map)((()=>{}))),this.renderHandler=new a.ExpressionRenderHandler(e,{interactive:null==n?void 0:n.interactive,onRenderError:n&&n.onRenderError,renderMode:null==n?void 0:n.renderMode,syncColors:null==n?void 0:n.syncColors,syncTooltips:null==n?void 0:n.syncTooltips,syncCursor:null==n?void 0:n.syncCursor,hasCompatibleActions:null==n?void 0:n.hasCompatibleActions,getCompatibleCellValueActions:null==n?void 0:n.getCompatibleCellValueActions,executionContext:null==n?void 0:n.executionContext}),this.render$=this.renderHandler.render$,this.update$=this.renderHandler.update$,this.events$=this.renderHandler.events$,this.update$.subscribe((e=>{if(e){const{newExpression:t,newParams:n}=e;this.update(t,n)}})),this.data$.subscribe((({result:e})=>{this.render(e)})),this.render$.subscribe((()=>{this.loadingSubject.next(!1)})),this.setParams(n),t&&(this.loadingSubject.next(!0),this.loadData(t,this.params))}destroy(){var e;this.dataSubject.complete(),this.loadingSubject.complete(),this.renderHandler.destroy(),this.cancel(),null===(e=this.subscription)||void 0===e||e.unsubscribe()}cancel(){var e;null===(e=this.execution)||void 0===e||e.cancel()}getExpression(){var e;return null===(e=this.execution)||void 0===e?void 0:e.getExpression()}getAst(){var e;return null===(e=this.execution)||void 0===e?void 0:e.getAst()}getElement(){return this.renderHandler.getElement()}inspect(){var e;return null===(e=this.execution)||void 0===e?void 0:e.inspect()}update(e,t){this.setParams(t),this.loadingSubject.next(!0),e?this.loadData(e,this.params):this.data&&this.render(this.data)}render(e){this.renderHandler.render(e,this.params.uiState)}setParams(e){var t,n;e&&Object.keys(e).length&&(e.searchContext&&(this.params.searchContext=(0,i.defaults)({},e.searchContext,this.params.searchContext||{})),e.uiState&&this.params&&(this.params.uiState=e.uiState),e.variables&&this.params&&(this.params.variables=e.variables),e.searchSessionId&&this.params&&(this.params.searchSessionId=e.searchSessionId),this.params.syncColors=e.syncColors,this.params.syncCursor=e.syncCursor,this.params.syncTooltips=e.syncTooltips,this.params.debug=Boolean(e.debug),this.params.partial=Boolean(e.partial),this.params.throttle=Number(null!==(t=e.throttle)&&void 0!==t?t:1e3),this.params.allowCache=e.allowCache,this.params.inspectorAdapters=e.inspectorAdapters||(null===(n=this.execution)||void 0===n?void 0:n.inspect()),this.params.executionContext=e.executionContext)}}},6835:(e,t,n)=>{"use strict";n.d(t,{ReactExpressionRenderer:()=>v,Z:()=>m});var r=n(3185),s=n(4286),i=n(1319),a=n(6791),o=n(5815),u=n(190),l=n(6753),c=n(4552),p=n(151),d=n(770),h=n(4001);function f(e){const t=(0,s.useRef)(e);return(0,h.A)(t.current,e)||(t.current=e),t.current}function m(e,{debounce:t,expression:n,hasCustomErrorRenderer:r,onData$:i,onEvent:a,onRender$:o,reload$:h,abortController:m,...g}){const[{error:v,isEmpty:y,isLoading:b},x]=(0,s.useReducer)(((e,t)=>({...e,...t})),{isEmpty:!0,isLoading:!1,error:null}),w=f({expression:n,params:f(g)}),[{expression:E,params:C},T]=function(e,t){const[n,r]=(0,s.useState)(e),[i,a]=(0,s.useState)(!1),o=(0,s.useCallback)((e=>{r(e),a(!1)}),[r,a]),u=(0,s.useMemo)((()=>t?(0,d.debounce)(o,t):o),[o,t]);return(0,s.useEffect)((()=>()=>{var e;return null===(e=u.cancel)||void 0===e?void 0:e.call(u)}),[u]),(0,l.A)((()=>(a(!0),u(e),()=>{var e;return null===(e=u.cancel)||void 0===e?void 0:e.call(u)})),[e]),[n,i]}(w,t),S=(0,s.useRef)(null),A=(0,s.useRef)(!1),j=(0,s.useRef)(null);return(0,s.useEffect)((()=>{null!=m&&m.signal&&(m.signal.onabort=()=>{var e;null===(e=S.current)||void 0===e||e.cancel()})}),[m]),(0,s.useEffect)((()=>{var t;S.current=e.current&&new p.ExpressionLoader(e.current,E,{...C,onRenderError:(e,t,n)=>{var r;return j.current=n,x({error:t,isEmpty:!1,isLoading:!1}),null===(r=C.onRenderError)||void 0===r?void 0:r.call(C,e,t,n)}});const n=null===(t=S.current)||void 0===t?void 0:t.loading$.subscribe((()=>{A.current=!1,x({isLoading:!0})}));return()=>{var e;null==n||n.unsubscribe(),null===(e=S.current)||void 0===e||e.destroy(),S.current=null,j.current=null}}),[C.onRenderError,C.interactive,C.renderMode,C.syncColors,C.syncTooltips,C.syncCursor]),(0,s.useEffect)((()=>{var e;const t=a&&(null===(e=S.current)||void 0===e?void 0:e.events$.subscribe(a));return()=>null==t?void 0:t.unsubscribe()}),[S.current,a]),(0,s.useEffect)((()=>{var e;const t=null===(e=S.current)||void 0===e?void 0:e.data$.subscribe((({partial:e,result:t})=>{var n;x({isEmpty:!1,...(0,c.isExpressionValueError)(t)?{}:{error:null}}),null==i||i(t,null===(n=S.current)||void 0===n?void 0:n.inspect(),e)}));return()=>null==t?void 0:t.unsubscribe()}),[S.current,i]),(0,s.useEffect)((()=>{var e;const t=null===(e=S.current)||void 0===e?void 0:e.render$.pipe((0,u.filter)((()=>!A.current))).subscribe((e=>{x({error:null,isEmpty:!1,isLoading:!1}),null==o||o(e)}));return()=>{null==t||t.unsubscribe()}}),[S.current,o]),(0,s.useEffect)((()=>{const e=null==h?void 0:h.subscribe((()=>{var e;null===(e=S.current)||void 0===e||e.update(E,C)}));return()=>null==e?void 0:e.unsubscribe()}),[h,E,C]),(0,l.A)((()=>{var e;null===(e=S.current)||void 0===e||e.update(E,C)}),[E,C]),(0,s.useLayoutEffect)((()=>{var e;v&&r&&(A.current=!0,null===(e=j.current)||void 0===e||e.done()),j.current=null}),[v,r]),{error:v,isEmpty:y,isLoading:b||T}}var g={name:"1739oy8",styles:"z-index:1"};function v({className:e,dataAttrs:t,padding:n,renderError:u,abortController:l,...c}){const p=(0,s.useRef)(null),{euiTheme:d}=(0,i.useEuiTheme)(),{error:h,isEmpty:f,isLoading:v}=m(p,{...c,hasCustomErrorRenderer:!!u});return(0,a.jsx)("div",(0,r.default)({},t,{className:e,css:y}),f&&(0,a.jsx)(o.a,null),v&&(0,a.jsx)(i.EuiProgress,{size:"xs",color:"accent",position:"absolute",css:g}),!v&&h&&(null==u?void 0:u(h.message,h)),(0,a.jsx)("div",{className:"expExpressionRenderer__expression",css:(0,a.css)({width:"100%",height:"100%",...n?{padding:d.size[n]}:{},...f||h?{display:"none"}:{}},"",""),ref:p}))}const y={name:"14nsv1b",styles:"position:relative;display:flex;width:100%;height:100%;align-items:center;justify-content:center"}},969:(e,t,n)=>{"use strict";n.d(t,{ExpressionRenderHandler:()=>ExpressionRenderHandler});var r=n(8915),s=n(190),i=n(770),a=n(5008),o=n(2294);const u=(e,t,n)=>{"AbortError"!==t.name?((0,o.Tr)().toasts.addError(t,{title:a.i18n.translate("expressions.defaultErrorRenderer.errorTitle",{defaultMessage:"Error in visualisation"}),toastMessage:t.message}),n.done()):n.done()};class ExpressionRenderHandler{constructor(e,{onRenderError:t,renderMode:n,syncColors:a,syncTooltips:l,syncCursor:c,interactive:p,hasCompatibleActions:d=async()=>!1,getCompatibleCellValueActions:h=async()=>[],executionContext:f}={}){(0,r.default)(this,"render$",void 0),(0,r.default)(this,"update$",void 0),(0,r.default)(this,"events$",void 0),(0,r.default)(this,"element",void 0),(0,r.default)(this,"destroyFn",void 0),(0,r.default)(this,"renderCount",0),(0,r.default)(this,"renderSubject",void 0),(0,r.default)(this,"eventsSubject",void 0),(0,r.default)(this,"updateSubject",void 0),(0,r.default)(this,"handlers",void 0),(0,r.default)(this,"onRenderError",void 0),(0,r.default)(this,"render",(async(e,t)=>{if(!e||"object"!=typeof e)return this.handleRenderError(new Error("invalid data provided to the expression renderer"));if("render"!==e.type||!e.as)return"error"===e.type?this.handleRenderError(e.error):this.handleRenderError(new Error("invalid data provided to the expression renderer"));if(!(0,o.yn)().get(e.as))return this.handleRenderError(new Error(`invalid renderer id '${e.as}'`));try{await(0,o.yn)().get(e.as).render(this.element,e.value,{...this.handlers,uiState:t})}catch(e){return this.handleRenderError(e)}})),(0,r.default)(this,"destroy",(()=>{this.renderSubject.complete(),this.eventsSubject.complete(),this.updateSubject.complete(),this.destroyFn&&this.destroyFn()})),(0,r.default)(this,"getElement",(()=>this.element)),(0,r.default)(this,"handleRenderError",(e=>{this.onRenderError(this.element,e,this.handlers)})),this.element=e,this.eventsSubject=new s.Subject,this.events$=this.eventsSubject.asObservable(),this.onRenderError=t||u,this.renderSubject=new s.BehaviorSubject(null),this.render$=this.renderSubject.asObservable().pipe((0,s.filter)(i.isNumber)),this.updateSubject=new s.Subject,this.update$=this.updateSubject.asObservable(),this.handlers={onDestroy:e=>{this.destroyFn=e},done:()=>{this.renderCount++,this.renderSubject.next(this.renderCount)},reload:()=>{this.updateSubject.next(null)},getExecutionContext:()=>f,update:e=>{this.updateSubject.next(e)},event:e=>{this.eventsSubject.next(e)},getRenderMode:()=>n||"view",isSyncColorsEnabled:()=>a||!1,isSyncTooltipsEnabled:()=>l||!1,isSyncCursorEnabled:()=>c||!0,isInteractive:()=>null==p||p,hasCompatibleActions:d,getCompatibleCellValueActions:h}}}},2294:(e,t,n)=>{"use strict";n.d(t,{F7:()=>ExpressionsService,jH:()=>l,Tr:()=>i,yn:()=>o,H$:()=>c,d_:()=>a,i3:()=>u});var r=n(1215),s=n(4552);class ExpressionsService extends s.ExpressionsService{setup({getStartServices:e}){return this.registerFunction(function({getStartServices:e}){return(0,s.getUiSettingFnBrowser)({async getStartDependencies(){const[{uiSettings:t}]=await e();return{uiSettings:t}}})}({getStartServices:e})),super.setup()}}const[i,a]=(0,r.createGetterSetter)("Notifications"),[o,u]=(0,r.createGetterSetter)("Renderers registry"),[l,c]=(0,r.createGetterSetter)("ExpressionsService")},4335:(e,t,n)=>{"use strict";var r,s=n(3721),i="object"==typeof Reflect?Reflect:null,a=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function u(){u.init.call(this)}e.exports=u,e.exports.once=function(e,t){return new Promise((function(n,r){function s(n){e.removeListener(t,i),r(n)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",s),n([].slice.call(arguments))}y(e,t,i,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&y(e,"error",t,{once:!0})}(e,s)}))},u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var l=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function p(e){return void 0===e._maxListeners?u.defaultMaxListeners:e._maxListeners}function d(e,t,n,r){var i,a,o,u;if(c(n),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]),void 0===o)o=a[t]=n,++e._eventsCount;else if("function"==typeof o?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=p(e))>0&&o.length>i&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,u=l,s&&s.warn&&s.warn(u)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},s=h.bind(r);return s.listener=n,r.wrapFn=s,s}function m(e,t,n){var r=e._events;if(void 0===r)return[];var s=r[t];return void 0===s?[]:"function"==typeof s?n?[s.listener||s]:[s]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(s):v(s,s.length)}function g(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function v(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function y(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function s(i){r.once&&e.removeEventListener(t,s),n(i)}))}}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),u.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},u.prototype.getMaxListeners=function(){return p(this)},u.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,s=this._events;if(void 0!==s)r=r&&void 0===s.error;else if(!r)return!1;if(r){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var o=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw o.context=i,o}var u=s[e];if(void 0===u)return!1;if("function"==typeof u)a(u,this,t);else{var l=u.length,c=v(u,l);for(n=0;n<l;++n)a(c[n],this,t)}return!0},u.prototype.addListener=function(e,t){return d(this,e,t,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(e,t){return d(this,e,t,!0)},u.prototype.once=function(e,t){return c(t),this.on(e,f(this,e,t)),this},u.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,f(this,e,t)),this},u.prototype.removeListener=function(e,t){var n,r,s,i,a;if(c(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(s=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){a=n[i].listener,s=i;break}if(s<0)return this;0===s?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,s),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var s,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(s=i[r])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},u.prototype.listeners=function(e){return m(this,e,!0)},u.prototype.rawListeners=function(e){return m(this,e,!1)},u.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},u.prototype.listenerCount=g,u.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},4001:(e,t)=>{"use strict";function n(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}t.A=function(e,t){if(n(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(var i=0;i<r.length;i++)if(!Object.prototype.hasOwnProperty.call(t,r[i])||!n(e[r[i]],t[r[i]]))return!1;return!0}},8345:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useFirstMountState=void 0;var r=n(4286);t.useFirstMountState=function(){var e=r.useRef(!0);return e.current?(e.current=!1,!0):e.current}},6753:(e,t,n)=>{"use strict";var r=n(4286),s=n(8345);t.A=function(e,t){var n=s.useFirstMountState();r.useEffect((function(){if(!n)return e()}),t)}},4191:(e,t,n)=>{n.p=window.__kbnPublicPath__.expressions},8370:(e,t,n)=>{n.r(t);var r=__kbnBundles__.get("plugin/inspector/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},1359:(e,t,n)=>{n.r(t);var r=__kbnBundles__.get("plugin/kibanaUtils/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},136:(e,t,n)=>{n.r(t);var r=__kbnBundles__.get("plugin/kibanaUtils/common/state_containers");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},1215:(e,t,n)=>{n.r(t);var r=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},3721:(e,t,n)=>{e.exports=n(2497)(4971)},3185:(e,t,n)=>{e.exports=n(2497)(51858)},8915:(e,t,n)=>{e.exports=n(2497)(67493)},1319:e=>{"use strict";e.exports=__kbnSharedDeps__.ElasticEui},6791:e=>{"use strict";e.exports=__kbnSharedDeps__.EmotionReact},5008:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18n},770:e=>{"use strict";e.exports=__kbnSharedDeps__.Lodash},4286:e=>{"use strict";e.exports=__kbnSharedDeps__.React},190:e=>{"use strict";e.exports=__kbnSharedDeps__.Rxjs},2497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},n={};function r(e){var s=n[e];if(void 0!==s)return s.exports;var i=n[e]={exports:{}};return t[e](i,i.exports,r),i.exports}r.m=t,r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,n)=>(r.f[n](e,t),t)),[])),r.u=e=>"expressions.chunk."+e+".js",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},r.l=(t,n,s,i)=>{if(e[t])e[t].push(n);else{var a,o;if(void 0!==s)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var c=u[l];if(c.getAttribute("src")==t){a=c;break}}a||(o=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.src=t),e[t]=[n];var p=(n,r)=>{a.onerror=a.onload=null,clearTimeout(d);var s=e[t];if(delete e[t],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach((e=>e(r))),n)return n(r)},d=setTimeout(p.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=p.bind(null,a.onerror),a.onload=p.bind(null,a.onload),o&&document.head.appendChild(a)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var s=n.length-1;s>-1&&(!e||!/^http(s?):/.test(e));)e=n[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{var e={504:0};r.f.j=(t,n)=>{var s=r.o(e,t)?e[t]:void 0;if(0!==s)if(s)n.push(s[2]);else{var i=new Promise(((n,r)=>s=e[t]=[n,r]));n.push(s[2]=i);var a=r.p+r.u(t),o=new Error;r.l(a,(n=>{if(r.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var i=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;o.message="Loading chunk "+t+" failed.\n("+i+": "+a+")",o.name="ChunkLoadError",o.type=i,o.request=a,s[1](o)}}),"chunk-"+t,t)}};var t=(t,n)=>{var s,i,[a,o,u]=n,l=0;if(a.some((t=>0!==e[t]))){for(s in o)r.o(o,s)&&(r.m[s]=o[s]);u&&u(r)}for(t&&t(n);l<a.length;l++)i=a[l],r.o(e,i)&&e[i]&&e[i][0](),e[i]=0},n=self.expressions_bundle_jsonpfunction=self.expressions_bundle_jsonpfunction||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),r(4191),__kbnBundles__.define("plugin/expressions/public",r,3855),__kbnBundles__.define("plugin/expressions/common",r,4552),__kbnBundles__.define("plugin/expressions/common/fonts",r,2664)})();