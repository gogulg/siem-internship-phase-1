/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */(()=>{var e={101:(e,t,n)=>{"use strict";n.r(t),n.d(t,{apiHasDynamicActions:()=>l,plugin:()=>p});var i=n(915);const r=__kbnSharedDeps__.Rxjs;__kbnSharedDeps__.React,__kbnSharedDeps__.KbnEsQuery,n(513);var o=n(118),s=n(899),a=n.n(s),c=n(546);class DynamicActionStorage extends o.UiActionsEnhancedAbstractActionStorage{constructor(e,t,n){super(),this.id=e,this.getPanelTitle=t,this.api=n}put(e){this.api.setDynamicActions({dynamicActions:e})}async create(e){const t=this.getEvents();if(t.find((({eventId:t})=>t===e.eventId)))throw new Error(`[EEXIST]: Event with [eventId = ${e.eventId}] already exists on [embeddable.id = ${this.id}, embeddable.title = ${this.getPanelTitle()}].`);this.put({events:[...t,e]})}async update(e){const t=this.api.dynamicActionsState$.getValue(),n=this.getEvents(),i=n.findIndex((({eventId:t})=>t===e.eventId));if(-1===i)throw new Error(`[ENOENT]: Event with [eventId = ${e.eventId}] could not be updated as it does not exist in [embeddable.id = ${this.id}, embeddable.title = ${this.getPanelTitle()}].`);this.put({...t,events:[...n.slice(0,i),e,...n.slice(i+1)]})}async remove(e){const t=this.api.dynamicActionsState$.getValue(),n=this.getEvents(),i=n.findIndex((t=>e===t.eventId));if(-1===i)throw new Error(`[ENOENT]: Event with [eventId = ${e}] could not be removed as it does not exist in [embeddable.id = ${this.id}, embeddable.title = ${this.getPanelTitle()}].`);this.put({...t,events:[...n.slice(0,i),...n.slice(i+1)]})}async read(e){const t=this.getEvents().find((t=>e===t.eventId));if(!t)throw new Error(`[ENOENT]: Event with [eventId = ${e}] could not be found in [embeddable.id = ${this.id}, embeddable.title = ${this.getPanelTitle()}].`);return t}async list(){return this.getEvents()}getEvents(){var e,t;const n=this.api.dynamicActionsState$.getValue(),i=null!==(e=null==n||null===(t=n.dynamicActions)||void 0===t?void 0:t.events)&&void 0!==e?e:[];return this.migrate(i)}migrate(e){return e.map((e=>{if("DASHBOARD_TO_DASHBOARD_DRILLDOWN"===e.action.factoryId){const t=e.triggers.filter((e=>e!==c.VALUE_CLICK_TRIGGER&&e!==c.SELECT_RANGE_TRIGGER));return t.length===e.triggers.length||t.includes("FILTER_TRIGGER")||t.push("FILTER_TRIGGER"),{...e,triggers:t}}return e}))}}function d(e){var t;return{dynamicActions:{events:[],...null!==(t=null==e?void 0:e.dynamicActions)&&void 0!==t?t:{}}}}var u=n(721);class EmbeddableEnhancedPlugin{constructor(e){(0,i.default)(this,"uiActions",void 0),this.context=e}setup(e,t){return{}}start(e,t){return this.uiActions=t.uiActionsEnhanced,{initializeReactEmbeddableDynamicActions:this.initializeDynamicActions.bind(this)}}stop(){}initializeDynamicActions(e,t,n){const i=new r.BehaviorSubject(d(n.enhancements)),s={dynamicActionsState$:i,setDynamicActions:e=>{i.next(d(e))}},c=new DynamicActionStorage(e,t,s),u=new o.UiActionsEnhancedDynamicActionManager({isCompatible:async t=>{const{embeddable:n}=t;return i=n,Boolean(i&&void 0!==(null==i?void 0:i.uuid))&&n.uuid===e;var i},storage:c,uiActions:this.uiActions});return{dynamicActionsApi:{...s,enhancements:{dynamicActions:u}},dynamicActionsComparator:{enhancements:[i,s.setDynamicActions,(e,t)=>a()(d(e),d(t))]},serializeDynamicActions:()=>({enhancements:i.getValue()}),startDynamicActions:()=>({stopDynamicActions:this.startDynamicActions(u)})}}startDynamicActions(e){return e.start().catch((t=>{u.log("Failed to start embeddable dynamic actions",e),u.error(t)})),()=>{e.stop().catch((t=>{u.log("Failed to stop embeddable dynamic actions",e),u.error(t)}))}}}const l=e=>{const t=e;return Boolean(t&&t.enhancements&&"object"==typeof t.enhancements.dynamicActions&&"function"==typeof t.setDynamicActions&&t.dynamicActionsState$)};function p(e){return new EmbeddableEnhancedPlugin(e)}},513:e=>{"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var i,r,o;if(Array.isArray(t)){if((i=t.length)!=n.length)return!1;for(r=i;0!=r--;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((i=(o=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(r=i;0!=r--;)if(!Object.prototype.hasOwnProperty.call(n,o[r]))return!1;for(r=i;0!=r--;){var s=o[r];if(!e(t[s],n[s]))return!1}return!0}return t!=t&&n!=n}},899:(e,t,n)=>{"use strict";var i=n(721),r=Array.isArray,o=Object.keys,s=Object.prototype.hasOwnProperty,a="undefined"!=typeof Element;function c(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,i,d,u=r(e),l=r(t);if(u&&l){if((i=e.length)!=t.length)return!1;for(n=i;0!=n--;)if(!c(e[n],t[n]))return!1;return!0}if(u!=l)return!1;var p=e instanceof Date,f=t instanceof Date;if(p!=f)return!1;if(p&&f)return e.getTime()==t.getTime();var h=e instanceof RegExp,b=t instanceof RegExp;if(h!=b)return!1;if(h&&b)return e.toString()==t.toString();var m=o(e);if((i=m.length)!==o(t).length)return!1;for(n=i;0!=n--;)if(!s.call(t,m[n]))return!1;if(a&&e instanceof Element&&t instanceof Element)return e===t;for(n=i;0!=n--;)if(!("_owner"===(d=m[n])&&e.$$typeof||c(e[d],t[d])))return!1;return!0}return e!=e&&t!=t}e.exports=function(e,t){try{return c(e,t)}catch(e){if(e.message&&e.message.match(/stack|recursion/i)||-2146828260===e.number)return i.warn("Warning: react-fast-compare does not handle circular references.",e.name,e.message),!1;throw e}}},366:(e,t,n)=>{n.p=window.__kbnPublicPath__.embeddableEnhanced},546:(e,t,n)=>{n.r(t);var i=__kbnBundles__.get("plugin/embeddable/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},118:(e,t,n)=>{n.r(t);var i=__kbnBundles__.get("plugin/uiActionsEnhanced/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},721:(e,t,n)=>{e.exports=n(497)(4971)},915:(e,t,n)=>{e.exports=n(497)(67493)},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var r=i.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=i[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n(366),__kbnBundles__.define("plugin/embeddableEnhanced/public",n,101)})();