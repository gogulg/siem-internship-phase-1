(()=>{var e={212:(e,t,r)=>{"use strict";r.r(t),r.d(t,{TrackApplicationView:()=>k,plugin:()=>b});var i=r(915);const o=__kbnSharedDeps__.KbnAnalytics,n=__kbnSharedDeps__.React;var a=r.n(n),s=r(215);const c=__kbnSharedDeps__.Rxjs,p="main",l=["kibana"],u=__kbnSharedDeps__.ReactDom;var d=r.n(u);class TrackApplicationViewComponent extends a().Component{constructor(...e){super(...e),(0,i.default)(this,"parentNode",void 0),(0,i.default)(this,"onClick",(e=>{var t,r;const{applicationUsageTracker:i,viewId:o}=this.props;this.parentNode=this.parentNode||(null===(t=d().findDOMNode(this))||void 0===t?void 0:t.parentNode),(this.parentNode===e.target||null!==(r=this.parentNode)&&void 0!==r&&r.contains(e.target))&&(null==i||i.updateViewClickCounter(o))}))}componentDidMount(){const{applicationUsageTracker:e,viewId:t}=this.props;e&&(e.trackApplicationViewUsage(t),document.addEventListener("click",this.onClick))}componentWillUnmount(){const{applicationUsageTracker:e,viewId:t}=this.props;e&&e.flushTrackedView(t),document.removeEventListener("click",this.onClick)}render(){return this.props.children}}const g=__kbnSharedDeps__.EmotionReact,h=(0,n.createContext)(void 0),k=e=>(0,g.jsx)(h.Consumer,null,(t=>{const r={...e,applicationUsageTracker:t};return(0,g.jsx)(TrackApplicationViewComponent,r)}));class UsageCollectionPlugin{constructor(e){(0,i.default)(this,"applicationUsageTracker",void 0),(0,i.default)(this,"subscriptions",[]),(0,i.default)(this,"reporter",void 0),(0,i.default)(this,"config",void 0),this.initContext=e,this.config=e.config.get()}setup({http:e}){const t=new s.Storage(window.localStorage);this.reporter=function(e){const{localStorage:t,logger:r,fetch:i}=e;return new o.Reporter({logger:r,storage:t,async http(e){const t=await i.post("/api/ui_counters/_report",{body:JSON.stringify({report:e}),asSystemRequest:!0}),r=t.status;if(t.status!==r)throw Error("Unable to store report.");return t}})}({localStorage:t,logger:this.initContext.logger.get("reporter"),fetch:e}),this.applicationUsageTracker=new o.ApplicationUsageTracker(this.reporter);const r=this.getPublicApplicationUsageTracker();return{components:{ApplicationUsageTrackingProvider:e=>(0,g.jsx)(h.Provider,{value:r},e.children)},reportUiCounter:this.reporter.reportUiCounter}}start({http:e,application:t},{screenshotMode:r}){if(!this.reporter||!this.applicationUsageTracker)throw new Error("Usage collection reporter not set up correctly");var i,o;return!this.config.uiCounters.enabled||function(e){const{anonymousPaths:t}=e;return t.isAnonymous(window.location.pathname)}(e)||r.isScreenshotMode()||window.navigator.userAgent.includes("Elastic/Synthetics")||(this.reporter.start(),this.applicationUsageTracker.start(),this.subscriptions=(i=t.currentAppId$,o=this.applicationUsageTracker,[(0,c.fromEvent)(window,"click").subscribe((()=>{o.updateViewClickCounter(p)})),i.pipe((0,c.filter)((e=>"string"==typeof e&&!l.includes(e))),(0,c.distinctUntilChanged)()).subscribe((e=>{e&&(o.setCurrentAppId(e),o.trackApplicationViewUsage(p))}))])),this.reporter.reportUserAgent("kibana"),{reportUiCounter:this.reporter.reportUiCounter}}stop(){this.applicationUsageTracker&&(this.applicationUsageTracker.stop(),this.subscriptions.forEach((e=>e.unsubscribe())))}getPublicApplicationUsageTracker(){return{trackApplicationViewUsage:this.applicationUsageTracker.trackApplicationViewUsage.bind(this.applicationUsageTracker),flushTrackedView:this.applicationUsageTracker.flushTrackedView.bind(this.applicationUsageTracker),updateViewClickCounter:this.applicationUsageTracker.updateViewClickCounter.bind(this.applicationUsageTracker)}}}function b(e){return new UsageCollectionPlugin(e)}},987:(e,t,r)=>{r.p=window.__kbnPublicPath__.usageCollection},215:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},915:(e,t,r)=>{e.exports=r(497)(67493)},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},t={};function r(i){var o=t[i];if(void 0!==o)return o.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var o=i.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=i[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),r(987),__kbnBundles__.define("plugin/usageCollection/public",r,212)})();