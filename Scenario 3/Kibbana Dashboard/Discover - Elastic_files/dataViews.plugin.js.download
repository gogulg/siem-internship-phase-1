(()=>{var e,t={313:(e,t,i)=>{"use strict";i.d(t,{fM:()=>n,Bh:()=>o,Ey:()=>c,cD:()=>d});var s=i(915);let a=function(e){return e._ID="_id",e._INDEX="_index",e._SOURCE="_source",e._TYPE="_type",e.STRING="string",e.TEXT="text",e.MATCH_ONLY_TEXT="match_only_text",e.KEYWORD="keyword",e.VERSION="version",e.BOOLEAN="boolean",e.OBJECT="object",e.DATE="date",e.DATE_NANOS="date_nanos",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.FLOAT="float",e.HALF_FLOAT="half_float",e.SCALED_FLOAT="scaled_float",e.DOUBLE="double",e.INTEGER="integer",e.LONG="long",e.SHORT="short",e.UNSIGNED_LONG="unsigned_long",e.AGGREGATE_METRIC_DOUBLE="aggregate_metric_double",e.FLOAT_RANGE="float_range",e.DOUBLE_RANGE="double_range",e.INTEGER_RANGE="integer_range",e.LONG_RANGE="long_range",e.NESTED="nested",e.BYTE="byte",e.IP="ip",e.IP_RANGE="ip_range",e.ATTACHMENT="attachment",e.TOKEN_COUNT="token_count",e.MURMUR3="murmur3",e.HISTOGRAM="histogram",e}({}),n=function(e){return e._SOURCE="_source",e.ATTACHMENT="attachment",e.BOOLEAN="boolean",e.DATE="date",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.IP="ip",e.IP_RANGE="ip_range",e.MURMUR3="murmur3",e.NUMBER="number",e.NUMBER_RANGE="number_range",e.STRING="string",e.UNKNOWN="unknown",e.CONFLICT="conflict",e.OBJECT="object",e.NESTED="nested",e.HISTOGRAM="histogram",e.MISSING="missing",e}({});class KbnFieldType{constructor(e={}){(0,s.default)(this,"name",void 0),(0,s.default)(this,"sortable",void 0),(0,s.default)(this,"filterable",void 0),(0,s.default)(this,"esTypes",void 0),this.name=e.name||n.UNKNOWN,this.sortable=e.sortable||!1,this.filterable=e.filterable||!1,this.esTypes=Object.freeze((e.esTypes||[]).slice())}}const r=new KbnFieldType({name:n.UNKNOWN}),l=[new KbnFieldType({name:n.STRING,sortable:!0,filterable:!0,esTypes:[a.STRING,a.TEXT,a.MATCH_ONLY_TEXT,a.KEYWORD,a.VERSION,a._TYPE,a._ID]}),new KbnFieldType({name:n.NUMBER,sortable:!0,filterable:!0,esTypes:[a.FLOAT,a.HALF_FLOAT,a.SCALED_FLOAT,a.DOUBLE,a.INTEGER,a.LONG,a.UNSIGNED_LONG,a.SHORT,a.BYTE,a.TOKEN_COUNT,a.AGGREGATE_METRIC_DOUBLE]}),new KbnFieldType({name:n.NUMBER_RANGE,sortable:!0,filterable:!0,esTypes:[a.FLOAT_RANGE,a.DOUBLE_RANGE,a.INTEGER_RANGE,a.LONG_RANGE]}),new KbnFieldType({name:n.DATE,sortable:!0,filterable:!0,esTypes:[a.DATE,a.DATE_NANOS]}),new KbnFieldType({name:n.DATE_RANGE,sortable:!0,filterable:!0,esTypes:[a.DATE_RANGE]}),new KbnFieldType({name:n.IP,sortable:!0,filterable:!0,esTypes:[a.IP]}),new KbnFieldType({name:n.IP_RANGE,sortable:!0,filterable:!0,esTypes:[a.IP_RANGE]}),new KbnFieldType({name:n.BOOLEAN,sortable:!0,filterable:!0,esTypes:[a.BOOLEAN]}),new KbnFieldType({name:n.OBJECT,esTypes:[a.OBJECT]}),new KbnFieldType({name:n.NESTED,esTypes:[a.NESTED]}),new KbnFieldType({name:n.GEO_POINT,esTypes:[a.GEO_POINT]}),new KbnFieldType({name:n.GEO_SHAPE,esTypes:[a.GEO_SHAPE]}),new KbnFieldType({name:n.ATTACHMENT,esTypes:[a.ATTACHMENT]}),new KbnFieldType({name:n.MURMUR3,esTypes:[a.MURMUR3]}),new KbnFieldType({name:n._SOURCE,esTypes:[a._SOURCE]}),new KbnFieldType({name:n.HISTOGRAM,filterable:!0,esTypes:[a.HISTOGRAM]}),new KbnFieldType({name:n.CONFLICT}),r],d=e=>l.find((t=>t.name===e))||r,o=e=>{const t=l.find((t=>t.esTypes.includes(e)));return t&&t.name?t.name:n.UNKNOWN},c=()=>l.filter((e=>e.filterable)).map((e=>e.name))},787:(e,t,i)=>{"use strict";i.d(t,{Ds:()=>u,KR:()=>s,Nw:()=>l,RA:()=>a,Su:()=>n,_u:()=>r,ni:()=>h,s2:()=>o,sR:()=>c,v2:()=>d});const s=["keyword","long","double","date","ip","boolean","geo_point","composite"],a={DATA_STREAMS_TO_IGNORE:["logs-enterprise_search.api-default","logs-enterprise_search.audit-default"]},n="metaFields",r="index-pattern",l=300,d="/internal/data_views/_fields_for_wildcard",o="/internal/data_views/fields",c="/internal/data_views/_existing_indices",u="defaultIndex";let h=function(e){return e.localDataTimeout="local_data_timeout",e.remoteDataTimeout="remote_data_timeout",e.unknown="unknown",e}({})},119:(e,t,i)=>{"use strict";i.d(t,{O:()=>s.DATA_VIEW_SAVED_OBJECT_TYPE,X:()=>a});var s=i(449);const a=1},983:(e,t,i)=>{"use strict";i.d(t,{C9:()=>AbstractDataView,U$:()=>DataView,IQ:()=>DataViewLazy,GQ:()=>w,Qj:()=>DataViewsService});var s=i(770),a=i.n(s);var n=i(915),r=i(313),l=i(359),d=i(830);__kbnSharedDeps__.Rxjs;const o=e=>{const{type:t,script:i,fields:s}=e;return{type:t,script:i,...s&&{fields:Object.entries(s).reduce(((e,[t,i])=>(e[t]={type:i.type},e)),{})}}},c=(e="milliseconds")=>({id:"duration",params:{inputFormat:e,outputFormat:"humanizePrecise",outputPrecision:2,includeSpaceWithSuffix:!0,useShortSuffix:!0}}),u={percent:{id:"percent"},byte:{id:"bytes"},nanos:c("nanoseconds"),micros:c("microseconds"),ms:c("milliseconds"),s:c("seconds"),m:c("minutes"),h:c("hours"),d:c("days")};class AbstractDataView{constructor(e){(0,n.default)(this,"id",void 0),(0,n.default)(this,"title",""),(0,n.default)(this,"fieldFormatMap",void 0),(0,n.default)(this,"typeMeta",void 0),(0,n.default)(this,"timeFieldName",void 0),(0,n.default)(this,"type",void 0),(0,n.default)(this,"metaFields",void 0),(0,n.default)(this,"version",void 0),(0,n.default)(this,"sourceFilters",void 0),(0,n.default)(this,"namespaces",void 0),(0,n.default)(this,"originalSavedObjectBody",{}),(0,n.default)(this,"shortDotsEnable",!1),(0,n.default)(this,"fieldFormats",void 0),(0,n.default)(this,"fieldAttrs",void 0),(0,n.default)(this,"runtimeFieldMap",void 0),(0,n.default)(this,"allowNoIndex",!1),(0,n.default)(this,"name",""),(0,n.default)(this,"matchedIndices",[]),(0,n.default)(this,"scriptedFieldsMap",void 0),(0,n.default)(this,"allowHidden",!1),(0,n.default)(this,"getAllowHidden",(()=>this.allowHidden)),(0,n.default)(this,"setAllowHidden",(e=>this.allowHidden=e)),(0,n.default)(this,"getName",(()=>this.name?this.name:this.title)),(0,n.default)(this,"getIndexPattern",(()=>this.title)),(0,n.default)(this,"setIndexPattern",(e=>{this.title=e})),(0,n.default)(this,"getOriginalSavedObjectBody",(()=>({...this.originalSavedObjectBody}))),(0,n.default)(this,"resetOriginalSavedObjectBody",(()=>{this.originalSavedObjectBody=this.getAsSavedObjectBody()})),(0,n.default)(this,"setFieldFormat",((e,t)=>{this.fieldFormatMap[e]=t})),(0,n.default)(this,"deleteFieldFormat",(e=>{delete this.fieldFormatMap[e]})),(0,n.default)(this,"upsertScriptedFieldInternal",(e=>{this.scriptedFieldsMap[e.name]={name:e.name,script:e.script,lang:e.lang,type:e.type,scripted:e.scripted}})),(0,n.default)(this,"deleteScriptedFieldInternal",(e=>{delete this.scriptedFieldsMap[e]})),(0,n.default)(this,"getFieldAttrs",(()=>{const e=(0,s.cloneDeep)(Object.fromEntries(this.fieldAttrs.entries()));return new Map(Object.entries(e))}));const{spec:t={},fieldFormats:i,shortDotsEnable:a=!1,metaFields:r=[]}=e,l=null!=t&&t.fields?Object.entries(t.fields).reduce(((e,[t,i])=>{const s={};let a=!1;return i.count&&(s.count=i.count,a=!0),i.customLabel&&(s.customLabel=i.customLabel,a=!0),i.customDescription&&(s.customDescription=i.customDescription,a=!0),a&&(e[t]=s),e}),{}):{};this.allowNoIndex=(null==t?void 0:t.allowNoIndex)||!1,this.scriptedFieldsMap=null!=t&&t.fields?Object.values(t.fields).filter((e=>e.scripted)).reduce(((e,t)=>(e[t.name]=t,e)),{}):{},this.fieldFormats={...i},this.shortDotsEnable=a,this.metaFields=r,this.id=t.id,this.fieldFormatMap={...t.fieldFormats},this.version=t.version,this.title=t.title||"",this.timeFieldName=t.timeFieldName,this.sourceFilters=[...t.sourceFilters||[]],this.type=t.type,this.typeMeta=t.typeMeta,this.fieldAttrs=new Map(Object.entries({...l,...t.fieldAttrs})),this.runtimeFieldMap=(0,s.cloneDeep)(t.runtimeFieldMap)||{},this.namespaces=t.namespaces||[],this.name=t.name||"",this.allowHidden=t.allowHidden||!1}isPersisted(){return"string"==typeof this.version}getSourceFiltering(){return{excludes:this.sourceFilters&&this.sourceFilters.map((e=>e.value))||[]}}getAggregationRestrictions(){var e;return null===(e=this.typeMeta)||void 0===e?void 0:e.aggs}getFormatterForField(e){const t=this.getFormatterForFieldNoDefault(e.name);if(t)return t;const i=e.defaultFormatter?u[e.defaultFormatter]:void 0;return i?this.fieldFormats.getInstance(i.id,i.params):this.fieldFormats.getDefaultInstance(e.type,e.esTypes)}getFormatterForFieldNoDefault(e){const t=this.fieldFormatMap[e];if(null!=t&&t.id)return this.fieldFormats.getInstance(t.id,t.params)}setFieldAttrs(e,t,i){const s=this.fieldAttrs.get(e)||{};this.fieldAttrs.set(e,{...s,[t]:i})}setFieldCustomLabelInternal(e,t){this.setFieldAttrs(e,"customLabel",null===t?void 0:t)}setFieldCountInternal(e,t){this.setFieldAttrs(e,"count",null===t?void 0:t)}setFieldCustomDescriptionInternal(e,t){this.setFieldAttrs(e,"customDescription",null===t?void 0:t)}getAsSavedObjectBody(){const e=e=>e?JSON.stringify(e):void 0,t={};return this.fieldAttrs.forEach(((e,i)=>{Object.keys(e).length&&(t[i]=e)})),{fieldAttrs:e(t),title:this.getIndexPattern(),timeFieldName:this.timeFieldName,sourceFilters:e(this.sourceFilters),fields:e(Object.values(this.scriptedFieldsMap)),fieldFormatMap:e(this.fieldFormatMap),type:this.type,typeMeta:e(this.typeMeta),allowNoIndex:this.allowNoIndex?this.allowNoIndex:void 0,runtimeFieldMap:e(this.runtimeFieldMap),name:this.name,allowHidden:this.allowHidden}}toSpecShared(e=!0){const t=(0,s.cloneDeep)(Object.fromEntries(this.fieldAttrs.entries()));e||Object.keys(t).forEach((e=>{delete t[e].count,0===Object.keys(t[e]).length&&delete t[e]}));const i={id:this.id,version:this.version,title:this.getIndexPattern(),timeFieldName:this.timeFieldName,sourceFilters:[...this.sourceFilters||[]],typeMeta:this.typeMeta,type:this.type,fieldFormats:{...this.fieldFormatMap},runtimeFieldMap:(0,s.cloneDeep)(this.runtimeFieldMap),fieldAttrs:t,allowNoIndex:this.allowNoIndex,name:this.name,allowHidden:this.getAllowHidden()};return Object.fromEntries(Object.entries(i).filter((([,e])=>void 0!==e)))}replaceAllScriptedFields(e){Object.keys(this.scriptedFieldsMap).forEach((e=>{this.removeScriptedField(e)})),Object.entries(e).forEach((([e,t])=>{this.upsertScriptedField(t)}))}removeScriptedField(e){return this.deleteScriptedFieldInternal(e)}upsertScriptedField(e){return this.upsertScriptedFieldInternal(e)}getScriptedField(e){if(this.runtimeFieldMap[e])return;const t=this.scriptedFieldsMap[e];return t?{...t,scripted:!0}:void 0}hasRuntimeField(e){return!!this.runtimeFieldMap[e]}getRuntimeField(e){if(!this.runtimeFieldMap[e])return null;const{type:t,script:i,fields:s}={...this.runtimeFieldMap[e]},a={type:t,script:i};return"composite"===t&&(a.fields=s),a}getAllRuntimeFields(){return Object.keys(this.runtimeFieldMap).reduce(((e,t)=>({...e,[t]:this.getRuntimeField(t)})),{})}replaceAllRuntimeFields(e){Object.keys(this.runtimeFieldMap).forEach((e=>{this.removeRuntimeField(e)})),Object.entries(e).forEach((([e,t])=>{this.addRuntimeField(e,t)}))}removeRuntimeField(e){return this.removeRuntimeFieldInteral(e)}addRuntimeField(e,t){return this.addRuntimeFieldInteral(e,t)}removeRuntimeFieldInteral(e){delete this.runtimeFieldMap[e]}addRuntimeFieldInteral(e,t){this.runtimeFieldMap[e]=o(t)}}class DataView extends AbstractDataView{constructor(e){super(e),(0,n.default)(this,"fields",void 0),(0,n.default)(this,"flattenHit",void 0),(0,n.default)(this,"etag",void 0),(0,n.default)(this,"getEtag",(()=>this.etag)),(0,n.default)(this,"setEtag",(e=>this.etag=e)),(0,n.default)(this,"upsertScriptedField",(e=>{this.upsertScriptedFieldInternal(e),this.fields.getByName(e.name)?this.fields.update(e):this.fields.add(e)}));const{spec:t={},metaFields:i}=e;this.fields=(0,d.FL)([],this.shortDotsEnable),this.flattenHit=function(e,t={},i=new WeakMap){return function(s,n=!1){const r=function(e,t){return function(i){return a().each(t,(function(t){"_source"!==t&&(i[t]=e[t])})),a().forOwn(e.fields,(function(e,t){Array.isArray(e)&&e.length<=1?i[t]=e[0]:i[t]=e})),new Proxy(i,{ownKeys:e=>Reflect.ownKeys(e).sort(((e,i)=>{const s=a().includes(t,e),n=a().includes(t,i);return s&&n?String(e).localeCompare(String(i)):s?1:n?-1:String(e).localeCompare(String(i))}))})}}(s,t),l=i.get(s),d=l||function(e,t,i){const s={},n=e.fields.getByName;return function e(t,r=""){r=r?r+".":"",a().forOwn(t,(function(t,l){if(l=r+l,i){const i=n(l),s=i&&"nested"===i.type;if(Array.isArray(t)&&a().isPlainObject(a().first(t))&&!s)return void a().each(t,(t=>e(t,l)))}else if(void 0!==s[l])return;const d=n(l),o=d&&"conflict"!==d.type,c=!a().isPlainObject(t);o||c?s[l]?Array.isArray(s[l])?s[l].push(t):s[l]=[s[l],t]:s[l]=t:e(t,l)}))}(t._source),s}(e,s,n);return l||i.set(s,{...d}),r(d)}}(this,i),this.fields.replaceAll(Object.values(t.fields||{}))}getScriptedFieldsForQuery(){return this.getScriptedFields().reduce(((e,t)=>(e[t.name]={script:{source:t.script,lang:t.lang}},e)),{})}getComputedFields(){const e={};if(!this.fields)return{scriptFields:e,docvalueFields:[],runtimeFields:{}};const t=(0,s.reject)(this.fields.getByType("date"),"scripted").map((e=>({field:e.name,format:e.esTypes&&-1!==e.esTypes.indexOf("date_nanos")?"strict_date_time":"date_time"})));return(0,s.each)(this.getScriptedFields(),(function(t){e[t.name]={script:{source:t.script,lang:t.lang}}})),{scriptFields:this.getScriptedFieldsForQuery(),docvalueFields:t,runtimeFields:this.getRuntimeMappings()}}toSpec(e=!0){const t=this.toSpecShared(e),i=e&&this.fields?this.fields.toSpec({getFormatterForField:this.getFormatterForField.bind(this)}):void 0;return i&&(t.fields=i),t}toMinimalSpec(e){var t;const i=null!==(t=null==e?void 0:e.keepFieldAttrs)&&void 0!==t?t:["customLabel","customDescription"],a=this.toSpec(!1);return a.fieldAttrs&&(a.fieldAttrs=(0,s.pickBy)((0,s.mapValues)(a.fieldAttrs,(e=>(0,s.pick)(e,i))),(e=>Object.keys(e).length>0)),0===Object.keys(a.fieldAttrs).length&&(a.fieldAttrs=void 0)),a}removeScriptedField(e){this.deleteScriptedFieldInternal(e);const t=this.fields.getByName(e);if(!t||!t.scripted)throw new Error(`Scripted field ${e} does not exist in data view ${this.getName()}`);this.fields.remove(t)}getNonScriptedFields(){return[...this.fields.getAll().filter((e=>!e.scripted))]}getScriptedFields(){return[...this.fields.getAll().filter((e=>e.scripted))]}isTSDBMode(){return this.fields.some((e=>e.timeSeriesDimension||e.timeSeriesMetric))}isTimeBased(){return!(!this.timeFieldName||this.fields&&!this.getTimeField())}isTimeNanosBased(){const e=this.getTimeField();return!(!e||!e.esTypes||-1===e.esTypes.indexOf("date_nanos"))}getTimeField(){if(this.timeFieldName&&this.fields&&this.fields.getByName)return this.fields.getByName(this.timeFieldName)}getFieldByName(e){if(this.fields&&this.fields.getByName)return this.fields.getByName(e)}addRuntimeField(e,t){if(e.includes("*"))throw new l.CharacterNotAllowedInField("*",e);const{type:i,script:s,customLabel:a,customDescription:n,format:r,popularity:d}=t;return"composite"===i?this.addCompositeRuntimeField(e,t):(this.addRuntimeFieldInteral(e,t),[this.updateOrAddRuntimeField(e,i,{type:i,script:s},{customLabel:a,customDescription:n,format:r,popularity:d})])}getFieldsByRuntimeFieldName(e){const t=this.getRuntimeField(e);if(!t)return;if("composite"===t.type)return Object.entries(t.fields).reduce(((t,[i,s])=>{const a=`${e}.${i}`,n=this.getFieldByName(a);return n?(t[i]=n,t):t}),{});const i=this.getFieldByName(e);return i&&{[e]:i}}removeRuntimeField(e){const t=this.getFieldByName(e);t&&t.isMapped?t.runtimeField=void 0:Object.values(this.getFieldsByRuntimeFieldName(e)||{}).forEach((e=>{this.fields.remove(e)})),this.removeRuntimeFieldInteral(e)}getRuntimeMappings(){return Object.keys(this.runtimeFieldMap).reduce(((e,t)=>{const i=this.fields.getByName(t);return null!=i&&i.isMapped||(e[t]=this.runtimeFieldMap[t]),e}),{})}setFieldCustomLabel(e,t){const i=this.fields.getByName(e),s=null===t?void 0:t;i&&(i.customLabel=s),this.setFieldCustomLabelInternal(e,t)}setFieldCustomDescription(e,t){const i=this.fields.getByName(e),s=null===t?void 0:t;i&&(i.customDescription=s),this.setFieldCustomDescriptionInternal(e,t)}setFieldCount(e,t){const i=this.fields.getByName(e),s=null===t?void 0:t;i&&(s?i.count=s:i.deleteCount()),this.setFieldCountInternal(e,s)}addCompositeRuntimeField(e,t){const{fields:i}=t;if(void 0===i||0===Object.keys(i).length)throw new Error(`Can't add composite runtime field [name = ${e}] without subfields.`);if(void 0!==this.getFieldByName(e))throw new Error(`Can't create composite runtime field ["${e}"] as there is already a field with this name`);this.removeRuntimeField(e);const s=o(t),a=Object.entries(i).map((([t,i])=>this.updateOrAddRuntimeField(`${e}.${t}`,i.type,s,{customLabel:i.customLabel,customDescription:i.customDescription,format:i.format,popularity:i.popularity})));return this.addRuntimeFieldInteral(e,t),a}updateOrAddRuntimeField(e,t,i,s){var a;if("composite"===t)throw new Error(`Trying to add composite field as primmitive field, this shouldn't happen! [name = ${e}]`);let n;const l=this.getFieldByName(e);var d;return l?l.runtimeField=i:n=this.fields.add({name:e,runtimeField:i,type:(0,r.Bh)(t),esTypes:[t],aggregatable:!0,searchable:!0,count:null!==(d=s.popularity)&&void 0!==d?d:0,readFromDocValues:!1}),this.setFieldCustomLabel(e,s.customLabel),this.setFieldCustomDescription(e,s.customDescription),(s.popularity||null===s.popularity)&&this.setFieldCount(e,s.popularity),s.format?this.setFieldFormat(e,s.format):null===s.format&&this.deleteFieldFormat(e),null!==(a=n)&&void 0!==a?a:l}}var h=i(8),p=i(374);const m=__kbnSharedDeps__.Uuid,f=(e,t)=>!!t.includes("*")||t.includes(e);class DataViewLazy extends AbstractDataView{constructor(e){super(e),(0,n.default)(this,"apiClient",void 0),(0,n.default)(this,"fieldCache",new Map),(0,n.default)(this,"scriptedFieldsEnabled",!1),(0,n.default)(this,"getRuntimeFields",(({fieldName:e=["*"]})=>Object.values(this.getRuntimeFieldSpecMap({fieldName:["*"]})).reduce(((t,i)=>{var s;if(!f(i.name,e))return t;let a=this.fieldCache.get(i.name);if(null!==(s=a)&&void 0!==s&&s.isMapped)return t;if(!a){const e=this.fieldAttrs.get(i.name)||{};a=new d.eS({...i,count:e.count,customLabel:e.customLabel,customDescription:e.customDescription,shortDotsEnable:this.shortDotsEnable}),this.fieldCache.set(i.name,a)}return t[i.name]=a,t}),{}))),(0,n.default)(this,"getRuntimeFieldSpecMap",(({fieldName:e=["*"]})=>{const t={},i=(e,i,s,a)=>{const n=this.fieldAttrs.get(e)||{};t[e]={name:e,type:(0,r.Bh)(i),esTypes:[i],runtimeField:s,aggregatable:!0,searchable:!0,readFromDocValues:!1,customLabel:n.customLabel,customDescription:n.customDescription,count:n.count},a&&(t[e].parentName=a)};for(const[t,s]of Object.entries(this.runtimeFieldMap||{}))f(t,e)&&("composite"===s.type?Object.entries(s.fields).forEach((([e,a])=>{i(`${t}.${e}`,a.type,s,t)})):i(t,s.type,s));return t})),(0,n.default)(this,"isTimeBased",(async()=>!!await this.getTimeField())),(0,n.default)(this,"getTimeField",(()=>this.timeFieldName?this.getFieldByName(this.timeFieldName):void 0)),this.apiClient=e.apiClient,this.scriptedFieldsEnabled=e.scriptedFieldsEnabled}async getFields({mapped:e=!0,scripted:t=!0,runtime:i=!0,fieldName:a,forceRefresh:n=!1,unmapped:r,indexFilter:l,metaFields:d=!0}){let o={},c={},u={};if(e||i){const t=e?a:((e,t)=>t.includes("*")?e:(0,s.union)(e,t))(Object.keys(this.runtimeFieldMap),a);o=await this.getMappedFields({fieldName:t,forceRefresh:n,unmapped:r,indexFilter:l,metaFields:d})}t&&this.scriptedFieldsEnabled&&(c=this.getScriptedFields({fieldName:a})),i&&(u=this.getRuntimeFields({fieldName:a}));const h={...o,...c,...u};let p={},m=!1;return{getFieldMap:()=>h,getFieldMapSorted:()=>(m||(p=(0,s.chain)(h).toPairs().sortBy(0).fromPairs().value(),m=!0),p)}}async addRuntimeField(e,t){if(e.includes("*"))throw new l.CharacterNotAllowedInField("*",e);const{type:i,script:s,customLabel:a,customDescription:n,format:r,popularity:d}=t;return"composite"===i?this.addCompositeRuntimeField(e,t):(this.addRuntimeFieldInteral(e,t),[await this.updateOrAddRuntimeField(e,i,{type:i,script:s},{customLabel:a,customDescription:n,format:r,popularity:d})])}async addCompositeRuntimeField(e,t){const{fields:i}=t;if(void 0===i||0===Object.keys(i).length)throw new Error(`Can't add composite runtime field [name = ${e}] without subfields.`);if(void 0!==await this.getFieldByName(e))throw new Error(`Can't create composite runtime field ["${e}"] as there is already a field with this name`);this.removeRuntimeField(e);const s=o(t),a=await Promise.all(Object.entries(i).map((async([t,i])=>await this.updateOrAddRuntimeField(`${e}.${t}`,i.type,s,{customLabel:i.customLabel,customDescription:i.customDescription,format:i.format,popularity:i.popularity}))));return this.addRuntimeFieldInteral(e,t),a}removeRuntimeField(e){const t=this.fieldCache.get(e);t&&t.isMapped?t.runtimeField=void 0:Object.values(this.getFieldsByRuntimeFieldName(e)||{}).forEach((e=>{this.fieldCache.delete(e.name)})),this.removeRuntimeFieldInteral(e)}getFieldsByRuntimeFieldName(e){const t=this.getRuntimeField(e);if(!t)return;if("composite"===t.type)return Object.entries(t.fields).reduce(((t,[i,s])=>{const a=`${e}.${i}`,n=this.fieldCache.get(a);return n?(t[i]=n,t):t}),{});const i=this.fieldCache.get(e);return i&&{[e]:i}}async updateOrAddRuntimeField(e,t,i,s){if("composite"===t)throw new Error(`Trying to add composite field as primitive field, this shouldn't happen! [name = ${e}]`);let a=await this.getFieldByName(e);var n;return a?(a.runtimeField=i,a.spec.type=(0,r.Bh)(t),a.spec.esTypes=[t]):(a=new d.eS({name:e,runtimeField:i,type:(0,r.Bh)(t),esTypes:[t],aggregatable:!0,searchable:!0,count:null!==(n=s.popularity)&&void 0!==n?n:0,readFromDocValues:!1,shortDotsEnable:this.shortDotsEnable}),this.fieldCache.set(e,a)),this.setFieldCustomLabel(e,s.customLabel),this.setFieldCustomDescription(e,s.customDescription),(s.popularity||null===s.popularity)&&this.setFieldCount(e,s.popularity),s.format?this.setFieldFormat(e,s.format):null===s.format&&this.deleteFieldFormat(e),a}getScriptedFields({fieldName:e=["*"]}){const t={};return Object.values(this.scriptedFieldsMap).forEach((i=>{if(!f(i.name,e))return;let s=this.fieldCache.get(i.name);s&&!s.scripted&&s.isMapped&&this.fieldCache.delete(i.name);const a=this.fieldAttrs.get(i.name)||{};s=new d.eS({...i,scripted:!0,searchable:!0,aggregatable:!0,count:a.count,customLabel:a.customLabel,customDescription:a.customDescription}),this.fieldCache.set(i.name,s),t[i.name]=s})),t}async getMappedFields({fieldName:e,forceRefresh:t=!1,unmapped:i,indexFilter:a,metaFields:n,fieldTypes:r}){var l,o;const c=await this.apiClient.getFieldsForWildcard({pattern:this.getIndexPattern(),metaFields:n?this.metaFields:void 0,type:this.type,rollupIndex:null===(l=this.typeMeta)||void 0===l||null===(o=l.params)||void 0===o?void 0:o.rollup_index,fields:e||["*"],allowNoIndex:!0,indexFilter:a,includeUnmapped:i,forceRefresh:t,fieldTypes:r}),u={};return c.fields.forEach((e=>{let t=this.fieldCache.get(e.name);if(t)(0,s.assign)(t.spec,e),t.spec.runtimeField=void 0,t.spec.isMapped=!0;else{const i=this.fieldAttrs.get(e.name)||{};t=new d.eS({...e,count:i.count,customLabel:i.customLabel,customDescription:i.customDescription,shortDotsEnable:this.shortDotsEnable}),this.fieldCache.set(e.name,t)}u[e.name]=t})),u}getScriptedFieldsForQuery(){return Object.values(this.scriptedFieldsMap).reduce(((e,t)=>(e[t.name]={script:{source:t.script,lang:t.lang}},e)),{})}async getComputedFields({fieldName:e=["*"]}){const t={},i=(await this.getFields({fieldName:e,fieldTypes:["date","date_nanos"],scripted:!1,runtime:!1})).getFieldMap(),a=Object.values(i).map((e=>({field:e.name,format:e.esTypes&&-1!==e.esTypes.indexOf("date_nanos")?"strict_date_time":"date_time"})));return(0,s.each)(this.getScriptedFields({fieldName:e}),(function(e){t[e.name]={script:{source:e.script,lang:e.lang}}})),{scriptFields:t,docvalueFields:a,runtimeFields:this.getRuntimeMappings()}}getRuntimeMappings(){return this.runtimeFieldMap}async toSpec(e){const t=this.toSpecShared(!(null==e||!e.fieldParams));if(null!=e&&e.fieldParams){const i={},s=(await this.getFields(e.fieldParams)).getFieldMap();Object.values(s).forEach((e=>{i[e.name]=e.toSpec({getFormatterForField:this.getFormatterForField.bind(this)})})),t.fields=i}return t}toMinimalSpec(e){var t;const i=null!==(t=null==e?void 0:e.keepFieldAttrs)&&void 0!==t?t:["customLabel","customDescription"],a=this.toSpecShared(!1);return a.fieldAttrs&&(a.fieldAttrs=(0,s.pickBy)((0,s.mapValues)(a.fieldAttrs,(e=>(0,s.pick)(e,i))),(e=>Object.keys(e).length>0)),0===Object.keys(a.fieldAttrs).length&&delete a.fieldAttrs),Object.fromEntries(Object.entries(a).filter((([,e])=>void 0!==e)))}async isTSDBMode(){const e=(await this.getFields({fieldName:["*"]})).getFieldMap();return Object.values(e).some((e=>e.timeSeriesDimension||e.timeSeriesMetric))}removeScriptedField(e){this.deleteScriptedFieldInternal(e),this.fieldCache.delete(e)}upsertScriptedField(e){return this.upsertScriptedFieldInternal(e)}async isTimeNanosBased(){const e=await this.getTimeField();return!!e&&"date_nanos"===e.type}async getFieldByName(e,t=!1){return(await this.getFields({fieldName:[e],forceRefresh:t})).getFieldMap()[e]}setFieldCustomLabel(e,t){const i=null===t?void 0:t;this.setFieldCustomLabelInternal(e,t);const s=this.fieldCache.get(e);s&&(s.spec.customLabel=i)}setFieldCount(e,t){const i=null===t?void 0:t;this.setFieldCountInternal(e,t);const s=this.fieldCache.get(e);s&&(i?s.spec.count=i:s.deleteCount())}setFieldCustomDescription(e,t){const i=null===t?void 0:t;this.setFieldCustomDescriptionInternal(e,t);const s=this.fieldCache.get(e);s&&(s.spec.customDescription=i)}}var g=i(787),F=i(449),y=i(827),v=i(979);const b=({id:e,title:t})=>h.i18n.translate("dataViews.fetchFieldErrorTitle",{defaultMessage:"Error fetching fields for data view {title} (ID: {id})",values:{id:e,title:t}});class DataViewsService{constructor(e){(0,n.default)(this,"config",void 0),(0,n.default)(this,"savedObjectsClient",void 0),(0,n.default)(this,"savedObjectsCache",void 0),(0,n.default)(this,"apiClient",void 0),(0,n.default)(this,"fieldFormats",void 0),(0,n.default)(this,"onNotification",void 0),(0,n.default)(this,"onError",void 0),(0,n.default)(this,"dataViewCache",void 0),(0,n.default)(this,"dataViewLazyCache",void 0),(0,n.default)(this,"getCanSaveAdvancedSettings",void 0),(0,n.default)(this,"getCanSave",void 0),(0,n.default)(this,"scriptedFieldsEnabled",void 0),(0,n.default)(this,"getIds",(async(e=!1)=>(this.savedObjectsCache&&!e||await this.refreshSavedObjectsCache(),this.savedObjectsCache?this.savedObjectsCache.map((e=>null==e?void 0:e.id)):[]))),(0,n.default)(this,"getTitles",(async(e=!1)=>(this.savedObjectsCache&&!e||await this.refreshSavedObjectsCache(),this.savedObjectsCache?this.savedObjectsCache.map((e=>{var t;return null==e||null===(t=e.attributes)||void 0===t?void 0:t.title})):[]))),(0,n.default)(this,"find",(async(e,t=10)=>{const i=(await this.savedObjectsClient.find({fields:["title"],search:e,searchFields:["title","name"],perPage:t})).map((async e=>await this.get(e.id)));return await Promise.all(i)})),(0,n.default)(this,"findLazy",(async(e,t=10)=>{const i=(await this.savedObjectsClient.find({fields:["title"],search:e,searchFields:["title","name"],perPage:t})).map((async e=>await this.getDataViewLazy(e.id)));return await Promise.all(i)})),(0,n.default)(this,"getIdsWithTitle",(async(e=!1)=>(this.savedObjectsCache&&!e||await this.refreshSavedObjectsCache(),this.savedObjectsCache?this.savedObjectsCache.map((e=>{var t,i,s,a,n;return{id:null==e?void 0:e.id,namespaces:null==e?void 0:e.namespaces,title:null==e||null===(t=e.attributes)||void 0===t?void 0:t.title,type:null==e||null===(i=e.attributes)||void 0===i?void 0:i.type,typeMeta:(null==e||null===(s=e.attributes)||void 0===s?void 0:s.typeMeta)&&JSON.parse(null==e||null===(a=e.attributes)||void 0===a?void 0:a.typeMeta),name:null==e||null===(n=e.attributes)||void 0===n?void 0:n.name}})):[]))),(0,n.default)(this,"getAllDataViewLazy",(async(e=!1)=>(this.savedObjectsCache&&!e||await this.refreshSavedObjectsCache(),this.savedObjectsCache?await Promise.all(this.savedObjectsCache.map((async e=>await this.getDataViewLazy(e.id)))):[]))),(0,n.default)(this,"clearCache",(()=>{this.savedObjectsCache=null})),(0,n.default)(this,"clearInstanceCache",(e=>{e?(this.dataViewLazyCache.delete(e),this.dataViewCache.delete(e)):(this.dataViewLazyCache.clear(),this.dataViewCache.clear())})),(0,n.default)(this,"clearDataViewLazyCache",(e=>{this.dataViewLazyCache.delete(e)})),(0,n.default)(this,"getCache",(async()=>(this.savedObjectsCache||await this.refreshSavedObjectsCache(),this.savedObjectsCache))),(0,n.default)(this,"getDefault",(async(e=!0)=>{const t=await this.getDefaultId();return t?await this.get(t,e):null})),(0,n.default)(this,"getDefaultId",(async()=>{const e=await this.config.get(g.Ds);return null!=e?e:null})),(0,n.default)(this,"setDefault",(async(e,t=!1)=>{!t&&await this.getDefaultId()||await this.config.set(g.Ds,e)})),(0,n.default)(this,"getMetaFields",(async()=>await this.config.get(F.META_FIELDS))),(0,n.default)(this,"getShortDotsEnable",(async()=>await this.config.get(p.FORMATS_UI_SETTINGS.SHORT_DOTS_ENABLE))),(0,n.default)(this,"getFieldsForWildcard",(async e=>{const t=await this.getMetaFields(),{fields:i}=await this.apiClient.getFieldsForWildcard({...e,metaFields:t});return i})),(0,n.default)(this,"getFieldsForIndexPattern",(async(e,t)=>{var i,s,a,n;return this.getFieldsForWildcard({type:e.type,rollupIndex:null==e||null===(i=e.typeMeta)||void 0===i||null===(s=i.params)||void 0===s?void 0:s.rollup_index,allowNoIndex:!0,...t,pattern:e.title,allowHidden:null==e.allowHidden?null==e||null===(a=(n=e).getAllowHidden)||void 0===a?void 0:a.call(n):e.allowHidden})})),(0,n.default)(this,"getFieldsAndIndicesForDataView",(async(e,t=!1)=>{var i,s;const a=await this.getMetaFields();return this.apiClient.getFieldsForWildcard({type:e.type,rollupIndex:null==e||null===(i=e.typeMeta)||void 0===i||null===(s=i.params)||void 0===s?void 0:s.rollup_index,allowNoIndex:!0,pattern:e.getIndexPattern(),metaFields:a,forceRefresh:t,allowHidden:e.getAllowHidden()||void 0})})),(0,n.default)(this,"getFieldsAndIndicesForWildcard",(async e=>{const t=await this.getMetaFields();return this.apiClient.getFieldsForWildcard({pattern:e.pattern,metaFields:t,type:e.type,rollupIndex:e.rollupIndex,allowNoIndex:!0,indexFilter:e.indexFilter,allowHidden:e.allowHidden,forceRefresh:e.forceRefresh})})),(0,n.default)(this,"refreshFieldsFn",(async(e,t=!1)=>{const{fields:i,indices:s,etag:a}=await this.getFieldsAndIndicesForDataView(e,t);if(e.getEtag()&&a===e.getEtag())return;e.setEtag(a),i.forEach((e=>e.isMapped=!0));const n=this.scriptedFieldsEnabled?e.getScriptedFields().map((e=>e.spec)):[],r=Object.fromEntries(e.getFieldAttrs().entries()),l=Object.values(this.fieldArrayToMap([...i,...n],r)),d=this.getRuntimeFields(e.getRuntimeMappings(),e.getFieldAttrs()),o=Object.values(d).filter((e=>!l.find((t=>t.name===e.name))));e.fields.replaceAll([...o,...l]),e.matchedIndices=s})),(0,n.default)(this,"refreshFields",(async(e,t=!0,i=!1)=>{if(!t)return this.refreshFieldsFn(e,i);try{await this.refreshFieldsFn(e,i)}catch(t){t instanceof y.dA||this.onError(t,{title:b({id:e.id,title:e.getIndexPattern()})},e.getIndexPattern())}})),(0,n.default)(this,"refreshFieldSpecMap",(async(e,t,i,s,a={},n=!0)=>{const r=Object.values(e),l=this.scriptedFieldsEnabled?r.filter((e=>e.scripted)):[];try{let e;const{fields:t,indices:i,etag:n}=await this.getFieldsAndIndicesForWildcard(s);return t.forEach((e=>e.isMapped=!0)),e=!s.allowNoIndex||t&&t.length>5?[...t,...l]:r,{fields:this.fieldArrayToMap(e,a),indices:i,etag:n}}catch(e){if(e instanceof y.dA)return{};if(!n)throw e;throw this.onError(e,{title:b({id:t,title:i})},i),e}})),(0,n.default)(this,"fieldArrayToMap",((e,t)=>e.reduce(((e,i)=>{var s,a,n;return e[i.name]={...i,customLabel:null==t||null===(s=t[i.name])||void 0===s?void 0:s.customLabel,customDescription:null==t||null===(a=t[i.name])||void 0===a?void 0:a.customDescription,count:null==t||null===(n=t[i.name])||void 0===n?void 0:n.count},e}),{}))),(0,n.default)(this,"savedObjectToSpec",(e=>{const{id:t,version:i,namespaces:s,attributes:{title:a,timeFieldName:n,fields:r,sourceFilters:l,fieldFormatMap:d,runtimeFieldMap:o,typeMeta:c,type:u,fieldAttrs:h,allowNoIndex:p,name:m,allowHidden:f}}=e,g=l?JSON.parse(l):void 0,F=c?JSON.parse(c):void 0,y=d?JSON.parse(d):{},v=r?JSON.parse(r):[],b=h?JSON.parse(h):{},w=o?JSON.parse(o):{};return b&&Object.keys(b).forEach((e=>{const t=null==b?void 0:b[e];t&&"string"==typeof t.count&&(t.count=Number(t.count)||0)})),{id:t,version:i,namespaces:s,title:a,timeFieldName:n,sourceFilters:g,fields:this.fieldArrayToMap(v,b),typeMeta:F,type:u,fieldFormats:y,fieldAttrs:b,allowNoIndex:p,runtimeFieldMap:w,name:m,allowHidden:f}})),(0,n.default)(this,"getSavedObjectAndInit",(async(e,t=!0,i=!1)=>{const s=await this.savedObjectsClient.get(e);return this.initFromSavedObject(s,t,i)})),(0,n.default)(this,"initFromSavedObjectLoadFields",(async({savedObjectId:e,spec:t,displayErrors:i=!0,refreshFields:s=!1})=>{var a;const{title:n,type:r,typeMeta:l,runtimeFieldMap:d}=t,{fields:o,indices:c,etag:u}=await this.refreshFieldSpecMap(t.fields||{},e,t.title,{pattern:n,metaFields:await this.getMetaFields(),type:r,rollupIndex:null==l||null===(a=l.params)||void 0===a?void 0:a.rollup_index,allowNoIndex:t.allowNoIndex,allowHidden:t.allowHidden,forceRefresh:s},t.fieldAttrs,i);return{fields:{...this.getRuntimeFields(d,new Map(Object.entries(t.fieldAttrs||{}))),...o},indices:c||[],etag:u}})),(0,n.default)(this,"initFromSavedObject",(async(e,t=!0,i=!1)=>{const s=this.savedObjectToSpec(e);let a,n={},r=[];if(t)try{const l=await this.initFromSavedObjectLoadFields({savedObjectId:e.id,spec:s,displayErrors:t,refreshFields:i});n=l.fields,r=l.indices,a=l.etag}catch(t){t instanceof y.dA||this.onError(t,{title:b({id:e.id,title:s.title})},s.title||"")}else{const l=await this.initFromSavedObjectLoadFields({savedObjectId:e.id,spec:s,displayErrors:t,refreshFields:i});n=l.fields,r=l.indices,a=l.etag}s.fields=n,s.fieldFormats=e.attributes.fieldFormatMap?JSON.parse(e.attributes.fieldFormatMap):{};const l=await this.createFromSpec(s,!0,t);return l.setEtag(a),l.matchedIndices=r,l.resetOriginalSavedObjectBody(),l})),(0,n.default)(this,"getRuntimeFields",((e={},t=new Map)=>{const i={},s=(e,s,a,n)=>{const l=t.get(e)||{};i[e]={name:e,type:(0,r.Bh)(s),esTypes:[s],runtimeField:a,aggregatable:!0,searchable:!0,readFromDocValues:!1,customLabel:l.customLabel,customDescription:l.customDescription,count:l.count},n&&(i[e].parentName=n)};for(const[t,i]of Object.entries(e||{}))"composite"===i.type?Object.entries(i.fields).forEach((([e,a])=>{s(`${t}.${e}`,a.type,i,t)})):s(t,i.type,i);return i})),(0,n.default)(this,"getDataViewLazy",(async e=>{const t=this.dataViewLazyCache.get(e);if(t)return t;{const t=(async()=>{const t=await this.savedObjectsClient.get(e),i=this.savedObjectToSpec(t),s=await this.getShortDotsEnable(),a=await this.getMetaFields();return new DataViewLazy({spec:i,fieldFormats:this.fieldFormats,shortDotsEnable:s,metaFields:a,apiClient:this.apiClient,scriptedFieldsEnabled:this.scriptedFieldsEnabled})})();return t.catch((()=>{this.dataViewLazyCache.delete(e)})),this.dataViewLazyCache.set(e,t),t}})),(0,n.default)(this,"getDataViewLazyFromCache",(async e=>this.dataViewLazyCache.get(e))),(0,n.default)(this,"get",(async(e,t=!0,i=!1)=>{var s;const a=null===(s=this.dataViewCache.get(e))||void 0===s?void 0:s.then((async e=>(e&&i&&await this.refreshFields(e,t),e)));let n;return a?n=a:(n=this.getSavedObjectAndInit(e,t,i),this.dataViewCache.set(e,n)),n.catch((()=>{this.dataViewCache.delete(e)})),n}));const{uiSettings:t,savedObjectsClient:i,apiClient:s,fieldFormats:a,onNotification:l,onError:d,getCanSave:o=()=>Promise.resolve(!1),getCanSaveAdvancedSettings:c,scriptedFieldsEnabled:u}=e;this.apiClient=s,this.config=t,this.savedObjectsClient=i,this.fieldFormats=a,this.onNotification=l,this.onError=d,this.getCanSave=o,this.getCanSaveAdvancedSettings=c,this.dataViewCache=new Map,this.dataViewLazyCache=new Map,this.scriptedFieldsEnabled=u}async refreshSavedObjectsCache(){const e=await this.savedObjectsClient.find({fields:["title","type","typeMeta","name"],perPage:1e4});this.savedObjectsCache=e}async hasUserDataView(){return this.apiClient.hasUserDataView()}async createFromSpec({id:e,name:t,title:i,...s},a=!1,n=!0){const r=await this.getShortDotsEnable(),l=await this.getMetaFields(),d={id:null!=e?e:(0,m.v4)(),title:i,name:t||i,...s},o=new DataView({spec:d,fieldFormats:this.fieldFormats,shortDotsEnable:r,metaFields:l});return a||await this.refreshFields(o,n),o}async create(e,t=!1,i=!0){const s=()=>this.createFromSpec(e,t,i);if(e.id){const t=this.dataViewCache.get(e.id);if(t)return t;const i=s();return this.dataViewCache.set(e.id,i),i}const a=await s();return this.dataViewCache.set(a.id,Promise.resolve(a)),a}async createFromSpecLazy({id:e,name:t,title:i,...s}){const a=await this.getShortDotsEnable(),n=await this.getMetaFields(),r={id:null!=e?e:(0,m.v4)(),title:i,name:t||i,...s};return new DataViewLazy({spec:r,fieldFormats:this.fieldFormats,shortDotsEnable:a,metaFields:n,apiClient:this.apiClient,scriptedFieldsEnabled:this.scriptedFieldsEnabled})}async createDataViewLazy(e){const t=()=>this.createFromSpecLazy(e);if(e.id){const i=this.dataViewLazyCache.get(e.id);if(i)return i;const s=t();return this.dataViewLazyCache.set(e.id,s),s}const i=await t();return this.dataViewLazyCache.set(i.id,Promise.resolve(i)),i}async createAndSaveDataViewLazy(e,t=!1){const i=await this.createFromSpecLazy(e);return await this.createSavedObject(i,t),await this.setDefault(i.id),i}async createAndSave(e,t=!1,i=!1,s=!0){const a=await this.createFromSpec(e,i,s);return await this.createSavedObject(a,t),await this.setDefault(a.id),a}async createSavedObject(e,t=!1){if(!await this.getCanSave())throw new v.rJ;const i=await async function(e,t){if(t){const i=await e.find({perPage:10,search:`"${t}"`,searchFields:["name.keyword"],fields:["name"]});return i?i[0]:void 0}}(this.savedObjectsClient,e.getName());if(i){if(!t)throw new v.dt(`Duplicate data view: ${e.getName()}`);await this.delete(i.id)}const s=e.getAsSavedObjectBody(),a=await this.savedObjectsClient.create(s,{id:e.id,initialNamespaces:e.namespaces.length>0?e.namespaces:void 0,overwrite:t});this.savedObjectsCache&&this.savedObjectsCache.push(a),e.version=a.version,e.namespaces=a.namespaces||[]}async updateSavedObject(e,t=0,i=!1,s=!0){if(!e.id)return;if(!await this.getCanSave())throw new v.rJ(e.id);const a=e.getAsSavedObjectBody(),n=e.getOriginalSavedObjectBody(),r=[];Object.entries(a).forEach((([e,t])=>{t!==n[e]&&r.push(e)})),await this.savedObjectsClient.update(e.id,a,{version:e.version}).then((t=>{e.id=t.id,e.version=t.version})).catch((async l=>{var d;if(409===(null==l||null===(d=l.response)||void 0===d?void 0:d.status)&&t++<3){const d=await this.getDataViewLazy(e.id),o=d.getAsSavedObjectBody(),c=[];Object.entries(o).forEach((([e,t])=>{const i=e;t!==a[i]&&t!==n[i]&&c.push(e)}));let u=!1;for(const e of r)for(const t of c)if(e===t){u=!0;break}if(u){if(i)return;const t=h.i18n.translate("dataViews.unableWriteLabel",{defaultMessage:"Unable to write data view! Refresh the page to get the most up to date changes for this data view."});throw s&&this.onNotification({title:t,color:"danger"},`updateSavedObject:${e.getIndexPattern()}`),l}c.forEach((t=>{e[t]=d[t]})),e.version=d.version,this.dataViewCache.delete(e.id),this.dataViewLazyCache.delete(e.id),await this.updateSavedObject(e,t,i,s)}throw l}))}async delete(e){if(!await this.getCanSave())throw new v.rJ(e);return this.dataViewCache.delete(e),this.dataViewLazyCache.delete(e),this.savedObjectsClient.delete(e)}async getDefaultDataViewId(){const e=await this.getIdsWithTitle();let t=await this.getDefaultId();const i=!!t&&e.some((e=>e.id===t));return t&&!i&&(await this.getCanSaveAdvancedSettings()&&await this.config.remove(g.Ds),t=null),!t&&e.length>=1&&await this.hasUserDataView().catch((()=>!0))&&(t=e[0].id,await this.getCanSaveAdvancedSettings()&&await this.config.set(g.Ds,t)),t}async defaultDataViewExists(){return!!await this.getDefaultDataViewId()}async getDefaultDataViewLazy(){const e=await this.getDefaultDataViewId();return e?this.getDataViewLazy(e):null}async getDefaultDataView(e={}){const{displayErrors:t=!0,refreshFields:i}=e,s=await this.getDefaultDataViewId();return s?this.get(s,t,i):null}async toDataView(e){if(e.id&&e.isPersisted())return this.get(e.id);const t=await this.getShortDotsEnable(),i=await this.getMetaFields(),s=new DataView({spec:await e.toSpec(),fieldFormats:this.fieldFormats,shortDotsEnable:t,metaFields:i});return await this.refreshFields(s,!1),s}async toDataViewLazy(e){if(e.id&&e.isPersisted())return await this.getDataViewLazy(e.id);const t=await this.getShortDotsEnable(),i=await this.getMetaFields();return new DataViewLazy({spec:e.toSpec(),fieldFormats:this.fieldFormats,shortDotsEnable:t,metaFields:i,apiClient:this.apiClient,scriptedFieldsEnabled:this.scriptedFieldsEnabled})}}const w={inject:(e,t)=>e,extract:e=>({state:e,references:[]}),getAllMigrations:()=>({}),migrateToLatest:({state:e})=>e,telemetry:()=>({})}},979:(e,t,i)=>{"use strict";i.d(t,{rJ:()=>DataViewInsufficientAccessError,Ub:()=>DataViewSavedObjectConflictError,dt:()=>DuplicateDataViewError});class DuplicateDataViewError extends Error{constructor(e){super(e),this.name="DuplicateDataViewError"}}class DataViewSavedObjectConflictError extends Error{constructor(e){super(`Conflict loading DataView saved object, id: ${e}`),this.name="DataViewSavedObjectConflictError"}}class DataViewInsufficientAccessError extends Error{constructor(e){super(`Operation failed due to insufficient access, id: ${e}`),this.name="DataViewInsufficientAccessError"}}},668:(e,t,i)=>{"use strict";i.d(t,{E:()=>a});var s=i(8);const a=()=>({name:"indexPatternLoad",type:"index_pattern",inputTypes:["null"],help:s.i18n.translate("dataViews.functions.dataViewLoad.help",{defaultMessage:"Loads a data view"}),args:{id:{types:["string"],required:!0,help:s.i18n.translate("dataViews.functions.dataViewLoad.id.help",{defaultMessage:"data view id to load"})}},extract(e){const t="indexPatternLoad.id",i=[{name:t,type:"search",id:e.id[0]}];return{state:{...e,id:[t]},references:i}},inject(e,t){const i=t.find((e=>"indexPatternLoad.id"===e.name));return i&&(e.id[0]=i.id),e}})},830:(e,t,i)=>{"use strict";i.d(t,{eS:()=>DataViewField,FL:()=>g,KL:()=>d,c8:()=>o,$U:()=>n,eD:()=>l,IK:()=>r});var s=i(313);const a=(0,s.Ey)();function n(e){return"_id"===e.name||e.scripted||Boolean(e.searchable&&a.includes(e.type))}const r=c,l=h,d=p,o=u;function c(e){var t;const i=null==e?void 0:e.subType;return!(null==i||null===(t=i.nested)||void 0===t||!t.path)}function u(e){return c(e)?e.subType:void 0}function h(e){var t;const i=null==e?void 0:e.subType;return!(null==i||null===(t=i.multi)||void 0===t||!t.parent)}function p(e){return h(e)?e.subType:void 0}var m=i(915),f=i(770);class DataViewField{constructor(e){(0,m.default)(this,"spec",void 0),(0,m.default)(this,"kbnFieldType",void 0),this.spec={...e,type:"_source"===e.name?"_source":e.type},this.kbnFieldType=(0,s.cD)(e.type)}get count(){return this.spec.count||0}set count(e){this.spec.count=e}get defaultFormatter(){return this.spec.defaultFormatter}get runtimeField(){return this.spec.runtimeField}set runtimeField(e){this.spec.runtimeField=e}get script(){return this.spec.script}set script(e){this.spec.script=e}get lang(){return this.spec.lang}set lang(e){this.spec.lang=e}get customLabel(){return this.spec.customLabel}set customLabel(e){this.spec.customLabel=e}get customDescription(){return this.spec.customDescription}set customDescription(e){this.spec.customDescription=e}get conflictDescriptions(){return this.spec.conflictDescriptions}set conflictDescriptions(e){this.spec.conflictDescriptions=e}get name(){return this.spec.name}get displayName(){return this.spec.customLabel?this.spec.customLabel:this.spec.shortDotsEnable?function(e){if("string"==typeof e){const t=e.split(".");return t.reduce(((e,i,s)=>s===t.length-1?e+i:e+i[0]+"."),"")}return e}(this.spec.name):this.spec.name}get type(){return this.spec.type}get esTypes(){return this.spec.esTypes}get scripted(){return!!this.spec.scripted}get searchable(){return!(!this.spec.searchable&&!this.scripted)}get aggregatable(){return!(!this.spec.aggregatable&&!this.scripted)}get timeSeriesDimension(){return this.spec.timeSeriesDimension||!1}get timeSeriesMetric(){return this.spec.timeSeriesMetric}get fixedInterval(){return this.spec.fixedInterval}get isRolledUpField(){var e;return null===(e=this.esTypes)||void 0===e?void 0:e.includes("aggregate_metric_double")}get timeZone(){return this.spec.timeZone}get readFromDocValues(){return!(!this.spec.readFromDocValues||this.scripted)}get subType(){return this.spec.subType}get isMapped(){return this.spec.isMapped}get isRuntimeField(){return!this.isMapped&&void 0!==this.runtimeField}get sortable(){return(!this.scripted||"date"!==this.spec.type)&&("_score"===this.name||(this.spec.indexed||this.aggregatable)&&this.kbnFieldType.sortable)}get filterable(){return"_id"===this.name||this.scripted||(this.spec.indexed||this.searchable)&&this.kbnFieldType.filterable}get visualizable(){const e=[s.fM.UNKNOWN,s.fM.CONFLICT];return this.aggregatable&&!e.includes(this.spec.type)}get isNull(){return Boolean(this.spec.isNull)}isSubtypeNested(){return c(this)}isSubtypeMulti(){return h(this)}getSubtypeNested(){return u(this)}getSubtypeMulti(){return p(this)}deleteCount(){delete this.spec.count}toJSON(){return{count:this.count,script:this.script,lang:this.lang,conflictDescriptions:this.conflictDescriptions,name:this.name,type:this.type,esTypes:this.esTypes,scripted:this.scripted,searchable:this.searchable,aggregatable:this.aggregatable,readFromDocValues:this.readFromDocValues,subType:this.subType,customLabel:this.customLabel,customDescription:this.customDescription,defaultFormatter:this.defaultFormatter}}toSpec(e={}){const{getFormatterForField:t}=e,i={count:this.count,script:this.script,lang:this.lang,conflictDescriptions:this.conflictDescriptions,name:this.name,type:this.type,esTypes:this.esTypes,scripted:this.scripted,searchable:this.searchable,aggregatable:this.aggregatable,readFromDocValues:this.readFromDocValues,subType:this.subType,format:t?t(this).toJSON():void 0,customLabel:this.customLabel,customDescription:this.customDescription,shortDotsEnable:this.spec.shortDotsEnable,runtimeField:this.runtimeField,isMapped:this.isMapped,timeSeriesDimension:this.spec.timeSeriesDimension,timeSeriesMetric:this.spec.timeSeriesMetric,timeZone:this.spec.timeZone,fixedInterval:this.spec.fixedInterval,defaultFormatter:this.defaultFormatter};return Object.fromEntries(Object.entries(i).filter((([,e])=>void 0!==e)))}isRuntimeCompositeSubField(){var e;return"composite"===(null===(e=this.runtimeField)||void 0===e?void 0:e.type)}}const g=(e=[],t=!1)=>new class FldList extends Array{constructor(){super(),(0,m.default)(this,"byName",new Map),(0,m.default)(this,"groups",new Map),(0,m.default)(this,"setByName",(e=>this.byName.set(e.name,e))),(0,m.default)(this,"setByGroup",(e=>{void 0===this.groups.get(e.type)&&this.groups.set(e.type,new Map),this.groups.get(e.type).set(e.name,e)})),(0,m.default)(this,"removeByGroup",(e=>{var t;return null===(t=this.groups.get(e.type))||void 0===t?void 0:t.delete(e.name)})),(0,m.default)(this,"getAll",(()=>[...this.byName.values()])),(0,m.default)(this,"getByName",(e=>this.byName.get(e))),(0,m.default)(this,"getByType",(e=>[...(this.groups.get(e)||new Map).values()])),(0,m.default)(this,"create",(e=>new DataViewField({...e,shortDotsEnable:t}))),(0,m.default)(this,"add",(e=>{const t=this.create(e);return this.push(t),this.setByName(t),this.setByGroup(t),t})),(0,m.default)(this,"remove",(e=>{this.removeByGroup(e),this.byName.delete(e.name);const t=(0,f.findIndex)(this,{name:e.name});this.splice(t,1)})),(0,m.default)(this,"update",(e=>{const t=new DataViewField(e),i=this.findIndex((e=>e.name===t.name));this.splice(i,1,t),this.setByName(t),this.removeByGroup(t),this.setByGroup(t)})),(0,m.default)(this,"removeAll",(()=>{this.length=0,this.byName.clear(),this.groups.clear()})),(0,m.default)(this,"replaceAll",((e=[])=>{this.removeAll(),e.forEach(this.add)})),e.map((e=>this.add(e)))}toSpec({getFormatterForField:e}={}){return{...this.reduce(((t,i)=>(t[i.name]=i.toSpec({getFormatterForField:e}),t)),{})}}}},449:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AbstractDataView:()=>l.C9,DATA_VIEW_SAVED_OBJECT_TYPE:()=>s._u,DEFAULT_ASSETS_TO_IGNORE:()=>s.RA,DataView:()=>l.U$,DataViewField:()=>n.eS,DataViewInsufficientAccessError:()=>d.rJ,DataViewLazy:()=>l.IQ,DataViewMissingIndices:()=>c.d,DataViewPersistableStateService:()=>l.GQ,DataViewSavedObjectConflictError:()=>d.Ub,DataViewType:()=>r,DataViewsService:()=>l.Qj,DuplicateDataViewError:()=>d.dt,HasEsDataFailureReason:()=>s.ni,LATEST_VERSION:()=>a.X,MAX_DATA_VIEW_FIELD_DESCRIPTION_LENGTH:()=>s.Nw,META_FIELDS:()=>s.Su,RUNTIME_FIELD_TYPES:()=>s.KR,fieldList:()=>n.FL,getFieldSubtypeMulti:()=>n.KL,getFieldSubtypeNested:()=>n.c8,getIndexPatternLoadMeta:()=>o.E,isFilterable:()=>n.$U,isMultiField:()=>n.eD,isNestedField:()=>n.IK});var s=i(787),a=i(119),n=i(830);let r=function(e){return e.DEFAULT="default",e.ROLLUP="rollup",e}({});var l=i(983),d=i(979),o=i(668),c=i(603)},603:(e,t,i)=>{"use strict";i.d(t,{d:()=>DataViewMissingIndices});var s=i(359);class DataViewMissingIndices extends s.KbnError{constructor(e){super(e&&e.length?`No matching indices found: ${e}`:"Data view's title does not match any indices")}}},827:(e,t,i)=>{"use strict";i.d(t,{iJ:()=>n,dA:()=>s.d,iv:()=>l,UQ:()=>a,xV:()=>r,qd:()=>d});var s=i(603);const a="ILLEGAL_CHARACTERS",n="CONTAINS_SPACES",r=["\\","/","?",'"',"<",">","|"],l=r.concat(" ");function d(e){const t={},i=function(e){return r.reduce(((t,i)=>(e.includes(i)&&t.push(i),t)),[])}(e);return i.length&&(t[a]=i),function(e){return e.includes(" ")}(e)&&(t[n]=!0),t}},675:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CONTAINS_SPACES_KEY:()=>s.iJ,DATA_VIEW_SAVED_OBJECT_TYPE:()=>a.DATA_VIEW_SAVED_OBJECT_TYPE,DataView:()=>r.U$,DataViewField:()=>a.DataViewField,DataViewLazy:()=>r.IQ,DataViewSavedObjectConflictError:()=>a.DataViewSavedObjectConflictError,DataViewType:()=>a.DataViewType,DataViewsApiClient:()=>DataViewsApiClient,DataViewsService:()=>r.Qj,ILLEGAL_CHARACTERS:()=>s.iv,ILLEGAL_CHARACTERS_KEY:()=>s.UQ,ILLEGAL_CHARACTERS_VISIBLE:()=>s.xV,INDEX_PATTERN_TYPE:()=>n.dL,META_FIELDS:()=>a.META_FIELDS,UiSettingsPublicToCommon:()=>UiSettingsPublicToCommon,getFieldSubtypeMulti:()=>a.getFieldSubtypeMulti,getFieldSubtypeNested:()=>a.getFieldSubtypeNested,plugin:()=>y,validateDataView:()=>s.qd});var s=i(827),a=i(449),n=i(39),r=i(983),l=i(915),d=i(787);class DataViewsApiClient{constructor(e,t){(0,l.default)(this,"http",void 0),(0,l.default)(this,"getCurrentUserId",void 0),this.http=e,this.getCurrentUserId=t}async _request(e,t,a,n,r){const l=!0,d=n?{cache:"no-cache"}:{},o=await this.getCurrentUserId(),c=o?await async function(e){if(crypto.subtle){const t=new TextEncoder,i=await crypto.subtle.digest("SHA-256",t.encode(e));return Array.from(new Uint8Array(i)).map((e=>e.toString(16).padStart(2,"0"))).join("")}{const{sha256:t}=await i.e(499).then(i.bind(i,499));return t(e)}}(o):"",u=c?{"user-hash":c}:void 0;return(a?this.http.post(e,{query:t,body:a,version:"1",asResponse:l,signal:r}):this.http.fetch(e,{query:t,version:"1",...d,asResponse:l,headers:u,signal:r})).catch((e=>{if(null!=e&&e.body){var t;if(404===e.body.statusCode&&"no_matching_indices"===(null===(t=e.body.attributes)||void 0===t?void 0:t.code))throw new s.dA(e.body.message);throw new Error(e.body.message||e.body.error||`${e.body.statusCode} Response`)}if("string"==typeof(null==e?void 0:e.name)&&"string"==typeof(null==e?void 0:e.message))throw e;throw new Error("Unknown error")}))}_getUrl(e){return"/api/index_patterns/"+e.filter(Boolean).map(encodeURIComponent).join("/")}getFieldsForWildcard(e){const{pattern:t,metaFields:i,type:s,rollupIndex:a,allowNoIndex:n,indexFilter:r,includeUnmapped:l,fields:o,forceRefresh:c,allowHidden:u,fieldTypes:h,includeEmptyFields:p,abortSignal:m}=e,f=r?d.v2:d.s2,g=r?{}:{apiVersion:"1"};return this._request(f,{pattern:t,meta_fields:i,type:s,rollup_index:a,allow_no_index:n,include_unmapped:l,fields:o,field_types:h,allow_hidden:u||void 0,include_empty_fields:p,...g},function(e){const{indexFilter:t,runtimeMappings:i}=e;if(t||i)return JSON.stringify({...t&&{index_filter:t},...i&&{runtime_mappings:i}})}(e),c,m).then((e=>{var t,i,s,a;return{indices:(null==e||null===(t=e.body)||void 0===t?void 0:t.indices)||[],fields:(null==e||null===(i=e.body)||void 0===i?void 0:i.fields)||[],etag:(null==e||null===(s=e.response)||void 0===s||null===(a=s.headers)||void 0===a?void 0:a.get("etag"))||""}}))}async hasUserDataView(){var e,t;const i=await this._request(this._getUrl(["has_user_index_pattern"]));return null!==(e=null==i||null===(t=i.body)||void 0===t?void 0:t.result)&&void 0!==e&&e}}class UiSettingsPublicToCommon{constructor(e){(0,l.default)(this,"uiSettings",void 0),this.uiSettings=e}get(e){return Promise.resolve(this.uiSettings.get(e))}getAll(){return Promise.resolve(this.uiSettings.getAll())}set(e,t){return this.uiSettings.set(e,t),Promise.resolve()}remove(e){return this.uiSettings.remove(e),Promise.resolve()}}var o=i(8),c=i(668);function u({getStartServices:e}){return function({getStartDependencies:e}){return()=>({...(0,c.E)(),async fn(t,i){const{indexPatterns:s}=await e();return{type:"index_pattern",value:(await s.get(i.id)).toSpec()}}})}({getStartDependencies:async()=>{const[,,t]=await e();return{indexPatterns:t}}})}var h=i(359),p=i(979),m=i(119);class ContentMagementWrapper{constructor(e){(0,l.default)(this,"contentManagementClient",void 0),this.contentManagementClient=e}async find(e){return(await this.contentManagementClient.search({contentTypeId:m.O,query:{text:e.search,limit:e.perPage},options:{searchFields:e.searchFields,fields:e.fields}})).hits}async get(e){let t;try{t=await this.contentManagementClient.get({contentTypeId:m.O,id:e})}catch(t){var i;throw 404===(null===(i=t.body)||void 0===i?void 0:i.statusCode)?new h.SavedObjectNotFound("data view",e,"management/kibana/dataViews"):t}if("conflict"===t.meta.outcome)throw new p.Ub(e);return t.item}async update(e,t,i){return(await this.contentManagementClient.update({contentTypeId:m.O,id:e,data:t,options:i})).item}async create(e,t){return(await this.contentManagementClient.create({contentTypeId:m.O,data:e,options:t})).item}async delete(e){await this.contentManagementClient.delete({contentTypeId:m.O,id:e,options:{force:!0}})}}class DataViewsServicePublic extends r.Qj{constructor(e){super(e),(0,l.default)(this,"getCanSaveSync",void 0),(0,l.default)(this,"getIndices",void 0),(0,l.default)(this,"hasData",void 0),(0,l.default)(this,"rollupsEnabled",!1),(0,l.default)(this,"http",void 0),(0,l.default)(this,"scriptedFieldsEnabled",void 0),this.getCanSaveSync=e.getCanSaveSync,this.hasData=e.hasData,this.getIndices=e.getIndices,this.rollupsEnabled=e.getRollupsEnabled(),this.scriptedFieldsEnabled=e.scriptedFieldsEnabled,this.http=e.http}getRollupsEnabled(){return this.rollupsEnabled}async getExistingIndices(e){return this.http.get(d.sR,{query:{indices:e},version:"1"})}}var f=i(770),g=i(721);class HasData{constructor(){(0,l.default)(this,"removeAliases",(e=>!e.item.indices)),(0,l.default)(this,"isUserDataSource",(e=>!e.name.startsWith(".")&&!a.DEFAULT_ASSETS_TO_IGNORE.DATA_STREAMS_TO_IGNORE.includes(e.name))),(0,l.default)(this,"isResponseError",(e=>{return(t=e)instanceof Error&&"request"in t&&"name"in t&&(0,f.isObject)(e.body)&&"message"in e.body&&"statusCode"in e.body;var t})),(0,l.default)(this,"responseToItemArray",(e=>{const{indices:t=[],aliases:i=[]}=e,s=[];return[...t,...i,...e.data_streams||[]].forEach((e=>{s.push({name:e.name,item:e})})),s})),(0,l.default)(this,"getIndicesViaSearch",(async({http:e,pattern:t,showAllIndices:i})=>e.post("/internal/search/ese",{version:"1",body:JSON.stringify({params:{ignore_unavailable:!0,expand_wildcards:i?"all":"open",index:t,body:{size:0,aggs:{indices:{terms:{field:"_index",size:200}}}}}})}).then((e=>!!(e&&e.total>=0))).catch((e=>(g.warn("getIndicesViaSearch failed with error, assuming there is data",e),!0))))),(0,l.default)(this,"getIndices",(async({http:e,pattern:t,showAllIndices:i})=>e.get(`/internal/index-pattern-management/resolve_index/${t}`,{query:i?{expand_wildcards:"all"}:void 0}).then((e=>e?this.responseToItemArray(e):[])))),(0,l.default)(this,"checkLocalESData",(e=>this.getIndices({http:e,pattern:"*",showAllIndices:!1}).then((e=>e.some(this.isUserDataSource))).catch((()=>this.getIndicesViaSearch({http:e,pattern:"*",showAllIndices:!1}))))),(0,l.default)(this,"checkRemoteESData",(e=>this.getIndices({http:e,pattern:"*:*",showAllIndices:!1}).then((e=>!!e.filter(this.removeAliases).length)).catch((()=>this.getIndicesViaSearch({http:e,pattern:"*:*",showAllIndices:!1}))))),(0,l.default)(this,"getHasDataViews",(async({http:e})=>e.get("/internal/data_views/has_data_views",{version:"1"}))),(0,l.default)(this,"hasDataViews",(e=>this.getHasDataViews({http:e}).then((e=>{const{hasDataView:t}=e;return t})).catch((e=>(g.warn("hasDataViews failed with error, assuming there are data views",e),!0))))),(0,l.default)(this,"hasUserDataViews",(e=>this.getHasDataViews({http:e}).then((e=>{const{hasUserDataView:t}=e;return t})).catch((e=>(g.warn("hasUserDataViews failed with error, assuming there are user-created data views",e),!0)))))}start(e,t){const{http:i}=e,s=async()=>{const e=await this.checkLocalESData(i);return e||await this.checkRemoteESData(i)},n=async e=>{try{const{hasEsData:e}=await i.get("/internal/data_views/has_es_data",{version:"1"});return e}catch(i){var t,n,r;return this.isResponseError(i)&&504===(null===(t=i.body)||void 0===t?void 0:t.statusCode)&&(null===(n=i.body)||void 0===n||null===(r=n.attributes)||void 0===r?void 0:r.failureReason)===a.HasEsDataFailureReason.remoteDataTimeout?(e(i.body),!0):s()}},r=()=>e.notifications.toasts.addDanger({title:o.i18n.translate("dataViews.hasData.remoteDataTimeoutTitle",{defaultMessage:"Remote cluster timeout"}),text:o.i18n.translate("dataViews.hasData.remoteDataTimeoutText",{defaultMessage:"Checking for data on remote clusters timed out. One or more remote clusters may be unavailable."})});return{hasESData:async({onRemoteDataTimeout:e=r}={})=>t?n(e):s(),hasDataView:async()=>await this.hasDataViews(i),hasUserDataView:async()=>await this.hasUserDataViews(i)}}}const F=(e,t)=>{const i={};return s=>(i[s]||(i[s]=(0,f.debounce)(e,t,{leading:!0})),i[s])};class DataViewsPublicPlugin{constructor(e){(0,l.default)(this,"hasData",new HasData),(0,l.default)(this,"rollupsEnabled",!1),(0,l.default)(this,"callResolveCluster",void 0),this.initializerContext=e,this.callResolveCluster="traditional"===e.env.packageInfo.buildFlavor}setup(e,{expressions:t,contentManagement:i}){return t.registerFunction(u({getStartServices:e.getStartServices})),i.registry.register({id:d._u,version:{latest:m.X},name:o.i18n.translate("dataViews.contentManagementType",{defaultMessage:"Data view"})}),{enableRollups:()=>this.rollupsEnabled=!0}}start(e,{fieldFormats:t,contentManagement:s}){const{uiSettings:a,http:n,notifications:r,application:l}=e,d=F(r.toasts.add.bind(r.toasts),1e4),o=F(r.toasts.addError.bind(r.toasts),1e4),c=this.initializerContext.config.get();return new DataViewsServicePublic({hasData:this.hasData.start(e,this.callResolveCluster),uiSettings:new UiSettingsPublicToCommon(a),savedObjectsClient:new ContentMagementWrapper(s.client),apiClient:new DataViewsApiClient(n,(async()=>{const t=await e.security.authc.getCurrentUser();return null==t?void 0:t.profile_uid})),fieldFormats:t,http:n,onNotification:(e,t)=>{d(t)(e)},onError:(e,t,i)=>{o(i)(e,t)},getCanSave:()=>Promise.resolve(!0===l.capabilities.indexPatterns.save),getCanSaveSync:()=>!0===l.capabilities.indexPatterns.save,getCanSaveAdvancedSettings:()=>Promise.resolve(!0===l.capabilities.advancedSettings.save),getIndices:t=>async function(e){const{getIndices:t}=await i.e(233).then(i.bind(i,233));return t(e)}({...t,http:e.http}),getRollupsEnabled:()=>this.rollupsEnabled,scriptedFieldsEnabled:!1!==c.scriptedFieldsEnabled})}stop(){}}function y(e){return new DataViewsPublicPlugin(e)}},39:(e,t,i)=>{"use strict";i.d(t,{VU:()=>a,dL:()=>s});let s=function(e){return e.ROLLUP="rollup",e.DEFAULT="default",e}({}),a=function(e){return e.OPEN="open",e.CLOSED="closed",e.HIDDEN="hidden",e.FROZEN="frozen",e}({})},604:(e,t,i)=>{i.p=window.__kbnPublicPath__.dataViews},374:(e,t,i)=>{i.r(t);var s=__kbnBundles__.get("plugin/fieldFormats/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},359:(e,t,i)=>{i.r(t);var s=__kbnBundles__.get("plugin/kibanaUtils/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},721:(e,t,i)=>{e.exports=i(497)(4971)},915:(e,t,i)=>{e.exports=i(497)(67493)},551:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnCryptoBrowser},8:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18n},770:e=>{"use strict";e.exports=__kbnSharedDeps__.Lodash},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},i={};function s(e){var a=i[e];if(void 0!==a)return a.exports;var n=i[e]={exports:{}};return t[e](n,n.exports,s),n.exports}s.m=t,s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,i)=>(s.f[i](e,t),t)),[])),s.u=e=>"dataViews.chunk."+e+".js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},s.l=(t,i,a,n)=>{if(e[t])e[t].push(i);else{var r,l;if(void 0!==a)for(var d=document.getElementsByTagName("script"),o=0;o<d.length;o++){var c=d[o];if(c.getAttribute("src")==t){r=c;break}}r||(l=!0,(r=document.createElement("script")).charset="utf-8",r.timeout=120,s.nc&&r.setAttribute("nonce",s.nc),r.src=t),e[t]=[i];var u=(i,s)=>{r.onerror=r.onload=null,clearTimeout(h);var a=e[t];if(delete e[t],r.parentNode&&r.parentNode.removeChild(r),a&&a.forEach((e=>e(s))),i)return i(s)},h=setTimeout(u.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=u.bind(null,r.onerror),r.onload=u.bind(null,r.onload),l&&document.head.appendChild(r)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var a=i.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=i[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{var e={475:0};s.f.j=(t,i)=>{var a=s.o(e,t)?e[t]:void 0;if(0!==a)if(a)i.push(a[2]);else{var n=new Promise(((i,s)=>a=e[t]=[i,s]));i.push(a[2]=n);var r=s.p+s.u(t),l=new Error;s.l(r,(i=>{if(s.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var n=i&&("load"===i.type?"missing":i.type),r=i&&i.target&&i.target.src;l.message="Loading chunk "+t+" failed.\n("+n+": "+r+")",l.name="ChunkLoadError",l.type=n,l.request=r,a[1](l)}}),"chunk-"+t,t)}};var t=(t,i)=>{var a,n,[r,l,d]=i,o=0;if(r.some((t=>0!==e[t]))){for(a in l)s.o(l,a)&&(s.m[a]=l[a]);d&&d(s)}for(t&&t(i);o<r.length;o++)n=r[o],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0},i=self.dataViews_bundle_jsonpfunction=self.dataViews_bundle_jsonpfunction||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),s(604),__kbnBundles__.define("plugin/dataViews/public",s,675),__kbnBundles__.define("plugin/dataViews/common",s,449)})();