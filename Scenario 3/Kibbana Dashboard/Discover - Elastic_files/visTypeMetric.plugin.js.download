(()=>{var e,t={212:(e,t,r)=>{"use strict";r.r(t),r.d(t,{plugin:()=>x});var i=r(915);const s=__kbnSharedDeps__.KbnI18n;var a=r(240),o=r(627);const n=__kbnSharedDeps__.React;var l=r.n(n);const c=__kbnSharedDeps__.ElasticEui,u=__kbnSharedDeps__.KbnI18nReact;var d=r(499);const p=__kbnSharedDeps__.EmotionReact,g=[{id:a.ColorMode.None,label:s.i18n.translate("visTypeMetric.colorModes.noneOptionLabel",{defaultMessage:"None"})},{id:a.ColorMode.Labels,label:s.i18n.translate("visTypeMetric.colorModes.labelsOptionLabel",{defaultMessage:"Labels"})},{id:a.ColorMode.Background,label:s.i18n.translate("visTypeMetric.colorModes.backgroundOptionLabel",{defaultMessage:"Background"})}];function m({stateParams:e,setValue:t,setValidity:r,setTouched:i,uiState:o}){const m=(0,n.useCallback)(((r,i)=>t("metric",{...e.metric,[r]:i})),[t,e.metric]),b=(0,n.useCallback)(((t,r)=>m("labels",{...e.metric.labels,[t]:r})),[m,e.metric.labels]),f=(0,n.useCallback)(((t,r)=>m("style",{...e.metric.style,[t]:r})),[m,e.metric.style]),_=(0,n.useCallback)((e=>m("metricColorMode",e)),[m]),v=s.i18n.translate("visTypeMetric.params.color.useForLabel",{defaultMessage:"Use color for"});return(0,p.jsx)(l().Fragment,null,(0,p.jsx)(c.EuiPanel,{paddingSize:"s"},(0,p.jsx)(c.EuiTitle,{size:"xs"},(0,p.jsx)("h3",null,(0,p.jsx)(u.FormattedMessage,{id:"visTypeMetric.params.settingsTitle",defaultMessage:"Settings"}))),(0,p.jsx)(c.EuiSpacer,{size:"s"}),(0,p.jsx)(d.PercentageModeOption,{"data-test-subj":"metricPercentageMode",percentageMode:e.metric.percentageMode,formatPattern:e.metric.percentageFormatPattern,setValue:m}),(0,p.jsx)(d.SwitchOption,{label:s.i18n.translate("visTypeMetric.params.showTitleLabel",{defaultMessage:"Show title"}),paramName:"show",value:e.metric.labels.show,setValue:b})),(0,p.jsx)(c.EuiSpacer,{size:"s"}),(0,p.jsx)(c.EuiPanel,{paddingSize:"s"},(0,p.jsx)(c.EuiTitle,{size:"xs"},(0,p.jsx)("h3",null,(0,p.jsx)(u.FormattedMessage,{id:"visTypeMetric.params.rangesTitle",defaultMessage:"Ranges"}))),(0,p.jsx)(c.EuiSpacer,{size:"s"}),(0,p.jsx)(d.ColorRanges,{"data-test-subj":"metricColorRange",colorsRange:e.metric.colorsRange,setValue:m,setTouched:i,setValidity:r}),(0,p.jsx)(c.EuiFormRow,{fullWidth:!0,display:"rowCompressed",label:v},(0,p.jsx)(c.EuiButtonGroup,{buttonSize:"compressed",idSelected:e.metric.metricColorMode,isDisabled:1===e.metric.colorsRange.length,isFullWidth:!0,legend:v,options:g,onChange:_})),(0,p.jsx)(d.ColorSchemaOptions,{colorSchema:e.metric.colorSchema,colorSchemas:a.colorSchemas,disabled:1===e.metric.colorsRange.length||e.metric.metricColorMode===a.ColorMode.None,invertColors:e.metric.invertColors,setValue:m,showHelpText:!1,uiState:o})),(0,p.jsx)(c.EuiSpacer,{size:"s"}),(0,p.jsx)(c.EuiPanel,{paddingSize:"s"},(0,p.jsx)(c.EuiTitle,{size:"xs"},(0,p.jsx)("h3",null,(0,p.jsx)(u.FormattedMessage,{id:"visTypeMetric.params.style.styleTitle",defaultMessage:"Style"}))),(0,p.jsx)(c.EuiSpacer,{size:"s"}),(0,p.jsx)(d.RangeOption,{label:s.i18n.translate("visTypeMetric.params.style.fontSizeLabel",{defaultMessage:"Metric font size in points"}),min:12,max:120,paramName:"fontSize",value:e.metric.style.fontSize,setValue:f,showInput:!0,showLabels:!0,showValue:!1})))}const b=__kbnSharedDeps__.Lodash;var f=r(634),_=r(500),v=r(904),h=r(876);const y=e=>{const t=(0,v.buildExpressionFunction)("visdimension",{accessor:e.accessor});return e.format&&(t.addArgument("format",e.format.id),t.addArgument("formatParams",JSON.stringify(e.format.params))),(0,v.buildExpression)([t])},M=(e,t)=>{var r;const i=(0,_.getVisSchemas)(e,t),{percentageMode:s,percentageFormatPattern:o,colorSchema:n,metricColorMode:l,colorsRange:c,labels:u,invertColors:d,style:p}=e.params.metric;!0===(0,b.get)(e.params,"metric.percentageMode")&&i.metric.forEach((e=>{e.format={id:"percent",params:{pattern:o}}}));const g=c&&c.length>1,m=(0,v.buildExpressionFunction)("legacyMetricVis",{percentageMode:s,colorMode:g?l:a.ColorMode.None,showLabels:null!==(r=null==u?void 0:u.show)&&void 0!==r&&r});if(m.addArgument("font",(0,v.buildExpression)(`font family="${h.inter.value}"\n        weight="bold"\n        align="center"\n        sizeUnit="pt"\n        ${p?`size=${p.fontSize}`:""}`)),m.addArgument("labelFont",(0,v.buildExpression)('font size="14" align="center"')),c&&c.length){const e=(0,f.getStopsWithColorsFromRanges)(c,n,d),t=(0,v.buildExpressionFunction)("palette",{...e,range:"number",continuity:"none"});m.addArgument("palette",(0,v.buildExpression)([t]))}return i.group&&m.addArgument("bucket",y(i.group[0])),i.metric.forEach((e=>{m.addArgument("metric",y(e))})),(0,v.buildExpression)([m]).toAst()};var j=r(107);class MetricVisPlugin{constructor(e){(0,i.default)(this,"initializerContext",void 0),this.initializerContext=e}setup(e,{visualizations:t}){const{readOnly:i}=this.initializerContext.config.get();t.createBaseVisualization({name:"metric",title:s.i18n.translate("visTypeMetric.metricTitle",{defaultMessage:"Metric"}),icon:"visMetric",description:s.i18n.translate("visTypeMetric.metricDescription",{defaultMessage:"Show a calculation as a single number."}),fetchDatatable:!0,toExpressionAst:M,visConfig:{defaults:{addTooltip:!0,addLegend:!1,type:"metric",metric:{percentageMode:!1,useRanges:!1,colorSchema:a.ColorSchemas.GreenToRed,metricColorMode:a.ColorMode.None,colorsRange:[{from:0,to:1e4}],labels:{show:!0},invertColors:!1,style:{bgFill:"#000",bgColor:!1,labelColor:!1,subText:"",fontSize:60}}}},editorConfig:{enableDataViewChange:!0,optionsTemplate:m,schemas:[{group:o.AggGroupNames.Metrics,name:"metric",title:s.i18n.translate("visTypeMetric.schemas.metricTitle",{defaultMessage:"Metric"}),min:1,aggFilter:["!std_dev","!geo_centroid","!derivative","!serial_diff","!moving_avg","!cumulative_sum","!geo_bounds","!filtered_metric","!single_percentile","!single_percentile_rank"],aggSettings:{top_hits:{allowStrings:!0}},defaults:[{type:"count",schema:"metric"}]},{group:o.AggGroupNames.Buckets,name:"group",title:s.i18n.translate("visTypeMetric.schemas.splitGroupTitle",{defaultMessage:"Split group"}),min:0,max:1,aggFilter:["!geotile_grid","!filter","!sampler","!diversified_sampler","!rare_terms","!multi_terms","!significant_text"]}]},requiresSearch:!0,navigateToLens:async(e,t)=>{const{convertToLens:i}=await r.e(529).then(r.bind(r,529));return e?i(e,t):null},getExpressionVariables:async(e,t)=>{const{convertToLens:i}=await r.e(529).then(r.bind(r,529));return{canNavigateToLens:Boolean(null!=e&&e.params?await i(e,t):null)}},disableCreate:Boolean(i),disableEdit:Boolean(i)})}start(e,{dataViews:t}){(0,j.L)(t)}}function x(e){return new MetricVisPlugin(e)}},107:(e,t,r)=>{"use strict";r.d(t,{L:()=>a,x:()=>s});var i=r(215);const[s,a]=(0,i.createGetterSetter)("dataViews")},171:(e,t,r)=>{r.p=window.__kbnPublicPath__.visTypeMetric},240:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/charts/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},627:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/data/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},876:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/expressions/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},904:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/expressions/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},215:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},499:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/visDefaultEditor/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},587:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/visualizations/common/convert_to_lens");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},634:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/visualizations/common/utils");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},500:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/visualizations/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},915:(e,t,r)=>{e.exports=r(497)(67493)},472:e=>{"use strict";e.exports=__kbnSharedDeps__.Uuid},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},r={};function i(e){var s=r[e];if(void 0!==s)return s.exports;var a=r[e]={exports:{}};return t[e](a,a.exports,i),a.exports}i.m=t,i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,r)=>(i.f[r](e,t),t)),[])),i.u=e=>"visTypeMetric.chunk."+e+".js",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},i.l=(t,r,s,a)=>{if(e[t])e[t].push(r);else{var o,n;if(void 0!==s)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var u=l[c];if(u.getAttribute("src")==t){o=u;break}}o||(n=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.src=t),e[t]=[r];var d=(r,i)=>{o.onerror=o.onload=null,clearTimeout(p);var s=e[t];if(delete e[t],o.parentNode&&o.parentNode.removeChild(o),s&&s.forEach((e=>e(i))),r)return r(i)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=d.bind(null,o.onerror),o.onload=d.bind(null,o.onload),n&&document.head.appendChild(o)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var s=r.length-1;s>-1&&(!e||!/^http(s?):/.test(e));)e=r[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{var e={95:0};i.f.j=(t,r)=>{var s=i.o(e,t)?e[t]:void 0;if(0!==s)if(s)r.push(s[2]);else{var a=new Promise(((r,i)=>s=e[t]=[r,i]));r.push(s[2]=a);var o=i.p+i.u(t),n=new Error;i.l(o,(r=>{if(i.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var a=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;n.message="Loading chunk "+t+" failed.\n("+a+": "+o+")",n.name="ChunkLoadError",n.type=a,n.request=o,s[1](n)}}),"chunk-"+t,t)}};var t=(t,r)=>{var s,a,[o,n,l]=r,c=0;if(o.some((t=>0!==e[t]))){for(s in n)i.o(n,s)&&(i.m[s]=n[s]);l&&l(i)}for(t&&t(r);c<o.length;c++)a=o[c],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0},r=self.visTypeMetric_bundle_jsonpfunction=self.visTypeMetric_bundle_jsonpfunction||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),i(171),__kbnBundles__.define("plugin/visTypeMetric/public",i,212)})();