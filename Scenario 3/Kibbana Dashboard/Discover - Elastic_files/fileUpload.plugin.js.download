/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */(()=>{var e,t={787:(e,t,i)=>{"use strict";i.d(t,{GM:()=>d,MB:()=>n,Mf:()=>o,UQ:()=>c,W0:()=>l,Yb:()=>a,ay:()=>r,w3:()=>s,xr:()=>u});const r="fileUpload:maxFileSize",n=Math.pow(2,20),s="100MB",o=524288e3,a=1073741274,c="0,0.[0] b",l=62914560,d={DELIMITED:"delimited",NDJSON:"ndjson",SEMI_STRUCTURED_TEXT:"semi_structured_text",TIKA:"tika"},u=1e5},850:(e,t,i)=>{"use strict";i.r(t),i.d(t,{TIKA_PREVIEW_CHARS:()=>r.xr});var r=i(787)},166:(e,t,i)=>{"use strict";i.d(t,{Pj:()=>p,fp:()=>h,xy:()=>m,Jc:()=>y,F1:()=>x,$Z:()=>g,BB:()=>f,Wd:()=>_});var r=i(367),n=i(723);let s;async function o(){return void 0!==s||(s=new Promise((async(e,t)=>{try{const{GeoUploadWizard:t,importerFactory:r,IndexNameForm:s}=await i.e(640).then(i.bind(i,640));e({GeoUploadWizard:t,importerFactory:r,getHttp:n.PA,IndexNameForm:s})}catch(e){t(e)}}))),s}var a=i(915),c=i(286),l=i.n(c),d=i(319),u=i(791);class GeoUploadWizardAsyncWrapper extends l().Component{constructor(...e){super(...e),(0,a.default)(this,"state",{GeoUploadWizard:null}),(0,a.default)(this,"_isMounted",!1)}componentDidMount(){this._isMounted=!0,o().then((e=>{this._isMounted&&this.setState({GeoUploadWizard:e.GeoUploadWizard})}))}componentWillUnmount(){this._isMounted=!1}render(){const{GeoUploadWizard:e}=this.state;return e?(0,u.jsx)(e,this.props):(0,u.jsx)(d.EuiSkeletonText,{lines:3})}}class IndexNameFormAsyncWrapper extends l().Component{constructor(...e){super(...e),(0,a.default)(this,"state",{IndexNameForm:null}),(0,a.default)(this,"_isMounted",!1)}componentWillUnmount(){this._isMounted=!1}componentDidMount(){this._isMounted=!0,o().then((e=>{this._isMounted&&this.setState({IndexNameForm:e.IndexNameForm})}))}render(){const{IndexNameForm:e}=this.state;return e?(0,u.jsx)(e,this.props):(0,u.jsx)(d.EuiSkeletonText,{lines:3})}}const p=GeoUploadWizardAsyncWrapper,h=IndexNameFormAsyncWrapper;async function f(e,t){return(await o()).importerFactory(e,t)}async function m(e,t={}){const{getHttp:i}=await o(),r=JSON.stringify(e);return await i().fetch({path:"/internal/file_upload/analyze_file",method:"POST",version:"1",body:r,query:t})}async function _(e,t={}){const{getHttp:i}=await o(),n=(0,r.fromByteArray)(new Uint8Array(e)),s=JSON.stringify({base64File:n});return await i().fetch({path:"/internal/file_upload/preview_tika_contents",method:"POST",version:"1",body:s,query:t})}async function g(e){const t=await o();try{return(await t.getHttp().fetch({path:"/internal/file_upload/has_import_permission",method:"GET",version:"1",query:{...e}})).hasImportPermission}catch(e){return!1}}async function y(e,t={}){const i=JSON.stringify({index:e}),r=await o();try{const{exists:e}=await r.getHttp().fetch({path:"/internal/file_upload/index_exists",method:"POST",version:"1",body:i,query:t});return e}catch(e){return!1}}async function x(e,t,i){const r=JSON.stringify({index:e,timeFieldName:i,query:t}),n=await o();return await n.getHttp().fetch({path:"/internal/file_upload/time_field_range",method:"POST",version:"1",body:r})}},426:(e,t,i)=>{"use strict";i.d(t,{oq:()=>a,i3:()=>c,Zz:()=>l,D1:()=>d});const r=__kbnSharedDeps__.ElasticNumeral;var n=i.n(r),s=i(787),o=i(723);function a(){const e=(0,o.C_)().get(s.ay,s.w3),t=n()(e.toUpperCase()).value();return t<s.Mf?s.Mf:t<=s.Yb?t:s.Yb}function c(){return n()(a()).format(s.UQ)}function l(){return s.W0}function d(){return n()(l()).format(s.UQ)}},412:(e,t,i)=>{"use strict";i.d(t,{fL:()=>h,l9:()=>Importer,Oi:()=>p,fB:()=>g});var r=i(915),n=i(770);const s=__kbnSharedDeps__.Moment;var o=i.n(s),a=i(8);const c=(e,t=[])=>"object"==typeof e&&null!==e&&Object.keys(e).length>0&&(0===t.length||t.every((t=>Object.hasOwn(e,t))));var l=i(723),d=i(787),u=i(721);const p=1e6,h=5,f="@timestamp";class Importer{constructor(){(0,r.default)(this,"_docArray",[]),(0,r.default)(this,"_chunkSize",5e3),(0,r.default)(this,"_index",void 0),(0,r.default)(this,"_pipeline",void 0),(0,r.default)(this,"_timeFieldName",void 0),(0,r.default)(this,"_initialized",!1)}initialized(){return this._initialized}getIndex(){return this._index}getTimeField(){return this._timeFieldName}read(e){const t=new TextDecoder,i=100*d.MB,r=Math.ceil(e.byteLength/i);let n=0;for(let s=0;s<r;s++){const o=t.decode(e.slice(s*i-n,(s+1)*i)),{success:a,docs:c,remainder:l}=this._createDocs(o,s===r-1);if(!a)return{success:!1};this._docArray=this._docArray.concat(c),n=l}return{success:!0}}async initializeImport(e,t,i,r,n){let s,a;return void 0!==r&&(function(e){if(void 0!==e&&e.processors&&e.processors){const t=e.processors.find((e=>void 0!==e.date&&"{{ event.timezone }}"===e.date.timezone));t&&(t.date.timezone=o().tz.guess())}}(r),_(r)&&(this._chunkSize=100),s={id:`${e}-pipeline`,pipeline:r}),n&&(a=n.map(((t,i)=>({id:`${e}-${i}-pipeline`,pipeline:t})))),this._index=e,this._pipeline=r,this._timeFieldName=c(i.properties,[f])?f:void 0,this._initialized=!0,await g({id:void 0,index:e,data:[],settings:t,mappings:i,ingestPipeline:s,createPipelines:a})}async initializeWithoutCreate(e,t,i){void 0!==i&&_(i)&&(this._chunkSize=100),this._index=e,this._pipeline=i,this._timeFieldName=c(t.properties,[f])?f:void 0,this._initialized=!0}async import(e,t,i,r){if(!e||!t)return{success:!1,error:a.i18n.translate("xpack.fileUpload.import.noIdOrIndexSuppliedErrorMessage",{defaultMessage:"no ID or index supplied"})};const s=function(e,t){if(0===t)return[e];const i=[],r=(0,n.chunk)(e,t);for(let e=0;e<r.length;e++){const t=r[e],s=t.length,o=JSON.stringify(t).length;if(o>p){const e=Math.floor(p/o*s),r=(0,n.chunk)(t,e);i.push(...r)}else i.push(t)}return i}(this._docArray,this._chunkSize),o=i?{id:i}:void 0;let c=!0;const l=[];let d;for(let i=0;i<s.length;i++){let n=h,a={success:!1,failures:[],docCount:0,id:"",index:"",pipelineId:""};for(;!1===a.success&&n>0;)try{a=await g({id:e,index:t,data:s[i],settings:{},mappings:{},ingestPipeline:o}),n<h&&u.log("Retrying import "+(h-n)),n--}catch(e){a.success=!1,a.error=e,n=0}if(!a.success){u.error(a),c=!1,d=a.error,m(a,l,i,this._chunkSize);break}r((i+1)/s.length*100),m(a,l,i,this._chunkSize)}const f={success:c,failures:l,docCount:this._docArray.length};return c?r(100):f.error=d,f}_getFirstReadDocs(e=1){return this._docArray.slice(0,e).map((e=>"string"==typeof e?JSON.parse(e):e))}_getLastReadDocs(e=1){return this._docArray.slice(-e).map((e=>"string"==typeof e?JSON.parse(e):e))}async previewIndexTimeRange(){if(!1===this._initialized||void 0===this._pipeline)throw new Error("Import has not been initialized");const e=this._getFirstReadDocs(10),t=this._getLastReadDocs(10),i=JSON.stringify({docs:e.concat(t),pipeline:this._pipeline,timeField:this._timeFieldName});return await(0,l.PA)().fetch({path:"/internal/file_upload/preview_index_time_range",method:"POST",version:"1",body:i})}async deletePipelines(e){return await(0,l.PA)().fetch({path:`/internal/file_upload/remove_pipelines/${e.join(",")}`,method:"DELETE",version:"1"})}}function m(e,t,i,r){if(e.failures&&e.failures.length){for(let t=0;t<e.failures.length;t++){const n=e.failures[t];n.item=n.item+r*i}t.push(...e.failures)}}function _(e){const t=e=>{const i=[];return Object.entries(e).forEach((([e,r])=>{i.push(e),c(r)&&i.push(...t(r))})),i},i=t(e);return 0!==(0,n.intersection)(["inference","enrich"],i).length}function g({id:e,index:t,data:i,settings:r,mappings:n,ingestPipeline:s,createPipelines:o}){const a=void 0!==e?{id:e}:{},c=JSON.stringify({index:t,data:i,settings:r,mappings:n,ingestPipeline:s,createPipelines:o});return(0,l.PA)().fetch({path:"/internal/file_upload/import",method:"POST",version:"1",query:a,body:c})}},926:(e,t,i)=>{"use strict";i.d(t,{ud:()=>MessageImporter,BB:()=>a});var r=i(915),n=i(412);class MessageImporter extends n.l9{constructor(e){super(),(0,r.default)(this,"_excludeLinesRegex",void 0),(0,r.default)(this,"_multilineStartRegex",void 0),this._excludeLinesRegex=void 0===e.excludeLinesPattern?null:new RegExp(e.excludeLinesPattern),this._multilineStartRegex=void 0===e.multilineStartPattern?null:new RegExp(e.multilineStartPattern)}_createDocs(e,t,i){let r=0;try{const n=[];let s="",o="";for(let r=0;r<e.length;r++){const a=e[r],c=r===e.length-1;if("\n"===a?(s=this._processLine(n,s,o),o=""):t&&c?(o+=a,s=this._processLine(n,s,o),o=""):o+=a,void 0!==i&&n.length>=i)break}return r=o.length,""!==s&&this._addMessage(n,s),n[0]&&""===n[0].message&&n.shift(),{success:!0,docs:n,remainder:r}}catch(e){return{success:!1,docs:[],remainder:r,error:e}}}_processLine(e,t,i){if(null===this._excludeLinesRegex||null===i.match(this._excludeLinesRegex)){if(null===this._multilineStartRegex||null!==i.match(this._multilineStartRegex))this._addMessage(e,t),t="";else{if(0===e.length)return"";t+="\n"}t+=i}return t}_addMessage(e,t){t=t.replace(/\r$/,""),e.push({message:t})}}class NdjsonImporter extends n.l9{constructor(){super()}_createDocs(e,t){let i=0;try{const t=e.split(/}\s*\n/),r=null===e.match(/}\s*\n?$/),n=[];if(t.length){for(let e=0;e<t.length-1;e++)""!==t[e]&&n.push(`${t[e]}}`);const e=t[t.length-1];e&&(!0===r?i=e.length:n.push(`${e}}`))}return{success:!0,docs:n,remainder:i}}catch(e){return{success:!1,docs:[],remainder:i,error:e}}}}var s=i(367);class TikaImporter extends n.l9{constructor(){super()}read(e){this._chunkSize=0;const t=(0,s.fromByteArray)(new Uint8Array(e)),{success:i,docs:r}=this._createDocs(t);return i?(this._docArray=this._docArray.concat(r),{success:!0}):{success:!1}}_createDocs(e){try{return{success:!0,docs:[{data:e}],remainder:0}}catch(e){return{success:!1,docs:[],remainder:0,error:e}}}}var o=i(787);function a(e,t){switch(e){case o.GM.DELIMITED:case o.GM.SEMI_STRUCTURED_TEXT:return new MessageImporter(t);case o.GM.NDJSON:return new NdjsonImporter;case o.GM.TIKA:return new TikaImporter;default:throw new Error("Importer not found for format")}}i(164)},164:(e,t,i)=>{"use strict";i.d(t,{Q:()=>s,n:()=>o});var r=i(8),n=i(426);function s(e){return"."+e.name.split(".").pop()}function o(e,t,i){if(e.size>(0,n.oq)()&&null!=i&&i.checkSizeLimit)throw new Error(r.i18n.translate("xpack.fileUpload.fileSizeError",{defaultMessage:"File size {fileSize} exceeds maximum file size of {maxFileSize}",values:{fileSize:a(e.size),maxFileSize:(0,n.i3)()}}));if(!e.name)throw new Error(r.i18n.translate("xpack.fileUpload.noFileNameError",{defaultMessage:"File name not provided"}));if(!t.includes(s(e)))throw new Error(r.i18n.translate("xpack.fileUpload.fileTypeError",{defaultMessage:"File is not one of acceptable types: {types}",values:{types:t.join(", ")}}))}function a(e){if(0===e)return"n/a";const t=["Bytes","KB","MB","GB","TB"],i=Math.round(Math.floor(Math.log(e)/Math.log(1024)));return 0===i?`${e} ${t[i]})`:`${(e/1024**i).toFixed(1)} ${t[i]}`}},11:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MessageImporter:()=>o.ud,plugin:()=>a});var r=i(166),n=i(723),s=i(426);class FileUploadPlugin{setup(){}start(e,t){return(0,n.b3)(e,t),{FileUploadComponent:r.Pj,IndexNameFormComponent:r.fp,importerFactory:r.BB,getMaxBytes:s.oq,getMaxBytesFormatted:s.i3,getMaxTikaBytes:s.Zz,getMaxTikaBytesFormatted:s.D1,hasImportPermission:r.$Z,checkIndexExists:r.Jc,getTimeFieldRange:r.F1,analyzeFile:r.xy,previewTikaFile:r.Wd}}}var o=i(926);function a(){return new FileUploadPlugin}},723:(e,t,i)=>{"use strict";let r,n;function s(e,t){r=e,n=t}i.d(t,{C_:()=>l,O4:()=>u,PA:()=>c,b3:()=>s,eP:()=>a,g9:()=>o,mt:()=>d});const o=()=>r.docLinks,a=()=>n.data.dataViews,c=()=>r.http,l=()=>r.settings.client,d=()=>r.settings,u=()=>r.theme},332:(e,t,i)=>{i.p=window.__kbnPublicPath__.fileUpload},627:(e,t,i)=>{i.r(t);var r=__kbnBundles__.get("plugin/data/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},409:(e,t,i)=>{i.r(t);var r=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},367:(e,t,i)=>{e.exports=i(497)(38422)},721:(e,t,i)=>{e.exports=i(497)(4971)},915:(e,t,i)=>{e.exports=i(497)(67493)},319:e=>{"use strict";e.exports=__kbnSharedDeps__.ElasticEui},791:e=>{"use strict";e.exports=__kbnSharedDeps__.EmotionReact},424:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnCodeEditor},8:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18n},879:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18nReact},770:e=>{"use strict";e.exports=__kbnSharedDeps__.Lodash},286:e=>{"use strict";e.exports=__kbnSharedDeps__.React},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},i={};function r(e){var n=i[e];if(void 0!==n)return n.exports;var s=i[e]={exports:{}};return t[e].call(s.exports,s,s.exports,r),s.exports}r.m=t,r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,i)=>(r.f[i](e,t),t)),[])),r.u=e=>"fileUpload.chunk."+e+".js",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},r.l=(t,i,n,s)=>{if(e[t])e[t].push(i);else{var o,a;if(void 0!==n)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var d=c[l];if(d.getAttribute("src")==t){o=d;break}}o||(a=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,r.nc&&o.setAttribute("nonce",r.nc),o.src=t),e[t]=[i];var u=(i,r)=>{o.onerror=o.onload=null,clearTimeout(p);var n=e[t];if(delete e[t],o.parentNode&&o.parentNode.removeChild(o),n&&n.forEach((e=>e(r))),i)return i(r)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),a&&document.head.appendChild(o)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var n=i.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=i[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{var e={50:0};r.f.j=(t,i)=>{var n=r.o(e,t)?e[t]:void 0;if(0!==n)if(n)i.push(n[2]);else{var s=new Promise(((i,r)=>n=e[t]=[i,r]));i.push(n[2]=s);var o=r.p+r.u(t),a=new Error;r.l(o,(i=>{if(r.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var s=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+o+")",a.name="ChunkLoadError",a.type=s,a.request=o,n[1](a)}}),"chunk-"+t,t)}};var t=(t,i)=>{var n,s,[o,a,c]=i,l=0;if(o.some((t=>0!==e[t]))){for(n in a)r.o(a,n)&&(r.m[n]=a[n]);c&&c(r)}for(t&&t(i);l<o.length;l++)s=o[l],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0},i=self.fileUpload_bundle_jsonpfunction=self.fileUpload_bundle_jsonpfunction||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),r(332),__kbnBundles__.define("plugin/fileUpload/public",r,11),__kbnBundles__.define("plugin/fileUpload/common",r,850)})();