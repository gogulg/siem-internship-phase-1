(()=>{var e={787:(e,t,a)=>{"use strict";a.d(t,{D3:()=>s,HI:()=>c,SE:()=>r,X1:()=>n,j7:()=>i});const r="search",s="discover session",n=1,i=1,c=1e4},410:(e,t,a)=>{"use strict";a.r(t),a.d(t,{LATEST_VERSION:()=>i.X1,MAX_SAVED_SEARCH_SAMPLE_SIZE:()=>i.HI,MIN_SAVED_SEARCH_SAMPLE_SIZE:()=>i.j7,SavedSearchType:()=>i.SE,SavedSearchTypeDisplayName:()=>i.D3,VIEW_MODE:()=>v,fromSavedSearchAttributes:()=>n,getKibanaContextFn:()=>g,getSavedSearchFullPathUrl:()=>s,getSavedSearchUrl:()=>r,toSavedSearchAttributes:()=>h.Yw});const r=e=>e?`#/view/${encodeURIComponent(e)}`:"#/",s=e=>`/app/discover${r(e)}`,n=(e,t,a,r,s,n=!1)=>({id:e,...n?{serializedSearchSource:r}:{searchSource:r},title:t.title,sort:t.sort,columns:t.columns,description:t.description,tags:a,grid:t.grid,hideChart:t.hideChart,viewMode:t.viewMode,hideAggregatedPreview:t.hideAggregatedPreview,rowHeight:t.rowHeight,headerRowHeight:t.headerRowHeight,isTextBasedQuery:t.isTextBasedQuery,usesAdHocDataView:t.usesAdHocDataView,timeRestore:t.timeRestore,timeRange:t.timeRange,refreshInterval:t.refreshInterval,rowsPerPage:t.rowsPerPage,sampleSize:t.sampleSize,breakdownField:t.breakdownField,visContext:t.visContext,density:t.density,managed:s});var i=a(787),c=a(770),o=a(8);const d=__kbnSharedDeps__.KbnEsQuery;var l=a(876);const u=(e=[],t)=>(0,c.uniqBy)([...Array.isArray(e)?e:[e],...Array.isArray(t)?t:[t]],(e=>JSON.stringify(e.query))),g=e=>({name:"kibana_context",type:"kibana_context",inputTypes:["kibana_context","null"],help:o.i18n.translate("savedSearch.kibana_context.help",{defaultMessage:"Updates kibana global context"}),args:{q:{types:["kibana_query","null"],multi:!0,aliases:["query","_"],help:o.i18n.translate("savedSearch.kibana_context.q.help",{defaultMessage:"Specify Kibana free form text query"})},filters:{types:["kibana_filter","null"],multi:!0,help:o.i18n.translate("savedSearch.kibana_context.filters.help",{defaultMessage:"Specify Kibana generic filters"})},timeRange:{types:["timerange","null"],default:null,help:o.i18n.translate("savedSearch.kibana_context.timeRange.help",{defaultMessage:"Specify Kibana time range filter"})},savedSearchId:{types:["string","null"],default:null,help:o.i18n.translate("savedSearch.kibana_context.savedSearchId.help",{defaultMessage:"Specify saved search ID to be used for queries and filters"})}},extract(e){const t=[];if(e.savedSearchId.length&&"string"==typeof e.savedSearchId[0]){const a="kibana_context.savedSearchId";return t.push({name:a,type:"search",id:e.savedSearchId[0]}),{state:{...e,savedSearchId:[a]},references:t}}return{state:e,references:t}},inject(e,t){const a=t.find((e=>"kibana_context.savedSearchId"===e.name));return a&&(e.savedSearchId[0]=a.id),e},async fn(t,a,{getKibanaRequest:r}){var s,n;const{getSavedSearch:i}=await e(r),o=a.timeRange||(null==t?void 0:t.timeRange);let g=u(null==t?void 0:t.query,(null==a||null===(s=a.q)||void 0===s?void 0:s.filter(Boolean))||[]);const h=(null==a||null===(n=a.filters)||void 0===n?void 0:n.map(l.unboxExpressionValue))||[];let v=[...(null==t?void 0:t.filters)||[]];if(a.savedSearchId){const e=await i(a.savedSearchId),{query:t,filter:r}=e.searchSource.getFields();t&&(g=u(g,t)),r&&(v=[...v,...Array.isArray(r)?r:[r]])}const p=h.filter((e=>!v.some((t=>(0,c.isEqual)((0,d.fromCombinedFilter)(t).query,e.query)))));return v=[...v,...p],{type:"kibana_context",query:g,esqlVariables:null==t?void 0:t.esqlVariables,filters:(0,d.uniqFilters)(v.filter((e=>{var t;return!(null!==(t=e.meta)&&void 0!==t&&t.disabled)}))),timeRange:o}}});var h=a(138);let v=function(e){return e.DOCUMENT_LEVEL="documents",e.AGGREGATED_LEVEL="aggregated",e.PATTERN_LEVEL="patterns",e}({})},138:(e,t,a)=>{"use strict";a.d(t,{Hd:()=>n,Yw:()=>i,jT:()=>s.getSavedSearchFullPathUrl,tX:()=>s.getSavedSearchUrl});var r=a(770),s=a(410);const n=(e,t,a,r,n,i,c,o=!1)=>({...(0,s.fromSavedSearchAttributes)(e,t,a,n,c,o),sharingSavedObjectProps:i,references:r}),i=(e,t)=>{var a,s,n,i,c,o,d,l;return{kibanaSavedObjectMeta:{searchSourceJSON:t},title:null!==(a=e.title)&&void 0!==a?a:"",sort:null!==(s=e.sort)&&void 0!==s?s:[],columns:null!==(n=e.columns)&&void 0!==n?n:[],description:null!==(i=e.description)&&void 0!==i?i:"",grid:null!==(c=e.grid)&&void 0!==c?c:{},hideChart:null!==(o=e.hideChart)&&void 0!==o&&o,viewMode:e.viewMode,hideAggregatedPreview:e.hideAggregatedPreview,rowHeight:e.rowHeight,headerRowHeight:e.headerRowHeight,isTextBasedQuery:null!==(d=e.isTextBasedQuery)&&void 0!==d&&d,usesAdHocDataView:e.usesAdHocDataView,timeRestore:null!==(l=e.timeRestore)&&void 0!==l&&l,timeRange:e.timeRange?(0,r.pick)(e.timeRange,["from","to"]):void 0,refreshInterval:e.refreshInterval,rowsPerPage:e.rowsPerPage,sampleSize:e.sampleSize,density:e.density,breakdownField:e.breakdownField,visContext:e.visContext}}},207:(e,t,a)=>{"use strict";a.r(t),a.d(t,{VIEW_MODE:()=>s.VIEW_MODE,getSavedSearchFullPathUrl:()=>c.jT,getSavedSearchUrl:()=>c.tX,plugin:()=>p});var r=a(8),s=a(410),n=a(195);const i={name:"kibana_context",from:{null:()=>({type:"kibana_context"})},to:{null:()=>({type:"null"}),filter:e=>{const{filters:t=[]}=e;return{type:"filter",filterType:"filter",and:t.map(n.adaptToExpressionValueFilter)}}}};var c=a(138);const o=async({savedSearchId:e,attributes:t,references:a,sharingSavedObjectProps:r,managed:s},{searchSourceCreate:i,savedObjectsTagging:o},d)=>{var l,u;const g=(0,n.parseSearchSourceJSON)(null!==(l=null===(u=t.kibanaSavedObjectMeta)||void 0===u?void 0:u.searchSourceJSON)&&void 0!==l?l:"{}"),h=(0,n.injectReferences)(g,a),v=o?o.ui.getTagIdsFromReferences(a):void 0,p=d?h:await i(h);return(0,c.Hd)(e,t,v,a,p,r,Boolean(s),d)},d="search",l=async({title:e,isTitleDuplicateConfirmed:t,onTitleDuplicate:a,contentManagement:r})=>{if(e&&!t&&a&&await(async(e,t)=>{if(e)return(await t.search({contentTypeId:d,query:{text:`"${e}"`},options:{searchFields:["title"],fields:["title"]}})).hits.some((t=>t.attributes.title.toLowerCase()===e.toLowerCase()))})(e,r))return a(),Promise.reject(new Error(`Saved Discover session title already exists: ${e}`))};var u=a(787);const g=({spaces:e,savedObjectsTaggingOss:t,search:a,contentManagement:r})=>({spaces:e,savedObjectsTagging:null==t?void 0:t.getTaggingApi(),searchSourceCreate:a.searchSource.create,getSavedSrch:e=>r.get({contentTypeId:u.SE,id:e})}),h=e=>{var t;const{references:a,...r}=e;return{references:a,attributes:{...r,description:null!==(t=r.description)&&void 0!==t?t:""}}};var v=a(915);class SavedSearchesService{constructor(e){(0,v.default)(this,"get",((e,t)=>(async(e,t,a)=>{const n=await(async(e,{spaces:t,getSavedSrch:a})=>{const n=await a(e);if(n.error)throw new Error(`Could not locate that Discover session (id: ${e})`);var i;if("conflict"===n.meta.outcome)throw new Error(await(async e=>r.i18n.translate("savedSearch.legacyURLConflict.errorMessage",{defaultMessage:"This Discover session has the same URL as a legacy alias. Disable the alias to resolve this error : {json}",values:{json:e}}))(JSON.stringify({targetType:s.SavedSearchType,sourceId:e,targetSpace:null===(i=await(null==t?void 0:t.getActiveSpace()))||void 0===i?void 0:i.id})));return n})(e,t);return await o({savedSearchId:e,attributes:n.item.attributes,references:n.item.references,sharingSavedObjectProps:n.meta,managed:n.item.managed},t,a)})(e,g(this.deps),t))),(0,v.default)(this,"getAll",(async()=>{const{contentManagement:e}=this.deps;return(await e.search({contentTypeId:s.SavedSearchType,query:{}})).hits})),(0,v.default)(this,"getNew",(()=>(({searchSource:e})=>({searchSource:e.createEmpty(),managed:!1}))({searchSource:this.deps.search.searchSource}))),(0,v.default)(this,"find",(async e=>{const{contentManagement:t}=this.deps;return(await t.search({contentTypeId:s.SavedSearchType,query:{text:e},options:{searchFields:["title"],fields:["title"]}})).hits})),(0,v.default)(this,"save",((e,t={})=>{const{contentManagement:a,savedObjectsTaggingOss:r}=this.deps;return(async(e,t,a,r)=>{var s;const n=t.copyOnSave||!e.id;if(n)try{await l({title:e.title,isTitleDuplicateConfirmed:t.isTitleDuplicateConfirmed,onTitleDuplicate:t.onTitleDuplicate,contentManagement:a})}catch{return}const{searchSourceJSON:i,references:o}=e.searchSource.serialize(),u=r?r.ui.updateTagsReferences(o,null!==(s=e.tags)&&void 0!==s?s:[]):o;return(async(e,t,a,r)=>(e?await r.update({contentTypeId:d,id:e,data:t,options:{references:a}}):await r.create({contentTypeId:d,data:t,options:{references:a}})).item.id)(n?void 0:e.id,(0,c.Yw)(e,i),u,a)})(e,t,a,null==r?void 0:r.getTaggingApi())})),this.deps=e}}class SavedSearchPublicPlugin{setup({getStartServices:e},{contentManagement:t,expressions:a,embeddable:n}){return t.registry.register({id:s.SavedSearchType,version:{latest:s.LATEST_VERSION},name:r.i18n.translate("savedSearch.contentManagementType",{defaultMessage:"Discover session"})}),a.registerFunction(function({getStartServices:e}){return(0,s.getKibanaContextFn)((async()=>{const[,,{get:t}]=await e();return{getSavedSearch:t}}))}({getStartServices:e})),a.registerType(i),{}}start(e,{data:{search:t},spaces:a,savedObjectsTaggingOss:r,contentManagement:{client:s},embeddable:n}){const i={search:t,spaces:a,savedObjectsTaggingOss:r,contentManagement:s,embeddable:n},c=new SavedSearchesService(i);return{get:(e,t)=>c.get(e,t),getAll:()=>c.getAll(),getNew:()=>c.getNew(),save:(e,t)=>c.save(e,t),checkForDuplicateTitle:e=>l({title:e.newTitle,isTitleDuplicateConfirmed:e.isTitleDuplicateConfirmed,onTitleDuplicate:e.onTitleDuplicate,contentManagement:i.contentManagement}),byValueToSavedSearch:async(e,t)=>await(async(e,t,a)=>{var r;const{sharingSavedObjectProps:s,managed:n}=null!==(r=e.metaInfo)&&void 0!==r?r:{};return await o({...h(e.attributes),savedSearchId:void 0,sharingSavedObjectProps:s,managed:n},g(t),a)})(e,i,t)}}}function p(){return new SavedSearchPublicPlugin}},871:(e,t,a)=>{a.p=window.__kbnPublicPath__.savedSearch},195:(e,t,a)=>{a.r(t);var r=__kbnBundles__.get("plugin/data/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},876:(e,t,a)=>{a.r(t);var r=__kbnBundles__.get("plugin/expressions/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},915:(e,t,a)=>{e.exports=a(497)(67493)},8:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18n},770:e=>{"use strict";e.exports=__kbnSharedDeps__.Lodash},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},t={};function a(r){var s=t[r];if(void 0!==s)return s.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,a),n.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var s=r.length-1;s>-1&&(!e||!/^http(s?):/.test(e));)e=r[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),a(871),__kbnBundles__.define("plugin/savedSearch/public",a,207),__kbnBundles__.define("plugin/savedSearch/common",a,410)})();