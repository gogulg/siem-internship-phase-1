/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */(()=>{var e={563:(e,t,r)=>{"use strict";r.r(t),r.d(t,{DashboardEnhancedAbstractDashboardDrilldown:()=>AbstractDashboardDrilldown,plugin:()=>Y});var a=r(915),o=r(546),n=r(215),i=r(373);const s=__kbnSharedDeps__.KbnI18n,d=__kbnSharedDeps__.React;var l=r.n(d);const c=__kbnSharedDeps__.ReactDom;var u=r.n(c);const p=__kbnSharedDeps__.KbnReactKibanaContextRender,h=__kbnSharedDeps__.EmotionReact,b=(e,t)=>r=>(u().render((0,h.jsx)(p.KibanaRenderContextProvider,t,e),r),()=>u().unmountComponentAtNode(r));d.Component;const g=__kbnSharedDeps__.Rxjs;r(513);const f=e=>Boolean(e&&void 0!==(null==e?void 0:e.parentApi)),v=e=>Boolean(e&&void 0!==(null==e?void 0:e.viewMode$)),_=e=>v(e)||f(e)&&v(e.parentApi),D=e=>v(e)?e.viewMode$.getValue():f(e)&&v(e.parentApi)?e.parentApi.viewMode$.getValue():void 0,m=__kbnSharedDeps__.KbnEsQuery,y=e=>Boolean(e&&"function"==typeof e.supportedTriggers),w=e=>Boolean(null==e?void 0:e.children$),O=e=>Boolean(e&&e.openOverlay&&e.clearOverlays);var I=r(839),C=r(627);function E(e){return e.includes(C.APPLY_FILTER_TRIGGER)||!e.includes(o.VALUE_CLICK_TRIGGER)&&!e.includes(o.SELECT_RANGE_TRIGGER)?e:[...e,C.APPLY_FILTER_TRIGGER]}const A=e=>{const t=e.parentApi;if(!(e=>Boolean((e=>"function"==typeof(null==e?void 0:e.addNewPanel))(e)&&"function"==typeof(null==e?void 0:e.removePanel)&&"function"==typeof(null==e?void 0:e.replacePanel)&&"function"==typeof(null==e?void 0:e.addNewPanel)&&w(e)))(t))return[];const r=[];for(const c of Object.keys(t.children$.value)){const u=t.children$.value[c];if(c===e.uuid)continue;if(!(0,i.apiHasDynamicActions)(u))continue;const p=u.enhancements.dynamicActions.state.get().events;for(const e of p){var a,o;const t={id:e.eventId,name:e.action.name,icon:"dashboardApp",description:null!==(a=null!==(n=u,void 0,void 0,l=void 0,o=null!==(s=null===(d=n.title$)||void 0===d?void 0:d.value)&&void 0!==s?s:null===(l=n.defaultTitle$)||void 0===l?void 0:l.value)&&void 0!==o?o:u.uuid)&&void 0!==a?a:"",config:e.action.config,factoryId:e.action.factoryId,triggers:e.triggers};r.push(t)}}var n,s,d,l;return r},S={id:"drilldown",order:3},T="OPEN_FLYOUT_ADD_DRILLDOWN",R=e=>(0,i.apiHasDynamicActions)(e)&&f(e)&&_(e)&&y(e);class FlyoutCreateDrilldownAction{constructor(e){(0,a.default)(this,"type",T),(0,a.default)(this,"id",T),(0,a.default)(this,"order",12),(0,a.default)(this,"grouping",[S]),this.params=e}getDisplayName(){return s.i18n.translate("xpack.dashboard.FlyoutCreateDrilldownAction.displayName",{defaultMessage:"Create drilldown"})}getIconType(){return"plusInCircle"}async isCompatible({embeddable:e}){if(!R(e))return!1;if("edit"!==D(e)||(t=e.parentApi,!Boolean(t&&t.type)||"dashboard"!==t.type))return!1;var t;const r=[o.CONTEXT_MENU_TRIGGER,...e.supportedTriggers()],a=this.params.start().plugins.uiActionsEnhanced.getActionFactories().map((e=>e.isCompatibleLicense()?e.supportedTriggers():[])).reduce(((e,t)=>e.concat(t)),[]);return E(r).some((e=>a.includes(e)))}async execute({embeddable:e}){if(!R(e))throw new I.IncompatibleActionError;const{core:t,plugins:r}=this.params.start(),a=A(e),n=O(e.parentApi)?e.parentApi:void 0,i=()=>{n&&n.clearOverlays(),d.close()},s=[...E(e.supportedTriggers()),o.CONTEXT_MENU_TRIGGER],d=t.overlays.openFlyout(b((0,h.jsx)(r.uiActionsEnhanced.DrilldownManager,{closeAfterCreate:!0,initialRoute:"/new",dynamicActionManager:e.enhancements.dynamicActions,triggers:s,placeContext:{embeddable:e},templates:a,onClose:i}),t),{maxWidth:500,ownFocus:!0,"data-test-subj":"createDrilldownFlyout",onClose:()=>{i()}});null==n||n.openOverlay(d)}}const j=s.i18n.translate("xpack.dashboard.panel.openFlyoutEditDrilldown.displayName",{defaultMessage:"Manage drilldowns"}),x=__kbnSharedDeps__.ElasticEui,P=({context:{embeddable:e}})=>{const t=(e=>{const t=(0,d.useRef)(!0),[r,a]=(0,d.useState)(null==e?void 0:e.getValue());return(0,d.useEffect)((()=>{if(t.current?t.current=!1:a(null==e?void 0:e.getValue()),!e)return;const r=e.pipe((0,g.skip)(1)).subscribe((e=>a(e)));return()=>r.unsubscribe()}),[e]),r})(e.dynamicActionsState$),r=(0,d.useMemo)((()=>{var e,r;return(null!==(e=null==t||null===(r=t.dynamicActions)||void 0===r?void 0:r.events)&&void 0!==e?e:[]).length}),[t]);return(0,h.jsx)(x.EuiFlexGroup,{alignItems:"center"},(0,h.jsx)(x.EuiFlexItem,{grow:!0},j),r>0&&(0,h.jsx)(x.EuiFlexItem,{grow:!1},(0,h.jsx)(x.EuiNotificationBadge,null,r)))},L="OPEN_FLYOUT_EDIT_DRILLDOWN",F=e=>(0,i.apiHasDynamicActions)(e)&&_(e)&&y(e);class FlyoutEditDrilldownAction{constructor(e){(0,a.default)(this,"type",L),(0,a.default)(this,"id",L),(0,a.default)(this,"order",10),(0,a.default)(this,"grouping",[S]),(0,a.default)(this,"MenuItem",P),this.params=e}getDisplayName(){return j}getIconType(){return"list"}async isCompatible({embeddable:e}){var t,r;return!(!F(e)||"edit"!==D(e))&&(null!==(t=null===(r=e.dynamicActionsState$.getValue())||void 0===r?void 0:r.dynamicActions.events)&&void 0!==t?t:[]).length>0}async execute({embeddable:e}){if(!F(e))throw new I.IncompatibleActionError;const{core:t,plugins:r}=this.params.start(),a=A(e),n=O(e.parentApi)?e.parentApi:void 0,i=()=>{n&&n.clearOverlays(),s.close()},s=t.overlays.openFlyout(b((0,h.jsx)(r.uiActionsEnhanced.DrilldownManager,{initialRoute:"/manage",dynamicActionManager:e.enhancements.dynamicActions,triggers:[...E(e.supportedTriggers()),o.CONTEXT_MENU_TRIGGER],placeContext:{embeddable:e},templates:a,onClose:i}),t),{maxWidth:500,ownFocus:!0,"data-test-subj":"editDrilldownFlyout",onClose:()=>{i()}});null==n||n.openOverlay(s)}}var N=r(961),k=r(930),M=r(185),G=r(704);const B=__kbnSharedDeps__.Lodash,U=s.i18n.translate("xpack.dashboard.components.DashboardDrilldownConfig.chooseDestinationDashboard",{defaultMessage:"Choose destination dashboard"}),$=(0,G.withSuspense)(G.DashboardDrilldownOptionsComponent,null),H=({dashboards:e,onDashboardSelect:t,onSearchChange:r,isLoading:a,error:o,config:n,onConfigChange:i})=>{var s;const d=(null===(s=e.find((e=>e.value===n.dashboardId)))||void 0===s?void 0:s.label)||"";return(0,h.jsx)(l().Fragment,null,(0,h.jsx)(x.EuiFormRow,{label:U,fullWidth:!0,isInvalid:!!o,error:o},(0,h.jsx)(x.EuiComboBox,{async:!0,selectedOptions:n.dashboardId?[{label:d,value:n.dashboardId}]:[],options:e,onChange:([{value:e=""}={value:""}])=>t(e),onSearchChange:r,isLoading:a,singleSelection:{asPlainText:!0},fullWidth:!0,"data-test-subj":"dashboardDrilldownSelectDashboard",isInvalid:!!o})),(0,h.jsx)($,{options:n,onOptionChange:i}))},K=(e,t)=>t&&-1===(0,B.findIndex)(e,{value:t.value})?[t,...e]:e,W=e=>({value:e.id,label:e.attributes.title});class CollectConfigContainer extends l().Component{constructor(e){super(e),(0,a.default)(this,"isMounted",!0),(0,a.default)(this,"state",{dashboards:[],isLoading:!1,searchString:void 0,selectedDashboard:void 0,error:void 0}),(0,a.default)(this,"debouncedLoadDashboards",void 0),this.debouncedLoadDashboards=(0,B.debounce)(this.loadDashboards.bind(this),500)}componentDidMount(){this.loadSelectedDashboard(),this.loadDashboards()}componentWillUnmount(){this.isMounted=!1}render(){const{config:e,onConfig:t}=this.props,{dashboards:r,selectedDashboard:a,isLoading:o,error:n}=this.state;return(0,h.jsx)(H,{dashboards:K(r,a),isLoading:o,error:n,onDashboardSelect:r=>{t({...e,dashboardId:r}),this.state.error&&this.setState({error:void 0})},onSearchChange:this.debouncedLoadDashboards,config:e,onConfigChange:r=>{t({...e,...r})}})}async loadSelectedDashboard(){var e;const{config:t,params:{start:r}}=this.props;if(!t.dashboardId)return;const a=await r().core.savedObjects.client.get("dashboard",t.dashboardId);var o;return this.isMounted?404===(null===(e=a.error)||void 0===e?void 0:e.statusCode)?(this.setState({error:(o=t.dashboardId,s.i18n.translate("xpack.dashboard.drilldown.errorDestinationDashboardIsMissing",{defaultMessage:"Destination dashboard (''{dashboardId}'') no longer exists. Choose another dashboard.",values:{dashboardId:o}}))}),void this.props.onConfig({...t,dashboardId:void 0})):a.error?(this.setState({error:a.error.message}),void this.props.onConfig({...t,dashboardId:void 0})):void this.setState({selectedDashboard:W(a)}):void 0}async loadDashboards(e){this.setState({searchString:e,isLoading:!0});const t=this.props.params.start().core.savedObjects.client,{savedObjects:r}=await t.find({type:"dashboard",search:e?`${e}*`:void 0,searchFields:["title^3","description"],defaultSearchOperator:"AND",perPage:100});if(!this.isMounted)return;if(e!==this.state.searchString)return;const a=r.map(W);this.setState({dashboards:a,isLoading:!1})}}const V=s.i18n.translate("xpack.dashboard.drilldown.goToDashboard",{defaultMessage:"Go to Dashboard"});class AbstractDashboardDrilldown{constructor(e){(0,a.default)(this,"order",100),(0,a.default)(this,"getDisplayName",(()=>V)),(0,a.default)(this,"euiIcon","dashboardApp"),(0,a.default)(this,"ReactCollectConfig",void 0),(0,a.default)(this,"CollectConfig",void 0),(0,a.default)(this,"createConfig",(()=>({dashboardId:"",...G.DEFAULT_DASHBOARD_DRILLDOWN_OPTIONS}))),(0,a.default)(this,"isConfigValid",(e=>!!e.dashboardId)),(0,a.default)(this,"getHref",(async(e,t)=>{const{app:r,path:a}=await this.getLocation(e,t,!0);return await this.params.start().core.application.getUrlForApp(r,{path:a,absolute:!0})})),(0,a.default)(this,"execute",(async(e,t)=>{if(e.openInNewTab)window.open(await this.getHref(e,t),"_blank");else{const{app:r,path:a,state:o}=await this.getLocation(e,t,!1);await this.params.start().core.application.navigateToApp(r,{path:a,state:o})}})),this.params=e,this.ReactCollectConfig=e=>(0,h.jsx)(CollectConfigContainer,(0,M.default)({},e,{params:this.params})),this.CollectConfig=this.ReactCollectConfig}get locator(){const e=this.params.start().plugins.dashboard.locator;if(!e)throw new Error("Dashboard locator is required for dashboard drilldown.");return e}}const X=(e,t)=>`drilldown:${t}:${e.eventId}:dashboardId`;class EmbeddableToDashboardDrilldown extends AbstractDashboardDrilldown{constructor(...e){super(...e),(0,a.default)(this,"id","DASHBOARD_TO_DASHBOARD_DRILLDOWN"),(0,a.default)(this,"supportedTriggers",(()=>[C.APPLY_FILTER_TRIGGER,k.IMAGE_CLICK_TRIGGER])),(0,a.default)(this,"inject",(({drilldownId:e})=>(t,r)=>{const a=t.action,o=X(t,e),n=r.find((e=>e.name===o));return n?n.id&&n.id===a.config.dashboardId?t:((e,t)=>({...e,action:{...e.action,config:{...e.action.config,dashboardId:t}}}))(t,n.id):t})({drilldownId:this.id})),(0,a.default)(this,"extract",(({drilldownId:e})=>t=>{const r=t.action,a=r.config.dashboardId?[{name:X(t,e),type:"dashboard",id:r.config.dashboardId}]:[],{dashboardId:o,...n}=r.config;return{state:{...t,action:{...t.action,config:n}},references:a}})({drilldownId:this.id}))}async getLocation(e,t,r){let a={dashboardId:e.dashboardId};t.embeddable&&(a={...a,...(0,N.getDashboardLocatorParamsFromEmbeddable)(t.embeddable,e)});const{restOfFilters:o,timeRange:n}=(0,m.extractTimeRange)(t.filters,t.timeFieldName);var i;o&&(a.filters=[...null!==(i=a.filters)&&void 0!==i?i:[],...o]),n&&(a.timeRange=n);const s=await this.locator.getLocation(a);return r&&this.useUrlForState(s),s}useUrlForState(e){var t;const r=e.state;e.path=(0,n.setStateToKbnUrl)("_a",(0,N.cleanEmptyKeys)({query:r.query,filters:null===(t=r.filters)||void 0===t?void 0:t.filter((e=>!(0,m.isFilterPinned)(e)))}),{useHash:!1,storeInHashQuery:!0},e.path)}}class DashboardDrilldownsService{bootstrap(e,t,{enableDrilldowns:r}){r&&this.setupDrilldowns(e,t)}setupDrilldowns(e,{uiActionsEnhanced:t}){const r=(0,n.createStartServicesGetter)(e.getStartServices),a=new FlyoutCreateDrilldownAction({start:r});t.addTriggerAction(o.CONTEXT_MENU_TRIGGER,a);const i=new FlyoutEditDrilldownAction({start:r});t.addTriggerAction(o.CONTEXT_MENU_TRIGGER,i);const s=new EmbeddableToDashboardDrilldown({start:r});t.registerDrilldown(s)}}class DashboardEnhancedPlugin{constructor(e){(0,a.default)(this,"drilldowns",new DashboardDrilldownsService),this.context=e}setup(e,t){return this.drilldowns.bootstrap(e,t,{enableDrilldowns:!0}),{}}start(e,t){return{}}stop(){}}function Y(e){return new DashboardEnhancedPlugin(e)}},513:e=>{"use strict";e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var a,o,n;if(Array.isArray(t)){if((a=t.length)!=r.length)return!1;for(o=a;0!=o--;)if(!e(t[o],r[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((a=(n=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(o=a;0!=o--;)if(!Object.prototype.hasOwnProperty.call(r,n[o]))return!1;for(o=a;0!=o--;){var i=n[o];if(!e(t[i],r[i]))return!1}return!0}return t!=t&&r!=r}},689:(e,t,r)=>{r.p=window.__kbnPublicPath__.dashboardEnhanced},961:(e,t,r)=>{r.r(t);var a=__kbnBundles__.get("plugin/dashboard/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},627:(e,t,r)=>{r.r(t);var a=__kbnBundles__.get("plugin/data/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},373:(e,t,r)=>{r.r(t);var a=__kbnBundles__.get("plugin/embeddableEnhanced/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},546:(e,t,r)=>{r.r(t);var a=__kbnBundles__.get("plugin/embeddable/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},930:(e,t,r)=>{r.r(t);var a=__kbnBundles__.get("plugin/imageEmbeddable/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},215:(e,t,r)=>{r.r(t);var a=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},704:(e,t,r)=>{r.r(t);var a=__kbnBundles__.get("plugin/presentationUtil/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},839:(e,t,r)=>{r.r(t);var a=__kbnBundles__.get("plugin/uiActions/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},185:(e,t,r)=>{e.exports=r(497)(51858)},915:(e,t,r)=>{e.exports=r(497)(67493)},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},t={};function r(a){var o=t[a];if(void 0!==o)return o.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");if(a.length)for(var o=a.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=a[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),r(689),__kbnBundles__.define("plugin/dashboardEnhanced/public",r,563)})();